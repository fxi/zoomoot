import Fa,{isWebCodecsSupported as Ra}from"https://unpkg.com/mp4-wasm@1.0.6";const Ba=function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))b(S);new MutationObserver(S=>{for(const E of S)if(E.type==="childList")for(const M of E.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&b(M)}).observe(document,{childList:!0,subtree:!0});function y(S){const E={};return S.integrity&&(E.integrity=S.integrity),S.referrerpolicy&&(E.referrerPolicy=S.referrerpolicy),S.crossorigin==="use-credentials"?E.credentials="include":S.crossorigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function b(S){if(S.ep)return;S.ep=!0;const E=y(S);fetch(S.href,E)}};Ba();const xe={listeners:[],debug:!0,interval:null};function Ee(A){var p;xe.interval||(xe.interval=setInterval(Na,1e4),window.el_config=xe);var y=document.createElement(A);return[].slice.call(arguments,1).forEach(S=>{An(S)&&!Vi(S)&&Object.keys(S).forEach(E=>{p=S[E],E==="on"&&Vi(p)&&zi(p[0])&&Fr(p[1])?(y.addEventListener(p[0],p[1]),y.dataset.el_id_listener=Math.random().toString(32),xe.listeners.push({target:y,tagName:p[0],listener:p[1]})):E==="on"&&An(p)?Object.keys(p).forEach(M=>{Fr(p[M])&&(y.addEventListener(M,p[M]),y.dataset.el_id_listener=Math.random().toString(32),xe.listeners.push({target:y,tagName:M,listener:p[M]}))}):E==="innerText"&&zi(p)?y.innerText=p:E!=="dataset"&&E!=="style"||!An(p)?E==="class"&&Vi(p)?p.forEach(M=>y.classList.add(M)):A==="input"&&E==="checked"&&S.type==="checkbox"?y.checked=p===!0:y.setAttribute(E,S[E]):Object.keys(p).forEach(M=>{y[E][M]=p[M]})}),Vi(S)&&S.forEach(E=>{Rr(E)&&y.appendChild(E)}),Rr(S)&&y.appendChild(S),Va(S)?S.then(b):b(S)}),y;function b(S){ja(S)||A==="style"?y.innerHTML=S:zi(S)&&(y.innerText=S)}}function An(A){return!!A&&typeof A=="object"&&!Array.isArray(A)}function Vi(A){return!!A&&typeof A=="object"&&Array.isArray(A)}function ja(A){return zi(A)&&/(<([^>]+)>)/i.test(A)}function Va(A){return A instanceof Promise}function zi(A){return typeof A=="string"}function Fr(A){return A instanceof Function}function Rr(A){return A instanceof Element}function Na(){let A=xe.listeners.length;if(!(A<1))for(;--A;){const p=xe.listeners[A];if(!p)return;document.body.querySelector('[data-el_id_listener="'+p.target.dataset.el_id_listener+'"]')||(xe.listeners.pop(),p.target.removeEventListener(p.tagName,p.listener))}}var bi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function za(A){var p=A.default;if(typeof p=="function"){var y=function(){return p.apply(this,arguments)};y.prototype=p.prototype}else y={};return Object.defineProperty(y,"__esModule",{value:!0}),Object.keys(A).forEach(function(b){var S=Object.getOwnPropertyDescriptor(A,b);Object.defineProperty(y,b,S.get?S:{enumerable:!0,get:function(){return A[b]}})}),y}var In={exports:{}};/*! Tweakpane 3.1.0 (c) 2016 cocopon, licensed under the MIT license. */(function(A,p){(function(y,b){b(p)})(bi,function(y){class b{constructor(t){const[c,m]=t.split("-"),x=c.split(".");this.major=parseInt(x[0],10),this.minor=parseInt(x[1],10),this.patch=parseInt(x[2],10),this.prerelease=m!=null?m:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[t,this.prerelease].join("-"):t}}class S{constructor(t){this.controller_=t}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(t){this.controller_.viewProps.set("hidden",t)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class E{constructor(t){this.target=t}}class M extends E{constructor(t,c,m,x){super(t),this.value=c,this.presetKey=m,this.last=x!=null?x:!0}}class d extends E{constructor(t,c,m){super(t),this.value=c,this.presetKey=m}}class i extends E{constructor(t,c){super(t),this.expanded=c}}class a extends E{constructor(t,c){super(t),this.index=c}}function l(f){return f}function e(f){return f==null}function r(f,t){if(f.length!==t.length)return!1;for(let c=0;c<f.length;c++)if(f[c]!==t[c])return!1;return!0}const n={alreadydisposed:()=>"View has been already disposed",invalidparams:f=>`Invalid parameters for '${f.name}'`,nomatchingcontroller:f=>`No matching controller for '${f.key}'`,nomatchingview:f=>`No matching view for '${JSON.stringify(f.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:f=>`Property '${f.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class o{constructor(t){var c;this.message=(c=n[t.type](t.context))!==null&&c!==void 0?c:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}static alreadyDisposed(){return new o({type:"alreadydisposed"})}static notBindable(){return new o({type:"notbindable"})}static propertyNotFound(t){return new o({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new o({type:"shouldneverhappen"})}}class u{constructor(t,c,m){this.obj_=t,this.key_=c,this.presetKey_=m!=null?m:c}static isBindable(t){return!(t===null||typeof t!="object")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(t){this.obj_[this.key_]=t}writeProperty(t,c){const m=this.read();if(!u.isBindable(m))throw o.notBindable();if(!(t in m))throw o.propertyNotFound(t);m[t]=c}}class s extends S{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get title(){var t;return(t=this.controller_.valueController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.valueController.props.set("title",t)}on(t,c){const m=c.bind(this);return this.controller_.valueController.emitter.on(t,()=>{m(new E(this))}),this}}class h{constructor(){this.observers_={}}on(t,c){let m=this.observers_[t];return m||(m=this.observers_[t]=[]),m.push({handler:c}),this}off(t,c){const m=this.observers_[t];return m&&(this.observers_[t]=m.filter(x=>x.handler!==c)),this}emit(t,c){const m=this.observers_[t];!m||m.forEach(x=>{x.handler(c)})}}const g="tp";function v(f){return(c,m)=>[g,"-",f,"v",c?`_${c}`:"",m?`-${m}`:""].join("")}function _(f,t){return c=>t(f(c))}function w(f){return f.rawValue}function C(f,t){f.emitter.on("change",_(w,t)),t(f.rawValue)}function P(f,t,c){C(f.value(t),c)}function D(f,t,c){c?f.classList.add(t):f.classList.remove(t)}function I(f,t){return c=>{D(f,t,c)}}function N(f,t){C(f,c=>{t.textContent=c!=null?c:""})}const H=v("btn");class K{constructor(t,c){this.element=t.createElement("div"),this.element.classList.add(H()),c.viewProps.bindClassModifiers(this.element);const m=t.createElement("button");m.classList.add(H("b")),c.viewProps.bindDisabled(m),this.element.appendChild(m),this.buttonElement=m;const x=t.createElement("div");x.classList.add(H("t")),N(c.props.value("title"),x),this.buttonElement.appendChild(x)}}class J{constructor(t,c){this.emitter=new h,this.onClick_=this.onClick_.bind(this),this.props=c.props,this.viewProps=c.viewProps,this.view=new K(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Q{constructor(t,c){var m;this.constraint_=c==null?void 0:c.constraint,this.equals_=(m=c==null?void 0:c.equals)!==null&&m!==void 0?m:(x,j)=>x===j,this.emitter=new h,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,c){const m=c!=null?c:{forceEmit:!1,last:!0},x=this.constraint_?this.constraint_.constrain(t):t;!!this.equals_(this.rawValue_,x)&&!m.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=x,this.emitter.emit("change",{options:m,rawValue:x,sender:this}))}}class tt{constructor(t){this.emitter=new h,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,c){const m=c!=null?c:{forceEmit:!1,last:!0};this.value_===t&&!m.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:m,rawValue:this.value_,sender:this}))}}function dt(f,t){const c=t==null?void 0:t.constraint,m=t==null?void 0:t.equals;return!c&&!m?new tt(f):new Q(f,t)}class rt{constructor(t){this.emitter=new h,this.valMap_=t;for(const c in this.valMap_)this.valMap_[c].emitter.on("change",()=>{this.emitter.emit("change",{key:c,sender:this})})}static createCore(t){return Object.keys(t).reduce((m,x)=>Object.assign(m,{[x]:dt(t[x])}),{})}static fromObject(t){const c=this.createCore(t);return new rt(c)}get(t){return this.valMap_[t].rawValue}set(t,c){this.valMap_[t].rawValue=c}value(t){return this.valMap_[t]}}function _t(f,t){const m=Object.keys(t).reduce((x,j)=>{if(x===void 0)return;const $=t[j],vt=$(f[j]);return vt.succeeded?Object.assign(Object.assign({},x),{[j]:vt.value}):void 0},{});return m}function T(f,t){return f.reduce((c,m)=>{if(c===void 0)return;const x=t(m);if(!(!x.succeeded||x.value===void 0))return[...c,x.value]},[])}function B(f){return f===null?!1:typeof f=="object"}function R(f){return t=>c=>{if(!t&&c===void 0)return{succeeded:!1,value:void 0};if(t&&c===void 0)return{succeeded:!0,value:void 0};const m=f(c);return m!==void 0?{succeeded:!0,value:m}:{succeeded:!1,value:void 0}}}function V(f){return{custom:t=>R(t)(f),boolean:R(t=>typeof t=="boolean"?t:void 0)(f),number:R(t=>typeof t=="number"?t:void 0)(f),string:R(t=>typeof t=="string"?t:void 0)(f),function:R(t=>typeof t=="function"?t:void 0)(f),constant:t=>R(c=>c===t?t:void 0)(f),raw:R(t=>t)(f),object:t=>R(c=>{if(!!B(c))return _t(c,t)})(f),array:t=>R(c=>{if(!!Array.isArray(c))return T(c,t)})(f)}}const G={optional:V(!0),required:V(!1)};function F(f,t){const c=G.required.object(t)(f);return c.succeeded?c.value:void 0}function k(f){return f&&f.parentElement&&f.parentElement.removeChild(f),null}function X(){return["veryfirst","first","last","verylast"]}const Z=v(""),st={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class et{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const c=this.view.element;this.blade.value("positions").emitter.on("change",()=>{X().forEach(m=>{c.classList.remove(Z(void 0,st[m]))}),this.blade.get("positions").forEach(m=>{c.classList.add(Z(void 0,st[m]))})}),this.viewProps.handleDispose(()=>{k(c)})}get parent(){return this.parent_}}const lt="http://www.w3.org/2000/svg";function ft(f){f.offsetHeight}function yt(f,t){const c=f.style.transition;f.style.transition="none",t(),f.style.transition=c}function it(f){return f.ontouchstart!==void 0}function q(){return new Function("return this")()}function ot(){return q().document}function ht(f){const t=f.ownerDocument.defaultView;return t&&"document"in t?f.getContext("2d"):null}const nt={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function ut(f,t){const c=f.createElementNS(lt,"svg");return c.innerHTML=nt[t],c}function wt(f,t,c){f.insertBefore(t,f.children[c])}function Pt(f){f.parentElement&&f.parentElement.removeChild(f)}function Ct(f){for(;f.children.length>0;)f.removeChild(f.children[0])}function ct(f){for(;f.childNodes.length>0;)f.removeChild(f.childNodes[0])}function xt(f){return f.relatedTarget?f.relatedTarget:"explicitOriginalTarget"in f?f.explicitOriginalTarget:null}const Tt=v("lbl");function Mt(f,t){const c=f.createDocumentFragment();return t.split(`
`).map(x=>f.createTextNode(x)).forEach((x,j)=>{j>0&&c.appendChild(f.createElement("br")),c.appendChild(x)}),c}class jt{constructor(t,c){this.element=t.createElement("div"),this.element.classList.add(Tt()),c.viewProps.bindClassModifiers(this.element);const m=t.createElement("div");m.classList.add(Tt("l")),P(c.props,"label",j=>{e(j)?this.element.classList.add(Tt(void 0,"nol")):(this.element.classList.remove(Tt(void 0,"nol")),ct(m),m.appendChild(Mt(t,j)))}),this.element.appendChild(m),this.labelElement=m;const x=t.createElement("div");x.classList.add(Tt("v")),this.element.appendChild(x),this.valueElement=x}}class At extends et{constructor(t,c){const m=c.valueController.viewProps;super(Object.assign(Object.assign({},c),{view:new jt(t,{props:c.props,viewProps:m}),viewProps:m})),this.props=c.props,this.valueController=c.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Ht={id:"button",type:"blade",accept(f){const t=G,c=F(f,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return c?{params:c}:null},controller(f){return new At(f.document,{blade:f.blade,props:rt.fromObject({label:f.params.label}),valueController:new J(f.document,{props:rt.fromObject({title:f.params.title}),viewProps:f.viewProps})})},api(f){return!(f.controller instanceof At)||!(f.controller.valueController instanceof J)?null:new s(f.controller)}};class Vt extends et{constructor(t){super(t),this.value=t.value}}function Kt(){return new rt({positions:dt([],{equals:r})})}class $t extends rt{constructor(t){super(t)}static create(t){const c={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},m=rt.createCore(c);return new $t(m)}get styleExpanded(){var t;return(t=this.get("temporaryExpanded"))!==null&&t!==void 0?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!e(t)?`${t}px`:"auto"}bindExpandedClass(t,c){const m=()=>{this.styleExpanded?t.classList.add(c):t.classList.remove(c)};P(this,"expanded",m),P(this,"temporaryExpanded",m)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function qt(f,t){let c=0;return yt(t,()=>{f.set("expandedHeight",null),f.set("temporaryExpanded",!0),ft(t),c=t.clientHeight,f.set("temporaryExpanded",null),ft(t)}),c}function Pe(f,t){t.style.height=f.styleHeight}function ae(f,t){f.value("expanded").emitter.on("beforechange",()=>{f.set("completed",!1),e(f.get("expandedHeight"))&&f.set("expandedHeight",qt(f,t)),f.set("shouldFixHeight",!0),ft(t)}),f.emitter.on("change",()=>{Pe(f,t)}),Pe(f,t),t.addEventListener("transitionend",c=>{c.propertyName==="height"&&f.cleanUpTransition()})}class Te extends S{constructor(t,c){super(t),this.rackApi_=c}}function Qe(f,t){return f.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}function ti(f,t){return f.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}function yi(f,t){const c=t!=null?t:{};return f.addBlade(Object.assign(Object.assign({},c),{view:"separator"}))}function Xi(f,t){return f.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}class ee{constructor(t){this.emitter=new h,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const c of this.allItems())if(t(c))return c;return null}includes(t){return this.cache_.has(t)}add(t,c){if(this.includes(t))throw o.shouldNeverHappen();const m=c!==void 0?c:this.items_.length;this.items_.splice(m,0,t),this.cache_.add(t);const x=this.extract_(t);x&&(x.emitter.on("add",this.onSubListAdd_),x.emitter.on("remove",this.onSubListRemove_),x.allItems().forEach(j=>{this.cache_.add(j)})),this.emitter.emit("add",{index:m,item:t,root:this,target:this})}remove(t){const c=this.items_.indexOf(t);if(c<0)return;this.items_.splice(c,1),this.cache_.delete(t);const m=this.extract_(t);m&&(m.emitter.off("add",this.onSubListAdd_),m.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:c,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}class ei extends S{constructor(t){super(t),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new h,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,c){const m=c.bind(this);return this.emitter_.on(t,x=>{m(x.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(t){const c=t.sender.target.read();this.emitter_.emit("change",{event:new M(this,c,this.controller_.binding.target.presetKey,t.options.last)})}}class ie extends At{constructor(t,c){super(t,c),this.binding=c.binding}}class Ve extends S{constructor(t){super(t),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new h,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,c){const m=c.bind(this);return this.emitter_.on(t,x=>{m(x.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(t){const c=t.sender.target.read();this.emitter_.emit("update",{event:new d(this,c,this.controller_.binding.target.presetKey)})}}class le extends At{constructor(t,c){super(t,c),this.binding=c.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Ui(f){return f instanceof Ne?f.apiSet_:f instanceof Te?f.rackApi_.apiSet_:null}function Oe(f,t){const c=f.find(m=>m.controller_===t);if(!c)throw o.shouldNeverHappen();return c}function Ci(f,t,c){if(!u.isBindable(f))throw o.notBindable();return new u(f,t,c)}class Ne extends S{constructor(t,c){super(t),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new h,this.apiSet_=new ee(Ui),this.pool_=c;const m=this.controller_.rack;m.emitter.on("add",this.onRackAdd_),m.emitter.on("remove",this.onRackRemove_),m.emitter.on("inputchange",this.onRackInputChange_),m.emitter.on("monitorupdate",this.onRackMonitorUpdate_),m.children.forEach(x=>{this.setUpApi_(x)})}get children(){return this.controller_.rack.children.map(t=>Oe(this.apiSet_,t))}addInput(t,c,m){const x=m!=null?m:{},j=this.controller_.view.element.ownerDocument,$=this.pool_.createInput(j,Ci(t,c,x.presetKey),x),vt=new ei($);return this.add(vt,x.index)}addMonitor(t,c,m){const x=m!=null?m:{},j=this.controller_.view.element.ownerDocument,$=this.pool_.createMonitor(j,Ci(t,c),x),vt=new Ve($);return this.add(vt,x.index)}addFolder(t){return ti(this,t)}addButton(t){return Qe(this,t)}addSeparator(t){return yi(this,t)}addTab(t){return Xi(this,t)}add(t,c){this.controller_.rack.add(t.controller_,c);const m=this.apiSet_.find(x=>x.controller_===t.controller_);return m&&this.apiSet_.remove(m),this.apiSet_.add(t),t}remove(t){this.controller_.rack.remove(t.controller_)}addBlade(t){const c=this.controller_.view.element.ownerDocument,m=this.pool_.createBlade(c,t),x=this.pool_.createBladeApi(m);return this.add(x,t.index)}on(t,c){const m=c.bind(this);return this.emitter_.on(t,x=>{m(x.event)}),this}setUpApi_(t){this.apiSet_.find(m=>m.controller_===t)||this.apiSet_.add(this.pool_.createBladeApi(t))}onRackAdd_(t){this.setUpApi_(t.bladeController)}onRackRemove_(t){if(t.isRoot){const c=Oe(this.apiSet_,t.bladeController);this.apiSet_.remove(c)}}onRackInputChange_(t){const c=t.bladeController;if(c instanceof ie){const m=Oe(this.apiSet_,c),x=c.binding;this.emitter_.emit("change",{event:new M(m,x.target.read(),x.target.presetKey,t.options.last)})}else if(c instanceof Vt){const m=Oe(this.apiSet_,c);this.emitter_.emit("change",{event:new M(m,c.value.rawValue,void 0,t.options.last)})}}onRackMonitorUpdate_(t){if(!(t.bladeController instanceof le))throw o.shouldNeverHappen();const c=Oe(this.apiSet_,t.bladeController),m=t.bladeController.binding;this.emitter_.emit("update",{event:new d(c,m.target.read(),m.target.presetKey)})}}class ii extends Te{constructor(t,c){super(t,new Ne(t.rackController,c)),this.emitter_=new h,this.controller_.foldable.value("expanded").emitter.on("change",m=>{this.emitter_.emit("fold",{event:new i(this,m.sender.rawValue)})}),this.rackApi_.on("change",m=>{this.emitter_.emit("change",{event:m})}),this.rackApi_.on("update",m=>{this.emitter_.emit("update",{event:m})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(t){this.controller_.foldable.set("expanded",t)}get title(){return this.controller_.props.get("title")}set title(t){this.controller_.props.set("title",t)}get children(){return this.rackApi_.children}addInput(t,c,m){return this.rackApi_.addInput(t,c,m)}addMonitor(t,c,m){return this.rackApi_.addMonitor(t,c,m)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,c){return this.rackApi_.add(t,c)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,c){const m=c.bind(this);return this.emitter_.on(t,x=>{m(x.event)}),this}}class ni extends et{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}}class Hi{constructor(t,c){const m=v(c.viewName);this.element=t.createElement("div"),this.element.classList.add(m()),c.viewProps.bindClassModifiers(this.element)}}function Wi(f,t){for(let c=0;c<f.length;c++){const m=f[c];if(m instanceof ie&&m.binding===t)return m}return null}function Gi(f,t){for(let c=0;c<f.length;c++){const m=f[c];if(m instanceof le&&m.binding===t)return m}return null}function Si(f,t){for(let c=0;c<f.length;c++){const m=f[c];if(m instanceof Vt&&m.value===t)return m}return null}function ri(f){return f instanceof De?f.rack:f instanceof ni?f.rackController.rack:null}function Ki(f){const t=ri(f);return t?t.bcSet_:null}class qi{constructor(t){var c;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new h,this.blade_=t!=null?t:null,(c=this.blade_)===null||c===void 0||c.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new ee(Ki),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,c){t.parent&&t.parent.remove(t),t.parent_=this,this.bcSet_.add(t,c)}remove(t){t.parent_=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(c=>c instanceof t)}onSetAdd_(t){this.updatePositions_();const c=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,isRoot:c,sender:this}),!c)return;const m=t.item;if(m.viewProps.emitter.on("change",this.onChildViewPropsChange_),m.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),m.viewProps.handleDispose(this.onChildDispose_),m instanceof ie)m.binding.emitter.on("change",this.onChildInputChange_);else if(m instanceof le)m.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(m instanceof Vt)m.value.emitter.on("change",this.onChildValueChange_);else{const x=ri(m);if(x){const j=x.emitter;j.on("layout",this.onDescendantLayout_),j.on("inputchange",this.onDescendantInputChange_),j.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(t){this.updatePositions_();const c=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,isRoot:c,sender:this}),!c)return;const m=t.item;if(m instanceof ie)m.binding.emitter.off("change",this.onChildInputChange_);else if(m instanceof le)m.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(m instanceof Vt)m.value.emitter.off("change",this.onChildValueChange_);else{const x=ri(m);if(x){const j=x.emitter;j.off("layout",this.onDescendantLayout_),j.off("inputchange",this.onDescendantInputChange_),j.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const t=this.bcSet_.items.filter(x=>!x.viewProps.get("hidden")),c=t[0],m=t[t.length-1];this.bcSet_.items.forEach(x=>{const j=[];x===c&&(j.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&j.push("veryfirst")),x===m&&(j.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&j.push("verylast")),x.blade.set("positions",j)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(c=>c.viewProps.get("disposed")).forEach(c=>{this.bcSet_.remove(c)})}onChildInputChange_(t){const c=Wi(this.find(ie),t.sender);if(!c)throw o.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:c,options:t.options,sender:this})}onChildMonitorUpdate_(t){const c=Gi(this.find(le),t.sender);if(!c)throw o.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:c,sender:this})}onChildValueChange_(t){const c=Si(this.find(Vt),t.sender);if(!c)throw o.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:c,options:t.options,sender:this})}onDescendantLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(t){this.emitter.emit("inputchange",{bladeController:t.bladeController,options:t.options,sender:this})}onDescendantMonitorUpdate_(t){this.emitter.emit("monitorupdate",{bladeController:t.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class De extends et{constructor(t,c){super(Object.assign(Object.assign({},c),{view:new Hi(t,{viewName:"brk",viewProps:c.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const m=new qi(c.root?void 0:c.blade);m.emitter.on("add",this.onRackAdd_),m.emitter.on("remove",this.onRackRemove_),this.rack=m,this.viewProps.handleDispose(()=>{for(let x=this.rack.children.length-1;x>=0;x--)this.rack.children[x].viewProps.set("disposed",!0)})}onRackAdd_(t){!t.isRoot||wt(this.view.element,t.bladeController.view.element,t.index)}onRackRemove_(t){!t.isRoot||Pt(t.bladeController.view.element)}}const xi=v("cnt");class $i{constructor(t,c){var m;this.className_=v((m=c.viewName)!==null&&m!==void 0?m:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),xi()),c.viewProps.bindClassModifiers(this.element),this.foldable_=c.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),P(this.foldable_,"completed",I(this.element,this.className_(void 0,"cpl")));const x=t.createElement("button");x.classList.add(this.className_("b")),P(c.props,"title",Et=>{e(Et)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),c.viewProps.bindDisabled(x),this.element.appendChild(x),this.buttonElement=x;const j=t.createElement("div");j.classList.add(this.className_("t")),N(c.props.value("title"),j),this.buttonElement.appendChild(j),this.titleElement=j;const $=t.createElement("div");$.classList.add(this.className_("m")),this.buttonElement.appendChild($);const vt=c.containerElement;vt.classList.add(this.className_("c")),this.element.appendChild(vt),this.containerElement=vt}}class si extends ni{constructor(t,c){var m;const x=$t.create((m=c.expanded)!==null&&m!==void 0?m:!0),j=new De(t,{blade:c.blade,root:c.root,viewProps:c.viewProps});super(Object.assign(Object.assign({},c),{rackController:j,view:new $i(t,{containerElement:j.view.element,foldable:x,props:c.props,viewName:c.root?"rot":void 0,viewProps:c.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=c.props,this.foldable=x,ae(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Zi={id:"folder",type:"blade",accept(f){const t=G,c=F(f,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return c?{params:c}:null},controller(f){return new si(f.document,{blade:f.blade,expanded:f.params.expanded,props:rt.fromObject({title:f.params.title}),viewProps:f.viewProps})},api(f){return f.controller instanceof si?new ii(f.controller,f.pool):null}};class ge extends Vt{constructor(t,c){const m=c.valueController.viewProps;super(Object.assign(Object.assign({},c),{value:c.valueController.value,view:new jt(t,{props:c.props,viewProps:m}),viewProps:m})),this.props=c.props,this.valueController=c.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Ei extends S{}const Pi=v("spr");class Ji{constructor(t,c){this.element=t.createElement("div"),this.element.classList.add(Pi()),c.viewProps.bindClassModifiers(this.element);const m=t.createElement("hr");m.classList.add(Pi("r")),this.element.appendChild(m)}}class Ti extends et{constructor(t,c){super(Object.assign(Object.assign({},c),{view:new Ji(t,{viewProps:c.viewProps})}))}}const Qi={id:"separator",type:"blade",accept(f){const c=F(f,{view:G.required.constant("separator")});return c?{params:c}:null},controller(f){return new Ti(f.document,{blade:f.blade,viewProps:f.viewProps})},api(f){return f.controller instanceof Ti?new Ei(f.controller):null}},tn=v("");function oi(f,t){return I(f,tn(void 0,t))}class Zt extends rt{constructor(t){super(t)}static create(t){var c,m;const x=t!=null?t:{},j={disabled:(c=x.disabled)!==null&&c!==void 0?c:!1,disposed:!1,hidden:(m=x.hidden)!==null&&m!==void 0?m:!1},$=rt.createCore(j);return new Zt($)}bindClassModifiers(t){P(this,"disabled",oi(t,"disabled")),P(this,"hidden",oi(t,"hidden"))}bindDisabled(t){P(this,"disabled",c=>{t.disabled=c})}bindTabIndex(t){P(this,"disabled",c=>{t.tabIndex=c?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",c=>{c&&t()})}}const ve=v("tbi");class me{constructor(t,c){this.element=t.createElement("div"),this.element.classList.add(ve()),c.viewProps.bindClassModifiers(this.element),P(c.props,"selected",j=>{j?this.element.classList.add(ve(void 0,"sel")):this.element.classList.remove(ve(void 0,"sel"))});const m=t.createElement("button");m.classList.add(ve("b")),c.viewProps.bindDisabled(m),this.element.appendChild(m),this.buttonElement=m;const x=t.createElement("div");x.classList.add(ve("t")),N(c.props.value("title"),x),this.buttonElement.appendChild(x),this.titleElement=x}}class en{constructor(t,c){this.emitter=new h,this.onClick_=this.onClick_.bind(this),this.props=c.props,this.viewProps=c.viewProps,this.view=new me(t,{props:c.props,viewProps:c.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Me{constructor(t,c){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new en(t,{props:c.itemProps,viewProps:Zt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new De(t,{blade:Kt(),viewProps:Zt.create()}),this.props=c.props,P(this.props,"selected",m=>{this.itemController.props.set("selected",m),this.contentController.viewProps.set("hidden",!m)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class ze{constructor(t,c){this.controller_=t,this.rackApi_=c}get title(){var t;return(t=this.controller_.itemController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.itemController.props.set("title",t)}get selected(){return this.controller_.props.get("selected")}set selected(t){this.controller_.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,c){this.rackApi_.add(t,c)}remove(t){this.rackApi_.remove(t)}addInput(t,c,m){return this.rackApi_.addInput(t,c,m)}addMonitor(t,c,m){return this.rackApi_.addMonitor(t,c,m)}addBlade(t){return this.rackApi_.addBlade(t)}}class Oi extends Te{constructor(t,c){super(t,new Ne(t.rackController,c)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new h,this.pageApiMap_=new Map,this.rackApi_.on("change",m=>{this.emitter_.emit("change",{event:m})}),this.rackApi_.on("update",m=>{this.emitter_.emit("update",{event:m})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(m=>{this.setUpPageApi_(m)})}get pages(){return this.controller_.pageSet.items.map(t=>{const c=this.pageApiMap_.get(t);if(!c)throw o.shouldNeverHappen();return c})}addPage(t){const c=this.controller_.view.element.ownerDocument,m=new Me(c,{itemProps:rt.fromObject({selected:!1,title:t.title}),props:rt.fromObject({selected:!1})});this.controller_.add(m,t.index);const x=this.pageApiMap_.get(m);if(!x)throw o.shouldNeverHappen();return x}removePage(t){this.controller_.remove(t)}on(t,c){const m=c.bind(this);return this.emitter_.on(t,x=>{m(x.event)}),this}setUpPageApi_(t){const c=this.rackApi_.apiSet_.find(x=>x.controller_===t.contentController);if(!c)throw o.shouldNeverHappen();const m=new ze(t,c);this.pageApiMap_.set(t,m)}onPageAdd_(t){this.setUpPageApi_(t.item)}onPageRemove_(t){if(!this.pageApiMap_.get(t.item))throw o.shouldNeverHappen();this.pageApiMap_.delete(t.item)}onSelect_(t){this.emitter_.emit("select",{event:new a(this,t.rawValue)})}}const Di=-1;class ai{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=dt(!0),this.selectedIndex=dt(Di),this.items_=[]}add(t,c){const m=c!=null?c:this.items_.length;this.items_.splice(m,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){const c=this.items_.indexOf(t);c<0||(this.items_.splice(c,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Di,this.empty.rawValue=!0;return}const t=this.items_.findIndex(c=>c.rawValue);t<0?(this.items_.forEach((c,m)=>{c.rawValue=m===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((c,m)=>{c.rawValue=m===t}),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){const c=this.items_.findIndex(m=>m===t.sender);this.items_.forEach((m,x)=>{m.rawValue=x===c}),this.selectedIndex.rawValue=c}else this.keepSelection_()}}const Ye=v("tab");class nn{constructor(t,c){this.element=t.createElement("div"),this.element.classList.add(Ye(),xi()),c.viewProps.bindClassModifiers(this.element),C(c.empty,I(this.element,Ye(void 0,"nop")));const m=t.createElement("div");m.classList.add(Ye("i")),this.element.appendChild(m),this.itemsElement=m;const x=c.contentsElement;x.classList.add(Ye("c")),this.element.appendChild(x),this.contentsElement=x}}class O extends ni{constructor(t,c){const m=new De(t,{blade:c.blade,viewProps:c.viewProps}),x=new ai;super({blade:c.blade,rackController:m,view:new nn(t,{contentsElement:m.view.element,empty:x.empty,viewProps:c.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new ee(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=x}get pageSet(){return this.pageSet_}add(t,c){this.pageSet_.add(t,c)}remove(t){this.pageSet_.remove(this.pageSet_.items[t])}onPageAdd_(t){const c=t.item;wt(this.view.itemsElement,c.itemController.view.element,t.index),this.rackController.rack.add(c.contentController,t.index),this.tab.add(c.props.value("selected"))}onPageRemove_(t){const c=t.item;Pt(c.itemController.view.element),this.rackController.rack.remove(c.contentController),this.tab.remove(c.props.value("selected"))}}const z={id:"tab",type:"blade",accept(f){const t=G,c=F(f,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});return!c||c.pages.length===0?null:{params:c}},controller(f){const t=new O(f.document,{blade:f.blade,viewProps:f.viewProps});return f.params.pages.forEach(c=>{const m=new Me(f.document,{itemProps:rt.fromObject({selected:!1,title:c.title}),props:rt.fromObject({selected:!1})});t.add(m)}),t},api(f){return f.controller instanceof O?new Oi(f.controller,f.pool):null}};function L(f,t){const c=f.accept(t.params);if(!c)return null;const m=G.optional.boolean(t.params.disabled).value,x=G.optional.boolean(t.params.hidden).value;return f.controller({blade:Kt(),document:t.document,params:Object.assign(Object.assign({},c.params),{disabled:m,hidden:x}),viewProps:Zt.create({disabled:m,hidden:x})})}class U{constructor(){this.disabled=!1,this.emitter=new h}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class W{constructor(t,c){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new h,this.interval_=c,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Y{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((c,m)=>m.constrain(c),t)}}function at(f,t){if(f instanceof t)return f;if(f instanceof Y){const c=f.constraints.reduce((m,x)=>m||(x instanceof t?x:null),null);if(c)return c}return null}class pt{constructor(t){this.options=t}constrain(t){const c=this.options;return c.length===0||c.filter(x=>x.value===t).length>0?t:c[0].value}}class gt{constructor(t){this.maxValue=t.max,this.minValue=t.min}constrain(t){let c=t;return e(this.minValue)||(c=Math.max(c,this.minValue)),e(this.maxValue)||(c=Math.min(c,this.maxValue)),c}}class mt{constructor(t,c=0){this.step=t,this.origin=c}constrain(t){const c=this.origin%this.step,m=Math.round((t-c)/this.step);return c+m*this.step}}const bt=v("lst");class St{constructor(t,c){this.onValueChange_=this.onValueChange_.bind(this),this.props_=c.props,this.element=t.createElement("div"),this.element.classList.add(bt()),c.viewProps.bindClassModifiers(this.element);const m=t.createElement("select");m.classList.add(bt("s")),P(this.props_,"options",j=>{Ct(m),j.forEach(($,vt)=>{const Et=t.createElement("option");Et.dataset.index=String(vt),Et.textContent=$.text,Et.value=String($.value),m.appendChild(Et)})}),c.viewProps.bindDisabled(m),this.element.appendChild(m),this.selectElement=m;const x=t.createElement("div");x.classList.add(bt("m")),x.appendChild(ut(t,"dropdown")),this.element.appendChild(x),c.value.emitter.on("change",this.onValueChange_),this.value_=c.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Dt{constructor(t,c){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=c.props,this.value=c.value,this.viewProps=c.viewProps,this.view=new St(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const m=t.currentTarget.selectedOptions.item(0);if(!m)return;const x=Number(m.dataset.index);this.value.rawValue=this.props.get("options")[x].value}}const Lt=v("pop");class Ft{constructor(t,c){this.element=t.createElement("div"),this.element.classList.add(Lt()),c.viewProps.bindClassModifiers(this.element),C(c.shows,I(this.element,Lt(void 0,"v")))}}class Ut{constructor(t,c){this.shows=dt(!1),this.viewProps=c.viewProps,this.view=new Ft(t,{shows:this.shows,viewProps:this.viewProps})}}const Yt=v("txt");class Jt{constructor(t,c){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Yt()),c.viewProps.bindClassModifiers(this.element),this.props_=c.props,this.props_.emitter.on("change",this.onChange_);const m=t.createElement("input");m.classList.add(Yt("i")),m.type="text",c.viewProps.bindDisabled(m),this.element.appendChild(m),this.inputElement=m,c.value.emitter.on("change",this.onChange_),this.value_=c.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class ce{constructor(t,c){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=c.parser,this.props=c.props,this.value=c.value,this.viewProps=c.viewProps,this.view=new Jt(t,{props:c.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const m=t.currentTarget.value,x=this.parser_(m);e(x)||(this.value.rawValue=x),this.view.refresh()}}function li(f){return String(f)}function Mi(f){return f==="false"?!1:!!f}function Xe(f){return li(f)}class Rn{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const rn={"**":(f,t)=>Math.pow(f,t),"*":(f,t)=>f*t,"/":(f,t)=>f/t,"%":(f,t)=>f%t,"+":(f,t)=>f+t,"-":(f,t)=>f-t,"<<":(f,t)=>f<<t,">>":(f,t)=>f>>t,">>>":(f,t)=>f>>>t,"&":(f,t)=>f&t,"^":(f,t)=>f^t,"|":(f,t)=>f|t};class sn{constructor(t,c,m){this.left=c,this.operator=t,this.right=m}evaluate(){const t=rn[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ai={"+":f=>f,"-":f=>-f,"~":f=>~f};class Wr{constructor(t,c){this.operator=t,this.expression=c}evaluate(){const t=Ai[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function on(f){return(t,c)=>{for(let m=0;m<f.length;m++){const x=f[m](t,c);if(x!=="")return x}return""}}function ci(f,t){var c;const m=f.substr(t).match(/^\s+/);return(c=m&&m[0])!==null&&c!==void 0?c:""}function Gr(f,t){const c=f.substr(t,1);return c.match(/^[1-9]$/)?c:""}function ui(f,t){var c;const m=f.substr(t).match(/^[0-9]+/);return(c=m&&m[0])!==null&&c!==void 0?c:""}function Kr(f,t){const c=ui(f,t);if(c!=="")return c;const m=f.substr(t,1);if(t+=1,m!=="-"&&m!=="+")return"";const x=ui(f,t);return x===""?"":m+x}function an(f,t){const c=f.substr(t,1);if(t+=1,c.toLowerCase()!=="e")return"";const m=Kr(f,t);return m===""?"":c+m}function Bn(f,t){const c=f.substr(t,1);if(c==="0")return c;const m=Gr(f,t);return t+=m.length,m===""?"":m+ui(f,t)}function qr(f,t){const c=Bn(f,t);if(t+=c.length,c==="")return"";const m=f.substr(t,1);if(t+=m.length,m!==".")return"";const x=ui(f,t);return t+=x.length,c+m+x+an(f,t)}function $r(f,t){const c=f.substr(t,1);if(t+=c.length,c!==".")return"";const m=ui(f,t);return t+=m.length,m===""?"":c+m+an(f,t)}function Zr(f,t){const c=Bn(f,t);return t+=c.length,c===""?"":c+an(f,t)}const Jr=on([qr,$r,Zr]);function Qr(f,t){var c;const m=f.substr(t).match(/^[01]+/);return(c=m&&m[0])!==null&&c!==void 0?c:""}function ts(f,t){const c=f.substr(t,2);if(t+=c.length,c.toLowerCase()!=="0b")return"";const m=Qr(f,t);return m===""?"":c+m}function es(f,t){var c;const m=f.substr(t).match(/^[0-7]+/);return(c=m&&m[0])!==null&&c!==void 0?c:""}function is(f,t){const c=f.substr(t,2);if(t+=c.length,c.toLowerCase()!=="0o")return"";const m=es(f,t);return m===""?"":c+m}function ns(f,t){var c;const m=f.substr(t).match(/^[0-9a-f]+/i);return(c=m&&m[0])!==null&&c!==void 0?c:""}function rs(f,t){const c=f.substr(t,2);if(t+=c.length,c.toLowerCase()!=="0x")return"";const m=ns(f,t);return m===""?"":c+m}const ss=on([ts,is,rs]),os=on([ss,Jr]);function as(f,t){const c=os(f,t);return t+=c.length,c===""?null:{evaluable:new Rn(c),cursor:t}}function ls(f,t){const c=f.substr(t,1);if(t+=c.length,c!=="(")return null;const m=Vn(f,t);if(!m)return null;t=m.cursor,t+=ci(f,t).length;const x=f.substr(t,1);return t+=x.length,x!==")"?null:{evaluable:m.evaluable,cursor:t}}function cs(f,t){var c;return(c=as(f,t))!==null&&c!==void 0?c:ls(f,t)}function jn(f,t){const c=cs(f,t);if(c)return c;const m=f.substr(t,1);if(t+=m.length,m!=="+"&&m!=="-"&&m!=="~")return null;const x=jn(f,t);return x?(t=x.cursor,{cursor:t,evaluable:new Wr(m,x.evaluable)}):null}function us(f,t,c){c+=ci(t,c).length;const m=f.filter(x=>t.startsWith(x,c))[0];return m?(c+=m.length,c+=ci(t,c).length,{cursor:c,operator:m}):null}function hs(f,t){return(c,m)=>{const x=f(c,m);if(!x)return null;m=x.cursor;let j=x.evaluable;for(;;){const $=us(t,c,m);if(!$)break;m=$.cursor;const vt=f(c,m);if(!vt)return null;m=vt.cursor,j=new sn($.operator,j,vt.evaluable)}return j?{cursor:m,evaluable:j}:null}}const ds=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((f,t)=>hs(f,t),jn);function Vn(f,t){return t+=ci(f,t).length,ds(f,t)}function fs(f){const t=Vn(f,0);return!t||t.cursor+ci(f,t.cursor).length!==f.length?null:t.evaluable}function he(f){var t;const c=fs(f);return(t=c==null?void 0:c.evaluate())!==null&&t!==void 0?t:null}function Nn(f){if(typeof f=="number")return f;if(typeof f=="string"){const t=he(f);if(!e(t))return t}return 0}function ps(f){return String(f)}function Gt(f){return t=>t.toFixed(Math.max(Math.min(f,20),0))}const gs=Gt(0);function ki(f){return gs(f)+"%"}function zn(f){return String(f)}function ln(f){return f}function Yn(f,t){for(;f.length<t;)f.push(void 0)}function vs(f){const t=[];return Yn(t,f),dt(t)}function ms(f){const t=f.indexOf(void 0);return t<0?f:f.slice(0,t)}function _s(f,t){const c=[...ms(f),t];return c.length>f.length?c.splice(0,c.length-f.length):Yn(c,f.length),c}function hi({primary:f,secondary:t,forward:c,backward:m}){let x=!1;function j($){x||(x=!0,$(),x=!1)}f.emitter.on("change",$=>{j(()=>{t.setRawValue(c(f,t),$.options)})}),t.emitter.on("change",$=>{j(()=>{f.setRawValue(m(f,t),$.options)}),j(()=>{t.setRawValue(c(f,t),$.options)})}),j(()=>{t.setRawValue(c(f,t),{forceEmit:!1,last:!0})})}function Qt(f,t){const c=f*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+c:t.downKey?-c:0}function di(f){return{altKey:f.altKey,downKey:f.key==="ArrowDown",shiftKey:f.shiftKey,upKey:f.key==="ArrowUp"}}function de(f){return{altKey:f.altKey,downKey:f.key==="ArrowLeft",shiftKey:f.shiftKey,upKey:f.key==="ArrowRight"}}function bs(f){return f==="ArrowUp"||f==="ArrowDown"}function Xn(f){return bs(f)||f==="ArrowLeft"||f==="ArrowRight"}function cn(f,t){var c,m;const x=t.ownerDocument.defaultView,j=t.getBoundingClientRect();return{x:f.pageX-(((c=x&&x.scrollX)!==null&&c!==void 0?c:0)+j.left),y:f.pageY-(((m=x&&x.scrollY)!==null&&m!==void 0?m:0)+j.top)}}class Ae{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new h,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const c=this.elem_.getBoundingClientRect();return{bounds:{width:c.width,height:c.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var c;t.preventDefault(),(c=t.currentTarget)===null||c===void 0||c.focus();const m=this.elem_.ownerDocument;m.addEventListener("mousemove",this.onDocumentMouseMove_),m.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(cn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(cn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const c=this.elem_.ownerDocument;c.removeEventListener("mousemove",this.onDocumentMouseMove_),c.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(cn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const c=t.targetTouches.item(0),m=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(c?{x:c.clientX-m.left,y:c.clientY-m.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=c}onTouchMove_(t){const c=t.targetTouches.item(0),m=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(c?{x:c.clientX-m.left,y:c.clientY-m.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=c}onTouchEnd_(t){var c;const m=(c=t.targetTouches.item(0))!==null&&c!==void 0?c:this.lastTouch_,x=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(m?{x:m.clientX-x.left,y:m.clientY-x.top}:void 0),sender:this,shiftKey:t.shiftKey})}}function Xt(f,t,c,m,x){const j=(f-t)/(c-t);return m+j*(x-m)}function Un(f){return String(f.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Wt(f,t,c){return Math.min(Math.max(f,t),c)}function Hn(f,t){return(f%t+t)%t}const ne=v("txt");class ws{constructor(t,c){this.onChange_=this.onChange_.bind(this),this.props_=c.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(ne(),ne(void 0,"num")),c.arrayPosition&&this.element.classList.add(ne(void 0,c.arrayPosition)),c.viewProps.bindClassModifiers(this.element);const m=t.createElement("input");m.classList.add(ne("i")),m.type="text",c.viewProps.bindDisabled(m),this.element.appendChild(m),this.inputElement=m,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=c.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(ne()),this.inputElement.classList.add(ne("i"));const x=t.createElement("div");x.classList.add(ne("k")),this.element.appendChild(x),this.knobElement=x;const j=t.createElementNS(lt,"svg");j.classList.add(ne("g")),this.knobElement.appendChild(j);const $=t.createElementNS(lt,"path");$.classList.add(ne("gb")),j.appendChild($),this.guideBodyElem_=$;const vt=t.createElementNS(lt,"path");vt.classList.add(ne("gh")),j.appendChild(vt),this.guideHeadElem_=vt;const Et=t.createElement("div");Et.classList.add(v("tt")()),this.knobElement.appendChild(Et),this.tooltipElem_=Et,c.value.emitter.on("change",this.onChange_),this.value=c.value,this.refresh()}onDraggingChange_(t){if(t.rawValue===null){this.element.classList.remove(ne(void 0,"drg"));return}this.element.classList.add(ne(void 0,"drg"));const c=t.rawValue/this.props_.get("draggingScale"),m=c+(c>0?-1:c<0?1:0),x=Wt(-m,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${m+x},0 L${m},4 L${m+x},8`,`M ${c},-1 L${c},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${c},4`);const j=this.props_.get("formatter");this.tooltipElem_.textContent=j(this.value.rawValue),this.tooltipElem_.style.left=`${c}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class fi{constructor(t,c){var m;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=c.baseStep,this.parser_=c.parser,this.props=c.props,this.sliderProps_=(m=c.sliderProps)!==null&&m!==void 0?m:null,this.value=c.value,this.viewProps=c.viewProps,this.dragging_=dt(null),this.view=new ws(t,{arrayPosition:c.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const x=new Ae(this.view.knobElement);x.emitter.on("down",this.onPointerDown_),x.emitter.on("move",this.onPointerMove_),x.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var c,m;const x=(c=this.sliderProps_)===null||c===void 0?void 0:c.get("minValue"),j=(m=this.sliderProps_)===null||m===void 0?void 0:m.get("maxValue");let $=t;return x!==void 0&&($=Math.max($,x)),j!==void 0&&($=Math.min($,j)),$}onInputChange_(t){const m=t.currentTarget.value,x=this.parser_(m);e(x)||(this.value.rawValue=this.constrainValue_(x)),this.view.refresh()}onInputKeyDown_(t){const c=Qt(this.baseStep_,di(t));c!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+c),{forceEmit:!1,last:!1})}onInputKeyUp_(t){Qt(this.baseStep_,di(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const c=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+c*this.props.get("draggingScale"))}onPointerMove_(t){const c=this.computeDraggingValue_(t.data);c!==null&&(this.value.setRawValue(c,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const c=this.computeDraggingValue_(t.data);c!==null&&(this.value.setRawValue(c,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const un=v("sld");class ys{constructor(t,c){this.onChange_=this.onChange_.bind(this),this.props_=c.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(un()),c.viewProps.bindClassModifiers(this.element);const m=t.createElement("div");m.classList.add(un("t")),c.viewProps.bindTabIndex(m),this.element.appendChild(m),this.trackElement=m;const x=t.createElement("div");x.classList.add(un("k")),this.trackElement.appendChild(x),this.knobElement=x,c.value.emitter.on("change",this.onChange_),this.value=c.value,this.update_()}update_(){const t=Wt(Xt(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class Cs{constructor(t,c){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=c.baseStep,this.value=c.value,this.viewProps=c.viewProps,this.props=c.props,this.view=new ys(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ae(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,c){!t.point||this.value.setRawValue(Xt(Wt(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),c)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const c=Qt(this.baseStep_,de(t));c!==0&&this.value.setRawValue(this.value.rawValue+c,{forceEmit:!1,last:!1})}onKeyUp_(t){Qt(this.baseStep_,de(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const hn=v("sldtxt");class Ss{constructor(t,c){this.element=t.createElement("div"),this.element.classList.add(hn());const m=t.createElement("div");m.classList.add(hn("s")),this.sliderView_=c.sliderView,m.appendChild(this.sliderView_.element),this.element.appendChild(m);const x=t.createElement("div");x.classList.add(hn("t")),this.textView_=c.textView,x.appendChild(this.textView_.element),this.element.appendChild(x)}}class dn{constructor(t,c){this.value=c.value,this.viewProps=c.viewProps,this.sliderC_=new Cs(t,{baseStep:c.baseStep,props:c.sliderProps,value:c.value,viewProps:this.viewProps}),this.textC_=new fi(t,{baseStep:c.baseStep,parser:c.parser,props:c.textProps,sliderProps:c.sliderProps,value:c.value,viewProps:c.viewProps}),this.view=new Ss(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function pi(f,t){f.write(t)}function Li(f){const t=G;if(Array.isArray(f))return t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(f).value;if(typeof f=="object")return t.required.raw(f).value}function Wn(f){if(f==="inline"||f==="popup")return f}function _e(f){const t=G;return t.required.object({max:t.optional.number,min:t.optional.number,step:t.optional.number})(f).value}function Gn(f){if(Array.isArray(f))return f;const t=[];return Object.keys(f).forEach(c=>{t.push({text:c,value:f[c]})}),t}function fn(f){return e(f)?null:new pt(Gn(f))}function pn(f){const t=f?at(f,pt):null;return t?t.options:null}function xs(f){const t=f?at(f,mt):null;return t?t.step:null}function Ii(f,t){const c=f&&at(f,mt);return c?Un(c.step):Math.max(Un(t),2)}function Ue(f){const t=xs(f);return t!=null?t:1}function He(f,t){var c;const m=f&&at(f,mt),x=Math.abs((c=m==null?void 0:m.step)!==null&&c!==void 0?c:t);return x===0?.1:Math.pow(10,Math.floor(Math.log10(x))-1)}const Fi=v("ckb");class Es{constructor(t,c){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Fi()),c.viewProps.bindClassModifiers(this.element);const m=t.createElement("label");m.classList.add(Fi("l")),this.element.appendChild(m);const x=t.createElement("input");x.classList.add(Fi("i")),x.type="checkbox",m.appendChild(x),this.inputElement=x,c.viewProps.bindDisabled(this.inputElement);const j=t.createElement("div");j.classList.add(Fi("w")),m.appendChild(j);const $=ut(t,"check");j.appendChild($),c.value.emitter.on("change",this.onValueChange_),this.value=c.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Ps{constructor(t,c){this.onInputChange_=this.onInputChange_.bind(this),this.value=c.value,this.viewProps=c.viewProps,this.view=new Es(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const c=t.currentTarget;this.value.rawValue=c.checked}}function Ts(f){const t=[],c=fn(f.options);return c&&t.push(c),new Y(t)}const Os={id:"input-bool",type:"input",accept:(f,t)=>{if(typeof f!="boolean")return null;const m=F(t,{options:G.optional.custom(Li)});return m?{initialValue:f,params:m}:null},binding:{reader:f=>Mi,constraint:f=>Ts(f.params),writer:f=>pi},controller:f=>{var t;const c=f.document,m=f.value,x=f.constraint;return x&&at(x,pt)?new Dt(c,{props:rt.fromObject({options:(t=pn(x))!==null&&t!==void 0?t:[]}),value:m,viewProps:f.viewProps}):new Ps(c,{value:m,viewProps:f.viewProps})}},ke=v("col");class Ds{constructor(t,c){this.element=t.createElement("div"),this.element.classList.add(ke()),c.foldable.bindExpandedClass(this.element,ke(void 0,"expanded")),P(c.foldable,"completed",I(this.element,ke(void 0,"cpl")));const m=t.createElement("div");m.classList.add(ke("h")),this.element.appendChild(m);const x=t.createElement("div");x.classList.add(ke("s")),m.appendChild(x),this.swatchElement=x;const j=t.createElement("div");if(j.classList.add(ke("t")),m.appendChild(j),this.textElement=j,c.pickerLayout==="inline"){const $=t.createElement("div");$.classList.add(ke("p")),this.element.appendChild($),this.pickerElement=$}else this.pickerElement=null}}function Ms(f,t,c){const m=Wt(f/255,0,1),x=Wt(t/255,0,1),j=Wt(c/255,0,1),$=Math.max(m,x,j),vt=Math.min(m,x,j),Et=$-vt;let Ot=0,It=0;const Rt=(vt+$)/2;return Et!==0&&(It=Et/(1-Math.abs($+vt-1)),m===$?Ot=(x-j)/Et:x===$?Ot=2+(j-m)/Et:Ot=4+(m-x)/Et,Ot=Ot/6+(Ot<0?1:0)),[Ot*360,It*100,Rt*100]}function As(f,t,c){const m=(f%360+360)%360,x=Wt(t/100,0,1),j=Wt(c/100,0,1),$=(1-Math.abs(2*j-1))*x,vt=$*(1-Math.abs(m/60%2-1)),Et=j-$/2;let Ot,It,Rt;return m>=0&&m<60?[Ot,It,Rt]=[$,vt,0]:m>=60&&m<120?[Ot,It,Rt]=[vt,$,0]:m>=120&&m<180?[Ot,It,Rt]=[0,$,vt]:m>=180&&m<240?[Ot,It,Rt]=[0,vt,$]:m>=240&&m<300?[Ot,It,Rt]=[vt,0,$]:[Ot,It,Rt]=[$,0,vt],[(Ot+Et)*255,(It+Et)*255,(Rt+Et)*255]}function ks(f,t,c){const m=Wt(f/255,0,1),x=Wt(t/255,0,1),j=Wt(c/255,0,1),$=Math.max(m,x,j),vt=Math.min(m,x,j),Et=$-vt;let Ot;Et===0?Ot=0:$===m?Ot=60*(((x-j)/Et%6+6)%6):$===x?Ot=60*((j-m)/Et+2):Ot=60*((m-x)/Et+4);const It=$===0?0:Et/$,Rt=$;return[Ot,It*100,Rt*100]}function Kn(f,t,c){const m=Hn(f,360),x=Wt(t/100,0,1),j=Wt(c/100,0,1),$=j*x,vt=$*(1-Math.abs(m/60%2-1)),Et=j-$;let Ot,It,Rt;return m>=0&&m<60?[Ot,It,Rt]=[$,vt,0]:m>=60&&m<120?[Ot,It,Rt]=[vt,$,0]:m>=120&&m<180?[Ot,It,Rt]=[0,$,vt]:m>=180&&m<240?[Ot,It,Rt]=[0,vt,$]:m>=240&&m<300?[Ot,It,Rt]=[vt,0,$]:[Ot,It,Rt]=[$,0,vt],[(Ot+Et)*255,(It+Et)*255,(Rt+Et)*255]}function Ls(f,t,c){const m=c+t*(100-Math.abs(2*c-100))/200;return[f,m!==0?t*(100-Math.abs(2*c-100))/m:0,c+t*(100-Math.abs(2*c-100))/(2*100)]}function Is(f,t,c){const m=100-Math.abs(c*(200-t)/100-100);return[f,m!==0?t*c/m:0,c*(200-t)/(2*100)]}function Le(f){return[f[0],f[1],f[2]]}function qn(f,t){return[f[0],f[1],f[2],t]}const Fs={hsl:{hsl:(f,t,c)=>[f,t,c],hsv:Ls,rgb:As},hsv:{hsl:Is,hsv:(f,t,c)=>[f,t,c],rgb:Kn},rgb:{hsl:Ms,hsv:ks,rgb:(f,t,c)=>[f,t,c]}};function Ri(f,t){return[t==="float"?1:f==="rgb"?255:360,t==="float"?1:f==="rgb"?255:100,t==="float"?1:f==="rgb"?255:100]}function Rs(f,t,c){var m;const x=Ri(t,c);return[t==="rgb"?Wt(f[0],0,x[0]):Hn(f[0],x[0]),Wt(f[1],0,x[1]),Wt(f[2],0,x[2]),Wt((m=f[3])!==null&&m!==void 0?m:1,0,1)]}function $n(f,t,c,m){const x=Ri(t,c),j=Ri(t,m);return f.map(($,vt)=>$/x[vt]*j[vt])}function Bs(f,t,c){const m=$n(f,t.mode,t.type,"int"),x=Fs[t.mode][c.mode](...m);return $n(x,c.mode,"int",c.type)}function Bi(f,t){return typeof f!="object"||e(f)?!1:t in f&&typeof f[t]=="number"}class kt{constructor(t,c,m="int"){this.mode=c,this.type=m,this.comps_=Rs(t,c,m)}static black(t="int"){return new kt([0,0,0],"rgb",t)}static fromObject(t,c="int"){const m="a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b];return new kt(m,"rgb",c)}static toRgbaObject(t,c="int"){return t.toRgbaObject(c)}static isRgbColorObject(t){return Bi(t,"r")&&Bi(t,"g")&&Bi(t,"b")}static isRgbaColorObject(t){return this.isRgbColorObject(t)&&Bi(t,"a")}static isColorObject(t){return this.isRgbColorObject(t)}static equals(t,c){if(t.mode!==c.mode)return!1;const m=t.comps_,x=c.comps_;for(let j=0;j<m.length;j++)if(m[j]!==x[j])return!1;return!0}getComponents(t,c="int"){return qn(Bs(Le(this.comps_),{mode:this.mode,type:this.type},{mode:t!=null?t:this.mode,type:c}),this.comps_[3])}toRgbaObject(t="int"){const c=this.getComponents("rgb",t);return{r:c[0],g:c[1],b:c[2],a:c[3]}}}const be=v("colp");class js{constructor(t,c){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(be());const m=t.createElement("div");m.classList.add(be("hsv"));const x=t.createElement("div");x.classList.add(be("sv")),this.svPaletteView_=c.svPaletteView,x.appendChild(this.svPaletteView_.element),m.appendChild(x);const j=t.createElement("div");j.classList.add(be("h")),this.hPaletteView_=c.hPaletteView,j.appendChild(this.hPaletteView_.element),m.appendChild(j),this.element.appendChild(m);const $=t.createElement("div");if($.classList.add(be("rgb")),this.textView_=c.textView,$.appendChild(this.textView_.element),this.element.appendChild($),c.alphaViews){this.alphaViews_={palette:c.alphaViews.palette,text:c.alphaViews.text};const vt=t.createElement("div");vt.classList.add(be("a"));const Et=t.createElement("div");Et.classList.add(be("ap")),Et.appendChild(this.alphaViews_.palette.element),vt.appendChild(Et);const Ot=t.createElement("div");Ot.classList.add(be("at")),Ot.appendChild(this.alphaViews_.text.element),vt.appendChild(Ot),this.element.appendChild(vt)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(c=>c.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function Vs(f){return f==="int"?"int":f==="float"?"float":void 0}function gn(f){const t=G;return F(f,{alpha:t.optional.boolean,color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(Vs)}),expanded:t.optional.boolean,picker:t.optional.custom(Wn)})}function Ie(f){return f?.1:1}function Fe(f){var t;return(t=f.color)===null||t===void 0?void 0:t.type}function Ns(f,t){return f.alpha===t.alpha&&f.mode===t.mode&&f.notation===t.notation&&f.type===t.type}function re(f,t){const c=f.match(/^(.+)%$/);return Math.min(c?parseFloat(c[1])*.01*t:parseFloat(f),t)}const zs={deg:f=>f,grad:f=>f*360/400,rad:f=>f*360/(2*Math.PI),turn:f=>f*360};function Zn(f){const t=f.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(f);const c=parseFloat(t[1]),m=t[2];return zs[m](c)}function Jn(f){const t=f.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const c=[re(t[1],255),re(t[2],255),re(t[3],255)];return isNaN(c[0])||isNaN(c[1])||isNaN(c[2])?null:c}function Qn(f){return t=>{const c=Jn(t);return c?new kt(c,"rgb",f):null}}function tr(f){const t=f.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const c=[re(t[1],255),re(t[2],255),re(t[3],255),re(t[4],1)];return isNaN(c[0])||isNaN(c[1])||isNaN(c[2])||isNaN(c[3])?null:c}function er(f){return t=>{const c=tr(t);return c?new kt(c,"rgb",f):null}}function ir(f){const t=f.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const c=[Zn(t[1]),re(t[2],100),re(t[3],100)];return isNaN(c[0])||isNaN(c[1])||isNaN(c[2])?null:c}function nr(f){return t=>{const c=ir(t);return c?new kt(c,"hsl",f):null}}function rr(f){const t=f.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const c=[Zn(t[1]),re(t[2],100),re(t[3],100),re(t[4],1)];return isNaN(c[0])||isNaN(c[1])||isNaN(c[2])||isNaN(c[3])?null:c}function sr(f){return t=>{const c=rr(t);return c?new kt(c,"hsl",f):null}}function or(f){const t=f.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];const c=f.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return c?[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:null}function Ys(f){const t=or(f);return t?new kt(t,"rgb","int"):null}function ar(f){const t=f.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),Xt(parseInt(t[4]+t[4],16),0,255,0,1)];const c=f.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return c?[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16),Xt(parseInt(c[4],16),0,255,0,1)]:null}function Xs(f){const t=ar(f);return t?new kt(t,"rgb","int"):null}function lr(f){const t=f.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const c=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(c[0])||isNaN(c[1])||isNaN(c[2])?null:c}function cr(f){return t=>{const c=lr(t);return c?new kt(c,"rgb",f):null}}function ur(f){const t=f.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const c=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(c[0])||isNaN(c[1])||isNaN(c[2])||isNaN(c[3])?null:c}function hr(f){return t=>{const c=ur(t);return c?new kt(c,"rgb",f):null}}const Us=[{parser:or,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:ar,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Jn,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:tr,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:ir,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:rr,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:lr,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:ur,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Hs(f){return Us.reduce((t,{parser:c,result:m})=>t||(c(f)?m:null),null)}function vn(f,t="int"){const c=Hs(f);return c?c.notation==="hex"&&t!=="float"?Object.assign(Object.assign({},c),{type:"int"}):c.notation==="func"?Object.assign(Object.assign({},c),{type:t}):null:null}const dr={int:[Ys,Xs,Qn("int"),er("int"),nr("int"),sr("int"),cr("int"),hr("int")],float:[Qn("float"),er("float"),nr("float"),sr("float"),cr("float"),hr("float")]};function Ws(f){const t=dr[f];return c=>{if(typeof c!="string")return kt.black(f);const m=t.reduce((x,j)=>x||j(c),null);return m!=null?m:kt.black(f)}}function mn(f){const t=dr[f];return c=>t.reduce((m,x)=>m||x(c),null)}function fr(f){const t=Wt(Math.floor(f),0,255).toString(16);return t.length===1?`0${t}`:t}function pr(f,t="#"){const c=Le(f.getComponents("rgb")).map(fr).join("");return`${t}${c}`}function _n(f,t="#"){const c=f.getComponents("rgb"),m=[c[0],c[1],c[2],c[3]*255].map(fr).join("");return`${t}${m}`}function gr(f,t){const c=Gt(t==="float"?2:0);return`rgb(${Le(f.getComponents("rgb",t)).map(x=>c(x)).join(", ")})`}function Gs(f){return t=>gr(t,f)}function ji(f,t){const c=Gt(2),m=Gt(t==="float"?2:0);return`rgba(${f.getComponents("rgb",t).map((j,$)=>($===3?c:m)(j)).join(", ")})`}function Ks(f){return t=>ji(t,f)}function qs(f){const t=[Gt(0),ki,ki];return`hsl(${Le(f.getComponents("hsl")).map((m,x)=>t[x](m)).join(", ")})`}function $s(f){const t=[Gt(0),ki,ki,Gt(2)];return`hsla(${f.getComponents("hsl").map((m,x)=>t[x](m)).join(", ")})`}function vr(f,t){const c=Gt(t==="float"?2:0),m=["r","g","b"];return`{${Le(f.getComponents("rgb",t)).map((j,$)=>`${m[$]}: ${c(j)}`).join(", ")}}`}function Zs(f){return t=>vr(t,f)}function mr(f,t){const c=Gt(2),m=Gt(t==="float"?2:0),x=["r","g","b","a"];return`{${f.getComponents("rgb",t).map(($,vt)=>{const Et=vt===3?c:m;return`${x[vt]}: ${Et($)}`}).join(", ")}}`}function Js(f){return t=>mr(t,f)}const Qs=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:pr},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:_n},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:qs},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:$s},...["int","float"].reduce((f,t)=>[...f,{format:{alpha:!1,mode:"rgb",notation:"func",type:t},stringifier:Gs(t)},{format:{alpha:!0,mode:"rgb",notation:"func",type:t},stringifier:Ks(t)},{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:Zs(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:Js(t)}],[])];function bn(f){return Qs.reduce((t,c)=>t||(Ns(c.format,f)?c.stringifier:null),null)}const gi=v("apl");class eo{constructor(t,c){this.onValueChange_=this.onValueChange_.bind(this),this.value=c.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(gi()),c.viewProps.bindTabIndex(this.element);const m=t.createElement("div");m.classList.add(gi("b")),this.element.appendChild(m);const x=t.createElement("div");x.classList.add(gi("c")),m.appendChild(x),this.colorElem_=x;const j=t.createElement("div");j.classList.add(gi("m")),this.element.appendChild(j),this.markerElem_=j;const $=t.createElement("div");$.classList.add(gi("p")),this.markerElem_.appendChild($),this.previewElem_=$,this.update_()}update_(){const t=this.value.rawValue,c=t.getComponents("rgb"),m=new kt([c[0],c[1],c[2],0],"rgb"),x=new kt([c[0],c[1],c[2],255],"rgb"),j=["to right",ji(m),ji(x)];this.colorElem_.style.background=`linear-gradient(${j.join(",")})`,this.previewElem_.style.backgroundColor=ji(t);const $=Xt(c[3],0,1,0,100);this.markerElem_.style.left=`${$}%`}onValueChange_(){this.update_()}}class io{constructor(t,c){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=c.value,this.viewProps=c.viewProps,this.view=new eo(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ae(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,c){if(!t.point)return;const m=t.point.x/t.bounds.width,x=this.value.rawValue,[j,$,vt]=x.getComponents("hsv");this.value.setRawValue(new kt([j,$,vt,m],"hsv"),c)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const c=Qt(Ie(!0),de(t));if(c===0)return;const m=this.value.rawValue,[x,j,$,vt]=m.getComponents("hsv");this.value.setRawValue(new kt([x,j,$,vt+c],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){Qt(Ie(!0),de(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const We=v("coltxt");function no(f){const t=f.createElement("select"),c=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return t.appendChild(c.reduce((m,x)=>{const j=f.createElement("option");return j.textContent=x.text,j.value=x.value,m.appendChild(j),m},f.createDocumentFragment())),t}class ro{constructor(t,c){this.element=t.createElement("div"),this.element.classList.add(We());const m=t.createElement("div");m.classList.add(We("m")),this.modeElem_=no(t),this.modeElem_.classList.add(We("ms")),m.appendChild(this.modeSelectElement);const x=t.createElement("div");x.classList.add(We("mm")),x.appendChild(ut(t,"dropdown")),m.appendChild(x),this.element.appendChild(m);const j=t.createElement("div");j.classList.add(We("w")),this.element.appendChild(j),this.textsElem_=j,this.textViews_=c.textViews,this.applyTextViews_(),C(c.colorMode,$=>{this.modeElem_.value=$})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(t){this.textViews_=t,this.applyTextViews_()}applyTextViews_(){Ct(this.textsElem_);const t=this.element.ownerDocument;this.textViews_.forEach(c=>{const m=t.createElement("div");m.classList.add(We("c")),m.appendChild(c.element),this.textsElem_.appendChild(m)})}}function so(f){return Gt(f==="float"?2:0)}function oo(f,t,c){const m=Ri(f,t)[c];return new gt({min:0,max:m})}function wn(f,t,c){return new fi(f,{arrayPosition:c===0?"fst":c===3-1?"lst":"mid",baseStep:Ie(!1),parser:t.parser,props:rt.fromObject({draggingScale:t.colorType==="float"?.01:1,formatter:so(t.colorType)}),value:dt(0,{constraint:oo(t.colorMode,t.colorType,c)}),viewProps:t.viewProps})}class ao{constructor(t,c){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=c.colorType,this.parser_=c.parser,this.value=c.value,this.viewProps=c.viewProps,this.colorMode=dt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new ro(t,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const c={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},m=[wn(t,c,0),wn(t,c,1),wn(t,c,2)];return m.forEach((x,j)=>{hi({primary:this.value,secondary:x.value,forward:$=>$.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[j],backward:($,vt)=>{const Et=this.colorMode.rawValue,Ot=$.rawValue.getComponents(Et,this.colorType_);return Ot[j]=vt.rawValue,new kt(qn(Le(Ot),Ot[3]),Et,this.colorType_)}})}),m}onModeSelectChange_(t){const c=t.currentTarget;this.colorMode.rawValue=c.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const yn=v("hpl");class lo{constructor(t,c){this.onValueChange_=this.onValueChange_.bind(this),this.value=c.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(yn()),c.viewProps.bindTabIndex(this.element);const m=t.createElement("div");m.classList.add(yn("c")),this.element.appendChild(m);const x=t.createElement("div");x.classList.add(yn("m")),this.element.appendChild(x),this.markerElem_=x,this.update_()}update_(){const t=this.value.rawValue,[c]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=gr(new kt([c,100,100],"hsv"));const m=Xt(c,0,360,0,100);this.markerElem_.style.left=`${m}%`}onValueChange_(){this.update_()}}class co{constructor(t,c){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=c.value,this.viewProps=c.viewProps,this.view=new lo(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ae(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,c){if(!t.point)return;const m=Xt(Wt(t.point.x,0,t.bounds.width),0,t.bounds.width,0,359),x=this.value.rawValue,[,j,$,vt]=x.getComponents("hsv");this.value.setRawValue(new kt([m,j,$,vt],"hsv"),c)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const c=Qt(Ie(!1),de(t));if(c===0)return;const m=this.value.rawValue,[x,j,$,vt]=m.getComponents("hsv");this.value.setRawValue(new kt([x+c,j,$,vt],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){Qt(Ie(!1),de(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Cn=v("svp"),_r=64;class uo{constructor(t,c){this.onValueChange_=this.onValueChange_.bind(this),this.value=c.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Cn()),c.viewProps.bindTabIndex(this.element);const m=t.createElement("canvas");m.height=_r,m.width=_r,m.classList.add(Cn("c")),this.element.appendChild(m),this.canvasElement=m;const x=t.createElement("div");x.classList.add(Cn("m")),this.element.appendChild(x),this.markerElem_=x,this.update_()}update_(){const t=ht(this.canvasElement);if(!t)return;const m=this.value.rawValue.getComponents("hsv"),x=this.canvasElement.width,j=this.canvasElement.height,$=t.getImageData(0,0,x,j),vt=$.data;for(let It=0;It<j;It++)for(let Rt=0;Rt<x;Rt++){const pe=Xt(Rt,0,x,0,100),mi=Xt(It,0,j,100,0),_i=Kn(m[0],pe,mi),$e=(It*x+Rt)*4;vt[$e]=_i[0],vt[$e+1]=_i[1],vt[$e+2]=_i[2],vt[$e+3]=255}t.putImageData($,0,0);const Et=Xt(m[1],0,100,0,100);this.markerElem_.style.left=`${Et}%`;const Ot=Xt(m[2],0,100,100,0);this.markerElem_.style.top=`${Ot}%`}onValueChange_(){this.update_()}}class ho{constructor(t,c){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=c.value,this.viewProps=c.viewProps,this.view=new uo(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ae(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,c){if(!t.point)return;const m=Xt(t.point.x,0,t.bounds.width,0,100),x=Xt(t.point.y,0,t.bounds.height,100,0),[j,,,$]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new kt([j,m,x,$],"hsv"),c)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){Xn(t.key)&&t.preventDefault();const[c,m,x,j]=this.value.rawValue.getComponents("hsv"),$=Ie(!1),vt=Qt($,de(t)),Et=Qt($,di(t));vt===0&&Et===0||this.value.setRawValue(new kt([c,m+vt,x+Et,j],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const c=Ie(!1),m=Qt(c,de(t)),x=Qt(c,di(t));m===0&&x===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class fo{constructor(t,c){this.value=c.value,this.viewProps=c.viewProps,this.hPaletteC_=new co(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new ho(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=c.supportsAlpha?{palette:new io(t,{value:this.value,viewProps:this.viewProps}),text:new fi(t,{parser:he,baseStep:.1,props:rt.fromObject({draggingScale:.01,formatter:Gt(2)}),value:dt(0,{constraint:new gt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&hi({primary:this.value,secondary:this.alphaIcs_.text.value,forward:m=>m.rawValue.getComponents()[3],backward:(m,x)=>{const j=m.rawValue.getComponents();return j[3]=x.rawValue,new kt(j,m.rawValue.mode)}}),this.textC_=new ao(t,{colorType:c.colorType,parser:he,value:this.value,viewProps:this.viewProps}),this.view=new js(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:c.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Sn=v("colsw");class po{constructor(t,c){this.onValueChange_=this.onValueChange_.bind(this),c.value.emitter.on("change",this.onValueChange_),this.value=c.value,this.element=t.createElement("div"),this.element.classList.add(Sn()),c.viewProps.bindClassModifiers(this.element);const m=t.createElement("div");m.classList.add(Sn("sw")),this.element.appendChild(m),this.swatchElem_=m;const x=t.createElement("button");x.classList.add(Sn("b")),c.viewProps.bindDisabled(x),this.element.appendChild(x),this.buttonElement=x,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=_n(t)}onValueChange_(){this.update_()}}class go{constructor(t,c){this.value=c.value,this.viewProps=c.viewProps,this.view=new po(t,{value:this.value,viewProps:this.viewProps})}}class xn{constructor(t,c){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=c.value,this.viewProps=c.viewProps,this.foldable_=$t.create(c.expanded),this.swatchC_=new go(t,{value:this.value,viewProps:this.viewProps});const m=this.swatchC_.view.buttonElement;m.addEventListener("blur",this.onButtonBlur_),m.addEventListener("click",this.onButtonClick_),this.textC_=new ce(t,{parser:c.parser,props:rt.fromObject({formatter:c.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Ds(t,{foldable:this.foldable_,pickerLayout:c.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=c.pickerLayout==="popup"?new Ut(t,{viewProps:this.viewProps}):null;const x=new fo(t,{colorType:c.colorType,supportsAlpha:c.supportsAlpha,value:this.value,viewProps:this.viewProps});x.view.allFocusableElements.forEach(j=>{j.addEventListener("blur",this.onPopupChildBlur_),j.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=x,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(x.view.element),hi({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:j=>j.rawValue,backward:(j,$)=>$.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ae(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const c=this.view.element,m=t.relatedTarget;(!m||!c.contains(m))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const c=this.popC_.view.element,m=xt(t);m&&c.contains(m)||m&&m===this.swatchC_.view.buttonElement&&!it(c.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function vo(f,t){return kt.isColorObject(f)?kt.fromObject(f,t):kt.black(t)}function mo(f){return Le(f.getComponents("rgb")).reduce((t,c)=>t<<8|Math.floor(c)&255,0)}function _o(f){return f.getComponents("rgb").reduce((t,c,m)=>{const x=Math.floor(m===3?c*255:c)&255;return t<<8|x},0)>>>0}function bo(f){return new kt([f>>16&255,f>>8&255,f&255],"rgb")}function wo(f){return new kt([f>>24&255,f>>16&255,f>>8&255,Xt(f&255,0,255,0,1)],"rgb")}function yo(f){return typeof f!="number"?kt.black():bo(f)}function Co(f){return typeof f!="number"?kt.black():wo(f)}function So(f){const t=bn(f);return t?(c,m)=>{pi(c,t(m))}:null}function xo(f){const t=f?_o:mo;return(c,m)=>{pi(c,t(m))}}function Eo(f,t,c){const m=t.toRgbaObject(c);f.writeProperty("r",m.r),f.writeProperty("g",m.g),f.writeProperty("b",m.b),f.writeProperty("a",m.a)}function Po(f,t,c){const m=t.toRgbaObject(c);f.writeProperty("r",m.r),f.writeProperty("g",m.g),f.writeProperty("b",m.b)}function To(f,t){return(c,m)=>{f?Eo(c,m,t):Po(c,m,t)}}function En(f){var t;return!!((f==null?void 0:f.alpha)||((t=f==null?void 0:f.color)===null||t===void 0?void 0:t.alpha))}function Oo(f){return f?t=>_n(t,"0x"):t=>pr(t,"0x")}function Do(f){return"color"in f||"view"in f&&f.view==="color"}const Mo={id:"input-color-number",type:"input",accept:(f,t)=>{if(typeof f!="number"||!Do(t))return null;const c=gn(t);return c?{initialValue:f,params:c}:null},binding:{reader:f=>En(f.params)?Co:yo,equals:kt.equals,writer:f=>xo(En(f.params))},controller:f=>{const t=En(f.params),c="expanded"in f.params?f.params.expanded:void 0,m="picker"in f.params?f.params.picker:void 0;return new xn(f.document,{colorType:"int",expanded:c!=null?c:!1,formatter:Oo(t),parser:mn("int"),pickerLayout:m!=null?m:"popup",supportsAlpha:t,value:f.value,viewProps:f.viewProps})}};function Ao(f){return kt.isRgbaColorObject(f)}function ko(f){return t=>vo(t,f)}function Lo(f,t){return c=>f?mr(c,t):vr(c,t)}const Io={id:"input-color-object",type:"input",accept:(f,t)=>{if(!kt.isColorObject(f))return null;const c=gn(t);return c?{initialValue:f,params:c}:null},binding:{reader:f=>ko(Fe(f.params)),equals:kt.equals,writer:f=>To(Ao(f.initialValue),Fe(f.params))},controller:f=>{var t;const c=kt.isRgbaColorObject(f.initialValue),m="expanded"in f.params?f.params.expanded:void 0,x="picker"in f.params?f.params.picker:void 0,j=(t=Fe(f.params))!==null&&t!==void 0?t:"int";return new xn(f.document,{colorType:j,expanded:m!=null?m:!1,formatter:Lo(c,j),parser:mn(j),pickerLayout:x!=null?x:"popup",supportsAlpha:c,value:f.value,viewProps:f.viewProps})}},Fo={id:"input-color-string",type:"input",accept:(f,t)=>{if(typeof f!="string"||"view"in t&&t.view==="text")return null;const c=vn(f,Fe(t));if(!c||!bn(c))return null;const x=gn(t);return x?{initialValue:f,params:x}:null},binding:{reader:f=>{var t;return Ws((t=Fe(f.params))!==null&&t!==void 0?t:"int")},equals:kt.equals,writer:f=>{const t=vn(f.initialValue,Fe(f.params));if(!t)throw o.shouldNeverHappen();const c=So(t);if(!c)throw o.notBindable();return c}},controller:f=>{const t=vn(f.initialValue,Fe(f.params));if(!t)throw o.shouldNeverHappen();const c=bn(t);if(!c)throw o.shouldNeverHappen();const m="expanded"in f.params?f.params.expanded:void 0,x="picker"in f.params?f.params.picker:void 0;return new xn(f.document,{colorType:t.type,expanded:m!=null?m:!1,formatter:c,parser:mn(t.type),pickerLayout:x!=null?x:"popup",supportsAlpha:t.alpha,value:f.value,viewProps:f.viewProps})}};class we{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const c=this.asm_.toComponents(t).map((m,x)=>{var j,$;return($=(j=this.components[x])===null||j===void 0?void 0:j.constrain(m))!==null&&$!==void 0?$:m});return this.asm_.fromComponents(c)}}const br=v("pndtxt");class Ro{constructor(t,c){this.textViews=c.textViews,this.element=t.createElement("div"),this.element.classList.add(br()),this.textViews.forEach(m=>{const x=t.createElement("div");x.classList.add(br("a")),x.appendChild(m.element),this.element.appendChild(x)})}}function Bo(f,t,c){return new fi(f,{arrayPosition:c===0?"fst":c===t.axes.length-1?"lst":"mid",baseStep:t.axes[c].baseStep,parser:t.parser,props:t.axes[c].textProps,value:dt(0,{constraint:t.axes[c].constraint}),viewProps:t.viewProps})}class Pn{constructor(t,c){this.value=c.value,this.viewProps=c.viewProps,this.acs_=c.axes.map((m,x)=>Bo(t,c,x)),this.acs_.forEach((m,x)=>{hi({primary:this.value,secondary:m.value,forward:j=>c.assembly.toComponents(j.rawValue)[x],backward:(j,$)=>{const vt=c.assembly.toComponents(j.rawValue);return vt[x]=$.rawValue,c.assembly.fromComponents(vt)}})}),this.view=new Ro(t,{textViews:this.acs_.map(m=>m.view)})}}function wr(f,t){return"step"in f&&!e(f.step)?new mt(f.step,t):null}function yr(f){return"max"in f&&!e(f.max)||"min"in f&&!e(f.min)?new gt({max:f.max,min:f.min}):null}function jo(f,t){const c=[],m=wr(f,t);m&&c.push(m);const x=yr(f);x&&c.push(x);const j=fn(f.options);return j&&c.push(j),new Y(c)}function Vo(f){const t=f?at(f,gt):null;return t?[t.minValue,t.maxValue]:[void 0,void 0]}function No(f){const[t,c]=Vo(f);return[t!=null?t:0,c!=null?c:100]}const zo={id:"input-number",type:"input",accept:(f,t)=>{if(typeof f!="number")return null;const c=G,m=F(t,{format:c.optional.function,max:c.optional.number,min:c.optional.number,options:c.optional.custom(Li),step:c.optional.number});return m?{initialValue:f,params:m}:null},binding:{reader:f=>Nn,constraint:f=>jo(f.params,f.initialValue),writer:f=>pi},controller:f=>{var t,c;const m=f.value,x=f.constraint;if(x&&at(x,pt))return new Dt(f.document,{props:rt.fromObject({options:(t=pn(x))!==null&&t!==void 0?t:[]}),value:m,viewProps:f.viewProps});const j=(c="format"in f.params?f.params.format:void 0)!==null&&c!==void 0?c:Gt(Ii(x,m.rawValue));if(x&&at(x,gt)){const[$,vt]=No(x);return new dn(f.document,{baseStep:Ue(x),parser:he,sliderProps:rt.fromObject({maxValue:vt,minValue:$}),textProps:rt.fromObject({draggingScale:He(x,m.rawValue),formatter:j}),value:m,viewProps:f.viewProps})}return new fi(f.document,{baseStep:Ue(x),parser:he,props:rt.fromObject({draggingScale:He(x,m.rawValue),formatter:j}),value:m,viewProps:f.viewProps})}};class ye{constructor(t=0,c=0){this.x=t,this.y=c}getComponents(){return[this.x,this.y]}static isObject(t){if(e(t))return!1;const c=t.x,m=t.y;return!(typeof c!="number"||typeof m!="number")}static equals(t,c){return t.x===c.x&&t.y===c.y}toObject(){return{x:this.x,y:this.y}}}const Cr={toComponents:f=>f.getComponents(),fromComponents:f=>new ye(...f)},Ge=v("p2d");class Yo{constructor(t,c){this.element=t.createElement("div"),this.element.classList.add(Ge()),c.viewProps.bindClassModifiers(this.element),C(c.expanded,I(this.element,Ge(void 0,"expanded")));const m=t.createElement("div");m.classList.add(Ge("h")),this.element.appendChild(m);const x=t.createElement("button");x.classList.add(Ge("b")),x.appendChild(ut(t,"p2dpad")),c.viewProps.bindDisabled(x),m.appendChild(x),this.buttonElement=x;const j=t.createElement("div");if(j.classList.add(Ge("t")),m.appendChild(j),this.textElement=j,c.pickerLayout==="inline"){const $=t.createElement("div");$.classList.add(Ge("p")),this.element.appendChild($),this.pickerElement=$}else this.pickerElement=null}}const Ce=v("p2dp");class Xo{constructor(t,c){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=c.invertsY,this.maxValue_=c.maxValue,this.element=t.createElement("div"),this.element.classList.add(Ce()),c.layout==="popup"&&this.element.classList.add(Ce(void 0,"p"));const m=t.createElement("div");m.classList.add(Ce("p")),c.viewProps.bindTabIndex(m),this.element.appendChild(m),this.padElement=m;const x=t.createElementNS(lt,"svg");x.classList.add(Ce("g")),this.padElement.appendChild(x),this.svgElem_=x;const j=t.createElementNS(lt,"line");j.classList.add(Ce("ax")),j.setAttributeNS(null,"x1","0"),j.setAttributeNS(null,"y1","50%"),j.setAttributeNS(null,"x2","100%"),j.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(j);const $=t.createElementNS(lt,"line");$.classList.add(Ce("ax")),$.setAttributeNS(null,"x1","50%"),$.setAttributeNS(null,"y1","0"),$.setAttributeNS(null,"x2","50%"),$.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild($);const vt=t.createElementNS(lt,"line");vt.classList.add(Ce("l")),vt.setAttributeNS(null,"x1","50%"),vt.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(vt),this.lineElem_=vt;const Et=t.createElement("div");Et.classList.add(Ce("m")),this.padElement.appendChild(Et),this.markerElem_=Et,c.value.emitter.on("change",this.onValueChange_),this.value=c.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,c]=this.value.rawValue.getComponents(),m=this.maxValue_,x=Xt(t,-m,+m,0,100),j=Xt(c,-m,+m,0,100),$=this.invertsY_?100-j:j;this.lineElem_.setAttributeNS(null,"x2",`${x}%`),this.lineElem_.setAttributeNS(null,"y2",`${$}%`),this.markerElem_.style.left=`${x}%`,this.markerElem_.style.top=`${$}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Sr(f,t,c){return[Qt(t[0],de(f)),Qt(t[1],di(f))*(c?1:-1)]}class Uo{constructor(t,c){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=c.value,this.viewProps=c.viewProps,this.baseSteps_=c.baseSteps,this.maxValue_=c.maxValue,this.invertsY_=c.invertsY,this.view=new Xo(t,{invertsY:this.invertsY_,layout:c.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ae(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,c){if(!t.point)return;const m=this.maxValue_,x=Xt(t.point.x,0,t.bounds.width,-m,+m),j=Xt(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-m,+m);this.value.setRawValue(new ye(x,j),c)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){Xn(t.key)&&t.preventDefault();const[c,m]=Sr(t,this.baseSteps_,this.invertsY_);c===0&&m===0||this.value.setRawValue(new ye(this.value.rawValue.x+c,this.value.rawValue.y+m),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[c,m]=Sr(t,this.baseSteps_,this.invertsY_);c===0&&m===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ho{constructor(t,c){var m,x;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=c.value,this.viewProps=c.viewProps,this.foldable_=$t.create(c.expanded),this.popC_=c.pickerLayout==="popup"?new Ut(t,{viewProps:this.viewProps}):null;const j=new Uo(t,{baseSteps:[c.axes[0].baseStep,c.axes[1].baseStep],invertsY:c.invertsY,layout:c.pickerLayout,maxValue:c.maxValue,value:this.value,viewProps:this.viewProps});j.view.allFocusableElements.forEach($=>{$.addEventListener("blur",this.onPopupChildBlur_),$.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=j,this.textC_=new Pn(t,{assembly:Cr,axes:c.axes,parser:c.parser,value:this.value,viewProps:this.viewProps}),this.view=new Yo(t,{expanded:this.foldable_.value("expanded"),pickerLayout:c.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(m=this.view.buttonElement)===null||m===void 0||m.addEventListener("blur",this.onPadButtonBlur_),(x=this.view.buttonElement)===null||x===void 0||x.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),hi({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:$=>$.rawValue,backward:($,vt)=>vt.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ae(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(t){if(!this.popC_)return;const c=this.view.element,m=t.relatedTarget;(!m||!c.contains(m))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const c=this.popC_.view.element,m=xt(t);m&&c.contains(m)||m&&m===this.view.buttonElement&&!it(c.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.view.buttonElement.focus()}}function Wo(f){return ye.isObject(f)?new ye(f.x,f.y):new ye}function Go(f,t){f.writeProperty("x",t.x),f.writeProperty("y",t.y)}function fe(f,t){if(!f)return;const c=[],m=wr(f,t);m&&c.push(m);const x=yr(f);return x&&c.push(x),new Y(c)}function Ko(f,t){return new we({assembly:Cr,components:[fe("x"in f?f.x:void 0,t.x),fe("y"in f?f.y:void 0,t.y)]})}function xr(f,t){var c,m;const x=f&&at(f,gt);if(x)return Math.max(Math.abs((c=x.minValue)!==null&&c!==void 0?c:0),Math.abs((m=x.maxValue)!==null&&m!==void 0?m:0));const j=Ue(f);return Math.max(Math.abs(j)*10,Math.abs(t)*10)}function qo(f,t){const c=t instanceof we?t.components[0]:void 0,m=t instanceof we?t.components[1]:void 0,x=xr(c,f.x),j=xr(m,f.y);return Math.max(x,j)}function Er(f,t){return{baseStep:Ue(t),constraint:t,textProps:rt.fromObject({draggingScale:He(t,f),formatter:Gt(Ii(t,f))})}}function $o(f){if(!("y"in f))return!1;const t=f.y;return t&&"inverted"in t?!!t.inverted:!1}const Zo={id:"input-point2d",type:"input",accept:(f,t)=>{if(!ye.isObject(f))return null;const c=G,m=F(t,{expanded:c.optional.boolean,picker:c.optional.custom(Wn),x:c.optional.custom(_e),y:c.optional.object({inverted:c.optional.boolean,max:c.optional.number,min:c.optional.number,step:c.optional.number})});return m?{initialValue:f,params:m}:null},binding:{reader:f=>Wo,constraint:f=>Ko(f.params,f.initialValue),equals:ye.equals,writer:f=>Go},controller:f=>{const t=f.document,c=f.value,m=f.constraint;if(!(m instanceof we))throw o.shouldNeverHappen();const x="expanded"in f.params?f.params.expanded:void 0,j="picker"in f.params?f.params.picker:void 0;return new Ho(t,{axes:[Er(c.rawValue.x,m.components[0]),Er(c.rawValue.y,m.components[1])],expanded:x!=null?x:!1,invertsY:$o(f.params),maxValue:qo(c.rawValue,m),parser:he,pickerLayout:j!=null?j:"popup",value:c,viewProps:f.viewProps})}};class Ke{constructor(t=0,c=0,m=0){this.x=t,this.y=c,this.z=m}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(e(t))return!1;const c=t.x,m=t.y,x=t.z;return!(typeof c!="number"||typeof m!="number"||typeof x!="number")}static equals(t,c){return t.x===c.x&&t.y===c.y&&t.z===c.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Pr={toComponents:f=>f.getComponents(),fromComponents:f=>new Ke(...f)};function Jo(f){return Ke.isObject(f)?new Ke(f.x,f.y,f.z):new Ke}function Qo(f,t){f.writeProperty("x",t.x),f.writeProperty("y",t.y),f.writeProperty("z",t.z)}function ta(f,t){return new we({assembly:Pr,components:[fe("x"in f?f.x:void 0,t.x),fe("y"in f?f.y:void 0,t.y),fe("z"in f?f.z:void 0,t.z)]})}function Tn(f,t){return{baseStep:Ue(t),constraint:t,textProps:rt.fromObject({draggingScale:He(t,f),formatter:Gt(Ii(t,f))})}}const ea={id:"input-point3d",type:"input",accept:(f,t)=>{if(!Ke.isObject(f))return null;const c=G,m=F(t,{x:c.optional.custom(_e),y:c.optional.custom(_e),z:c.optional.custom(_e)});return m?{initialValue:f,params:m}:null},binding:{reader:f=>Jo,constraint:f=>ta(f.params,f.initialValue),equals:Ke.equals,writer:f=>Qo},controller:f=>{const t=f.value,c=f.constraint;if(!(c instanceof we))throw o.shouldNeverHappen();return new Pn(f.document,{assembly:Pr,axes:[Tn(t.rawValue.x,c.components[0]),Tn(t.rawValue.y,c.components[1]),Tn(t.rawValue.z,c.components[2])],parser:he,value:t,viewProps:f.viewProps})}};class qe{constructor(t=0,c=0,m=0,x=0){this.x=t,this.y=c,this.z=m,this.w=x}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(e(t))return!1;const c=t.x,m=t.y,x=t.z,j=t.w;return!(typeof c!="number"||typeof m!="number"||typeof x!="number"||typeof j!="number")}static equals(t,c){return t.x===c.x&&t.y===c.y&&t.z===c.z&&t.w===c.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Tr={toComponents:f=>f.getComponents(),fromComponents:f=>new qe(...f)};function ia(f){return qe.isObject(f)?new qe(f.x,f.y,f.z,f.w):new qe}function na(f,t){f.writeProperty("x",t.x),f.writeProperty("y",t.y),f.writeProperty("z",t.z),f.writeProperty("w",t.w)}function ra(f,t){return new we({assembly:Tr,components:[fe("x"in f?f.x:void 0,t.x),fe("y"in f?f.y:void 0,t.y),fe("z"in f?f.z:void 0,t.z),fe("w"in f?f.w:void 0,t.w)]})}function sa(f,t){return{baseStep:Ue(t),constraint:t,textProps:rt.fromObject({draggingScale:He(t,f),formatter:Gt(Ii(t,f))})}}const oa={id:"input-point4d",type:"input",accept:(f,t)=>{if(!qe.isObject(f))return null;const c=G,m=F(t,{x:c.optional.custom(_e),y:c.optional.custom(_e),z:c.optional.custom(_e),w:c.optional.custom(_e)});return m?{initialValue:f,params:m}:null},binding:{reader:f=>ia,constraint:f=>ra(f.params,f.initialValue),equals:qe.equals,writer:f=>na},controller:f=>{const t=f.value,c=f.constraint;if(!(c instanceof we))throw o.shouldNeverHappen();return new Pn(f.document,{assembly:Tr,axes:t.rawValue.getComponents().map((m,x)=>sa(m,c.components[x])),parser:he,value:t,viewProps:f.viewProps})}};function aa(f){const t=[],c=fn(f.options);return c&&t.push(c),new Y(t)}const la={id:"input-string",type:"input",accept:(f,t)=>{if(typeof f!="string")return null;const m=F(t,{options:G.optional.custom(Li)});return m?{initialValue:f,params:m}:null},binding:{reader:f=>zn,constraint:f=>aa(f.params),writer:f=>pi},controller:f=>{var t;const c=f.document,m=f.value,x=f.constraint;return x&&at(x,pt)?new Dt(c,{props:rt.fromObject({options:(t=pn(x))!==null&&t!==void 0?t:[]}),value:m,viewProps:f.viewProps}):new ce(c,{parser:j=>j,props:rt.fromObject({formatter:ln}),value:m,viewProps:f.viewProps})}},vi={monitor:{defaultInterval:200,defaultLineCount:3}},Or=v("mll");class ca{constructor(t,c){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=c.formatter,this.element=t.createElement("div"),this.element.classList.add(Or()),c.viewProps.bindClassModifiers(this.element);const m=t.createElement("textarea");m.classList.add(Or("i")),m.style.height=`calc(var(--bld-us) * ${c.lineCount})`,m.readOnly=!0,c.viewProps.bindDisabled(m),this.element.appendChild(m),this.textareaElem_=m,c.value.emitter.on("change",this.onValueUpdate_),this.value=c.value,this.update_()}update_(){const t=this.textareaElem_,c=t.scrollTop===t.scrollHeight-t.clientHeight,m=[];this.value.rawValue.forEach(x=>{x!==void 0&&m.push(this.formatter_(x))}),t.textContent=m.join(`
`),c&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class On{constructor(t,c){this.value=c.value,this.viewProps=c.viewProps,this.view=new ca(t,{formatter:c.formatter,lineCount:c.lineCount,value:this.value,viewProps:this.viewProps})}}const Dr=v("sgl");class ua{constructor(t,c){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=c.formatter,this.element=t.createElement("div"),this.element.classList.add(Dr()),c.viewProps.bindClassModifiers(this.element);const m=t.createElement("input");m.classList.add(Dr("i")),m.readOnly=!0,m.type="text",c.viewProps.bindDisabled(m),this.element.appendChild(m),this.inputElement=m,c.value.emitter.on("change",this.onValueUpdate_),this.value=c.value,this.update_()}update_(){const t=this.value.rawValue,c=t[t.length-1];this.inputElement.value=c!==void 0?this.formatter_(c):""}onValueUpdate_(){this.update_()}}class Dn{constructor(t,c){this.value=c.value,this.viewProps=c.viewProps,this.view=new ua(t,{formatter:c.formatter,value:this.value,viewProps:this.viewProps})}}const ha={id:"monitor-bool",type:"monitor",accept:(f,t)=>{if(typeof f!="boolean")return null;const m=F(t,{lineCount:G.optional.number});return m?{initialValue:f,params:m}:null},binding:{reader:f=>Mi},controller:f=>{var t;return f.value.rawValue.length===1?new Dn(f.document,{formatter:Xe,value:f.value,viewProps:f.viewProps}):new On(f.document,{formatter:Xe,lineCount:(t=f.params.lineCount)!==null&&t!==void 0?t:vi.monitor.defaultLineCount,value:f.value,viewProps:f.viewProps})}},Se=v("grl");class da{constructor(t,c){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Se()),c.viewProps.bindClassModifiers(this.element),this.formatter_=c.formatter,this.props_=c.props,this.cursor_=c.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const m=t.createElementNS(lt,"svg");m.classList.add(Se("g")),m.style.height=`calc(var(--bld-us) * ${c.lineCount})`,this.element.appendChild(m),this.svgElem_=m;const x=t.createElementNS(lt,"polyline");this.svgElem_.appendChild(x),this.lineElem_=x;const j=t.createElement("div");j.classList.add(Se("t"),v("tt")()),this.element.appendChild(j),this.tooltipElem_=j,c.value.emitter.on("change",this.onValueUpdate_),this.value=c.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const t=this.svgElem_.getBoundingClientRect(),c=this.value.rawValue.length-1,m=this.props_.get("minValue"),x=this.props_.get("maxValue"),j=[];this.value.rawValue.forEach((It,Rt)=>{if(It===void 0)return;const pe=Xt(Rt,0,c,0,t.width),mi=Xt(It,m,x,t.height,0);j.push([pe,mi].join(","))}),this.lineElem_.setAttributeNS(null,"points",j.join(" "));const $=this.tooltipElem_,vt=this.value.rawValue[this.cursor_.rawValue];if(vt===void 0){$.classList.remove(Se("t","a"));return}const Et=Xt(this.cursor_.rawValue,0,c,0,t.width),Ot=Xt(vt,m,x,t.height,0);$.style.left=`${Et}px`,$.style.top=`${Ot}px`,$.textContent=`${this.formatter_(vt)}`,$.classList.contains(Se("t","a"))||($.classList.add(Se("t","a"),Se("t","in")),ft($),$.classList.remove(Se("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class fa{constructor(t,c){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=c.props,this.value=c.value,this.viewProps=c.viewProps,this.cursor_=dt(-1),this.view=new da(t,{cursor:this.cursor_,formatter:c.formatter,lineCount:c.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!it(t))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const m=new Ae(this.view.element);m.emitter.on("down",this.onGraphPointerDown_),m.emitter.on("move",this.onGraphPointerMove_),m.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){const c=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Xt(t.offsetX,0,c.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){if(!t.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(Xt(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Mn(f){return"format"in f&&!e(f.format)?f.format:Gt(2)}function pa(f){var t;return f.value.rawValue.length===1?new Dn(f.document,{formatter:Mn(f.params),value:f.value,viewProps:f.viewProps}):new On(f.document,{formatter:Mn(f.params),lineCount:(t=f.params.lineCount)!==null&&t!==void 0?t:vi.monitor.defaultLineCount,value:f.value,viewProps:f.viewProps})}function ga(f){var t,c,m;return new fa(f.document,{formatter:Mn(f.params),lineCount:(t=f.params.lineCount)!==null&&t!==void 0?t:vi.monitor.defaultLineCount,props:rt.fromObject({maxValue:(c="max"in f.params?f.params.max:null)!==null&&c!==void 0?c:100,minValue:(m="min"in f.params?f.params.min:null)!==null&&m!==void 0?m:0}),value:f.value,viewProps:f.viewProps})}function Mr(f){return"view"in f&&f.view==="graph"}const va={id:"monitor-number",type:"monitor",accept:(f,t)=>{if(typeof f!="number")return null;const c=G,m=F(t,{format:c.optional.function,lineCount:c.optional.number,max:c.optional.number,min:c.optional.number,view:c.optional.string});return m?{initialValue:f,params:m}:null},binding:{defaultBufferSize:f=>Mr(f)?64:1,reader:f=>Nn},controller:f=>Mr(f.params)?ga(f):pa(f)},ma={id:"monitor-string",type:"monitor",accept:(f,t)=>{if(typeof f!="string")return null;const c=G,m=F(t,{lineCount:c.optional.number,multiline:c.optional.boolean});return m?{initialValue:f,params:m}:null},binding:{reader:f=>zn},controller:f=>{var t;const c=f.value;return c.rawValue.length>1||"multiline"in f.params&&f.params.multiline?new On(f.document,{formatter:ln,lineCount:(t=f.params.lineCount)!==null&&t!==void 0?t:vi.monitor.defaultLineCount,value:c,viewProps:f.viewProps}):new Dn(f.document,{formatter:ln,value:c,viewProps:f.viewProps})}};class _a{constructor(t){this.onValueChange_=this.onValueChange_.bind(this),this.reader=t.reader,this.writer=t.writer,this.emitter=new h,this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.target=t.target,this.read()}read(){const t=this.target.read();t!==void 0&&(this.value.rawValue=this.reader(t))}write_(t){this.writer(this.target,t)}onValueChange_(t){this.write_(t.rawValue),this.emitter.emit("change",{options:t.options,rawValue:t.rawValue,sender:this})}}function ba(f,t){const c=f.accept(t.target.read(),t.params);if(e(c))return null;const m=G,x={target:t.target,initialValue:c.initialValue,params:c.params},j=f.binding.reader(x),$=f.binding.constraint?f.binding.constraint(x):void 0,vt=dt(j(c.initialValue),{constraint:$,equals:f.binding.equals}),Et=new _a({reader:j,target:t.target,value:vt,writer:f.binding.writer(x)}),Ot=m.optional.boolean(t.params.disabled).value,It=m.optional.boolean(t.params.hidden).value,Rt=f.controller({constraint:$,document:t.document,initialValue:c.initialValue,params:c.params,value:Et.value,viewProps:Zt.create({disabled:Ot,hidden:It})}),pe=m.optional.string(t.params.label).value;return new ie(t.document,{binding:Et,blade:Kt(),props:rt.fromObject({label:pe!=null?pe:t.target.key}),valueController:Rt})}class wa{constructor(t){this.onTick_=this.onTick_.bind(this),this.reader_=t.reader,this.target=t.target,this.emitter=new h,this.value=t.value,this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const t=this.target.read();if(t===void 0)return;const c=this.value.rawValue,m=this.reader_(t);this.value.rawValue=_s(c,m),this.emitter.emit("update",{rawValue:m,sender:this})}onTick_(t){this.read()}}function ya(f,t){return t===0?new U:new W(f,t!=null?t:vi.monitor.defaultInterval)}function Ca(f,t){var c,m,x;const j=G,$=f.accept(t.target.read(),t.params);if(e($))return null;const vt={target:t.target,initialValue:$.initialValue,params:$.params},Et=f.binding.reader(vt),Ot=(m=(c=j.optional.number(t.params.bufferSize).value)!==null&&c!==void 0?c:f.binding.defaultBufferSize&&f.binding.defaultBufferSize($.params))!==null&&m!==void 0?m:1,It=j.optional.number(t.params.interval).value,Rt=new wa({reader:Et,target:t.target,ticker:ya(t.document,It),value:vs(Ot)}),pe=j.optional.boolean(t.params.disabled).value,mi=j.optional.boolean(t.params.hidden).value,_i=f.controller({document:t.document,params:$.params,value:Rt.value,viewProps:Zt.create({disabled:pe,hidden:mi})}),$e=(x=j.optional.string(t.params.label).value)!==null&&x!==void 0?x:t.target.key;return new le(t.document,{binding:Rt,blade:Kt(),props:rt.fromObject({label:$e}),valueController:_i})}class Sa{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t){t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput(t,c,m){const x=c.read();if(e(x))throw new o({context:{key:c.key},type:"nomatchingcontroller"});const j=this.pluginsMap_.inputs.reduce(($,vt)=>$!=null?$:ba(vt,{document:t,target:c,params:m}),null);if(j)return j;throw new o({context:{key:c.key},type:"nomatchingcontroller"})}createMonitor(t,c,m){const x=this.pluginsMap_.monitors.reduce((j,$)=>j!=null?j:Ca($,{document:t,params:m,target:c}),null);if(x)return x;throw new o({context:{key:c.key},type:"nomatchingcontroller"})}createBlade(t,c){const m=this.pluginsMap_.blades.reduce((x,j)=>x!=null?x:L(j,{document:t,params:c}),null);if(!m)throw new o({type:"nomatchingview",context:{params:c}});return m}createBladeApi(t){if(t instanceof ie)return new ei(t);if(t instanceof le)return new Ve(t);if(t instanceof De)return new Ne(t,this);const c=this.pluginsMap_.blades.reduce((m,x)=>m!=null?m:x.api({controller:t,pool:this}),null);if(!c)throw o.shouldNeverHappen();return c}}function xa(){const f=new Sa;return[Zo,ea,oa,la,zo,Fo,Io,Mo,Os,ha,ma,va,Ht,Zi,Qi,z].forEach(t=>{f.register(t)}),f}class Ar extends S{constructor(t){super(t),this.emitter_=new h,this.controller_.valueController.value.emitter.on("change",c=>{this.emitter_.emit("change",{event:new M(this,c.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get options(){return this.controller_.valueController.props.get("options")}set options(t){this.controller_.valueController.props.set("options",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,c){const m=c.bind(this);return this.emitter_.on(t,x=>{m(x.event)}),this}}class kr extends S{constructor(t){super(t),this.emitter_=new h,this.controller_.valueController.value.emitter.on("change",c=>{this.emitter_.emit("change",{event:new M(this,c.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(t){this.controller_.valueController.sliderController.props.set("maxValue",t)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(t){this.controller_.valueController.sliderController.props.set("minValue",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,c){const m=c.bind(this);return this.emitter_.on(t,x=>{m(x.event)}),this}}class Lr extends S{constructor(t){super(t),this.emitter_=new h,this.controller_.valueController.value.emitter.on("change",c=>{this.emitter_.emit("change",{event:new M(this,c.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(t){this.controller_.valueController.props.set("formatter",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,c){const m=c.bind(this);return this.emitter_.on(t,x=>{m(x.event)}),this}}const Ea=function(){return{id:"list",type:"blade",accept(f){const t=G,c=F(f,{options:t.required.custom(Li),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return c?{params:c}:null},controller(f){const t=new Dt(f.document,{props:rt.fromObject({options:Gn(f.params.options)}),value:dt(f.params.value),viewProps:f.viewProps});return new ge(f.document,{blade:f.blade,props:rt.fromObject({label:f.params.label}),valueController:t})},api(f){return!(f.controller instanceof ge)||!(f.controller.valueController instanceof Dt)?null:new Ar(f.controller)}}}();function Pa(f){return f.reduce((t,c)=>Object.assign(t,{[c.presetKey]:c.read()}),{})}function Ta(f,t){f.forEach(c=>{const m=t[c.presetKey];m!==void 0&&c.write(m)})}class Oa extends ii{constructor(t,c){super(t,c)}get element(){return this.controller_.view.element}importPreset(t){const c=this.controller_.rackController.rack.find(ie).map(m=>m.binding.target);Ta(c,t),this.refresh()}exportPreset(){const t=this.controller_.rackController.rack.find(ie).map(c=>c.binding.target);return Pa(t)}refresh(){this.controller_.rackController.rack.find(ie).forEach(t=>{t.binding.read()}),this.controller_.rackController.rack.find(le).forEach(t=>{t.binding.read()})}}class Da extends si{constructor(t,c){super(t,{expanded:c.expanded,blade:c.blade,props:c.props,root:!0,viewProps:c.viewProps})}}const Ma={id:"slider",type:"blade",accept(f){const t=G,c=F(f,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return c?{params:c}:null},controller(f){var t,c;const m=(t=f.params.value)!==null&&t!==void 0?t:0,x=new dn(f.document,{baseStep:1,parser:he,sliderProps:rt.fromObject({maxValue:f.params.max,minValue:f.params.min}),textProps:rt.fromObject({draggingScale:He(void 0,m),formatter:(c=f.params.format)!==null&&c!==void 0?c:ps}),value:dt(m),viewProps:f.viewProps});return new ge(f.document,{blade:f.blade,props:rt.fromObject({label:f.params.label}),valueController:x})},api(f){return!(f.controller instanceof ge)||!(f.controller.valueController instanceof dn)?null:new kr(f.controller)}},Aa=function(){return{id:"text",type:"blade",accept(f){const t=G,c=F(f,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return c?{params:c}:null},controller(f){var t;const c=new ce(f.document,{parser:f.params.parse,props:rt.fromObject({formatter:(t=f.params.format)!==null&&t!==void 0?t:m=>String(m)}),value:dt(f.params.value),viewProps:f.viewProps});return new ge(f.document,{blade:f.blade,props:rt.fromObject({label:f.params.label}),valueController:c})},api(f){return!(f.controller instanceof ge)||!(f.controller.valueController instanceof ce)?null:new Lr(f.controller)}}}();function ka(f){const t=f.createElement("div");return t.classList.add(v("dfw")()),f.body&&f.body.appendChild(t),t}function Ir(f,t,c){if(f.querySelector(`style[data-tp-style=${t}]`))return;const m=f.createElement("style");m.dataset.tpStyle=t,m.textContent=c,f.head.appendChild(m)}class La extends Oa{constructor(t){var c,m;const x=t!=null?t:{},j=(c=x.document)!==null&&c!==void 0?c:ot(),$=xa(),vt=new Da(j,{expanded:x.expanded,blade:Kt(),props:rt.fromObject({title:x.title}),viewProps:Zt.create()});super(vt,$),this.pool_=$,this.containerElem_=(m=x.container)!==null&&m!==void 0?m:ka(j),this.containerElem_.appendChild(this.element),this.doc_=j,this.usesDefaultWrapper_=!x.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw o.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw o.alreadyDisposed();if(this.usesDefaultWrapper_){const c=t.parentElement;c&&c.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach(m=>{this.pool_.register(m),this.embedPluginStyle_(m)})}embedPluginStyle_(t){t.css&&Ir(this.document,`plugin-${t.id}`,t.css)}setUpDefaultPlugins_(){Ir(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(t=>{this.embedPluginStyle_(t)}),this.registerPlugin({plugins:[Ma,Ea,z,Aa]})}}const Ia=new b("3.1.0");y.BladeApi=S,y.ButtonApi=s,y.FolderApi=ii,y.InputBindingApi=ei,y.ListApi=Ar,y.MonitorBindingApi=Ve,y.Pane=La,y.SeparatorApi=Ei,y.SliderApi=kr,y.TabApi=Oi,y.TabPageApi=ze,y.TextApi=Lr,y.TpChangeEvent=M,y.VERSION=Ia,Object.defineProperty(y,"__esModule",{value:!0})})})(In,In.exports);const Bt={pageTitle:"Zoomoot",title:"hello",description:"Amimation by zoomoot",background:"#000",width:1280,height:720,center_zoom_anim:{y:720/2,x:1280/2},offset:{x:130,y:130},ratio:2.9296875,framerate:60,duration:20,reverse:!1,video_export:"download",bitrate:15e6,vignette_radius:.66,vignette_smoothness:.09},Ya=new In.exports.Pane,Xa=Ya.addFolder({title:"Toolbox",expanded:!0}),oe=Xa.addTab({pages:[{title:"Animate"},{title:"Edit"}]}),Ua=oe.pages[0].addInput(Bt,"vignette_radius",{min:0,max:1}),Ha=oe.pages[0].addInput(Bt,"vignette_smoothness",{min:-1,max:1});oe.pages[0].addInput(Bt,"framerate");oe.pages[0].addInput(Bt,"duration");oe.pages[0].addInput(Bt,"reverse");Ua.on("change",A=>{te.updateVignette({smoothness:Bt.vignette_smoothness,radius:A.value})});Ha.on("change",A=>{te.updateVignette({smoothness:A.value,radius:Bt.vignette_radius})});const Wa=oe.pages[0].addButton({title:"Start"});Wa.on("click",()=>{te.play()});const Ga=oe.pages[0].addButton({title:"Stop"});Ga.on("click",()=>{te.stop()});const Ka=oe.pages[0].addButton({title:"Record"});Ka.on("click",()=>{te.record()});const qa=oe.pages[1].addButton({title:"Edit Next"});qa.on("click",()=>{te.editNext()});const $a=oe.pages[1].addButton({title:"Edit end"});$a.on("click",()=>{te.editEnd()});const Za=oe.pages[1].addButton({title:"Reset"});Za.on("click",()=>{te.reset()});var se={};const Ja={},Qa=Object.freeze(Object.defineProperty({__proto__:null,default:Ja},Symbol.toStringTag,{value:"Module"})),kn=za(Qa);(function(A){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var p=p||{version:"5.2.1"};if(A.fabric=p,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?p.document=document:p.document=document.implementation.createHTMLDocument(""),p.window=window;else{var y=kn,b=new y.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;p.document=b.document,p.jsdomImplForWrapper=kn.implForWrapper,p.nodeCanvas=kn.Canvas,p.window=b,DOMParser=p.window.DOMParser}p.isTouchSupported="ontouchstart"in p.window||"ontouchstart"in p.document||p.window&&p.window.navigator&&p.window.navigator.maxTouchPoints>0,p.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",p.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],p.DPI=96,p.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",p.commaWsp="(?:\\s+,?\\s*|,\\s*)",p.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,p.reNonWord=/[ \n\.,;!\?\-]/,p.fontPaths={},p.iMatrix=[1,0,0,1,0,0],p.svgNS="http://www.w3.org/2000/svg",p.perfLimitSizeTotal=2097152,p.maxCacheSideLimit=4096,p.minCacheSideLimit=256,p.charWidthsCache={},p.textureSize=2048,p.disableStyleCopyPaste=!1,p.enableGLFiltering=!0,p.devicePixelRatio=p.window.devicePixelRatio||p.window.webkitDevicePixelRatio||p.window.mozDevicePixelRatio||1,p.browserShadowBlurConstant=1,p.arcToSegmentsCache={},p.boundsOfCurveCache={},p.cachesBoundsOfCurve=!0,p.forceGLPutImageData=!1,p.initFilterBackend=function(){if(p.enableGLFiltering&&p.isWebglSupported&&p.isWebglSupported(p.textureSize))return console.log("max texture size: "+p.maxTextureSize),new p.WebglFilterBackend({tileSize:p.textureSize});if(p.Canvas2dFilterBackend)return new p.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=p),function(){function d(n,o){if(!!this.__eventListeners[n]){var u=this.__eventListeners[n];o?u[u.indexOf(o)]=!1:p.util.array.fill(u,!1)}}function i(n,o){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var u in n)this.on(u,n[u]);else this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(o);return this}function a(n,o){var u=function(){o.apply(this,arguments),this.off(n,u)}.bind(this);this.on(n,u)}function l(n,o){if(arguments.length===1)for(var u in n)a.call(this,u,n[u]);else a.call(this,n,o);return this}function e(n,o){if(!this.__eventListeners)return this;if(arguments.length===0)for(n in this.__eventListeners)d.call(this,n);else if(arguments.length===1&&typeof arguments[0]=="object")for(var u in n)d.call(this,u,n[u]);else d.call(this,n,o);return this}function r(n,o){if(!this.__eventListeners)return this;var u=this.__eventListeners[n];if(!u)return this;for(var s=0,h=u.length;s<h;s++)u[s]&&u[s].call(this,o||{});return this.__eventListeners[n]=u.filter(function(g){return g!==!1}),this}p.Observable={fire:r,on:i,once:l,off:e}}(),p.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var d=0,i=arguments.length;d<i;d++)this._onObjectAdded(arguments[d]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(d,i,a){var l=this._objects;return a?l[i]=d:l.splice(i,0,d),this._onObjectAdded&&this._onObjectAdded(d),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var d=this._objects,i,a=!1,l=0,e=arguments.length;l<e;l++)i=d.indexOf(arguments[l]),i!==-1&&(a=!0,d.splice(i,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[l]));return this.renderOnAddRemove&&a&&this.requestRenderAll(),this},forEachObject:function(d,i){for(var a=this.getObjects(),l=0,e=a.length;l<e;l++)d.call(i,a[l],l,a);return this},getObjects:function(d){return typeof d>"u"?this._objects.concat():this._objects.filter(function(i){return i.type===d})},item:function(d){return this._objects[d]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(d,i){return this._objects.indexOf(d)>-1?!0:i?this._objects.some(function(a){return typeof a.contains=="function"&&a.contains(d,!0)}):!1},complexity:function(){return this._objects.reduce(function(d,i){return d+=i.complexity?i.complexity():0,d},0)}},p.CommonMethods={_setOptions:function(d){for(var i in d)this.set(i,d[i])},_initGradient:function(d,i){d&&d.colorStops&&!(d instanceof p.Gradient)&&this.set(i,new p.Gradient(d))},_initPattern:function(d,i,a){d&&d.source&&!(d instanceof p.Pattern)?this.set(i,new p.Pattern(d,a)):a&&a()},_setObject:function(d){for(var i in d)this._set(i,d[i])},set:function(d,i){return typeof d=="object"?this._setObject(d):this._set(d,i),this},_set:function(d,i){this[d]=i},toggle:function(d){var i=this.get(d);return typeof i=="boolean"&&this.set(d,!i),this},get:function(d){return this[d]}},function(d){var i=Math.sqrt,a=Math.atan2,l=Math.pow,e=Math.PI/180,r=Math.PI/2;p.util={cos:function(n){if(n===0)return 1;n<0&&(n=-n);var o=n/r;switch(o){case 1:case 3:return 0;case 2:return-1}return Math.cos(n)},sin:function(n){if(n===0)return 0;var o=n/r,u=1;switch(n<0&&(u=-1),o){case 1:return u;case 2:return 0;case 3:return-u}return Math.sin(n)},removeFromArray:function(n,o){var u=n.indexOf(o);return u!==-1&&n.splice(u,1),n},getRandomInt:function(n,o){return Math.floor(Math.random()*(o-n+1))+n},degreesToRadians:function(n){return n*e},radiansToDegrees:function(n){return n/e},rotatePoint:function(n,o,u){var s=new p.Point(n.x-o.x,n.y-o.y),h=p.util.rotateVector(s,u);return new p.Point(h.x,h.y).addEquals(o)},rotateVector:function(n,o){var u=p.util.sin(o),s=p.util.cos(o),h=n.x*s-n.y*u,g=n.x*u+n.y*s;return{x:h,y:g}},createVector:function(n,o){return new p.Point(o.x-n.x,o.y-n.y)},calcAngleBetweenVectors:function(n,o){return Math.acos((n.x*o.x+n.y*o.y)/(Math.hypot(n.x,n.y)*Math.hypot(o.x,o.y)))},getHatVector:function(n){return new p.Point(n.x,n.y).multiply(1/Math.hypot(n.x,n.y))},getBisector:function(n,o,u){var s=p.util.createVector(n,o),h=p.util.createVector(n,u),g=p.util.calcAngleBetweenVectors(s,h),v=p.util.calcAngleBetweenVectors(p.util.rotateVector(s,g),h),_=g*(v===0?1:-1)/2;return{vector:p.util.getHatVector(p.util.rotateVector(s,_)),angle:g}},projectStrokeOnPoints:function(n,o,u){var s=[],h=o.strokeWidth/2,g=o.strokeUniform?new p.Point(1/o.scaleX,1/o.scaleY):new p.Point(1,1),v=function(_){var w=h/Math.hypot(_.x,_.y);return new p.Point(_.x*w*g.x,_.y*w*g.y)};return n.length<=1||n.forEach(function(_,w){var C=new p.Point(_.x,_.y),P,D;w===0?(D=n[w+1],P=u?v(p.util.createVector(D,C)).addEquals(C):n[n.length-1]):w===n.length-1?(P=n[w-1],D=u?v(p.util.createVector(P,C)).addEquals(C):n[0]):(P=n[w-1],D=n[w+1]);var I=p.util.getBisector(C,P,D),N=I.vector,H=I.angle,K,J;if(o.strokeLineJoin==="miter"&&(K=-h/Math.sin(H/2),J=new p.Point(N.x*K*g.x,N.y*K*g.y),Math.hypot(J.x,J.y)/h<=o.strokeMiterLimit)){s.push(C.add(J)),s.push(C.subtract(J));return}K=-h*Math.SQRT2,J=new p.Point(N.x*K*g.x,N.y*K*g.y),s.push(C.add(J)),s.push(C.subtract(J))}),s},transformPoint:function(n,o,u){return u?new p.Point(o[0]*n.x+o[2]*n.y,o[1]*n.x+o[3]*n.y):new p.Point(o[0]*n.x+o[2]*n.y+o[4],o[1]*n.x+o[3]*n.y+o[5])},makeBoundingBoxFromPoints:function(n,o){if(o)for(var u=0;u<n.length;u++)n[u]=p.util.transformPoint(n[u],o);var s=[n[0].x,n[1].x,n[2].x,n[3].x],h=p.util.array.min(s),g=p.util.array.max(s),v=g-h,_=[n[0].y,n[1].y,n[2].y,n[3].y],w=p.util.array.min(_),C=p.util.array.max(_),P=C-w;return{left:h,top:w,width:v,height:P}},invertTransform:function(n){var o=1/(n[0]*n[3]-n[1]*n[2]),u=[o*n[3],-o*n[1],-o*n[2],o*n[0]],s=p.util.transformPoint({x:n[4],y:n[5]},u,!0);return u[4]=-s.x,u[5]=-s.y,u},toFixed:function(n,o){return parseFloat(Number(n).toFixed(o))},parseUnit:function(n,o){var u=/\D{0,2}$/.exec(n),s=parseFloat(n);switch(o||(o=p.Text.DEFAULT_SVG_FONT_SIZE),u[0]){case"mm":return s*p.DPI/25.4;case"cm":return s*p.DPI/2.54;case"in":return s*p.DPI;case"pt":return s*p.DPI/72;case"pc":return s*p.DPI/72*12;case"em":return s*o;default:return s}},falseFunction:function(){return!1},getKlass:function(n,o){return n=p.util.string.camelize(n.charAt(0).toUpperCase()+n.slice(1)),p.util.resolveNamespace(o)[n]},getSvgAttributes:function(n){var o=["instantiated_by_use","style","id","class"];switch(n){case"linearGradient":o=o.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":o=o.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":o=o.concat(["offset","stop-color","stop-opacity"]);break}return o},resolveNamespace:function(n){if(!n)return p;var o=n.split("."),u=o.length,s,h=d||p.window;for(s=0;s<u;++s)h=h[o[s]];return h},loadImage:function(n,o,u,s){if(!n){o&&o.call(u,n);return}var h=p.util.createImage(),g=function(){o&&o.call(u,h,!1),h=h.onload=h.onerror=null};h.onload=g,h.onerror=function(){p.log("Error loading "+h.src),o&&o.call(u,null,!0),h=h.onload=h.onerror=null},n.indexOf("data")!==0&&s!==void 0&&s!==null&&(h.crossOrigin=s),n.substring(0,14)==="data:image/svg"&&(h.onload=null,p.util.loadImageInDom(h,g)),h.src=n},loadImageInDom:function(n,o){var u=p.document.createElement("div");u.style.width=u.style.height="1px",u.style.left=u.style.top="-100%",u.style.position="absolute",u.appendChild(n),p.document.querySelector("body").appendChild(u),n.onload=function(){o(),u.parentNode.removeChild(u),u=null}},enlivenObjects:function(n,o,u,s){n=n||[];var h=[],g=0,v=n.length;function _(){++g===v&&o&&o(h.filter(function(w){return w}))}if(!v){o&&o(h);return}n.forEach(function(w,C){if(!w||!w.type){_();return}var P=p.util.getKlass(w.type,u);P.fromObject(w,function(D,I){I||(h[C]=D),s&&s(w,D,I),_()})})},enlivenObjectEnlivables:function(n,o,u){var s=p.Object.ENLIVEN_PROPS.filter(function(h){return!!n[h]});p.util.enlivenObjects(s.map(function(h){return n[h]}),function(h){var g={};s.forEach(function(v,_){g[v]=h[_],o&&(o[v]=h[_])}),u&&u(g)})},enlivenPatterns:function(n,o){n=n||[];function u(){++h===g&&o&&o(s)}var s=[],h=0,g=n.length;if(!g){o&&o(s);return}n.forEach(function(v,_){v&&v.source?new p.Pattern(v,function(w){s[_]=w,u()}):(s[_]=v,u())})},groupSVGElements:function(n,o,u){var s;return n&&n.length===1?n[0]:(o&&(o.width&&o.height?o.centerPoint={x:o.width/2,y:o.height/2}:(delete o.width,delete o.height)),s=new p.Group(n,o),typeof u<"u"&&(s.sourcePath=u),s)},populateWithProperties:function(n,o,u){if(u&&Array.isArray(u))for(var s=0,h=u.length;s<h;s++)u[s]in n&&(o[u[s]]=n[u[s]])},createCanvasElement:function(){return p.document.createElement("canvas")},copyCanvasElement:function(n){var o=p.util.createCanvasElement();return o.width=n.width,o.height=n.height,o.getContext("2d").drawImage(n,0,0),o},toDataURL:function(n,o,u){return n.toDataURL("image/"+o,u)},createImage:function(){return p.document.createElement("img")},multiplyTransformMatrices:function(n,o,u){return[n[0]*o[0]+n[2]*o[1],n[1]*o[0]+n[3]*o[1],n[0]*o[2]+n[2]*o[3],n[1]*o[2]+n[3]*o[3],u?0:n[0]*o[4]+n[2]*o[5]+n[4],u?0:n[1]*o[4]+n[3]*o[5]+n[5]]},qrDecompose:function(n){var o=a(n[1],n[0]),u=l(n[0],2)+l(n[1],2),s=i(u),h=(n[0]*n[3]-n[2]*n[1])/s,g=a(n[0]*n[2]+n[1]*n[3],u);return{angle:o/e,scaleX:s,scaleY:h,skewX:g/e,skewY:0,translateX:n[4],translateY:n[5]}},calcRotateMatrix:function(n){if(!n.angle)return p.iMatrix.concat();var o=p.util.degreesToRadians(n.angle),u=p.util.cos(o),s=p.util.sin(o);return[u,s,-s,u,0,0]},calcDimensionsMatrix:function(n){var o=typeof n.scaleX>"u"?1:n.scaleX,u=typeof n.scaleY>"u"?1:n.scaleY,s=[n.flipX?-o:o,0,0,n.flipY?-u:u,0,0],h=p.util.multiplyTransformMatrices,g=p.util.degreesToRadians;return n.skewX&&(s=h(s,[1,0,Math.tan(g(n.skewX)),1],!0)),n.skewY&&(s=h(s,[1,Math.tan(g(n.skewY)),0,1],!0)),s},composeMatrix:function(n){var o=[1,0,0,1,n.translateX||0,n.translateY||0],u=p.util.multiplyTransformMatrices;return n.angle&&(o=u(o,p.util.calcRotateMatrix(n))),(n.scaleX!==1||n.scaleY!==1||n.skewX||n.skewY||n.flipX||n.flipY)&&(o=u(o,p.util.calcDimensionsMatrix(n))),o},resetObjectTransform:function(n){n.scaleX=1,n.scaleY=1,n.skewX=0,n.skewY=0,n.flipX=!1,n.flipY=!1,n.rotate(0)},saveObjectTransform:function(n){return{scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,angle:n.angle,left:n.left,flipX:n.flipX,flipY:n.flipY,top:n.top}},isTransparent:function(n,o,u,s){s>0&&(o>s?o-=s:o=0,u>s?u-=s:u=0);var h=!0,g,v,_=n.getImageData(o,u,s*2||1,s*2||1),w=_.data.length;for(g=3;g<w&&(v=_.data[g],h=v<=0,h!==!1);g+=4);return _=null,h},parsePreserveAspectRatioAttribute:function(n){var o="meet",u="Mid",s="Mid",h=n.split(" "),g;return h&&h.length&&(o=h.pop(),o!=="meet"&&o!=="slice"?(g=o,o="meet"):h.length&&(g=h.pop())),u=g!=="none"?g.slice(1,4):"none",s=g!=="none"?g.slice(5,8):"none",{meetOrSlice:o,alignX:u,alignY:s}},clearFabricFontCache:function(n){n=(n||"").toLowerCase(),n?p.charWidthsCache[n]&&delete p.charWidthsCache[n]:p.charWidthsCache={}},limitDimsByArea:function(n,o){var u=Math.sqrt(o*n),s=Math.floor(o/u);return{x:Math.floor(u),y:s}},capValue:function(n,o,u){return Math.max(n,Math.min(o,u))},findScaleToFit:function(n,o){return Math.min(o.width/n.width,o.height/n.height)},findScaleToCover:function(n,o){return Math.max(o.width/n.width,o.height/n.height)},matrixToSVG:function(n){return"matrix("+n.map(function(o){return p.util.toFixed(o,p.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(n,o){var u=p.util.invertTransform(o),s=p.util.multiplyTransformMatrices(u,n.calcOwnMatrix());p.util.applyTransformToObject(n,s)},addTransformToObject:function(n,o){p.util.applyTransformToObject(n,p.util.multiplyTransformMatrices(o,n.calcOwnMatrix()))},applyTransformToObject:function(n,o){var u=p.util.qrDecompose(o),s=new p.Point(u.translateX,u.translateY);n.flipX=!1,n.flipY=!1,n.set("scaleX",u.scaleX),n.set("scaleY",u.scaleY),n.skewX=u.skewX,n.skewY=u.skewY,n.angle=u.angle,n.setPositionByOrigin(s,"center","center")},sizeAfterTransform:function(n,o,u){var s=n/2,h=o/2,g=[{x:-s,y:-h},{x:s,y:-h},{x:-s,y:h},{x:s,y:h}],v=p.util.calcDimensionsMatrix(u),_=p.util.makeBoundingBoxFromPoints(g,v);return{x:_.width,y:_.height}},mergeClipPaths:function(n,o){var u=n,s=o;u.inverted&&!s.inverted&&(u=o,s=n),p.util.applyTransformToObject(s,p.util.multiplyTransformMatrices(p.util.invertTransform(u.calcTransformMatrix()),s.calcTransformMatrix()));var h=u.inverted&&s.inverted;return h&&(u.inverted=s.inverted=!1),new p.Group([u],{clipPath:s,inverted:h})}}}(A),function(){var d=Array.prototype.join,i={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},a={m:"l",M:"L"};function l(T,B,R,V,G,F,k,X,Z,st,et){var lt=p.util.cos(T),ft=p.util.sin(T),yt=p.util.cos(B),it=p.util.sin(B),q=R*G*yt-V*F*it+k,ot=V*G*yt+R*F*it+X,ht=st+Z*(-R*G*ft-V*F*lt),nt=et+Z*(-V*G*ft+R*F*lt),ut=q+Z*(R*G*it+V*F*yt),wt=ot+Z*(V*G*it-R*F*yt);return["C",ht,nt,ut,wt,q,ot]}function e(T,B,R,V,G,F,k){var X=Math.PI,Z=k*X/180,st=p.util.sin(Z),et=p.util.cos(Z),lt=0,ft=0;R=Math.abs(R),V=Math.abs(V);var yt=-et*T*.5-st*B*.5,it=-et*B*.5+st*T*.5,q=R*R,ot=V*V,ht=it*it,nt=yt*yt,ut=q*ot-q*ht-ot*nt,wt=0;if(ut<0){var Pt=Math.sqrt(1-ut/(q*ot));R*=Pt,V*=Pt}else wt=(G===F?-1:1)*Math.sqrt(ut/(q*ht+ot*nt));var Ct=wt*R*it/V,ct=-wt*V*yt/R,xt=et*Ct-st*ct+T*.5,Tt=st*Ct+et*ct+B*.5,Mt=r(1,0,(yt-Ct)/R,(it-ct)/V),jt=r((yt-Ct)/R,(it-ct)/V,(-yt-Ct)/R,(-it-ct)/V);F===0&&jt>0?jt-=2*X:F===1&&jt<0&&(jt+=2*X);for(var At=Math.ceil(Math.abs(jt/X*2)),Ht=[],Vt=jt/At,Kt=8/3*Math.sin(Vt/4)*Math.sin(Vt/4)/Math.sin(Vt/2),$t=Mt+Vt,qt=0;qt<At;qt++)Ht[qt]=l(Mt,$t,et,st,R,V,xt,Tt,Kt,lt,ft),lt=Ht[qt][5],ft=Ht[qt][6],Mt=$t,$t+=Vt;return Ht}function r(T,B,R,V){var G=Math.atan2(B,T),F=Math.atan2(V,R);return F>=G?F-G:2*Math.PI-(G-F)}function n(T,B,R,V,G,F,k,X){var Z;if(p.cachesBoundsOfCurve&&(Z=d.call(arguments),p.boundsOfCurveCache[Z]))return p.boundsOfCurveCache[Z];var st=Math.sqrt,et=Math.min,lt=Math.max,ft=Math.abs,yt=[],it=[[],[]],q,ot,ht,nt,ut,wt,Pt,Ct;ot=6*T-12*R+6*G,q=-3*T+9*R-9*G+3*k,ht=3*R-3*T;for(var ct=0;ct<2;++ct){if(ct>0&&(ot=6*B-12*V+6*F,q=-3*B+9*V-9*F+3*X,ht=3*V-3*B),ft(q)<1e-12){if(ft(ot)<1e-12)continue;nt=-ht/ot,0<nt&&nt<1&&yt.push(nt);continue}Pt=ot*ot-4*ht*q,!(Pt<0)&&(Ct=st(Pt),ut=(-ot+Ct)/(2*q),0<ut&&ut<1&&yt.push(ut),wt=(-ot-Ct)/(2*q),0<wt&&wt<1&&yt.push(wt))}for(var xt,Tt,Mt=yt.length,jt=Mt,At;Mt--;)nt=yt[Mt],At=1-nt,xt=At*At*At*T+3*At*At*nt*R+3*At*nt*nt*G+nt*nt*nt*k,it[0][Mt]=xt,Tt=At*At*At*B+3*At*At*nt*V+3*At*nt*nt*F+nt*nt*nt*X,it[1][Mt]=Tt;it[0][jt]=T,it[1][jt]=B,it[0][jt+1]=k,it[1][jt+1]=X;var Ht=[{x:et.apply(null,it[0]),y:et.apply(null,it[1])},{x:lt.apply(null,it[0]),y:lt.apply(null,it[1])}];return p.cachesBoundsOfCurve&&(p.boundsOfCurveCache[Z]=Ht),Ht}function o(T,B,R){for(var V=R[1],G=R[2],F=R[3],k=R[4],X=R[5],Z=R[6],st=R[7],et=e(Z-T,st-B,V,G,k,X,F),lt=0,ft=et.length;lt<ft;lt++)et[lt][1]+=T,et[lt][2]+=B,et[lt][3]+=T,et[lt][4]+=B,et[lt][5]+=T,et[lt][6]+=B;return et}function u(T){var B=0,R=0,V=T.length,G=0,F=0,k,X,Z,st=[],et,lt,ft;for(X=0;X<V;++X){switch(Z=!1,k=T[X].slice(0),k[0]){case"l":k[0]="L",k[1]+=B,k[2]+=R;case"L":B=k[1],R=k[2];break;case"h":k[1]+=B;case"H":k[0]="L",k[2]=R,B=k[1];break;case"v":k[1]+=R;case"V":k[0]="L",R=k[1],k[1]=B,k[2]=R;break;case"m":k[0]="M",k[1]+=B,k[2]+=R;case"M":B=k[1],R=k[2],G=k[1],F=k[2];break;case"c":k[0]="C",k[1]+=B,k[2]+=R,k[3]+=B,k[4]+=R,k[5]+=B,k[6]+=R;case"C":lt=k[3],ft=k[4],B=k[5],R=k[6];break;case"s":k[0]="S",k[1]+=B,k[2]+=R,k[3]+=B,k[4]+=R;case"S":et==="C"?(lt=2*B-lt,ft=2*R-ft):(lt=B,ft=R),B=k[3],R=k[4],k[0]="C",k[5]=k[3],k[6]=k[4],k[3]=k[1],k[4]=k[2],k[1]=lt,k[2]=ft,lt=k[3],ft=k[4];break;case"q":k[0]="Q",k[1]+=B,k[2]+=R,k[3]+=B,k[4]+=R;case"Q":lt=k[1],ft=k[2],B=k[3],R=k[4];break;case"t":k[0]="T",k[1]+=B,k[2]+=R;case"T":et==="Q"?(lt=2*B-lt,ft=2*R-ft):(lt=B,ft=R),k[0]="Q",B=k[1],R=k[2],k[1]=lt,k[2]=ft,k[3]=B,k[4]=R;break;case"a":k[0]="A",k[6]+=B,k[7]+=R;case"A":Z=!0,st=st.concat(o(B,R,k)),B=k[6],R=k[7];break;case"z":case"Z":B=G,R=F;break}Z||st.push(k),et=k[0]}return st}function s(T,B,R,V){return Math.sqrt((R-T)*(R-T)+(V-B)*(V-B))}function h(T){return T*T*T}function g(T){return 3*T*T*(1-T)}function v(T){return 3*T*(1-T)*(1-T)}function _(T){return(1-T)*(1-T)*(1-T)}function w(T,B,R,V,G,F,k,X){return function(Z){var st=h(Z),et=g(Z),lt=v(Z),ft=_(Z);return{x:k*st+G*et+R*lt+T*ft,y:X*st+F*et+V*lt+B*ft}}}function C(T,B,R,V,G,F,k,X){return function(Z){var st=1-Z,et=3*st*st*(R-T)+6*st*Z*(G-R)+3*Z*Z*(k-G),lt=3*st*st*(V-B)+6*st*Z*(F-V)+3*Z*Z*(X-F);return Math.atan2(lt,et)}}function P(T){return T*T}function D(T){return 2*T*(1-T)}function I(T){return(1-T)*(1-T)}function N(T,B,R,V,G,F){return function(k){var X=P(k),Z=D(k),st=I(k);return{x:G*X+R*Z+T*st,y:F*X+V*Z+B*st}}}function H(T,B,R,V,G,F){return function(k){var X=1-k,Z=2*X*(R-T)+2*k*(G-R),st=2*X*(V-B)+2*k*(F-V);return Math.atan2(st,Z)}}function K(T,B,R){var V={x:B,y:R},G,F=0,k;for(k=1;k<=100;k+=1)G=T(k/100),F+=s(V.x,V.y,G.x,G.y),V=G;return F}function J(T,B){for(var R=0,V=0,G=T.iterator,F={x:T.x,y:T.y},k,X,Z=.01,st=T.angleFinder,et;V<B&&Z>1e-4;)k=G(R),et=R,X=s(F.x,F.y,k.x,k.y),X+V>B?(R-=Z,Z/=2):(F=k,R+=Z,V+=X);return k.angle=st(et),k}function Q(T){for(var B=0,R=T.length,V,G=0,F=0,k=0,X=0,Z=[],st,et,lt,ft=0;ft<R;ft++){switch(V=T[ft],et={x:G,y:F,command:V[0]},V[0]){case"M":et.length=0,k=G=V[1],X=F=V[2];break;case"L":et.length=s(G,F,V[1],V[2]),G=V[1],F=V[2];break;case"C":st=w(G,F,V[1],V[2],V[3],V[4],V[5],V[6]),lt=C(G,F,V[1],V[2],V[3],V[4],V[5],V[6]),et.iterator=st,et.angleFinder=lt,et.length=K(st,G,F),G=V[5],F=V[6];break;case"Q":st=N(G,F,V[1],V[2],V[3],V[4]),lt=H(G,F,V[1],V[2],V[3],V[4]),et.iterator=st,et.angleFinder=lt,et.length=K(st,G,F),G=V[3],F=V[4];break;case"Z":case"z":et.destX=k,et.destY=X,et.length=s(G,F,k,X),G=k,F=X;break}B+=et.length,Z.push(et)}return Z.push({length:B,x:G,y:F}),Z}function tt(T,B,R){R||(R=Q(T));for(var V=0;B-R[V].length>0&&V<R.length-2;)B-=R[V].length,V++;var G=R[V],F=B/G.length,k=G.command,X=T[V],Z;switch(k){case"M":return{x:G.x,y:G.y,angle:0};case"Z":case"z":return Z=new p.Point(G.x,G.y).lerp(new p.Point(G.destX,G.destY),F),Z.angle=Math.atan2(G.destY-G.y,G.destX-G.x),Z;case"L":return Z=new p.Point(G.x,G.y).lerp(new p.Point(X[1],X[2]),F),Z.angle=Math.atan2(X[2]-G.y,X[1]-G.x),Z;case"C":return J(G,B);case"Q":return J(G,B)}}function dt(T){var B=[],R=[],V,G,F=p.rePathCommand,k="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",X="("+k+")"+p.commaWsp,Z="([01])"+p.commaWsp+"?",st=X+"?"+X+"?"+X+Z+Z+X+"?("+k+")",et=new RegExp(st,"g"),lt,ft,yt;if(!T||!T.match)return B;yt=T.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var it=0,q,ot=yt.length;it<ot;it++){V=yt[it],ft=V.slice(1).trim(),R.length=0;var ht=V.charAt(0);if(q=[ht],ht.toLowerCase()==="a")for(var nt;nt=et.exec(ft);)for(var ut=1;ut<nt.length;ut++)R.push(nt[ut]);else for(;lt=F.exec(ft);)R.push(lt[0]);for(var ut=0,wt=R.length;ut<wt;ut++)G=parseFloat(R[ut]),isNaN(G)||q.push(G);var Pt=i[ht.toLowerCase()],Ct=a[ht]||ht;if(q.length-1>Pt)for(var ct=1,xt=q.length;ct<xt;ct+=Pt)B.push([ht].concat(q.slice(ct,ct+Pt))),ht=Ct;else B.push(q)}return B}function rt(T,B){var R=[],V,G=new p.Point(T[0].x,T[0].y),F=new p.Point(T[1].x,T[1].y),k=T.length,X=1,Z=0,st=k>2;for(B=B||0,st&&(X=T[2].x<F.x?-1:T[2].x===F.x?0:1,Z=T[2].y<F.y?-1:T[2].y===F.y?0:1),R.push(["M",G.x-X*B,G.y-Z*B]),V=1;V<k;V++){if(!G.eq(F)){var et=G.midPointFrom(F);R.push(["Q",G.x,G.y,et.x,et.y])}G=T[V],V+1<T.length&&(F=T[V+1])}return st&&(X=G.x>T[V-2].x?1:G.x===T[V-2].x?0:-1,Z=G.y>T[V-2].y?1:G.y===T[V-2].y?0:-1),R.push(["L",G.x+X*B,G.y+Z*B]),R}function _t(T,B,R){return R&&(B=p.util.multiplyTransformMatrices(B,[1,0,0,1,-R.x,-R.y])),T.map(function(V){for(var G=V.slice(0),F={},k=1;k<V.length-1;k+=2)F.x=V[k],F.y=V[k+1],F=p.util.transformPoint(F,B),G[k]=F.x,G[k+1]=F.y;return G})}p.util.joinPath=function(T){return T.map(function(B){return B.join(" ")}).join(" ")},p.util.parsePath=dt,p.util.makePathSimpler=u,p.util.getSmoothPathFromPoints=rt,p.util.getPathSegmentsInfo=Q,p.util.getBoundsOfCurve=n,p.util.getPointOnPath=tt,p.util.transformPath=_t}(),function(){var d=Array.prototype.slice;function i(n,o){for(var u=d.call(arguments,2),s=[],h=0,g=n.length;h<g;h++)s[h]=u.length?n[h][o].apply(n[h],u):n[h][o].call(n[h]);return s}function a(n,o){return r(n,o,function(u,s){return u>=s})}function l(n,o){return r(n,o,function(u,s){return u<s})}function e(n,o){for(var u=n.length;u--;)n[u]=o;return n}function r(n,o,u){if(!(!n||n.length===0)){var s=n.length-1,h=o?n[s][o]:n[s];if(o)for(;s--;)u(n[s][o],h)&&(h=n[s][o]);else for(;s--;)u(n[s],h)&&(h=n[s]);return h}}p.util.array={fill:e,invoke:i,min:l,max:a}}(),function(){function d(a,l,e){if(e)if(!p.isLikelyNode&&l instanceof Element)a=l;else if(l instanceof Array){a=[];for(var r=0,n=l.length;r<n;r++)a[r]=d({},l[r],e)}else if(l&&typeof l=="object")for(var o in l)o==="canvas"||o==="group"?a[o]=null:l.hasOwnProperty(o)&&(a[o]=d({},l[o],e));else a=l;else for(var o in l)a[o]=l[o];return a}function i(a,l){return d({},a,l)}p.util.object={extend:d,clone:i},p.util.object.extend(p.util,p.Observable)}(),function(){function d(r){return r.replace(/-+(.)?/g,function(n,o){return o?o.toUpperCase():""})}function i(r,n){return r.charAt(0).toUpperCase()+(n?r.slice(1):r.slice(1).toLowerCase())}function a(r){return r.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(r){var n=0,o,u=[];for(n=0,o;n<r.length;n++)(o=e(r,n))!==!1&&u.push(o);return u}function e(r,n){var o=r.charCodeAt(n);if(isNaN(o))return"";if(o<55296||o>57343)return r.charAt(n);if(55296<=o&&o<=56319){if(r.length<=n+1)throw"High surrogate without following low surrogate";var u=r.charCodeAt(n+1);if(56320>u||u>57343)throw"High surrogate without following low surrogate";return r.charAt(n)+r.charAt(n+1)}if(n===0)throw"Low surrogate without preceding high surrogate";var s=r.charCodeAt(n-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1}p.util.string={camelize:d,capitalize:i,escapeXml:a,graphemeSplit:l}}(),function(){var d=Array.prototype.slice,i=function(){},a=function(){for(var o in{toString:1})if(o==="toString")return!1;return!0}(),l=function(o,u,s){for(var h in u)h in o.prototype&&typeof o.prototype[h]=="function"&&(u[h]+"").indexOf("callSuper")>-1?o.prototype[h]=function(g){return function(){var v=this.constructor.superclass;this.constructor.superclass=s;var _=u[g].apply(this,arguments);if(this.constructor.superclass=v,g!=="initialize")return _}}(h):o.prototype[h]=u[h],a&&(u.toString!==Object.prototype.toString&&(o.prototype.toString=u.toString),u.valueOf!==Object.prototype.valueOf&&(o.prototype.valueOf=u.valueOf))};function e(){}function r(o){for(var u=null,s=this;s.constructor.superclass;){var h=s.constructor.superclass.prototype[o];if(s[o]!==h){u=h;break}s=s.constructor.superclass.prototype}return u?arguments.length>1?u.apply(this,d.call(arguments,1)):u.call(this):console.log("tried to callSuper "+o+", method not found in prototype chain",this)}function n(){var o=null,u=d.call(arguments,0);typeof u[0]=="function"&&(o=u.shift());function s(){this.initialize.apply(this,arguments)}s.superclass=o,s.subclasses=[],o&&(e.prototype=o.prototype,s.prototype=new e,o.subclasses.push(s));for(var h=0,g=u.length;h<g;h++)l(s,u[h],o);return s.prototype.initialize||(s.prototype.initialize=i),s.prototype.constructor=s,s.prototype.callSuper=r,s}p.util.createClass=n}(),function(){var d=!!p.document.createElement("div").attachEvent,i=["touchstart","touchmove","touchend"];p.util.addListener=function(l,e,r,n){l&&l.addEventListener(e,r,d?!1:n)},p.util.removeListener=function(l,e,r,n){l&&l.removeEventListener(e,r,d?!1:n)};function a(l){var e=l.changedTouches;return e&&e[0]?e[0]:l}p.util.getPointer=function(l){var e=l.target,r=p.util.getScrollLeftTop(e),n=a(l);return{x:n.clientX+r.left,y:n.clientY+r.top}},p.util.isTouchEvent=function(l){return i.indexOf(l.type)>-1||l.pointerType==="touch"}}(),function(){function d(n,o){var u=n.style;if(!u)return n;if(typeof o=="string")return n.style.cssText+=";"+o,o.indexOf("opacity")>-1?r(n,o.match(/opacity:\s*(\d?\.?\d*)/)[1]):n;for(var s in o)if(s==="opacity")r(n,o[s]);else{var h=s==="float"||s==="cssFloat"?typeof u.styleFloat>"u"?"cssFloat":"styleFloat":s;u[h]=o[s]}return n}var i=p.document.createElement("div"),a=typeof i.style.opacity=="string",l=typeof i.style.filter=="string",e=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,r=function(n){return n};a?r=function(n,o){return n.style.opacity=o,n}:l&&(r=function(n,o){var u=n.style;return n.currentStyle&&!n.currentStyle.hasLayout&&(u.zoom=1),e.test(u.filter)?(o=o>=.9999?"":"alpha(opacity="+o*100+")",u.filter=u.filter.replace(e,o)):u.filter+=" alpha(opacity="+o*100+")",n}),p.util.setStyle=d}(),function(){var d=Array.prototype.slice;function i(_){return typeof _=="string"?p.document.getElementById(_):_}var a,l=function(_){return d.call(_,0)};try{a=l(p.document.childNodes)instanceof Array}catch{}a||(l=function(_){for(var w=new Array(_.length),C=_.length;C--;)w[C]=_[C];return w});function e(_,w){var C=p.document.createElement(_);for(var P in w)P==="class"?C.className=w[P]:P==="for"?C.htmlFor=w[P]:C.setAttribute(P,w[P]);return C}function r(_,w){_&&(" "+_.className+" ").indexOf(" "+w+" ")===-1&&(_.className+=(_.className?" ":"")+w)}function n(_,w,C){return typeof w=="string"&&(w=e(w,C)),_.parentNode&&_.parentNode.replaceChild(w,_),w.appendChild(_),w}function o(_){for(var w=0,C=0,P=p.document.documentElement,D=p.document.body||{scrollLeft:0,scrollTop:0};_&&(_.parentNode||_.host)&&(_=_.parentNode||_.host,_===p.document?(w=D.scrollLeft||P.scrollLeft||0,C=D.scrollTop||P.scrollTop||0):(w+=_.scrollLeft||0,C+=_.scrollTop||0),!(_.nodeType===1&&_.style.position==="fixed")););return{left:w,top:C}}function u(_){var w,C=_&&_.ownerDocument,P={left:0,top:0},D={left:0,top:0},I,N={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!C)return D;for(var H in N)D[N[H]]+=parseInt(s(_,H),10)||0;return w=C.documentElement,typeof _.getBoundingClientRect<"u"&&(P=_.getBoundingClientRect()),I=o(_),{left:P.left+I.left-(w.clientLeft||0)+D.left,top:P.top+I.top-(w.clientTop||0)+D.top}}var s;p.document.defaultView&&p.document.defaultView.getComputedStyle?s=function(_,w){var C=p.document.defaultView.getComputedStyle(_,null);return C?C[w]:void 0}:s=function(_,w){var C=_.style[w];return!C&&_.currentStyle&&(C=_.currentStyle[w]),C},function(){var _=p.document.documentElement.style,w="userSelect"in _?"userSelect":"MozUserSelect"in _?"MozUserSelect":"WebkitUserSelect"in _?"WebkitUserSelect":"KhtmlUserSelect"in _?"KhtmlUserSelect":"";function C(D){return typeof D.onselectstart<"u"&&(D.onselectstart=p.util.falseFunction),w?D.style[w]="none":typeof D.unselectable=="string"&&(D.unselectable="on"),D}function P(D){return typeof D.onselectstart<"u"&&(D.onselectstart=null),w?D.style[w]="":typeof D.unselectable=="string"&&(D.unselectable=""),D}p.util.makeElementUnselectable=C,p.util.makeElementSelectable=P}();function h(_){var w=p.jsdomImplForWrapper(_);return w._canvas||w._image}function g(_){if(!!p.isLikelyNode){var w=p.jsdomImplForWrapper(_);w&&(w._image=null,w._canvas=null,w._currentSrc=null,w._attributes=null,w._classList=null)}}function v(_,w){_.imageSmoothingEnabled=_.imageSmoothingEnabled||_.webkitImageSmoothingEnabled||_.mozImageSmoothingEnabled||_.msImageSmoothingEnabled||_.oImageSmoothingEnabled,_.imageSmoothingEnabled=w}p.util.setImageSmoothing=v,p.util.getById=i,p.util.toArray=l,p.util.addClass=r,p.util.makeElement=e,p.util.wrapElement=n,p.util.getScrollLeftTop=o,p.util.getElementOffset=u,p.util.getNodeCanvas=h,p.util.cleanUpJsdomNode=g}(),function(){function d(l,e){return l+(/\?/.test(l)?"&":"?")+e}function i(){}function a(l,e){e||(e={});var r=e.method?e.method.toUpperCase():"GET",n=e.onComplete||function(){},o=new p.window.XMLHttpRequest,u=e.body||e.parameters;return o.onreadystatechange=function(){o.readyState===4&&(n(o),o.onreadystatechange=i)},r==="GET"&&(u=null,typeof e.parameters=="string"&&(l=d(l,e.parameters))),o.open(r,l,!0),(r==="POST"||r==="PUT")&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(u),o}p.util.request=a}(),p.log=console.log,p.warn=console.warn,function(){var d=p.util.object.extend,i=p.util.object.clone,a=[];p.util.object.extend(a,{cancelAll:function(){var h=this.splice(0);return h.forEach(function(g){g.cancel()}),h},cancelByCanvas:function(h){if(!h)return[];var g=this.filter(function(v){return typeof v.target=="object"&&v.target.canvas===h});return g.forEach(function(v){v.cancel()}),g},cancelByTarget:function(h){var g=this.findAnimationsByTarget(h);return g.forEach(function(v){v.cancel()}),g},findAnimationIndex:function(h){return this.indexOf(this.findAnimation(h))},findAnimation:function(h){return this.find(function(g){return g.cancel===h})},findAnimationsByTarget:function(h){return h?this.filter(function(g){return g.target===h}):[]}});function l(){return!1}function e(h,g,v,_){return-v*Math.cos(h/_*(Math.PI/2))+v+g}function r(h){h||(h={});var g=!1,v,_=function(){var w=p.runningAnimations.indexOf(v);return w>-1&&p.runningAnimations.splice(w,1)[0]};return v=d(i(h),{cancel:function(){return g=!0,_()},currentValue:"startValue"in h?h.startValue:0,completionRate:0,durationRate:0}),p.runningAnimations.push(v),u(function(w){var C=w||+new Date,P=h.duration||500,D=C+P,I,N=h.onChange||l,H=h.abort||l,K=h.onComplete||l,J=h.easing||e,Q="startValue"in h?h.startValue.length>0:!1,tt="startValue"in h?h.startValue:0,dt="endValue"in h?h.endValue:100,rt=h.byValue||(Q?tt.map(function(_t,T){return dt[T]-tt[T]}):dt-tt);h.onStart&&h.onStart(),function _t(T){I=T||+new Date;var B=I>D?P:I-C,R=B/P,V=Q?tt.map(function(F,k){return J(B,tt[k],rt[k],P)}):J(B,tt,rt,P),G=Math.abs(Q?(V[0]-tt[0])/rt[0]:(V-tt)/rt);if(v.currentValue=Q?V.slice():V,v.completionRate=G,v.durationRate=R,!g){if(H(V,G,R)){_();return}if(I>D){v.currentValue=Q?dt.slice():dt,v.completionRate=1,v.durationRate=1,N(Q?dt.slice():dt,1,1),K(dt,1,1),_();return}else N(V,G,R),u(_t)}}(C)}),v.cancel}var n=p.window.requestAnimationFrame||p.window.webkitRequestAnimationFrame||p.window.mozRequestAnimationFrame||p.window.oRequestAnimationFrame||p.window.msRequestAnimationFrame||function(h){return p.window.setTimeout(h,1e3/60)},o=p.window.cancelAnimationFrame||p.window.clearTimeout;function u(){return n.apply(p.window,arguments)}function s(){return o.apply(p.window,arguments)}p.util.animate=r,p.util.requestAnimFrame=u,p.util.cancelAnimFrame=s,p.runningAnimations=a}(),function(){function d(a,l,e){var r="rgba("+parseInt(a[0]+e*(l[0]-a[0]),10)+","+parseInt(a[1]+e*(l[1]-a[1]),10)+","+parseInt(a[2]+e*(l[2]-a[2]),10);return r+=","+(a&&l?parseFloat(a[3]+e*(l[3]-a[3])):1),r+=")",r}function i(a,l,e,r){var n=new p.Color(a).getSource(),o=new p.Color(l).getSource(),u=r.onComplete,s=r.onChange;return r=r||{},p.util.animate(p.util.object.extend(r,{duration:e||500,startValue:n,endValue:o,byValue:o,easing:function(h,g,v,_){var w=r.colorEasing?r.colorEasing(h,_):1-Math.cos(h/_*(Math.PI/2));return d(g,v,w)},onComplete:function(h,g,v){if(u)return u(d(o,o,0),g,v)},onChange:function(h,g,v){if(s){if(Array.isArray(h))return s(d(h,h,0),g,v);s(h,g,v)}}}))}p.util.animateColor=i}(),function(){function d(T,B,R,V){return T<Math.abs(B)?(T=B,V=R/4):B===0&&T===0?V=R/(2*Math.PI)*Math.asin(1):V=R/(2*Math.PI)*Math.asin(B/T),{a:T,c:B,p:R,s:V}}function i(T,B,R){return T.a*Math.pow(2,10*(B-=1))*Math.sin((B*R-T.s)*(2*Math.PI)/T.p)}function a(T,B,R,V){return R*((T=T/V-1)*T*T+1)+B}function l(T,B,R,V){return T/=V/2,T<1?R/2*T*T*T+B:R/2*((T-=2)*T*T+2)+B}function e(T,B,R,V){return R*(T/=V)*T*T*T+B}function r(T,B,R,V){return-R*((T=T/V-1)*T*T*T-1)+B}function n(T,B,R,V){return T/=V/2,T<1?R/2*T*T*T*T+B:-R/2*((T-=2)*T*T*T-2)+B}function o(T,B,R,V){return R*(T/=V)*T*T*T*T+B}function u(T,B,R,V){return R*((T=T/V-1)*T*T*T*T+1)+B}function s(T,B,R,V){return T/=V/2,T<1?R/2*T*T*T*T*T+B:R/2*((T-=2)*T*T*T*T+2)+B}function h(T,B,R,V){return-R*Math.cos(T/V*(Math.PI/2))+R+B}function g(T,B,R,V){return R*Math.sin(T/V*(Math.PI/2))+B}function v(T,B,R,V){return-R/2*(Math.cos(Math.PI*T/V)-1)+B}function _(T,B,R,V){return T===0?B:R*Math.pow(2,10*(T/V-1))+B}function w(T,B,R,V){return T===V?B+R:R*(-Math.pow(2,-10*T/V)+1)+B}function C(T,B,R,V){return T===0?B:T===V?B+R:(T/=V/2,T<1?R/2*Math.pow(2,10*(T-1))+B:R/2*(-Math.pow(2,-10*--T)+2)+B)}function P(T,B,R,V){return-R*(Math.sqrt(1-(T/=V)*T)-1)+B}function D(T,B,R,V){return R*Math.sqrt(1-(T=T/V-1)*T)+B}function I(T,B,R,V){return T/=V/2,T<1?-R/2*(Math.sqrt(1-T*T)-1)+B:R/2*(Math.sqrt(1-(T-=2)*T)+1)+B}function N(T,B,R,V){var G=1.70158,F=0,k=R;if(T===0)return B;if(T/=V,T===1)return B+R;F||(F=V*.3);var X=d(k,R,F,G);return-i(X,T,V)+B}function H(T,B,R,V){var G=1.70158,F=0,k=R;if(T===0)return B;if(T/=V,T===1)return B+R;F||(F=V*.3);var X=d(k,R,F,G);return X.a*Math.pow(2,-10*T)*Math.sin((T*V-X.s)*(2*Math.PI)/X.p)+X.c+B}function K(T,B,R,V){var G=1.70158,F=0,k=R;if(T===0)return B;if(T/=V/2,T===2)return B+R;F||(F=V*(.3*1.5));var X=d(k,R,F,G);return T<1?-.5*i(X,T,V)+B:X.a*Math.pow(2,-10*(T-=1))*Math.sin((T*V-X.s)*(2*Math.PI)/X.p)*.5+X.c+B}function J(T,B,R,V,G){return G===void 0&&(G=1.70158),R*(T/=V)*T*((G+1)*T-G)+B}function Q(T,B,R,V,G){return G===void 0&&(G=1.70158),R*((T=T/V-1)*T*((G+1)*T+G)+1)+B}function tt(T,B,R,V,G){return G===void 0&&(G=1.70158),T/=V/2,T<1?R/2*(T*T*(((G*=1.525)+1)*T-G))+B:R/2*((T-=2)*T*(((G*=1.525)+1)*T+G)+2)+B}function dt(T,B,R,V){return R-rt(V-T,0,R,V)+B}function rt(T,B,R,V){return(T/=V)<1/2.75?R*(7.5625*T*T)+B:T<2/2.75?R*(7.5625*(T-=1.5/2.75)*T+.75)+B:T<2.5/2.75?R*(7.5625*(T-=2.25/2.75)*T+.9375)+B:R*(7.5625*(T-=2.625/2.75)*T+.984375)+B}function _t(T,B,R,V){return T<V/2?dt(T*2,0,R,V)*.5+B:rt(T*2-V,0,R,V)*.5+R*.5+B}p.util.ease={easeInQuad:function(T,B,R,V){return R*(T/=V)*T+B},easeOutQuad:function(T,B,R,V){return-R*(T/=V)*(T-2)+B},easeInOutQuad:function(T,B,R,V){return T/=V/2,T<1?R/2*T*T+B:-R/2*(--T*(T-2)-1)+B},easeInCubic:function(T,B,R,V){return R*(T/=V)*T*T+B},easeOutCubic:a,easeInOutCubic:l,easeInQuart:e,easeOutQuart:r,easeInOutQuart:n,easeInQuint:o,easeOutQuint:u,easeInOutQuint:s,easeInSine:h,easeOutSine:g,easeInOutSine:v,easeInExpo:_,easeOutExpo:w,easeInOutExpo:C,easeInCirc:P,easeOutCirc:D,easeInOutCirc:I,easeInElastic:N,easeOutElastic:H,easeInOutElastic:K,easeInBack:J,easeOutBack:Q,easeInOutBack:tt,easeInBounce:dt,easeOutBounce:rt,easeInOutBounce:_t}}(),function(d){var i=d.fabric||(d.fabric={}),a=i.util.object.extend,l=i.util.object.clone,e=i.util.toFixed,r=i.util.parseUnit,n=i.util.multiplyTransformMatrices,o=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],u=["symbol","image","marker","pattern","view","svg"],s=["pattern","defs","symbol","metadata","clipPath","mask","desc"],h=["symbol","g","a","svg","clipPath","defs"],g={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},v={stroke:"strokeOpacity",fill:"fillOpacity"},_="font-size",w="clip-path";i.svgValidTagNamesRegEx=D(o),i.svgViewBoxElementsRegEx=D(u),i.svgInvalidAncestorsRegEx=D(s),i.svgValidParentsRegEx=D(h),i.cssRules={},i.gradientDefs={},i.clipPaths={};function C(F){return F in g?g[F]:F}function P(F,k,X,Z){var st=Array.isArray(k),et;if((F==="fill"||F==="stroke")&&k==="none")k="";else{if(F==="strokeUniform")return k==="non-scaling-stroke";if(F==="strokeDashArray")k==="none"?k=null:k=k.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(F==="transformMatrix")X&&X.transformMatrix?k=n(X.transformMatrix,i.parseTransformAttribute(k)):k=i.parseTransformAttribute(k);else if(F==="visible")k=k!=="none"&&k!=="hidden",X&&X.visible===!1&&(k=!1);else if(F==="opacity")k=parseFloat(k),X&&typeof X.opacity<"u"&&(k*=X.opacity);else if(F==="textAnchor")k=k==="start"?"left":k==="end"?"right":"center";else if(F==="charSpacing")et=r(k,Z)/Z*1e3;else if(F==="paintFirst"){var lt=k.indexOf("fill"),ft=k.indexOf("stroke"),k="fill";(lt>-1&&ft>-1&&ft<lt||lt===-1&&ft>-1)&&(k="stroke")}else{if(F==="href"||F==="xlink:href"||F==="font")return k;if(F==="imageSmoothing")return k==="optimizeQuality";et=st?k.map(r):r(k,Z)}}return!st&&isNaN(et)?k:et}function D(F){return new RegExp("^("+F.join("|")+")\\b","i")}function I(F){for(var k in v)if(!(typeof F[v[k]]>"u"||F[k]==="")){if(typeof F[k]>"u"){if(!i.Object.prototype[k])continue;F[k]=i.Object.prototype[k]}if(F[k].indexOf("url(")!==0){var X=new i.Color(F[k]);F[k]=X.setAlpha(e(X.getAlpha()*F[v[k]],2)).toRgba()}}return F}function N(F,k){var X,Z=[],st,et,lt;for(et=0,lt=k.length;et<lt;et++)X=k[et],st=F.getElementsByTagName(X),Z=Z.concat(Array.prototype.slice.call(st));return Z}i.parseTransformAttribute=function(){function F(ct,xt){var Tt=i.util.cos(xt[0]),Mt=i.util.sin(xt[0]),jt=0,At=0;xt.length===3&&(jt=xt[1],At=xt[2]),ct[0]=Tt,ct[1]=Mt,ct[2]=-Mt,ct[3]=Tt,ct[4]=jt-(Tt*jt-Mt*At),ct[5]=At-(Mt*jt+Tt*At)}function k(ct,xt){var Tt=xt[0],Mt=xt.length===2?xt[1]:xt[0];ct[0]=Tt,ct[3]=Mt}function X(ct,xt,Tt){ct[Tt]=Math.tan(i.util.degreesToRadians(xt[0]))}function Z(ct,xt){ct[4]=xt[0],xt.length===2&&(ct[5]=xt[1])}var st=i.iMatrix,et=i.reNum,lt=i.commaWsp,ft="(?:(skewX)\\s*\\(\\s*("+et+")\\s*\\))",yt="(?:(skewY)\\s*\\(\\s*("+et+")\\s*\\))",it="(?:(rotate)\\s*\\(\\s*("+et+")(?:"+lt+"("+et+")"+lt+"("+et+"))?\\s*\\))",q="(?:(scale)\\s*\\(\\s*("+et+")(?:"+lt+"("+et+"))?\\s*\\))",ot="(?:(translate)\\s*\\(\\s*("+et+")(?:"+lt+"("+et+"))?\\s*\\))",ht="(?:(matrix)\\s*\\(\\s*("+et+")"+lt+"("+et+")"+lt+"("+et+")"+lt+"("+et+")"+lt+"("+et+")"+lt+"("+et+")\\s*\\))",nt="(?:"+ht+"|"+ot+"|"+q+"|"+it+"|"+ft+"|"+yt+")",ut="(?:"+nt+"(?:"+lt+"*"+nt+")*)",wt="^\\s*(?:"+ut+"?)\\s*$",Pt=new RegExp(wt),Ct=new RegExp(nt,"g");return function(ct){var xt=st.concat(),Tt=[];if(!ct||ct&&!Pt.test(ct))return xt;ct.replace(Ct,function(jt){var At=new RegExp(nt).exec(jt).filter(function(Kt){return!!Kt}),Ht=At[1],Vt=At.slice(2).map(parseFloat);switch(Ht){case"translate":Z(xt,Vt);break;case"rotate":Vt[0]=i.util.degreesToRadians(Vt[0]),F(xt,Vt);break;case"scale":k(xt,Vt);break;case"skewX":X(xt,Vt,2);break;case"skewY":X(xt,Vt,1);break;case"matrix":xt=Vt;break}Tt.push(xt.concat()),xt=st.concat()});for(var Mt=Tt[0];Tt.length>1;)Tt.shift(),Mt=i.util.multiplyTransformMatrices(Mt,Tt[0]);return Mt}}();function H(F,k){var X,Z;F.replace(/;\s*$/,"").split(";").forEach(function(st){var et=st.split(":");X=et[0].trim().toLowerCase(),Z=et[1].trim(),k[X]=Z})}function K(F,k){var X,Z;for(var st in F)typeof F[st]>"u"||(X=st.toLowerCase(),Z=F[st],k[X]=Z)}function J(F,k){var X={};for(var Z in i.cssRules[k])if(Q(F,Z.split(" ")))for(var st in i.cssRules[k][Z])X[st]=i.cssRules[k][Z][st];return X}function Q(F,k){var X,Z=!0;return X=dt(F,k.pop()),X&&k.length&&(Z=tt(F,k)),X&&Z&&k.length===0}function tt(F,k){for(var X,Z=!0;F.parentNode&&F.parentNode.nodeType===1&&k.length;)Z&&(X=k.pop()),F=F.parentNode,Z=dt(F,X);return k.length===0}function dt(F,k){var X=F.nodeName,Z=F.getAttribute("class"),st=F.getAttribute("id"),et,lt;if(et=new RegExp("^"+X,"i"),k=k.replace(et,""),st&&k.length&&(et=new RegExp("#"+st+"(?![a-zA-Z\\-]+)","i"),k=k.replace(et,"")),Z&&k.length)for(Z=Z.split(" "),lt=Z.length;lt--;)et=new RegExp("\\."+Z[lt]+"(?![a-zA-Z\\-]+)","i"),k=k.replace(et,"");return k.length===0}function rt(F,k){var X;if(F.getElementById&&(X=F.getElementById(k)),X)return X;var Z,st,et,lt=F.getElementsByTagName("*");for(st=0,et=lt.length;st<et;st++)if(Z=lt[st],k===Z.getAttribute("id"))return Z}function _t(F){for(var k=N(F,["use","svg:use"]),X=0;k.length&&X<k.length;){var Z=k[X],st=Z.getAttribute("xlink:href")||Z.getAttribute("href");if(st===null)return;var et=st.slice(1),lt=Z.getAttribute("x")||0,ft=Z.getAttribute("y")||0,yt=rt(F,et).cloneNode(!0),it=(yt.getAttribute("transform")||"")+" translate("+lt+", "+ft+")",q,ot=k.length,ht,nt,ut,wt,Pt=i.svgNS;if(B(yt),/^svg$/i.test(yt.nodeName)){var Ct=yt.ownerDocument.createElementNS(Pt,"g");for(nt=0,ut=yt.attributes,wt=ut.length;nt<wt;nt++)ht=ut.item(nt),Ct.setAttributeNS(Pt,ht.nodeName,ht.nodeValue);for(;yt.firstChild;)Ct.appendChild(yt.firstChild);yt=Ct}for(nt=0,ut=Z.attributes,wt=ut.length;nt<wt;nt++)ht=ut.item(nt),!(ht.nodeName==="x"||ht.nodeName==="y"||ht.nodeName==="xlink:href"||ht.nodeName==="href")&&(ht.nodeName==="transform"?it=ht.nodeValue+" "+it:yt.setAttribute(ht.nodeName,ht.nodeValue));yt.setAttribute("transform",it),yt.setAttribute("instantiated_by_use","1"),yt.removeAttribute("id"),q=Z.parentNode,q.replaceChild(yt,Z),k.length===ot&&X++}}var T=new RegExp("^\\s*("+i.reNum+"+)\\s*,?\\s*("+i.reNum+"+)\\s*,?\\s*("+i.reNum+"+)\\s*,?\\s*("+i.reNum+"+)\\s*$");function B(F){if(!i.svgViewBoxElementsRegEx.test(F.nodeName))return{};var k=F.getAttribute("viewBox"),X=1,Z=1,st=0,et=0,lt,ft,yt,it,q=F.getAttribute("width"),ot=F.getAttribute("height"),ht=F.getAttribute("x")||0,nt=F.getAttribute("y")||0,ut=F.getAttribute("preserveAspectRatio")||"",wt=!k||!(k=k.match(T)),Pt=!q||!ot||q==="100%"||ot==="100%",Ct=wt&&Pt,ct={},xt="",Tt=0,Mt=0;if(ct.width=0,ct.height=0,ct.toBeParsed=Ct,wt&&(ht||nt)&&F.parentNode&&F.parentNode.nodeName!=="#document"&&(xt=" translate("+r(ht)+" "+r(nt)+") ",yt=(F.getAttribute("transform")||"")+xt,F.setAttribute("transform",yt),F.removeAttribute("x"),F.removeAttribute("y")),Ct)return ct;if(wt)return ct.width=r(q),ct.height=r(ot),ct;if(st=-parseFloat(k[1]),et=-parseFloat(k[2]),lt=parseFloat(k[3]),ft=parseFloat(k[4]),ct.minX=st,ct.minY=et,ct.viewBoxWidth=lt,ct.viewBoxHeight=ft,Pt?(ct.width=lt,ct.height=ft):(ct.width=r(q),ct.height=r(ot),X=ct.width/lt,Z=ct.height/ft),ut=i.util.parsePreserveAspectRatioAttribute(ut),ut.alignX!=="none"&&(ut.meetOrSlice==="meet"&&(Z=X=X>Z?Z:X),ut.meetOrSlice==="slice"&&(Z=X=X>Z?X:Z),Tt=ct.width-lt*X,Mt=ct.height-ft*X,ut.alignX==="Mid"&&(Tt/=2),ut.alignY==="Mid"&&(Mt/=2),ut.alignX==="Min"&&(Tt=0),ut.alignY==="Min"&&(Mt=0)),X===1&&Z===1&&st===0&&et===0&&ht===0&&nt===0)return ct;if((ht||nt)&&F.parentNode.nodeName!=="#document"&&(xt=" translate("+r(ht)+" "+r(nt)+") "),yt=xt+" matrix("+X+" 0 0 "+Z+" "+(st*X+Tt)+" "+(et*Z+Mt)+") ",F.nodeName==="svg"){for(it=F.ownerDocument.createElementNS(i.svgNS,"g");F.firstChild;)it.appendChild(F.firstChild);F.appendChild(it)}else it=F,it.removeAttribute("x"),it.removeAttribute("y"),yt=it.getAttribute("transform")+yt;return it.setAttribute("transform",yt),ct}function R(F,k){for(;F&&(F=F.parentNode);)if(F.nodeName&&k.test(F.nodeName.replace("svg:",""))&&!F.getAttribute("instantiated_by_use"))return!0;return!1}i.parseSVGDocument=function(F,k,X,Z){if(!!F){_t(F);var st=i.Object.__uid++,et,lt,ft=B(F),yt=i.util.toArray(F.getElementsByTagName("*"));if(ft.crossOrigin=Z&&Z.crossOrigin,ft.svgUid=st,yt.length===0&&i.isLikelyNode){yt=F.selectNodes('//*[name(.)!="svg"]');var it=[];for(et=0,lt=yt.length;et<lt;et++)it[et]=yt[et];yt=it}var q=yt.filter(function(ht){return B(ht),i.svgValidTagNamesRegEx.test(ht.nodeName.replace("svg:",""))&&!R(ht,i.svgInvalidAncestorsRegEx)});if(!q||q&&!q.length){k&&k([],{});return}var ot={};yt.filter(function(ht){return ht.nodeName.replace("svg:","")==="clipPath"}).forEach(function(ht){var nt=ht.getAttribute("id");ot[nt]=i.util.toArray(ht.getElementsByTagName("*")).filter(function(ut){return i.svgValidTagNamesRegEx.test(ut.nodeName.replace("svg:",""))})}),i.gradientDefs[st]=i.getGradientDefs(F),i.cssRules[st]=i.getCSSRules(F),i.clipPaths[st]=ot,i.parseElements(q,function(ht,nt){k&&(k(ht,ft,nt,yt),delete i.gradientDefs[st],delete i.cssRules[st],delete i.clipPaths[st])},l(ft),X,Z)}};function V(F,k){var X=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],Z="xlink:href",st=k.getAttribute(Z).slice(1),et=rt(F,st);if(et&&et.getAttribute(Z)&&V(F,et),X.forEach(function(ft){et&&!k.hasAttribute(ft)&&et.hasAttribute(ft)&&k.setAttribute(ft,et.getAttribute(ft))}),!k.children.length)for(var lt=et.cloneNode(!0);lt.firstChild;)k.appendChild(lt.firstChild);k.removeAttribute(Z)}var G=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+i.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+i.reNum+"))?\\s+(.*)");a(i,{parseFontDeclaration:function(F,k){var X=F.match(G);if(!!X){var Z=X[1],st=X[3],et=X[4],lt=X[5],ft=X[6];Z&&(k.fontStyle=Z),st&&(k.fontWeight=isNaN(parseFloat(st))?st:parseFloat(st)),et&&(k.fontSize=r(et)),ft&&(k.fontFamily=ft),lt&&(k.lineHeight=lt==="normal"?1:lt)}},getGradientDefs:function(F){var k=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],X=N(F,k),Z,st=0,et={};for(st=X.length;st--;)Z=X[st],Z.getAttribute("xlink:href")&&V(F,Z),et[Z.getAttribute("id")]=Z;return et},parseAttributes:function(F,k,X){if(!!F){var Z,st={},et,lt;typeof X>"u"&&(X=F.getAttribute("svgUid")),F.parentNode&&i.svgValidParentsRegEx.test(F.parentNode.nodeName)&&(st=i.parseAttributes(F.parentNode,k,X));var ft=k.reduce(function(ut,wt){return Z=F.getAttribute(wt),Z&&(ut[wt]=Z),ut},{}),yt=a(J(F,X),i.parseStyleAttribute(F));ft=a(ft,yt),yt[w]&&F.setAttribute(w,yt[w]),et=lt=st.fontSize||i.Text.DEFAULT_SVG_FONT_SIZE,ft[_]&&(ft[_]=et=r(ft[_],lt));var it,q,ot={};for(var ht in ft)it=C(ht),q=P(it,ft[ht],st,et),ot[it]=q;ot&&ot.font&&i.parseFontDeclaration(ot.font,ot);var nt=a(st,ot);return i.svgValidParentsRegEx.test(F.nodeName)?nt:I(nt)}},parseElements:function(F,k,X,Z,st){new i.ElementsParser(F,k,X,Z,st).parse()},parseStyleAttribute:function(F){var k={},X=F.getAttribute("style");return X&&(typeof X=="string"?H(X,k):K(X,k)),k},parsePointsAttribute:function(F){if(!F)return null;F=F.replace(/,/g," ").trim(),F=F.split(/\s+/);var k=[],X,Z;for(X=0,Z=F.length;X<Z;X+=2)k.push({x:parseFloat(F[X]),y:parseFloat(F[X+1])});return k},getCSSRules:function(F){var k=F.getElementsByTagName("style"),X,Z,st={},et;for(X=0,Z=k.length;X<Z;X++){var lt=k[X].textContent;lt=lt.replace(/\/\*[\s\S]*?\*\//g,""),lt.trim()!==""&&(et=lt.split("}"),et=et.filter(function(ft){return ft.trim()}),et.forEach(function(ft){var yt=ft.split("{"),it={},q=yt[1].trim(),ot=q.split(";").filter(function(wt){return wt.trim()});for(X=0,Z=ot.length;X<Z;X++){var ht=ot[X].split(":"),nt=ht[0].trim(),ut=ht[1].trim();it[nt]=ut}ft=yt[0].trim(),ft.split(",").forEach(function(wt){wt=wt.replace(/^svg/i,"").trim(),wt!==""&&(st[wt]?i.util.object.extend(st[wt],it):st[wt]=i.util.object.clone(it))})}))}return st},loadSVGFromURL:function(F,k,X,Z){F=F.replace(/^\n\s*/,"").trim(),new i.util.request(F,{method:"get",onComplete:st});function st(et){var lt=et.responseXML;if(!lt||!lt.documentElement)return k&&k(null),!1;i.parseSVGDocument(lt.documentElement,function(ft,yt,it,q){k&&k(ft,yt,it,q)},X,Z)}},loadSVGFromString:function(F,k,X,Z){var st=new i.window.DOMParser,et=st.parseFromString(F.trim(),"text/xml");i.parseSVGDocument(et.documentElement,function(lt,ft,yt,it){k(lt,ft,yt,it)},X,Z)}})}(A),p.ElementsParser=function(d,i,a,l,e,r){this.elements=d,this.callback=i,this.options=a,this.reviver=l,this.svgUid=a&&a.svgUid||0,this.parsingOptions=e,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=r},function(d){d.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},d.createObjects=function(){var i=this;this.elements.forEach(function(a,l){a.setAttribute("svgUid",i.svgUid),i.createObject(a,l)})},d.findTag=function(i){return p[p.util.string.capitalize(i.tagName.replace("svg:",""))]},d.createObject=function(i,a){var l=this.findTag(i);if(l&&l.fromElement)try{l.fromElement(i,this.createCallback(a,i),this.options)}catch(e){p.log(e)}else this.checkIfDone()},d.createCallback=function(i,a){var l=this;return function(e){var r;l.resolveGradient(e,a,"fill"),l.resolveGradient(e,a,"stroke"),e instanceof p.Image&&e._originalElement&&(r=e.parsePreserveAspectRatioAttribute(a)),e._removeTransformMatrix(r),l.resolveClipPath(e,a),l.reviver&&l.reviver(a,e),l.instances[i]=e,l.checkIfDone()}},d.extractPropertyDefinition=function(i,a,l){var e=i[a],r=this.regexUrl;if(!!r.test(e)){r.lastIndex=0;var n=r.exec(e)[1];return r.lastIndex=0,p[l][this.svgUid][n]}},d.resolveGradient=function(i,a,l){var e=this.extractPropertyDefinition(i,l,"gradientDefs");if(e){var r=a.getAttribute(l+"-opacity"),n=p.Gradient.fromElement(e,i,r,this.options);i.set(l,n)}},d.createClipPathCallback=function(i,a){return function(l){l._removeTransformMatrix(),l.fillRule=l.clipRule,a.push(l)}},d.resolveClipPath=function(i,a){var l=this.extractPropertyDefinition(i,"clipPath","clipPaths"),e,r,n,o,u,s;if(l){o=[],n=p.util.invertTransform(i.calcTransformMatrix());for(var h=l[0].parentNode,g=a;g.parentNode&&g.getAttribute("clip-path")!==i.clipPath;)g=g.parentNode;g.parentNode.appendChild(h);for(var v=0;v<l.length;v++)e=l[v],r=this.findTag(e),r.fromElement(e,this.createClipPathCallback(i,o),this.options);o.length===1?l=o[0]:l=new p.Group(o),u=p.util.multiplyTransformMatrices(n,l.calcTransformMatrix()),l.clipPath&&this.resolveClipPath(l,g);var s=p.util.qrDecompose(u);l.flipX=!1,l.flipY=!1,l.set("scaleX",s.scaleX),l.set("scaleY",s.scaleY),l.angle=s.angle,l.skewX=s.skewX,l.skewY=0,l.setPositionByOrigin({x:s.translateX,y:s.translateY},"center","center"),i.clipPath=l}else delete i.clipPath},d.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(i){return i!=null}),this.callback(this.instances,this.elements))}}(p.ElementsParser.prototype),function(d){var i=d.fabric||(d.fabric={});if(i.Point){i.warn("fabric.Point is already defined");return}i.Point=a;function a(l,e){this.x=l,this.y=e}a.prototype={type:"point",constructor:a,add:function(l){return new a(this.x+l.x,this.y+l.y)},addEquals:function(l){return this.x+=l.x,this.y+=l.y,this},scalarAdd:function(l){return new a(this.x+l,this.y+l)},scalarAddEquals:function(l){return this.x+=l,this.y+=l,this},subtract:function(l){return new a(this.x-l.x,this.y-l.y)},subtractEquals:function(l){return this.x-=l.x,this.y-=l.y,this},scalarSubtract:function(l){return new a(this.x-l,this.y-l)},scalarSubtractEquals:function(l){return this.x-=l,this.y-=l,this},multiply:function(l){return new a(this.x*l,this.y*l)},multiplyEquals:function(l){return this.x*=l,this.y*=l,this},divide:function(l){return new a(this.x/l,this.y/l)},divideEquals:function(l){return this.x/=l,this.y/=l,this},eq:function(l){return this.x===l.x&&this.y===l.y},lt:function(l){return this.x<l.x&&this.y<l.y},lte:function(l){return this.x<=l.x&&this.y<=l.y},gt:function(l){return this.x>l.x&&this.y>l.y},gte:function(l){return this.x>=l.x&&this.y>=l.y},lerp:function(l,e){return typeof e>"u"&&(e=.5),e=Math.max(Math.min(1,e),0),new a(this.x+(l.x-this.x)*e,this.y+(l.y-this.y)*e)},distanceFrom:function(l){var e=this.x-l.x,r=this.y-l.y;return Math.sqrt(e*e+r*r)},midPointFrom:function(l){return this.lerp(l)},min:function(l){return new a(Math.min(this.x,l.x),Math.min(this.y,l.y))},max:function(l){return new a(Math.max(this.x,l.x),Math.max(this.y,l.y))},toString:function(){return this.x+","+this.y},setXY:function(l,e){return this.x=l,this.y=e,this},setX:function(l){return this.x=l,this},setY:function(l){return this.y=l,this},setFromPoint:function(l){return this.x=l.x,this.y=l.y,this},swap:function(l){var e=this.x,r=this.y;this.x=l.x,this.y=l.y,l.x=e,l.y=r},clone:function(){return new a(this.x,this.y)}}}(A),function(d){var i=d.fabric||(d.fabric={});if(i.Intersection){i.warn("fabric.Intersection is already defined");return}function a(l){this.status=l,this.points=[]}i.Intersection=a,i.Intersection.prototype={constructor:a,appendPoint:function(l){return this.points.push(l),this},appendPoints:function(l){return this.points=this.points.concat(l),this}},i.Intersection.intersectLineLine=function(l,e,r,n){var o,u=(n.x-r.x)*(l.y-r.y)-(n.y-r.y)*(l.x-r.x),s=(e.x-l.x)*(l.y-r.y)-(e.y-l.y)*(l.x-r.x),h=(n.y-r.y)*(e.x-l.x)-(n.x-r.x)*(e.y-l.y);if(h!==0){var g=u/h,v=s/h;0<=g&&g<=1&&0<=v&&v<=1?(o=new a("Intersection"),o.appendPoint(new i.Point(l.x+g*(e.x-l.x),l.y+g*(e.y-l.y)))):o=new a}else u===0||s===0?o=new a("Coincident"):o=new a("Parallel");return o},i.Intersection.intersectLinePolygon=function(l,e,r){var n=new a,o=r.length,u,s,h,g;for(g=0;g<o;g++)u=r[g],s=r[(g+1)%o],h=a.intersectLineLine(l,e,u,s),n.appendPoints(h.points);return n.points.length>0&&(n.status="Intersection"),n},i.Intersection.intersectPolygonPolygon=function(l,e){var r=new a,n=l.length,o;for(o=0;o<n;o++){var u=l[o],s=l[(o+1)%n],h=a.intersectLinePolygon(u,s,e);r.appendPoints(h.points)}return r.points.length>0&&(r.status="Intersection"),r},i.Intersection.intersectPolygonRectangle=function(l,e,r){var n=e.min(r),o=e.max(r),u=new i.Point(o.x,n.y),s=new i.Point(n.x,o.y),h=a.intersectLinePolygon(n,u,l),g=a.intersectLinePolygon(u,o,l),v=a.intersectLinePolygon(o,s,l),_=a.intersectLinePolygon(s,n,l),w=new a;return w.appendPoints(h.points),w.appendPoints(g.points),w.appendPoints(v.points),w.appendPoints(_.points),w.points.length>0&&(w.status="Intersection"),w}}(A),function(d){var i=d.fabric||(d.fabric={});if(i.Color){i.warn("fabric.Color is already defined.");return}function a(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}i.Color=a,i.Color.prototype={_tryParsingColor:function(e){var r;e in a.colorNameMap&&(e=a.colorNameMap[e]),e==="transparent"&&(r=[255,255,255,0]),r||(r=a.sourceFromHex(e)),r||(r=a.sourceFromRgb(e)),r||(r=a.sourceFromHsl(e)),r||(r=[0,0,0,1]),r&&this.setSource(r)},_rgbToHsl:function(e,r,n){e/=255,r/=255,n/=255;var o,u,s,h=i.util.array.max([e,r,n]),g=i.util.array.min([e,r,n]);if(s=(h+g)/2,h===g)o=u=0;else{var v=h-g;switch(u=s>.5?v/(2-h-g):v/(h+g),h){case e:o=(r-n)/v+(r<n?6:0);break;case r:o=(n-e)/v+2;break;case n:o=(e-r)/v+4;break}o/=6}return[Math.round(o*360),Math.round(u*100),Math.round(s*100)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var e=this.getSource(),r=this._rgbToHsl(e[0],e[1],e[2]);return"hsl("+r[0]+","+r[1]+"%,"+r[2]+"%)"},toHsla:function(){var e=this.getSource(),r=this._rgbToHsl(e[0],e[1],e[2]);return"hsla("+r[0]+","+r[1]+"%,"+r[2]+"%,"+e[3]+")"},toHex:function(){var e=this.getSource(),r,n,o;return r=e[0].toString(16),r=r.length===1?"0"+r:r,n=e[1].toString(16),n=n.length===1?"0"+n:n,o=e[2].toString(16),o=o.length===1?"0"+o:o,r.toUpperCase()+n.toUpperCase()+o.toUpperCase()},toHexa:function(){var e=this.getSource(),r;return r=Math.round(e[3]*255),r=r.toString(16),r=r.length===1?"0"+r:r,this.toHex()+r.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var r=this.getSource();return r[3]=e,this.setSource(r),this},toGrayscale:function(){var e=this.getSource(),r=parseInt((e[0]*.3+e[1]*.59+e[2]*.11).toFixed(0),10),n=e[3];return this.setSource([r,r,r,n]),this},toBlackWhite:function(e){var r=this.getSource(),n=(r[0]*.3+r[1]*.59+r[2]*.11).toFixed(0),o=r[3];return e=e||127,n=Number(n)<Number(e)?0:255,this.setSource([n,n,n,o]),this},overlayWith:function(e){e instanceof a||(e=new a(e));var r=[],n=this.getAlpha(),o=.5,u=this.getSource(),s=e.getSource(),h;for(h=0;h<3;h++)r.push(Math.round(u[h]*(1-o)+s[h]*o));return r[3]=n,this.setSource(r),this}},i.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,i.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,i.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,i.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function l(e,r,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(r-e)*6*n:n<1/2?r:n<2/3?e+(r-e)*(2/3-n)*6:e}i.Color.fromRgb=function(e){return a.fromSource(a.sourceFromRgb(e))},i.Color.sourceFromRgb=function(e){var r=e.match(a.reRGBa);if(r){var n=parseInt(r[1],10)/(/%$/.test(r[1])?100:1)*(/%$/.test(r[1])?255:1),o=parseInt(r[2],10)/(/%$/.test(r[2])?100:1)*(/%$/.test(r[2])?255:1),u=parseInt(r[3],10)/(/%$/.test(r[3])?100:1)*(/%$/.test(r[3])?255:1);return[parseInt(n,10),parseInt(o,10),parseInt(u,10),r[4]?parseFloat(r[4]):1]}},i.Color.fromRgba=a.fromRgb,i.Color.fromHsl=function(e){return a.fromSource(a.sourceFromHsl(e))},i.Color.sourceFromHsl=function(e){var r=e.match(a.reHSLa);if(!!r){var n=(parseFloat(r[1])%360+360)%360/360,o=parseFloat(r[2])/(/%$/.test(r[2])?100:1),u=parseFloat(r[3])/(/%$/.test(r[3])?100:1),s,h,g;if(o===0)s=h=g=u;else{var v=u<=.5?u*(o+1):u+o-u*o,_=u*2-v;s=l(_,v,n+1/3),h=l(_,v,n),g=l(_,v,n-1/3)}return[Math.round(s*255),Math.round(h*255),Math.round(g*255),r[4]?parseFloat(r[4]):1]}},i.Color.fromHsla=a.fromHsl,i.Color.fromHex=function(e){return a.fromSource(a.sourceFromHex(e))},i.Color.sourceFromHex=function(e){if(e.match(a.reHex)){var r=e.slice(e.indexOf("#")+1),n=r.length===3||r.length===4,o=r.length===8||r.length===4,u=n?r.charAt(0)+r.charAt(0):r.substring(0,2),s=n?r.charAt(1)+r.charAt(1):r.substring(2,4),h=n?r.charAt(2)+r.charAt(2):r.substring(4,6),g=o?n?r.charAt(3)+r.charAt(3):r.substring(6,8):"FF";return[parseInt(u,16),parseInt(s,16),parseInt(h,16),parseFloat((parseInt(g,16)/255).toFixed(2))]}},i.Color.fromSource=function(e){var r=new a;return r.setSource(e),r}}(A),function(d){var i=d.fabric||(d.fabric={}),a=["e","se","s","sw","w","nw","n","ne","e"],l=["ns","nesw","ew","nwse"],e={},r="left",n="top",o="right",u="bottom",s="center",h={top:u,bottom:n,left:o,right:r,center:s},g=i.util.radiansToDegrees,v=Math.sign||function(it){return(it>0)-(it<0)||+it};function _(it,q){var ot=it.angle+g(Math.atan2(q.y,q.x))+360;return Math.round(ot%360/45)}function w(it,q){var ot=q.transform.target,ht=ot.canvas,nt=i.util.object.clone(q);nt.target=ot,ht&&ht.fire("object:"+it,nt),ot.fire(it,q)}function C(it,q){var ot=q.canvas,ht=ot.uniScaleKey,nt=it[ht];return ot.uniformScaling&&!nt||!ot.uniformScaling&&nt}function P(it){return it.originX===s&&it.originY===s}function D(it,q,ot){var ht=it.lockScalingX,nt=it.lockScalingY;return!!(ht&&nt||!q&&(ht||nt)&&ot||ht&&q==="x"||nt&&q==="y")}function I(it,q,ot){var ht="not-allowed",nt=C(it,ot),ut="";if(q.x!==0&&q.y===0?ut="x":q.x===0&&q.y!==0&&(ut="y"),D(ot,ut,nt))return ht;var wt=_(ot,q);return a[wt]+"-resize"}function N(it,q,ot){var ht="not-allowed";if(q.x!==0&&ot.lockSkewingY||q.y!==0&&ot.lockSkewingX)return ht;var nt=_(ot,q)%4;return l[nt]+"-resize"}function H(it,q,ot){return it[ot.canvas.altActionKey]?e.skewCursorStyleHandler(it,q,ot):e.scaleCursorStyleHandler(it,q,ot)}function K(it,q,ot){var ht=it[ot.canvas.altActionKey];if(q.x===0)return ht?"skewX":"scaleY";if(q.y===0)return ht?"skewY":"scaleX"}function J(it,q,ot){return ot.lockRotation?"not-allowed":q.cursorStyle}function Q(it,q,ot,ht){return{e:it,transform:q,pointer:{x:ot,y:ht}}}function tt(it){return function(q,ot,ht,nt){var ut=ot.target,wt=ut.getCenterPoint(),Pt=ut.translateToOriginPoint(wt,ot.originX,ot.originY),Ct=it(q,ot,ht,nt);return ut.setPositionByOrigin(Pt,ot.originX,ot.originY),Ct}}function dt(it,q){return function(ot,ht,nt,ut){var wt=q(ot,ht,nt,ut);return wt&&w(it,Q(ot,ht,nt,ut)),wt}}function rt(it,q,ot,ht,nt){var ut=it.target,wt=ut.controls[it.corner],Pt=ut.canvas.getZoom(),Ct=ut.padding/Pt,ct=ut.toLocalPoint(new i.Point(ht,nt),q,ot);return ct.x>=Ct&&(ct.x-=Ct),ct.x<=-Ct&&(ct.x+=Ct),ct.y>=Ct&&(ct.y-=Ct),ct.y<=Ct&&(ct.y+=Ct),ct.x-=wt.offsetX,ct.y-=wt.offsetY,ct}function _t(it){return it.flipX!==it.flipY}function T(it,q,ot,ht,nt){if(it[q]!==0){var ut=it._getTransformedDimensions()[ht],wt=nt/ut*it[ot];it.set(ot,wt)}}function B(it,q,ot,ht){var nt=q.target,ut=nt._getTransformedDimensions(0,nt.skewY),wt=rt(q,q.originX,q.originY,ot,ht),Pt=Math.abs(wt.x*2)-ut.x,Ct=nt.skewX,ct;Pt<2?ct=0:(ct=g(Math.atan2(Pt/nt.scaleX,ut.y/nt.scaleY)),q.originX===r&&q.originY===u&&(ct=-ct),q.originX===o&&q.originY===n&&(ct=-ct),_t(nt)&&(ct=-ct));var xt=Ct!==ct;if(xt){var Tt=nt._getTransformedDimensions().y;nt.set("skewX",ct),T(nt,"skewY","scaleY","y",Tt)}return xt}function R(it,q,ot,ht){var nt=q.target,ut=nt._getTransformedDimensions(nt.skewX,0),wt=rt(q,q.originX,q.originY,ot,ht),Pt=Math.abs(wt.y*2)-ut.y,Ct=nt.skewY,ct;Pt<2?ct=0:(ct=g(Math.atan2(Pt/nt.scaleY,ut.x/nt.scaleX)),q.originX===r&&q.originY===u&&(ct=-ct),q.originX===o&&q.originY===n&&(ct=-ct),_t(nt)&&(ct=-ct));var xt=Ct!==ct;if(xt){var Tt=nt._getTransformedDimensions().x;nt.set("skewY",ct),T(nt,"skewX","scaleX","x",Tt)}return xt}function V(it,q,ot,ht){var nt=q.target,ut=nt.skewX,wt,Pt=q.originY;if(nt.lockSkewingX)return!1;if(ut===0){var Ct=rt(q,s,s,ot,ht);Ct.x>0?wt=r:wt=o}else ut>0&&(wt=Pt===n?r:o),ut<0&&(wt=Pt===n?o:r),_t(nt)&&(wt=wt===r?o:r);q.originX=wt;var ct=dt("skewing",tt(B));return ct(it,q,ot,ht)}function G(it,q,ot,ht){var nt=q.target,ut=nt.skewY,wt,Pt=q.originX;if(nt.lockSkewingY)return!1;if(ut===0){var Ct=rt(q,s,s,ot,ht);Ct.y>0?wt=n:wt=u}else ut>0&&(wt=Pt===r?n:u),ut<0&&(wt=Pt===r?u:n),_t(nt)&&(wt=wt===n?u:n);q.originY=wt;var ct=dt("skewing",tt(R));return ct(it,q,ot,ht)}function F(it,q,ot,ht){var nt=q,ut=nt.target,wt=ut.translateToOriginPoint(ut.getCenterPoint(),nt.originX,nt.originY);if(ut.lockRotation)return!1;var Pt=Math.atan2(nt.ey-wt.y,nt.ex-wt.x),Ct=Math.atan2(ht-wt.y,ot-wt.x),ct=g(Ct-Pt+nt.theta),xt=!0;if(ut.snapAngle>0){var Tt=ut.snapAngle,Mt=ut.snapThreshold||Tt,jt=Math.ceil(ct/Tt)*Tt,At=Math.floor(ct/Tt)*Tt;Math.abs(ct-At)<Mt?ct=At:Math.abs(ct-jt)<Mt&&(ct=jt)}return ct<0&&(ct=360+ct),ct%=360,xt=ut.angle!==ct,ut.angle=ct,xt}function k(it,q,ot,ht,nt){nt=nt||{};var ut=q.target,wt=ut.lockScalingX,Pt=ut.lockScalingY,Ct=nt.by,ct,xt,Tt,Mt,jt=C(it,ut),At=D(ut,Ct,jt),Ht,Vt,Kt=q.gestureScale;if(At)return!1;if(Kt)xt=q.scaleX*Kt,Tt=q.scaleY*Kt;else{if(ct=rt(q,q.originX,q.originY,ot,ht),Ht=Ct!=="y"?v(ct.x):1,Vt=Ct!=="x"?v(ct.y):1,q.signX||(q.signX=Ht),q.signY||(q.signY=Vt),ut.lockScalingFlip&&(q.signX!==Ht||q.signY!==Vt))return!1;if(Mt=ut._getTransformedDimensions(),jt&&!Ct){var $t=Math.abs(ct.x)+Math.abs(ct.y),qt=q.original,Pe=Math.abs(Mt.x*qt.scaleX/ut.scaleX)+Math.abs(Mt.y*qt.scaleY/ut.scaleY),ae=$t/Pe;xt=qt.scaleX*ae,Tt=qt.scaleY*ae}else xt=Math.abs(ct.x*ut.scaleX/Mt.x),Tt=Math.abs(ct.y*ut.scaleY/Mt.y);P(q)&&(xt*=2,Tt*=2),q.signX!==Ht&&Ct!=="y"&&(q.originX=h[q.originX],xt*=-1,q.signX=Ht),q.signY!==Vt&&Ct!=="x"&&(q.originY=h[q.originY],Tt*=-1,q.signY=Vt)}var Te=ut.scaleX,Qe=ut.scaleY;return Ct?(Ct==="x"&&ut.set("scaleX",xt),Ct==="y"&&ut.set("scaleY",Tt)):(!wt&&ut.set("scaleX",xt),!Pt&&ut.set("scaleY",Tt)),Te!==ut.scaleX||Qe!==ut.scaleY}function X(it,q,ot,ht){return k(it,q,ot,ht)}function Z(it,q,ot,ht){return k(it,q,ot,ht,{by:"x"})}function st(it,q,ot,ht){return k(it,q,ot,ht,{by:"y"})}function et(it,q,ot,ht){return it[q.target.canvas.altActionKey]?e.skewHandlerX(it,q,ot,ht):e.scalingY(it,q,ot,ht)}function lt(it,q,ot,ht){return it[q.target.canvas.altActionKey]?e.skewHandlerY(it,q,ot,ht):e.scalingX(it,q,ot,ht)}function ft(it,q,ot,ht){var nt=q.target,ut=rt(q,q.originX,q.originY,ot,ht),wt=nt.strokeWidth/(nt.strokeUniform?nt.scaleX:1),Pt=P(q)?2:1,Ct=nt.width,ct=Math.abs(ut.x*Pt/nt.scaleX)-wt;return nt.set("width",Math.max(ct,0)),Ct!==ct}function yt(it,q,ot,ht){var nt=q.target,ut=ot-q.offsetX,wt=ht-q.offsetY,Pt=!nt.get("lockMovementX")&&nt.left!==ut,Ct=!nt.get("lockMovementY")&&nt.top!==wt;return Pt&&nt.set("left",ut),Ct&&nt.set("top",wt),(Pt||Ct)&&w("moving",Q(it,q,ot,ht)),Pt||Ct}e.scaleCursorStyleHandler=I,e.skewCursorStyleHandler=N,e.scaleSkewCursorStyleHandler=H,e.rotationWithSnapping=dt("rotating",tt(F)),e.scalingEqually=dt("scaling",tt(X)),e.scalingX=dt("scaling",tt(Z)),e.scalingY=dt("scaling",tt(st)),e.scalingYOrSkewingX=et,e.scalingXOrSkewingY=lt,e.changeWidth=dt("resizing",tt(ft)),e.skewHandlerX=V,e.skewHandlerY=G,e.dragHandler=yt,e.scaleOrSkewActionName=K,e.rotationStyleHandler=J,e.fireEvent=w,e.wrapWithFixedAnchor=tt,e.wrapWithFireEvent=dt,e.getLocalPoint=rt,i.controlsUtils=e}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.util.degreesToRadians,l=i.controlsUtils;function e(n,o,u,s,h){s=s||{};var g=this.sizeX||s.cornerSize||h.cornerSize,v=this.sizeY||s.cornerSize||h.cornerSize,_=typeof s.transparentCorners<"u"?s.transparentCorners:h.transparentCorners,w=_?"stroke":"fill",C=!_&&(s.cornerStrokeColor||h.cornerStrokeColor),P=o,D=u,I;n.save(),n.fillStyle=s.cornerColor||h.cornerColor,n.strokeStyle=s.cornerStrokeColor||h.cornerStrokeColor,g>v?(I=g,n.scale(1,v/g),D=u*g/v):v>g?(I=v,n.scale(g/v,1),P=o*v/g):I=g,n.lineWidth=1,n.beginPath(),n.arc(P,D,I/2,0,2*Math.PI,!1),n[w](),C&&n.stroke(),n.restore()}function r(n,o,u,s,h){s=s||{};var g=this.sizeX||s.cornerSize||h.cornerSize,v=this.sizeY||s.cornerSize||h.cornerSize,_=typeof s.transparentCorners<"u"?s.transparentCorners:h.transparentCorners,w=_?"stroke":"fill",C=!_&&(s.cornerStrokeColor||h.cornerStrokeColor),P=g/2,D=v/2;n.save(),n.fillStyle=s.cornerColor||h.cornerColor,n.strokeStyle=s.cornerStrokeColor||h.cornerStrokeColor,n.lineWidth=1,n.translate(o,u),n.rotate(a(h.angle)),n[w+"Rect"](-P,-D,g,v),C&&n.strokeRect(-P,-D,g,v),n.restore()}l.renderCircleControl=e,l.renderSquareControl=r}(A),function(d){var i=d.fabric||(d.fabric={});function a(l){for(var e in l)this[e]=l[e]}i.Control=a,i.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(l,e){return e.cursorStyle},getActionName:function(l,e){return e.actionName},getVisibility:function(l,e){var r=l._controlsVisibility;return r&&typeof r[e]<"u"?r[e]:this.visible},setVisibility:function(l){this.visible=l},positionHandler:function(l,e){var r=i.util.transformPoint({x:this.x*l.x+this.offsetX,y:this.y*l.y+this.offsetY},e);return r},calcCornerCoords:function(l,e,r,n,o){var u,s,h,g,v=o?this.touchSizeX:this.sizeX,_=o?this.touchSizeY:this.sizeY;if(v&&_&&v!==_){var w=Math.atan2(_,v),C=Math.sqrt(v*v+_*_)/2,P=w-i.util.degreesToRadians(l),D=Math.PI/2-w-i.util.degreesToRadians(l);u=C*i.util.cos(P),s=C*i.util.sin(P),h=C*i.util.cos(D),g=C*i.util.sin(D)}else{var I=v&&_?v:e;C=I*.7071067812;var P=i.util.degreesToRadians(45-l);u=h=C*i.util.cos(P),s=g=C*i.util.sin(P)}return{tl:{x:r-g,y:n-h},tr:{x:r+u,y:n-s},bl:{x:r-u,y:n+s},br:{x:r+g,y:n+h}}},render:function(l,e,r,n,o){switch(n=n||{},n.cornerStyle||o.cornerStyle){case"circle":i.controlsUtils.renderCircleControl.call(this,l,e,r,n,o);break;default:i.controlsUtils.renderSquareControl.call(this,l,e,r,n,o)}}}}(A),function(){function d(r,n){var o=r.getAttribute("style"),u=r.getAttribute("offset")||0,s,h,g,v;if(u=parseFloat(u)/(/%$/.test(u)?100:1),u=u<0?0:u>1?1:u,o){var _=o.split(/\s*;\s*/);for(_[_.length-1]===""&&_.pop(),v=_.length;v--;){var w=_[v].split(/\s*:\s*/),C=w[0].trim(),P=w[1].trim();C==="stop-color"?s=P:C==="stop-opacity"&&(g=P)}}return s||(s=r.getAttribute("stop-color")||"rgb(0,0,0)"),g||(g=r.getAttribute("stop-opacity")),s=new p.Color(s),h=s.getAlpha(),g=isNaN(parseFloat(g))?1:parseFloat(g),g*=h*n,{offset:u,color:s.toRgb(),opacity:g}}function i(r){return{x1:r.getAttribute("x1")||0,y1:r.getAttribute("y1")||0,x2:r.getAttribute("x2")||"100%",y2:r.getAttribute("y2")||0}}function a(r){return{x1:r.getAttribute("fx")||r.getAttribute("cx")||"50%",y1:r.getAttribute("fy")||r.getAttribute("cy")||"50%",r1:0,x2:r.getAttribute("cx")||"50%",y2:r.getAttribute("cy")||"50%",r2:r.getAttribute("r")||"50%"}}var l=p.util.object.clone;p.Gradient=p.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(r){r||(r={}),r.coords||(r.coords={});var n,o=this;Object.keys(r).forEach(function(u){o[u]=r[u]}),this.id?this.id+="_"+p.Object.__uid++:this.id=p.Object.__uid++,n={x1:r.coords.x1||0,y1:r.coords.y1||0,x2:r.coords.x2||0,y2:r.coords.y2||0},this.type==="radial"&&(n.r1=r.coords.r1||0,n.r2=r.coords.r2||0),this.coords=n,this.colorStops=r.colorStops.slice()},addColorStop:function(r){for(var n in r){var o=new p.Color(r[n]);this.colorStops.push({offset:parseFloat(n),color:o.toRgb(),opacity:o.getAlpha()})}return this},toObject:function(r){var n={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return p.util.populateWithProperties(this,n,r),n},toSVG:function(r,h){var o=l(this.coords,!0),u,s,h=h||{},g,v,_=l(this.colorStops,!0),w=o.r1>o.r2,C=this.gradientTransform?this.gradientTransform.concat():p.iMatrix.concat(),P=-this.offsetX,D=-this.offsetY,I=!!h.additionalTransform,N=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(_.sort(function(tt,dt){return tt.offset-dt.offset}),N==="objectBoundingBox"?(P/=r.width,D/=r.height):(P+=r.width/2,D+=r.height/2),r.type==="path"&&this.gradientUnits!=="percentage"&&(P-=r.pathOffset.x,D-=r.pathOffset.y),C[4]-=P,C[5]-=D,v='id="SVGID_'+this.id+'" gradientUnits="'+N+'"',v+=' gradientTransform="'+(I?h.additionalTransform+" ":"")+p.util.matrixToSVG(C)+'" ',this.type==="linear"?g=["<linearGradient ",v,' x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,`">
`]:this.type==="radial"&&(g=["<radialGradient ",v,' cx="',w?o.x1:o.x2,'" cy="',w?o.y1:o.y2,'" r="',w?o.r1:o.r2,'" fx="',w?o.x2:o.x1,'" fy="',w?o.y2:o.y1,`">
`]),this.type==="radial"){if(w)for(_=_.concat(),_.reverse(),u=0,s=_.length;u<s;u++)_[u].offset=1-_[u].offset;var H=Math.min(o.r1,o.r2);if(H>0){var K=Math.max(o.r1,o.r2),J=H/K;for(u=0,s=_.length;u<s;u++)_[u].offset+=J*(1-_[u].offset)}}for(u=0,s=_.length;u<s;u++){var Q=_[u];g.push("<stop ",'offset="',Q.offset*100+"%",'" style="stop-color:',Q.color,typeof Q.opacity<"u"?";stop-opacity: "+Q.opacity:";",`"/>
`)}return g.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),g.join("")},toLive:function(r){var n,o=p.util.object.clone(this.coords),u,s;if(!!this.type){for(this.type==="linear"?n=r.createLinearGradient(o.x1,o.y1,o.x2,o.y2):this.type==="radial"&&(n=r.createRadialGradient(o.x1,o.y1,o.r1,o.x2,o.y2,o.r2)),u=0,s=this.colorStops.length;u<s;u++){var h=this.colorStops[u].color,g=this.colorStops[u].opacity,v=this.colorStops[u].offset;typeof g<"u"&&(h=new p.Color(h).setAlpha(g).toRgba()),n.addColorStop(v,h)}return n}}}),p.util.object.extend(p.Gradient,{fromElement:function(r,n,o,u){var s=parseFloat(o)/(/%$/.test(o)?100:1);s=s<0?0:s>1?1:s,isNaN(s)&&(s=1);var h=r.getElementsByTagName("stop"),g,v=r.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",_=r.getAttribute("gradientTransform")||"",w=[],C,P,D=0,I=0,N;for(r.nodeName==="linearGradient"||r.nodeName==="LINEARGRADIENT"?(g="linear",C=i(r)):(g="radial",C=a(r)),P=h.length;P--;)w.push(d(h[P],s));N=p.parseTransformAttribute(_),e(n,C,u,v),v==="pixels"&&(D=-n.left,I=-n.top);var H=new p.Gradient({id:r.getAttribute("id"),type:g,coords:C,colorStops:w,gradientUnits:v,gradientTransform:N,offsetX:D,offsetY:I});return H}});function e(r,n,o,u){var s,h;Object.keys(n).forEach(function(g){s=n[g],s==="Infinity"?h=1:s==="-Infinity"?h=0:(h=parseFloat(n[g],10),typeof s=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(s)&&(h*=.01,u==="pixels"&&((g==="x1"||g==="x2"||g==="r2")&&(h*=o.viewBoxWidth||o.width),(g==="y1"||g==="y2")&&(h*=o.viewBoxHeight||o.height)))),n[g]=h})}}(),function(){var d=p.util.toFixed;p.Pattern=p.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(i,a){if(i||(i={}),this.id=p.Object.__uid++,this.setOptions(i),!i.source||i.source&&typeof i.source!="string"){a&&a(this);return}else{var l=this;this.source=p.util.createImage(),p.util.loadImage(i.source,function(e,r){l.source=e,a&&a(l,r)},null,this.crossOrigin)}},toObject:function(i){var a=p.Object.NUM_FRACTION_DIGITS,l,e;return typeof this.source.src=="string"?l=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(l=this.source.toDataURL()),e={type:"pattern",source:l,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:d(this.offsetX,a),offsetY:d(this.offsetY,a),patternTransform:this.patternTransform?this.patternTransform.concat():null},p.util.populateWithProperties(this,e,i),e},toSVG:function(i){var a=typeof this.source=="function"?this.source():this.source,l=a.width/i.width,e=a.height/i.height,r=this.offsetX/i.width,n=this.offsetY/i.height,o="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(e=1,n&&(e+=Math.abs(n))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(l=1,r&&(l+=Math.abs(r))),a.src?o=a.src:a.toDataURL&&(o=a.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+n+'" width="'+l+'" height="'+e+`">
<image x="0" y="0" width="`+a.width+'" height="'+a.height+'" xlink:href="'+o+`"></image>
</pattern>
`},setOptions:function(i){for(var a in i)this[a]=i[a]},toLive:function(i){var a=this.source;return!a||typeof a.src<"u"&&(!a.complete||a.naturalWidth===0||a.naturalHeight===0)?"":i.createPattern(a,this.repeat)}})}(),function(d){var i=d.fabric||(d.fabric={}),a=i.util.toFixed;if(i.Shadow){i.warn("fabric.Shadow is already defined.");return}i.Shadow=i.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(l){typeof l=="string"&&(l=this._parseShadow(l));for(var e in l)this[e]=l[e];this.id=i.Object.__uid++},_parseShadow:function(l){var e=l.trim(),r=i.Shadow.reOffsetsAndBlur.exec(e)||[],n=e.replace(i.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:n.trim(),offsetX:parseFloat(r[1],10)||0,offsetY:parseFloat(r[2],10)||0,blur:parseFloat(r[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(l){var e=40,r=40,n=i.Object.NUM_FRACTION_DIGITS,o=i.util.rotateVector({x:this.offsetX,y:this.offsetY},i.util.degreesToRadians(-l.angle)),u=20,s=new i.Color(this.color);return l.width&&l.height&&(e=a((Math.abs(o.x)+this.blur)/l.width,n)*100+u,r=a((Math.abs(o.y)+this.blur)/l.height,n)*100+u),l.flipX&&(o.x*=-1),l.flipY&&(o.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+e+'%" width="'+(100+2*e)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+a(this.blur?this.blur/2:0,n)+`"></feGaussianBlur>
	<feOffset dx="`+a(o.x,n)+'" dy="'+a(o.y,n)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+s.toRgb()+'" flood-opacity="'+s.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var l={},e=i.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(r){this[r]!==e[r]&&(l[r]=this[r])},this),l}}),i.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(A),function(){if(p.StaticCanvas){p.warn("fabric.StaticCanvas is already defined.");return}var d=p.util.object.extend,i=p.util.getElementOffset,a=p.util.removeFromArray,l=p.util.toFixed,e=p.util.transformPoint,r=p.util.invertTransform,n=p.util.getNodeCanvas,o=p.util.createCanvasElement,u=new Error("Could not initialize `canvas` element");p.StaticCanvas=p.util.createClass(p.CommonMethods,{initialize:function(s,h){h||(h={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(s,h)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:p.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(s,h){var g=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(s),this._initOptions(h),this.interactive||this._initRetinaScaling(),h.overlayImage&&this.setOverlayImage(h.overlayImage,g),h.backgroundImage&&this.setBackgroundImage(h.backgroundImage,g),h.backgroundColor&&this.setBackgroundColor(h.backgroundColor,g),h.overlayColor&&this.setOverlayColor(h.overlayColor,g),this.calcOffset()},_isRetinaScaling:function(){return p.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,p.devicePixelRatio):1},_initRetinaScaling:function(){if(!!this._isRetinaScaling()){var s=p.devicePixelRatio;this.__initRetinaScaling(s,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(s,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(s,h,g){h.setAttribute("width",this.width*s),h.setAttribute("height",this.height*s),g.scale(s,s)},calcOffset:function(){return this._offset=i(this.lowerCanvasEl),this},setOverlayImage:function(s,h,g){return this.__setBgOverlayImage("overlayImage",s,h,g)},setBackgroundImage:function(s,h,g){return this.__setBgOverlayImage("backgroundImage",s,h,g)},setOverlayColor:function(s,h){return this.__setBgOverlayColor("overlayColor",s,h)},setBackgroundColor:function(s,h){return this.__setBgOverlayColor("backgroundColor",s,h)},__setBgOverlayImage:function(s,h,g,v){return typeof h=="string"?p.util.loadImage(h,function(_,w){if(_){var C=new p.Image(_,v);this[s]=C,C.canvas=this}g&&g(_,w)},this,v&&v.crossOrigin):(v&&h.setOptions(v),this[s]=h,h&&(h.canvas=this),g&&g(h,!1)),this},__setBgOverlayColor:function(s,h,g){return this[s]=h,this._initGradient(h,s),this._initPattern(h,s,g),this},_createCanvasElement:function(){var s=o();if(!s||(s.style||(s.style={}),typeof s.getContext>"u"))throw u;return s},_initOptions:function(s){var h=this.lowerCanvasEl;this._setOptions(s),this.width=this.width||parseInt(h.width,10)||0,this.height=this.height||parseInt(h.height,10)||0,this.lowerCanvasEl.style&&(h.width=this.width,h.height=this.height,h.style.width=this.width+"px",h.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(s){s&&s.getContext?this.lowerCanvasEl=s:this.lowerCanvasEl=p.util.getById(s)||this._createCanvasElement(),p.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(s,h){return this.setDimensions({width:s},h)},setHeight:function(s,h){return this.setDimensions({height:s},h)},setDimensions:function(s,h){var g;h=h||{};for(var v in s)g=s[v],h.cssOnly||(this._setBackstoreDimension(v,s[v]),g+="px",this.hasLostContext=!0),h.backstoreOnly||this._setCssDimension(v,g);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),h.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(s,h){return this.lowerCanvasEl[s]=h,this.upperCanvasEl&&(this.upperCanvasEl[s]=h),this.cacheCanvasEl&&(this.cacheCanvasEl[s]=h),this[s]=h,this},_setCssDimension:function(s,h){return this.lowerCanvasEl.style[s]=h,this.upperCanvasEl&&(this.upperCanvasEl.style[s]=h),this.wrapperEl&&(this.wrapperEl.style[s]=h),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(s){var h=this._activeObject,g=this.backgroundImage,v=this.overlayImage,_,w,C;for(this.viewportTransform=s,w=0,C=this._objects.length;w<C;w++)_=this._objects[w],_.group||_.setCoords(!0);return h&&h.setCoords(),g&&g.setCoords(!0),v&&v.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(s,h){var g=s,v=this.viewportTransform.slice(0);s=e(s,r(this.viewportTransform)),v[0]=h,v[3]=h;var _=e(s,v);return v[4]+=g.x-_.x,v[5]+=g.y-_.y,this.setViewportTransform(v)},setZoom:function(s){return this.zoomToPoint(new p.Point(0,0),s),this},absolutePan:function(s){var h=this.viewportTransform.slice(0);return h[4]=-s.x,h[5]=-s.y,this.setViewportTransform(h)},relativePan:function(s){return this.absolutePan(new p.Point(-s.x-this.viewportTransform[4],-s.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(s){this.stateful&&s.setupState(),s._set("canvas",this),s.setCoords(),this.fire("object:added",{target:s}),s.fire("added")},_onObjectRemoved:function(s){this.fire("object:removed",{target:s}),s.fire("removed"),delete s.canvas},clearContext:function(s){return s.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var s=this.contextContainer;return this.renderCanvas(s,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=p.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var s={},h=this.width,g=this.height,v=r(this.viewportTransform);return s.tl=e({x:0,y:0},v),s.br=e({x:h,y:g},v),s.tr=new p.Point(s.br.x,s.tl.y),s.bl=new p.Point(s.tl.x,s.br.y),this.vptCoords=s,s},cancelRequestedRender:function(){this.isRendering&&(p.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(s,h){var g=this.viewportTransform,v=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(s),p.util.setImageSmoothing(s,this.imageSmoothingEnabled),this.fire("before:render",{ctx:s}),this._renderBackground(s),s.save(),s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._renderObjects(s,h),s.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(s),v&&(v.canvas=this,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(s)),this._renderOverlay(s),this.controlsAboveOverlay&&this.interactive&&this.drawControls(s),this.fire("after:render",{ctx:s})},drawClipPathOnCanvas:function(s){var h=this.viewportTransform,g=this.clipPath;s.save(),s.transform(h[0],h[1],h[2],h[3],h[4],h[5]),s.globalCompositeOperation="destination-in",g.transform(s),s.scale(1/g.zoomX,1/g.zoomY),s.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),s.restore()},_renderObjects:function(s,h){var g,v;for(g=0,v=h.length;g<v;++g)h[g]&&h[g].render(s)},_renderBackgroundOrOverlay:function(s,h){var g=this[h+"Color"],v=this[h+"Image"],_=this.viewportTransform,w=this[h+"Vpt"];if(!(!g&&!v)){if(g){s.save(),s.beginPath(),s.moveTo(0,0),s.lineTo(this.width,0),s.lineTo(this.width,this.height),s.lineTo(0,this.height),s.closePath(),s.fillStyle=g.toLive?g.toLive(s,this):g,w&&s.transform(_[0],_[1],_[2],_[3],_[4],_[5]),s.transform(1,0,0,1,g.offsetX||0,g.offsetY||0);var C=g.gradientTransform||g.patternTransform;C&&s.transform(C[0],C[1],C[2],C[3],C[4],C[5]),s.fill(),s.restore()}v&&(s.save(),w&&s.transform(_[0],_[1],_[2],_[3],_[4],_[5]),v.render(s),s.restore())}},_renderBackground:function(s){this._renderBackgroundOrOverlay(s,"background")},_renderOverlay:function(s){this._renderBackgroundOrOverlay(s,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new p.Point(this.width/2,this.height/2)},centerObjectH:function(s){return this._centerObject(s,new p.Point(this.getCenterPoint().x,s.getCenterPoint().y))},centerObjectV:function(s){return this._centerObject(s,new p.Point(s.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(s){var h=this.getCenterPoint();return this._centerObject(s,h)},viewportCenterObject:function(s){var h=this.getVpCenter();return this._centerObject(s,h)},viewportCenterObjectH:function(s){var h=this.getVpCenter();return this._centerObject(s,new p.Point(h.x,s.getCenterPoint().y)),this},viewportCenterObjectV:function(s){var h=this.getVpCenter();return this._centerObject(s,new p.Point(s.getCenterPoint().x,h.y))},getVpCenter:function(){var s=this.getCenterPoint(),h=r(this.viewportTransform);return e(s,h)},_centerObject:function(s,h){return s.setPositionByOrigin(h,"center","center"),s.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(s){return this.toDatalessObject(s)},toObject:function(s){return this._toObjectMethod("toObject",s)},toDatalessObject:function(s){return this._toObjectMethod("toDatalessObject",s)},_toObjectMethod:function(s,h){var g=this.clipPath,v={version:p.version,objects:this._toObjects(s,h)};return g&&!g.excludeFromExport&&(v.clipPath=this._toObject(this.clipPath,s,h)),d(v,this.__serializeBgOverlay(s,h)),p.util.populateWithProperties(this,v,h),v},_toObjects:function(s,h){return this._objects.filter(function(g){return!g.excludeFromExport}).map(function(g){return this._toObject(g,s,h)},this)},_toObject:function(s,h,g){var v;this.includeDefaultValues||(v=s.includeDefaultValues,s.includeDefaultValues=!1);var _=s[h](g);return this.includeDefaultValues||(s.includeDefaultValues=v),_},__serializeBgOverlay:function(s,h){var g={},v=this.backgroundImage,_=this.overlayImage,w=this.backgroundColor,C=this.overlayColor;return w&&w.toObject?w.excludeFromExport||(g.background=w.toObject(h)):w&&(g.background=w),C&&C.toObject?C.excludeFromExport||(g.overlay=C.toObject(h)):C&&(g.overlay=C),v&&!v.excludeFromExport&&(g.backgroundImage=this._toObject(v,s,h)),_&&!_.excludeFromExport&&(g.overlayImage=this._toObject(_,s,h)),g},svgViewportTransformation:!0,toSVG:function(s,h){s||(s={}),s.reviver=h;var g=[];return this._setSVGPreamble(g,s),this._setSVGHeader(g,s),this.clipPath&&g.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(g,"background"),this._setSVGBgOverlayImage(g,"backgroundImage",h),this._setSVGObjects(g,h),this.clipPath&&g.push(`</g>
`),this._setSVGBgOverlayColor(g,"overlay"),this._setSVGBgOverlayImage(g,"overlayImage",h),g.push("</svg>"),g.join("")},_setSVGPreamble:function(s,h){h.suppressPreamble||s.push('<?xml version="1.0" encoding="',h.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(s,h){var g=h.width||this.width,v=h.height||this.height,_,w='viewBox="0 0 '+this.width+" "+this.height+'" ',C=p.Object.NUM_FRACTION_DIGITS;h.viewBox?w='viewBox="'+h.viewBox.x+" "+h.viewBox.y+" "+h.viewBox.width+" "+h.viewBox.height+'" ':this.svgViewportTransformation&&(_=this.viewportTransform,w='viewBox="'+l(-_[4]/_[0],C)+" "+l(-_[5]/_[3],C)+" "+l(this.width/_[0],C)+" "+l(this.height/_[3],C)+'" '),s.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',g,'" ','height="',v,'" ',w,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",p.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(h),`</defs>
`)},createSVGClipPathMarkup:function(s){var h=this.clipPath;return h?(h.clipPathId="CLIPPATH_"+p.Object.__uid++,'<clipPath id="'+h.clipPathId+`" >
`+this.clipPath.toClipPathSVG(s.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var s=this,h=["background","overlay"].map(function(g){var v=s[g+"Color"];if(v&&v.toLive){var _=s[g+"Vpt"],w=s.viewportTransform,C={width:s.width/(_?w[0]:1),height:s.height/(_?w[3]:1)};return v.toSVG(C,{additionalTransform:_?p.util.matrixToSVG(w):""})}});return h.join("")},createSVGFontFacesMarkup:function(){var s="",h={},g,v,_,w,C,P,D,I,N,H=p.fontPaths,K=[];for(this._objects.forEach(function Q(tt){K.push(tt),tt._objects&&tt._objects.forEach(Q)}),I=0,N=K.length;I<N;I++)if(g=K[I],v=g.fontFamily,!(g.type.indexOf("text")===-1||h[v]||!H[v])&&(h[v]=!0,!!g.styles)){_=g.styles;for(C in _){w=_[C];for(D in w)P=w[D],v=P.fontFamily,!h[v]&&H[v]&&(h[v]=!0)}}for(var J in h)s+=[`		@font-face {
`,"			font-family: '",J,`';
`,"			src: url('",H[J],`');
`,`		}
`].join("");return s&&(s=['	<style type="text/css">',`<![CDATA[
`,s,"]]>",`</style>
`].join("")),s},_setSVGObjects:function(s,h){var g,v,_,w=this._objects;for(v=0,_=w.length;v<_;v++)g=w[v],!g.excludeFromExport&&this._setSVGObject(s,g,h)},_setSVGObject:function(s,h,g){s.push(h.toSVG(g))},_setSVGBgOverlayImage:function(s,h,g){this[h]&&!this[h].excludeFromExport&&this[h].toSVG&&s.push(this[h].toSVG(g))},_setSVGBgOverlayColor:function(s,h){var g=this[h+"Color"],v=this.viewportTransform,_=this.width,w=this.height;if(!!g)if(g.toLive){var C=g.repeat,P=p.util.invertTransform(v),D=this[h+"Vpt"],I=D?p.util.matrixToSVG(P):"";s.push('<rect transform="'+I+" translate(",_/2,",",w/2,')"',' x="',g.offsetX-_/2,'" y="',g.offsetY-w/2,'" ','width="',C==="repeat-y"||C==="no-repeat"?g.source.width:_,'" height="',C==="repeat-x"||C==="no-repeat"?g.source.height:w,'" fill="url(#SVGID_'+g.id+')"',`></rect>
`)}else s.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',g,'"',`></rect>
`)},sendToBack:function(s){if(!s)return this;var h=this._activeObject,g,v,_;if(s===h&&s.type==="activeSelection")for(_=h._objects,g=_.length;g--;)v=_[g],a(this._objects,v),this._objects.unshift(v);else a(this._objects,s),this._objects.unshift(s);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(s){if(!s)return this;var h=this._activeObject,g,v,_;if(s===h&&s.type==="activeSelection")for(_=h._objects,g=0;g<_.length;g++)v=_[g],a(this._objects,v),this._objects.push(v);else a(this._objects,s),this._objects.push(s);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(s,h){if(!s)return this;var g=this._activeObject,v,_,w,C,P,D=0;if(s===g&&s.type==="activeSelection")for(P=g._objects,v=0;v<P.length;v++)_=P[v],w=this._objects.indexOf(_),w>0+D&&(C=w-1,a(this._objects,_),this._objects.splice(C,0,_)),D++;else w=this._objects.indexOf(s),w!==0&&(C=this._findNewLowerIndex(s,w,h),a(this._objects,s),this._objects.splice(C,0,s));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(s,h,g){var v,_;if(g)for(v=h,_=h-1;_>=0;--_){var w=s.intersectsWithObject(this._objects[_])||s.isContainedWithinObject(this._objects[_])||this._objects[_].isContainedWithinObject(s);if(w){v=_;break}}else v=h-1;return v},bringForward:function(s,h){if(!s)return this;var g=this._activeObject,v,_,w,C,P,D=0;if(s===g&&s.type==="activeSelection")for(P=g._objects,v=P.length;v--;)_=P[v],w=this._objects.indexOf(_),w<this._objects.length-1-D&&(C=w+1,a(this._objects,_),this._objects.splice(C,0,_)),D++;else w=this._objects.indexOf(s),w!==this._objects.length-1&&(C=this._findNewUpperIndex(s,w,h),a(this._objects,s),this._objects.splice(C,0,s));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(s,h,g){var v,_,w;if(g)for(v=h,_=h+1,w=this._objects.length;_<w;++_){var C=s.intersectsWithObject(this._objects[_])||s.isContainedWithinObject(this._objects[_])||this._objects[_].isContainedWithinObject(s);if(C){v=_;break}}else v=h+1;return v},moveTo:function(s,h){return a(this._objects,s),this._objects.splice(h,0,s),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(p.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(s){s.dispose&&s.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),p.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),p.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),d(p.StaticCanvas.prototype,p.Observable),d(p.StaticCanvas.prototype,p.Collection),d(p.StaticCanvas.prototype,p.DataURLExporter),d(p.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(s){var h=o();if(!h||!h.getContext)return null;var g=h.getContext("2d");if(!g)return null;switch(s){case"setLineDash":return typeof g.setLineDash<"u";default:return null}}}),p.StaticCanvas.prototype.toJSON=p.StaticCanvas.prototype.toObject,p.isLikelyNode&&(p.StaticCanvas.prototype.createPNGStream=function(){var s=n(this.lowerCanvasEl);return s&&s.createPNGStream()},p.StaticCanvas.prototype.createJPEGStream=function(s){var h=n(this.lowerCanvasEl);return h&&h.createJPEGStream(s)})}(),p.BaseBrush=p.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(d){d.strokeStyle=this.color,d.lineWidth=this.width,d.lineCap=this.strokeLineCap,d.miterLimit=this.strokeMiterLimit,d.lineJoin=this.strokeLineJoin,d.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(d){var i=this.canvas.viewportTransform;d.save(),d.transform(i[0],i[1],i[2],i[3],i[4],i[5])},_setShadow:function(){if(!!this.shadow){var d=this.canvas,i=this.shadow,a=d.contextTop,l=d.getZoom();d&&d._isRetinaScaling()&&(l*=p.devicePixelRatio),a.shadowColor=i.color,a.shadowBlur=i.blur*l,a.shadowOffsetX=i.offsetX*l,a.shadowOffsetY=i.offsetY*l}},needsFullRender:function(){var d=new p.Color(this.color);return d.getAlpha()<1||!!this.shadow},_resetShadow:function(){var d=this.canvas.contextTop;d.shadowColor="",d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0},_isOutSideCanvas:function(d){return d.x<0||d.x>this.canvas.getWidth()||d.y<0||d.y>this.canvas.getHeight()}}),function(){p.PencilBrush=p.util.createClass(p.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(d){this.canvas=d,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(d,i,a){var l=i.midPointFrom(a);return d.quadraticCurveTo(i.x,i.y,l.x,l.y),l},onMouseDown:function(d,i){!this.canvas._isMainEvent(i.e)||(this.drawStraightLine=i.e[this.straightLineKey],this._prepareForDrawing(d),this._captureDrawingPath(d),this._render())},onMouseMove:function(d,i){if(!!this.canvas._isMainEvent(i.e)&&(this.drawStraightLine=i.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(d))&&this._captureDrawingPath(d)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var a=this._points,l=a.length,e=this.canvas.contextTop;this._saveAndTransform(e),this.oldEnd&&(e.beginPath(),e.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(e,a[l-2],a[l-1],!0),e.stroke(),e.restore()}},onMouseUp:function(d){return this.canvas._isMainEvent(d.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(d){var i=new p.Point(d.x,d.y);this._reset(),this._addPoint(i),this.canvas.contextTop.moveTo(i.x,i.y)},_addPoint:function(d){return this._points.length>1&&d.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(d),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(d){var i=new p.Point(d.x,d.y);return this._addPoint(i)},_render:function(d){var i,a,l=this._points[0],e=this._points[1];if(d=d||this.canvas.contextTop,this._saveAndTransform(d),d.beginPath(),this._points.length===2&&l.x===e.x&&l.y===e.y){var r=this.width/1e3;l=new p.Point(l.x,l.y),e=new p.Point(e.x,e.y),l.x-=r,e.x+=r}for(d.moveTo(l.x,l.y),i=1,a=this._points.length;i<a;i++)this._drawSegment(d,l,e),l=this._points[i],e=this._points[i+1];d.lineTo(l.x,l.y),d.stroke(),d.restore()},convertPointsToSVGPath:function(d){var i=this.width/1e3;return p.util.getSmoothPathFromPoints(d,i)},_isEmptySVGPath:function(d){var i=p.util.joinPath(d);return i==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(d){var i=new p.Path(d,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,i.shadow=new p.Shadow(this.shadow)),i},decimatePoints:function(d,i){if(d.length<=2)return d;var a=this.canvas.getZoom(),l=Math.pow(i/a,2),e,r=d.length-1,n=d[0],o=[n],u;for(e=1;e<r-1;e++)u=Math.pow(n.x-d[e].x,2)+Math.pow(n.y-d[e].y,2),u>=l&&(n=d[e],o.push(n));return o.push(d[r]),o},_finalizeAndAddPath:function(){var d=this.canvas.contextTop;d.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var i=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(i)){this.canvas.requestRenderAll();return}var a=this.createPath(i);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:a}),this.canvas.add(a),this.canvas.requestRenderAll(),a.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:a})}})}(),p.CircleBrush=p.util.createClass(p.BaseBrush,{width:10,initialize:function(d){this.canvas=d,this.points=[]},drawDot:function(d){var i=this.addPoint(d),a=this.canvas.contextTop;this._saveAndTransform(a),this.dot(a,i),a.restore()},dot:function(d,i){d.fillStyle=i.fill,d.beginPath(),d.arc(i.x,i.y,i.radius,0,Math.PI*2,!1),d.closePath(),d.fill()},onMouseDown:function(d){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(d)},_render:function(){var d=this.canvas.contextTop,i,a,l=this.points;for(this._saveAndTransform(d),i=0,a=l.length;i<a;i++)this.dot(d,l[i]);d.restore()},onMouseMove:function(d){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(d)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(d),this._render()):this.drawDot(d))},onMouseUp:function(){var d=this.canvas.renderOnAddRemove,i,a;this.canvas.renderOnAddRemove=!1;var l=[];for(i=0,a=this.points.length;i<a;i++){var e=this.points[i],r=new p.Circle({radius:e.radius,left:e.x,top:e.y,originX:"center",originY:"center",fill:e.fill});this.shadow&&(r.shadow=new p.Shadow(this.shadow)),l.push(r)}var n=new p.Group(l);n.canvas=this.canvas,this.canvas.fire("before:path:created",{path:n}),this.canvas.add(n),this.canvas.fire("path:created",{path:n}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=d,this.canvas.requestRenderAll()},addPoint:function(d){var i=new p.Point(d.x,d.y),a=p.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,l=new p.Color(this.color).setAlpha(p.util.getRandomInt(0,100)/100).toRgba();return i.radius=a,i.fill=l,this.points.push(i),i}}),p.SprayBrush=p.util.createClass(p.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(d){this.canvas=d,this.sprayChunks=[]},onMouseDown:function(d){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(d),this.render(this.sprayChunkPoints)},onMouseMove:function(d){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(d)||(this.addSprayChunk(d),this.render(this.sprayChunkPoints))},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var i=[],a=0,l=this.sprayChunks.length;a<l;a++)for(var e=this.sprayChunks[a],r=0,n=e.length;r<n;r++){var o=new p.Rect({width:e[r].width,height:e[r].width,left:e[r].x+1,top:e[r].y+1,originX:"center",originY:"center",fill:this.color});i.push(o)}this.optimizeOverlapping&&(i=this._getOptimizedRects(i));var u=new p.Group(i);this.shadow&&u.set("shadow",new p.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:u}),this.canvas.add(u),this.canvas.fire("path:created",{path:u}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=d,this.canvas.requestRenderAll()},_getOptimizedRects:function(d){var i={},a,l,e;for(l=0,e=d.length;l<e;l++)a=d[l].left+""+d[l].top,i[a]||(i[a]=d[l]);var r=[];for(a in i)r.push(i[a]);return r},render:function(d){var i=this.canvas.contextTop,a,l;for(i.fillStyle=this.color,this._saveAndTransform(i),a=0,l=d.length;a<l;a++){var e=d[a];typeof e.opacity<"u"&&(i.globalAlpha=e.opacity),i.fillRect(e.x,e.y,e.width,e.width)}i.restore()},_render:function(){var d=this.canvas.contextTop,i,a;for(d.fillStyle=this.color,this._saveAndTransform(d),i=0,a=this.sprayChunks.length;i<a;i++)this.render(this.sprayChunks[i]);d.restore()},addSprayChunk:function(d){this.sprayChunkPoints=[];var i,a,l,e=this.width/2,r;for(r=0;r<this.density;r++){i=p.util.getRandomInt(d.x-e,d.x+e),a=p.util.getRandomInt(d.y-e,d.y+e),this.dotWidthVariance?l=p.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):l=this.dotWidth;var n=new p.Point(i,a);n.width=l,this.randomOpacity&&(n.opacity=p.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(n)}this.sprayChunks.push(this.sprayChunkPoints)}}),p.PatternBrush=p.util.createClass(p.PencilBrush,{getPatternSrc:function(){var d=20,i=5,a=p.util.createCanvasElement(),l=a.getContext("2d");return a.width=a.height=d+i,l.fillStyle=this.color,l.beginPath(),l.arc(d/2,d/2,d/2,0,Math.PI*2,!1),l.closePath(),l.fill(),a},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(d){return d.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(d){this.callSuper("_setBrushStyles",d),d.strokeStyle=this.getPattern(d)},createPath:function(d){var i=this.callSuper("createPath",d),a=i._getLeftTopCoords().scalarAdd(i.strokeWidth/2);return i.stroke=new p.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-a.x,offsetY:-a.y}),i}}),function(){var d=p.util.getPointer,i=p.util.degreesToRadians,a=p.util.isTouchEvent;p.Canvas=p.util.createClass(p.StaticCanvas,{initialize:function(e,r){r||(r={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,r),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=p.PencilBrush&&new p.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var e=this.getActiveObjects(),r,n,o;if(e.length>0&&!this.preserveObjectStacking){n=[],o=[];for(var u=0,s=this._objects.length;u<s;u++)r=this._objects[u],e.indexOf(r)===-1?n.push(r):o.push(r);e.length>1&&(this._activeObject._objects=o),n.push.apply(n,o)}else n=this._objects;return n},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var e=this.contextContainer;return this.renderCanvas(e,this._chooseObjectsToRender()),this},renderTopLayer:function(e){e.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0),e.restore()},renderTop:function(){var e=this.contextTop;return this.clearContext(e),this.renderTopLayer(e),this.fire("after:render"),this},_normalizePointer:function(e,r){var n=e.calcTransformMatrix(),o=p.util.invertTransform(n),u=this.restorePointerVpt(r);return p.util.transformPoint(u,o)},isTargetTransparent:function(e,r,n){if(e.shouldCache()&&e._cacheCanvas&&e!==this._activeObject){var o=this._normalizePointer(e,{x:r,y:n}),u=Math.max(e.cacheTranslationX+o.x*e.zoomX,0),s=Math.max(e.cacheTranslationY+o.y*e.zoomY,0),_=p.util.isTransparent(e._cacheContext,Math.round(u),Math.round(s),this.targetFindTolerance);return _}var h=this.contextCache,g=e.selectionBackgroundColor,v=this.viewportTransform;e.selectionBackgroundColor="",this.clearContext(h),h.save(),h.transform(v[0],v[1],v[2],v[3],v[4],v[5]),e.render(h),h.restore(),e.selectionBackgroundColor=g;var _=p.util.isTransparent(h,r,n,this.targetFindTolerance);return _},_isSelectionKeyPressed:function(e){var r=!1;return Array.isArray(this.selectionKey)?r=!!this.selectionKey.find(function(n){return e[n]===!0}):r=e[this.selectionKey],r},_shouldClearSelection:function(e,r){var n=this.getActiveObjects(),o=this._activeObject;return!r||r&&o&&n.length>1&&n.indexOf(r)===-1&&o!==r&&!this._isSelectionKeyPressed(e)||r&&!r.evented||r&&!r.selectable&&o&&o!==r},_shouldCenterTransform:function(e,r,n){if(!!e){var o;return r==="scale"||r==="scaleX"||r==="scaleY"||r==="resizing"?o=this.centeredScaling||e.centeredScaling:r==="rotate"&&(o=this.centeredRotation||e.centeredRotation),o?!n:n}},_getOriginFromCorner:function(e,r){var n={x:e.originX,y:e.originY};return r==="ml"||r==="tl"||r==="bl"?n.x="right":(r==="mr"||r==="tr"||r==="br")&&(n.x="left"),r==="tl"||r==="mt"||r==="tr"?n.y="bottom":(r==="bl"||r==="mb"||r==="br")&&(n.y="top"),n},_getActionFromCorner:function(e,r,n,o){if(!r||!e)return"drag";var u=o.controls[r];return u.getActionName(n,u,o)},_setupCurrentTransform:function(e,r,n){if(!!r){var o=this.getPointer(e),u=r.__corner,s=r.controls[u],h=n&&u?s.getActionHandler(e,r,s):p.controlsUtils.dragHandler,g=this._getActionFromCorner(n,u,e,r),v=this._getOriginFromCorner(r,u),_=e[this.centeredKey],w={target:r,action:g,actionHandler:h,corner:u,scaleX:r.scaleX,scaleY:r.scaleY,skewX:r.skewX,skewY:r.skewY,offsetX:o.x-r.left,offsetY:o.y-r.top,originX:v.x,originY:v.y,ex:o.x,ey:o.y,lastX:o.x,lastY:o.y,theta:i(r.angle),width:r.width*r.scaleX,shiftKey:e.shiftKey,altKey:_,original:p.util.saveObjectTransform(r)};this._shouldCenterTransform(r,g,_)&&(w.originX="center",w.originY="center"),w.original.originX=v.x,w.original.originY=v.y,this._currentTransform=w,this._beforeTransform(e)}},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_drawSelection:function(e){var r=this._groupSelector,n=new p.Point(r.ex,r.ey),o=p.util.transformPoint(n,this.viewportTransform),u=new p.Point(r.ex+r.left,r.ey+r.top),s=p.util.transformPoint(u,this.viewportTransform),h=Math.min(o.x,s.x),g=Math.min(o.y,s.y),v=Math.max(o.x,s.x),_=Math.max(o.y,s.y),w=this.selectionLineWidth/2;this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(h,g,v-h,_-g)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,h+=w,g+=w,v-=w,_-=w,p.Object.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(h,g,v-h,_-g))},findTarget:function(e,r){if(!this.skipTargetFind){var n=!0,o=this.getPointer(e,n),u=this._activeObject,s=this.getActiveObjects(),h,g,v=a(e),_=s.length>1&&!r||s.length===1;if(this.targets=[],_&&u._findTargetCorner(o,v)||s.length>1&&!r&&u===this._searchPossibleTargets([u],o))return u;if(s.length===1&&u===this._searchPossibleTargets([u],o))if(this.preserveObjectStacking)h=u,g=this.targets,this.targets=[];else return u;var w=this._searchPossibleTargets(this._objects,o);return e[this.altSelectionKey]&&w&&h&&w!==h&&(w=h,this.targets=g),w}},_checkTarget:function(e,r,n){if(r&&r.visible&&r.evented&&r.containsPoint(e))if((this.perPixelTargetFind||r.perPixelTargetFind)&&!r.isEditing){var o=this.isTargetTransparent(r,n.x,n.y);if(!o)return!0}else return!0},_searchPossibleTargets:function(e,r){for(var n,o=e.length,u;o--;){var s=e[o],h=s.group?this._normalizePointer(s.group,r):r;if(this._checkTarget(h,s,r)){n=e[o],n.subTargetCheck&&n instanceof p.Group&&(u=this._searchPossibleTargets(n._objects,r),u&&this.targets.push(u));break}}return n},restorePointerVpt:function(e){return p.util.transformPoint(e,p.util.invertTransform(this.viewportTransform))},getPointer:function(e,r){if(this._absolutePointer&&!r)return this._absolutePointer;if(this._pointer&&r)return this._pointer;var n=d(e),o=this.upperCanvasEl,u=o.getBoundingClientRect(),s=u.width||0,h=u.height||0,g;(!s||!h)&&("top"in u&&"bottom"in u&&(h=Math.abs(u.top-u.bottom)),"right"in u&&"left"in u&&(s=Math.abs(u.right-u.left))),this.calcOffset(),n.x=n.x-this._offset.left,n.y=n.y-this._offset.top,r||(n=this.restorePointerVpt(n));var v=this.getRetinaScaling();return v!==1&&(n.x/=v,n.y/=v),s===0||h===0?g={width:1,height:1}:g={width:o.width/s,height:o.height/h},{x:n.x*g.width,y:n.y*g.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),r=this.lowerCanvasEl,n=this.upperCanvasEl;n?n.className="":(n=this._createCanvasElement(),this.upperCanvasEl=n),p.util.addClass(n,"upper-canvas "+e),this.wrapperEl.appendChild(n),this._copyCanvasStyle(r,n),this._applyCanvasStyle(n),this.contextTop=n.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=p.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),p.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),p.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(e){var r=this.width||e.width,n=this.height||e.height;p.util.setStyle(e,{position:"absolute",width:r+"px",height:n+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),e.width=r,e.height=n,p.util.makeElementUnselectable(e)},_copyCanvasStyle:function(e,r){r.style.cssText=e.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var e=this._activeObject;return e?e.type==="activeSelection"&&e._objects?e._objects.slice(0):[e]:[]},_onObjectRemoved:function(e){e===this._activeObject&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared",{target:e}),e.fire("deselected")),e===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",e)},_fireSelectionEvents:function(e,r){var n=!1,o=this.getActiveObjects(),u=[],s=[];e.forEach(function(h){o.indexOf(h)===-1&&(n=!0,h.fire("deselected",{e:r,target:h}),s.push(h))}),o.forEach(function(h){e.indexOf(h)===-1&&(n=!0,h.fire("selected",{e:r,target:h}),u.push(h))}),e.length>0&&o.length>0?n&&this.fire("selection:updated",{e:r,selected:u,deselected:s}):o.length>0?this.fire("selection:created",{e:r,selected:u}):e.length>0&&this.fire("selection:cleared",{e:r,deselected:s})},setActiveObject:function(e,r){var n=this.getActiveObjects();return this._setActiveObject(e,r),this._fireSelectionEvents(n,r),this},_setActiveObject:function(e,r){return this._activeObject===e||!this._discardActiveObject(r,e)||e.onSelect({e:r})?!1:(this._activeObject=e,!0)},_discardActiveObject:function(e,r){var n=this._activeObject;if(n){if(n.onDeselect({e,object:r}))return!1;this._activeObject=null}return!0},discardActiveObject:function(e){var r=this.getActiveObjects(),n=this.getActiveObject();return r.length&&this.fire("before:selection:cleared",{target:n,e}),this._discardActiveObject(e),this._fireSelectionEvents(r,e),this},dispose:function(){var e=this.wrapperEl;return this.removeListeners(),e.removeChild(this.upperCanvasEl),e.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(r){p.util.cleanUpJsdomNode(this[r]),this[r]=void 0}.bind(this)),e.parentNode&&e.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,p.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(e){var r=this._activeObject;r&&r._renderControls(e)},_toObject:function(e,r,n){var o=this._realizeGroupTransformOnObject(e),u=this.callSuper("_toObject",e,r,n);return this._unwindGroupTransformOnObject(e,o),u},_realizeGroupTransformOnObject:function(e){if(e.group&&e.group.type==="activeSelection"&&this._activeObject===e.group){var r=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],n={};return r.forEach(function(o){n[o]=e[o]}),p.util.addTransformToObject(e,this._activeObject.calcOwnMatrix()),n}else return null},_unwindGroupTransformOnObject:function(e,r){r&&e.set(r)},_setSVGObject:function(e,r,n){var o=this._realizeGroupTransformOnObject(r);this.callSuper("_setSVGObject",e,r,n),this._unwindGroupTransformOnObject(r,o)},setViewportTransform:function(e){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),p.StaticCanvas.prototype.setViewportTransform.call(this,e)}});for(var l in p.StaticCanvas)l!=="prototype"&&(p.Canvas[l]=p.StaticCanvas[l])}(),function(){var d=p.util.addListener,i=p.util.removeListener,a=3,l=2,e=1,r={passive:!1};function n(o,u){return o.button&&o.button===u-1}p.util.object.extend(p.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(d,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(o,u){var s=this.upperCanvasEl,h=this._getEventPrefix();o(p.window,"resize",this._onResize),o(s,h+"down",this._onMouseDown),o(s,h+"move",this._onMouseMove,r),o(s,h+"out",this._onMouseOut),o(s,h+"enter",this._onMouseEnter),o(s,"wheel",this._onMouseWheel),o(s,"contextmenu",this._onContextMenu),o(s,"dblclick",this._onDoubleClick),o(s,"dragover",this._onDragOver),o(s,"dragenter",this._onDragEnter),o(s,"dragleave",this._onDragLeave),o(s,"drop",this._onDrop),this.enablePointerEvents||o(s,"touchstart",this._onTouchStart,r),typeof eventjs<"u"&&u in eventjs&&(eventjs[u](s,"gesture",this._onGesture),eventjs[u](s,"drag",this._onDrag),eventjs[u](s,"orientation",this._onOrientationChange),eventjs[u](s,"shake",this._onShake),eventjs[u](s,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(i,"remove");var o=this._getEventPrefix();i(p.document,o+"up",this._onMouseUp),i(p.document,"touchend",this._onTouchEnd,r),i(p.document,o+"move",this._onMouseMove,r),i(p.document,"touchmove",this._onMouseMove,r)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(o,u){this.__onTransformGesture&&this.__onTransformGesture(o,u)},_onDrag:function(o,u){this.__onDrag&&this.__onDrag(o,u)},_onMouseWheel:function(o){this.__onMouseWheel(o)},_onMouseOut:function(o){var u=this._hoveredTarget;this.fire("mouse:out",{target:u,e:o}),this._hoveredTarget=null,u&&u.fire("mouseout",{e:o});var s=this;this._hoveredTargets.forEach(function(h){s.fire("mouse:out",{target:u,e:o}),h&&u.fire("mouseout",{e:o})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(h){h.isEditing&&h.hiddenTextarea.focus()})},_onMouseEnter:function(o){!this._currentTransform&&!this.findTarget(o)&&(this.fire("mouse:over",{target:null,e:o}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(o,u){this.__onOrientationChange&&this.__onOrientationChange(o,u)},_onShake:function(o,u){this.__onShake&&this.__onShake(o,u)},_onLongPress:function(o,u){this.__onLongPress&&this.__onLongPress(o,u)},_onDragOver:function(o){o.preventDefault();var u=this._simpleEventHandler("dragover",o);this._fireEnterLeaveEvents(u,o)},_onDrop:function(o){return this._simpleEventHandler("drop:before",o),this._simpleEventHandler("drop",o)},_onContextMenu:function(o){return this.stopContextMenu&&(o.stopPropagation(),o.preventDefault()),!1},_onDoubleClick:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"dblclick"),this._resetTransformEventData(o)},getPointerId:function(o){var u=o.changedTouches;return u?u[0]&&u[0].identifier:this.enablePointerEvents?o.pointerId:-1},_isMainEvent:function(o){return o.isPrimary===!0?!0:o.isPrimary===!1?!1:o.type==="touchend"&&o.touches.length===0?!0:o.changedTouches?o.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(o){o.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(o)),this.__onMouseDown(o),this._resetTransformEventData();var u=this.upperCanvasEl,s=this._getEventPrefix();d(p.document,"touchend",this._onTouchEnd,r),d(p.document,"touchmove",this._onMouseMove,r),i(u,s+"down",this._onMouseDown)},_onMouseDown:function(o){this.__onMouseDown(o),this._resetTransformEventData();var u=this.upperCanvasEl,s=this._getEventPrefix();i(u,s+"move",this._onMouseMove,r),d(p.document,s+"up",this._onMouseUp),d(p.document,s+"move",this._onMouseMove,r)},_onTouchEnd:function(o){if(!(o.touches.length>0)){this.__onMouseUp(o),this._resetTransformEventData(),this.mainTouchId=null;var u=this._getEventPrefix();i(p.document,"touchend",this._onTouchEnd,r),i(p.document,"touchmove",this._onMouseMove,r);var s=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){d(s.upperCanvasEl,u+"down",s._onMouseDown),s._willAddMouseDown=0},400)}},_onMouseUp:function(o){this.__onMouseUp(o),this._resetTransformEventData();var u=this.upperCanvasEl,s=this._getEventPrefix();this._isMainEvent(o)&&(i(p.document,s+"up",this._onMouseUp),i(p.document,s+"move",this._onMouseMove,r),d(u,s+"move",this._onMouseMove,r))},_onMouseMove:function(o){!this.allowTouchScrolling&&o.preventDefault&&o.preventDefault(),this.__onMouseMove(o)},_onResize:function(){this.calcOffset()},_shouldRender:function(o){var u=this._activeObject;return!!u!=!!o||u&&o&&u!==o?!0:(u&&u.isEditing,!1)},__onMouseUp:function(o){var u,s=this._currentTransform,h=this._groupSelector,g=!1,v=!h||h.left===0&&h.top===0;if(this._cacheTransformEventData(o),u=this._target,this._handleEvent(o,"up:before"),n(o,a)){this.fireRightClick&&this._handleEvent(o,"up",a,v);return}if(n(o,l)){this.fireMiddleClick&&this._handleEvent(o,"up",l,v),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(o);return}if(!!this._isMainEvent(o)){if(s&&(this._finalizeCurrentTransform(o),g=s.actionPerformed),!v){var _=u===this._activeObject;this._maybeGroupObjects(o),g||(g=this._shouldRender(u)||!_&&u===this._activeObject)}var w,C;if(u){if(w=u._findTargetCorner(this.getPointer(o,!0),p.util.isTouchEvent(o)),u.selectable&&u!==this._activeObject&&u.activeOn==="up")this.setActiveObject(u,o),g=!0;else{var P=u.controls[w],D=P&&P.getMouseUpHandler(o,u,P);D&&(C=this.getPointer(o),D(o,s,C.x,C.y))}u.isMoving=!1}if(s&&(s.target!==u||s.corner!==w)){var I=s.target&&s.target.controls[s.corner],N=I&&I.getMouseUpHandler(o,u,P);C=C||this.getPointer(o),N&&N(o,s,C.x,C.y)}this._setCursorFromEvent(o,u),this._handleEvent(o,"up",e,v),this._groupSelector=null,this._currentTransform=null,u&&(u.__corner=0),g?this.requestRenderAll():v||this.renderTop()}},_simpleEventHandler:function(o,u){var s=this.findTarget(u),h=this.targets,g={e:u,target:s,subTargets:h};if(this.fire(o,g),s&&s.fire(o,g),!h)return s;for(var v=0;v<h.length;v++)h[v].fire(o,g);return s},_handleEvent:function(o,u,s,h){var g=this._target,v=this.targets||[],_={e:o,target:g,subTargets:v,button:s||e,isClick:h||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};u==="up"&&(_.currentTarget=this.findTarget(o),_.currentSubTargets=this.targets),this.fire("mouse:"+u,_),g&&g.fire("mouse"+u,_);for(var w=0;w<v.length;w++)v[w].fire("mouse"+u,_)},_finalizeCurrentTransform:function(o){var u=this._currentTransform,s=u.target,h={e:o,target:s,transform:u,action:u.action};s._scaling&&(s._scaling=!1),s.setCoords(),(u.actionPerformed||this.stateful&&s.hasStateChanged())&&this._fire("modified",h)},_onMouseDownInDrawingMode:function(o){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(o).requestRenderAll();var u=this.getPointer(o);this.freeDrawingBrush.onMouseDown(u,{e:o,pointer:u}),this._handleEvent(o,"down")},_onMouseMoveInDrawingMode:function(o){if(this._isCurrentlyDrawing){var u=this.getPointer(o);this.freeDrawingBrush.onMouseMove(u,{e:o,pointer:u})}this.setCursor(this.freeDrawingCursor),this._handleEvent(o,"move")},_onMouseUpInDrawingMode:function(o){var u=this.getPointer(o);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:o,pointer:u}),this._handleEvent(o,"up")},__onMouseDown:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"down:before");var u=this._target;if(n(o,a)){this.fireRightClick&&this._handleEvent(o,"down",a);return}if(n(o,l)){this.fireMiddleClick&&this._handleEvent(o,"down",l);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(o);return}if(!!this._isMainEvent(o)&&!this._currentTransform){var s=this._pointer;this._previousPointer=s;var h=this._shouldRender(u),g=this._shouldGroup(o,u);if(this._shouldClearSelection(o,u)?this.discardActiveObject(o):g&&(this._handleGrouping(o,u),u=this._activeObject),this.selection&&(!u||!u.selectable&&!u.isEditing&&u!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),u){var v=u===this._activeObject;u.selectable&&u.activeOn==="down"&&this.setActiveObject(u,o);var _=u._findTargetCorner(this.getPointer(o,!0),p.util.isTouchEvent(o));if(u.__corner=_,u===this._activeObject&&(_||!g)){this._setupCurrentTransform(o,u,v);var w=u.controls[_],s=this.getPointer(o),C=w&&w.getMouseDownHandler(o,u,w);C&&C(o,this._currentTransform,s.x,s.y)}}this._handleEvent(o,"down"),(h||g)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(o){this._resetTransformEventData(),this._pointer=this.getPointer(o,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(o)||null},_beforeTransform:function(o){var u=this._currentTransform;this.stateful&&u.target.saveState(),this.fire("before:transform",{e:o,transform:u})},__onMouseMove:function(o){this._handleEvent(o,"move:before"),this._cacheTransformEventData(o);var u,s;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(o);return}if(!!this._isMainEvent(o)){var h=this._groupSelector;h?(s=this._absolutePointer,h.left=s.x-h.ex,h.top=s.y-h.ey,this.renderTop()):this._currentTransform?this._transformObject(o):(u=this.findTarget(o)||null,this._setCursorFromEvent(o,u),this._fireOverOutEvents(u,o)),this._handleEvent(o,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(o,u){var s=this._hoveredTarget,h=this._hoveredTargets,g=this.targets,v=Math.max(h.length,g.length);this.fireSyntheticInOutEvents(o,u,{oldTarget:s,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var _=0;_<v;_++)this.fireSyntheticInOutEvents(g[_],u,{oldTarget:h[_],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=o,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(o,u){var s=this._draggedoverTarget,h=this._hoveredTargets,g=this.targets,v=Math.max(h.length,g.length);this.fireSyntheticInOutEvents(o,u,{oldTarget:s,evtOut:"dragleave",evtIn:"dragenter"});for(var _=0;_<v;_++)this.fireSyntheticInOutEvents(g[_],u,{oldTarget:h[_],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=o},fireSyntheticInOutEvents:function(o,u,s){var h,g,v=s.oldTarget,_,w,C=v!==o,P=s.canvasEvtIn,D=s.canvasEvtOut;C&&(h={e:u,target:o,previousTarget:v},g={e:u,target:v,nextTarget:o}),w=o&&C,_=v&&C,_&&(D&&this.fire(D,g),v.fire(s.evtOut,g)),w&&(P&&this.fire(P,h),o.fire(s.evtIn,h))},__onMouseWheel:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"wheel"),this._resetTransformEventData()},_transformObject:function(o){var u=this.getPointer(o),s=this._currentTransform;s.reset=!1,s.shiftKey=o.shiftKey,s.altKey=o[this.centeredKey],this._performTransformAction(o,s,u),s.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(o,u,s){var h=s.x,g=s.y,v=u.action,_=!1,w=u.actionHandler;w&&(_=w(o,u,h,g)),v==="drag"&&_&&(u.target.isMoving=!0,this.setCursor(u.target.moveCursor||this.moveCursor)),u.actionPerformed=u.actionPerformed||_},_fire:p.controlsUtils.fireEvent,_setCursorFromEvent:function(o,u){if(!u)return this.setCursor(this.defaultCursor),!1;var s=u.hoverCursor||this.hoverCursor,h=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,g=(!h||!h.contains(u))&&u._findTargetCorner(this.getPointer(o,!0));g?this.setCursor(this.getCornerCursor(g,u,o)):(u.subTargetCheck&&this.targets.concat().reverse().map(function(v){s=v.hoverCursor||s}),this.setCursor(s))},getCornerCursor:function(o,u,s){var h=u.controls[o];return h.cursorStyleHandler(s,h,u)}})}(),function(){var d=Math.min,i=Math.max;p.util.object.extend(p.Canvas.prototype,{_shouldGroup:function(a,l){var e=this._activeObject;return e&&this._isSelectionKeyPressed(a)&&l&&l.selectable&&this.selection&&(e!==l||e.type==="activeSelection")&&!l.onSelect({e:a})},_handleGrouping:function(a,l){var e=this._activeObject;e.__corner||l===e&&(l=this.findTarget(a,!0),!l||!l.selectable)||(e&&e.type==="activeSelection"?this._updateActiveSelection(l,a):this._createActiveSelection(l,a))},_updateActiveSelection:function(a,l){var e=this._activeObject,r=e._objects.slice(0);e.contains(a)?(e.removeWithUpdate(a),this._hoveredTarget=a,this._hoveredTargets=this.targets.concat(),e.size()===1&&this._setActiveObject(e.item(0),l)):(e.addWithUpdate(a),this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(r,l)},_createActiveSelection:function(a,l){var e=this.getActiveObjects(),r=this._createGroup(a);this._hoveredTarget=r,this._setActiveObject(r,l),this._fireSelectionEvents(e,l)},_createGroup:function(a){var l=this._objects,e=l.indexOf(this._activeObject)<l.indexOf(a),r=e?[this._activeObject,a]:[a,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new p.ActiveSelection(r,{canvas:this})},_groupSelectedObjects:function(a){var l=this._collectObjects(a),e;l.length===1?this.setActiveObject(l[0],a):l.length>1&&(e=new p.ActiveSelection(l.reverse(),{canvas:this}),this.setActiveObject(e,a))},_collectObjects:function(a){for(var l=[],e,r=this._groupSelector.ex,n=this._groupSelector.ey,o=r+this._groupSelector.left,u=n+this._groupSelector.top,s=new p.Point(d(r,o),d(n,u)),h=new p.Point(i(r,o),i(n,u)),g=!this.selectionFullyContained,v=r===o&&n===u,_=this._objects.length;_--&&(e=this._objects[_],!(!(!e||!e.selectable||!e.visible)&&(g&&e.intersectsWithRect(s,h,!0)||e.isContainedWithinRect(s,h,!0)||g&&e.containsPoint(s,null,!0)||g&&e.containsPoint(h,null,!0))&&(l.push(e),v))););return l.length>1&&(l=l.filter(function(w){return!w.onSelect({e:a})})),l},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){p.util.object.extend(p.StaticCanvas.prototype,{toDataURL:function(d){d||(d={});var i=d.format||"png",a=d.quality||1,l=(d.multiplier||1)*(d.enableRetinaScaling?this.getRetinaScaling():1),e=this.toCanvasElement(l,d);return p.util.toDataURL(e,i,a)},toCanvasElement:function(d,i){d=d||1,i=i||{};var a=(i.width||this.width)*d,l=(i.height||this.height)*d,e=this.getZoom(),r=this.width,n=this.height,o=e*d,u=this.viewportTransform,s=(u[4]-(i.left||0))*d,h=(u[5]-(i.top||0))*d,g=this.interactive,v=[o,0,0,o,s,h],_=this.enableRetinaScaling,w=p.util.createCanvasElement(),C=this.contextTop;return w.width=a,w.height=l,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=v,this.width=a,this.height=l,this.calcViewportBoundaries(),this.renderCanvas(w.getContext("2d"),this._objects),this.viewportTransform=u,this.width=r,this.height=n,this.calcViewportBoundaries(),this.interactive=g,this.enableRetinaScaling=_,this.contextTop=C,w}})}(),p.util.object.extend(p.StaticCanvas.prototype,{loadFromJSON:function(d,i,a){if(!!d){var l=typeof d=="string"?JSON.parse(d):p.util.object.clone(d),e=this,r=l.clipPath,n=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete l.clipPath,this._enlivenObjects(l.objects,function(o){e.clear(),e._setBgOverlay(l,function(){r?e._enlivenObjects([r],function(u){e.clipPath=u[0],e.__setupCanvas.call(e,l,o,n,i)}):e.__setupCanvas.call(e,l,o,n,i)})},a),this}},__setupCanvas:function(d,i,a,l){var e=this;i.forEach(function(r,n){e.insertAt(r,n)}),this.renderOnAddRemove=a,delete d.objects,delete d.backgroundImage,delete d.overlayImage,delete d.background,delete d.overlay,this._setOptions(d),this.renderAll(),l&&l()},_setBgOverlay:function(d,i){var a={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!d.backgroundImage&&!d.overlayImage&&!d.background&&!d.overlay){i&&i();return}var l=function(){a.backgroundImage&&a.overlayImage&&a.backgroundColor&&a.overlayColor&&i&&i()};this.__setBgOverlay("backgroundImage",d.backgroundImage,a,l),this.__setBgOverlay("overlayImage",d.overlayImage,a,l),this.__setBgOverlay("backgroundColor",d.background,a,l),this.__setBgOverlay("overlayColor",d.overlay,a,l)},__setBgOverlay:function(d,i,a,l){var e=this;if(!i){a[d]=!0,l&&l();return}d==="backgroundImage"||d==="overlayImage"?p.util.enlivenObjects([i],function(r){e[d]=r[0],a[d]=!0,l&&l()}):this["set"+p.util.string.capitalize(d,!0)](i,function(){a[d]=!0,l&&l()})},_enlivenObjects:function(d,i,a){if(!d||d.length===0){i&&i([]);return}p.util.enlivenObjects(d,function(l){i&&i(l)},null,a)},_toDataURL:function(d,i){this.clone(function(a){i(a.toDataURL(d))})},_toDataURLWithMultiplier:function(d,i,a){this.clone(function(l){a(l.toDataURLWithMultiplier(d,i))})},clone:function(d,i){var a=JSON.stringify(this.toJSON(i));this.cloneWithoutData(function(l){l.loadFromJSON(a,function(){d&&d(l)})})},cloneWithoutData:function(d){var i=p.util.createCanvasElement();i.width=this.width,i.height=this.height;var a=new p.Canvas(i);this.backgroundImage?(a.setBackgroundImage(this.backgroundImage.src,function(){a.renderAll(),d&&d(a)}),a.backgroundImageOpacity=this.backgroundImageOpacity,a.backgroundImageStretch=this.backgroundImageStretch):d&&d(a)}}),function(d){var i=d.fabric||(d.fabric={}),a=i.util.object.extend,l=i.util.object.clone,e=i.util.toFixed,r=i.util.string.capitalize,n=i.util.degreesToRadians,o=!i.isLikelyNode,u=2;i.Object||(i.Object=i.util.createClass(i.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:o,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(s){s&&this.setOptions(s)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=i.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(s){var h=i.perfLimitSizeTotal,g=s.width,v=s.height,_=i.maxCacheSideLimit,w=i.minCacheSideLimit;if(g<=_&&v<=_&&g*v<=h)return g<w&&(s.width=w),v<w&&(s.height=w),s;var C=g/v,P=i.util.limitDimsByArea(C,h),D=i.util.capValue,I=D(w,P.x,_),N=D(w,P.y,_);return g>I&&(s.zoomX/=g/I,s.width=I,s.capped=!0),v>N&&(s.zoomY/=v/N,s.height=N,s.capped=!0),s},_getCacheCanvasDimensions:function(){var s=this.getTotalObjectScaling(),h=this._getTransformedDimensions(0,0),g=h.x*s.scaleX/this.scaleX,v=h.y*s.scaleY/this.scaleY;return{width:g+u,height:v+u,zoomX:s.scaleX,zoomY:s.scaleY,x:g,y:v}},_updateCacheCanvas:function(){var s=this.canvas;if(this.noScaleCache&&s&&s._currentTransform){var h=s._currentTransform.target,g=s._currentTransform.action;if(this===h&&g.slice&&g.slice(0,5)==="scale")return!1}var v=this._cacheCanvas,_=this._limitCacheSize(this._getCacheCanvasDimensions()),w=i.minCacheSideLimit,C=_.width,P=_.height,D,I,N=_.zoomX,H=_.zoomY,K=C!==this.cacheWidth||P!==this.cacheHeight,J=this.zoomX!==N||this.zoomY!==H,Q=K||J,tt=0,dt=0,rt=!1;if(K){var _t=this._cacheCanvas.width,T=this._cacheCanvas.height,B=C>_t||P>T,R=(C<_t*.9||P<T*.9)&&_t>w&&T>w;rt=B||R,B&&!_.capped&&(C>w||P>w)&&(tt=C*.1,dt=P*.1)}return this instanceof i.Text&&this.path&&(Q=!0,rt=!0,tt+=this.getHeightOfLine(0)*this.zoomX,dt+=this.getHeightOfLine(0)*this.zoomY),Q?(rt?(v.width=Math.ceil(C+tt),v.height=Math.ceil(P+dt)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,v.width,v.height)),D=_.x/2,I=_.y/2,this.cacheTranslationX=Math.round(v.width/2-D)+D,this.cacheTranslationY=Math.round(v.height/2-I)+I,this.cacheWidth=C,this.cacheHeight=P,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(N,H),this.zoomX=N,this.zoomY=H,!0):!1},setOptions:function(s){this._setOptions(s),this._initGradient(s.fill,"fill"),this._initGradient(s.stroke,"stroke"),this._initPattern(s.fill,"fill"),this._initPattern(s.stroke,"stroke")},transform:function(s){var h=this.group&&!this.group._transformDone||this.group&&this.canvas&&s===this.canvas.contextTop,g=this.calcTransformMatrix(!h);s.transform(g[0],g[1],g[2],g[3],g[4],g[5])},toObject:function(s){var h=i.Object.NUM_FRACTION_DIGITS,g={type:this.type,version:i.version,originX:this.originX,originY:this.originY,left:e(this.left,h),top:e(this.top,h),width:e(this.width,h),height:e(this.height,h),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:e(this.strokeWidth,h),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:e(this.strokeMiterLimit,h),scaleX:e(this.scaleX,h),scaleY:e(this.scaleY,h),angle:e(this.angle,h),flipX:this.flipX,flipY:this.flipY,opacity:e(this.opacity,h),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:e(this.skewX,h),skewY:e(this.skewY,h)};return this.clipPath&&!this.clipPath.excludeFromExport&&(g.clipPath=this.clipPath.toObject(s),g.clipPath.inverted=this.clipPath.inverted,g.clipPath.absolutePositioned=this.clipPath.absolutePositioned),i.util.populateWithProperties(this,g,s),this.includeDefaultValues||(g=this._removeDefaultValues(g)),g},toDatalessObject:function(s){return this.toObject(s)},_removeDefaultValues:function(s){var h=i.util.getKlass(s.type).prototype,g=h.stateProperties;return g.forEach(function(v){v==="left"||v==="top"||(s[v]===h[v]&&delete s[v],Array.isArray(s[v])&&Array.isArray(h[v])&&s[v].length===0&&h[v].length===0&&delete s[v])}),s},toString:function(){return"#<fabric."+r(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var s=i.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(s.scaleX),scaleY:Math.abs(s.scaleY)}},getTotalObjectScaling:function(){var s=this.getObjectScaling(),h=s.scaleX,g=s.scaleY;if(this.canvas){var v=this.canvas.getZoom(),_=this.canvas.getRetinaScaling();h*=v*_,g*=v*_}return{scaleX:h,scaleY:g}},getObjectOpacity:function(){var s=this.opacity;return this.group&&(s*=this.group.getObjectOpacity()),s},_set:function(s,h){var g=s==="scaleX"||s==="scaleY",v=this[s]!==h,_=!1;return g&&(h=this._constrainScale(h)),s==="scaleX"&&h<0?(this.flipX=!this.flipX,h*=-1):s==="scaleY"&&h<0?(this.flipY=!this.flipY,h*=-1):s==="shadow"&&h&&!(h instanceof i.Shadow)?h=new i.Shadow(h):s==="dirty"&&this.group&&this.group.set("dirty",h),this[s]=h,v&&(_=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(s)>-1?(this.dirty=!0,_&&this.group.set("dirty",!0)):_&&this.stateProperties.indexOf(s)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:i.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(s){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(s.save(),this._setupCompositeOperation(s),this.drawSelectionBackground(s),this.transform(s),this._setOpacity(s),this._setShadow(s,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(s)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(s),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),s.restore())},renderCache:function(s){s=s||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,s.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(s,h){if(s.save(),h.inverted?s.globalCompositeOperation="destination-out":s.globalCompositeOperation="destination-in",h.absolutePositioned){var g=i.util.invertTransform(this.calcTransformMatrix());s.transform(g[0],g[1],g[2],g[3],g[4],g[5])}h.transform(s),s.scale(1/h.zoomX,1/h.zoomY),s.drawImage(h._cacheCanvas,-h.cacheTranslationX,-h.cacheTranslationY),s.restore()},drawObject:function(s,h){var g=this.fill,v=this.stroke;h?(this.fill="black",this.stroke="",this._setClippingProperties(s)):this._renderBackground(s),this._render(s),this._drawClipPath(s,this.clipPath),this.fill=g,this.stroke=v},_drawClipPath:function(s,h){!h||(h.canvas=this.canvas,h.shouldCache(),h._transformDone=!0,h.renderCache({forClipping:!0}),this.drawClipPathOnCache(s,h))},drawCacheOnCanvas:function(s){s.scale(1/this.zoomX,1/this.zoomY),s.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(s){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!s&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!s){var h=this.cacheWidth/this.zoomX,g=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-h/2,-g/2,h,g)}return!0}return!1},_renderBackground:function(s){if(!!this.backgroundColor){var h=this._getNonTransformedDimensions();s.fillStyle=this.backgroundColor,s.fillRect(-h.x/2,-h.y/2,h.x,h.y),this._removeShadow(s)}},_setOpacity:function(s){this.group&&!this.group._transformDone?s.globalAlpha=this.getObjectOpacity():s.globalAlpha*=this.opacity},_setStrokeStyles:function(s,h){var g=h.stroke;g&&(s.lineWidth=h.strokeWidth,s.lineCap=h.strokeLineCap,s.lineDashOffset=h.strokeDashOffset,s.lineJoin=h.strokeLineJoin,s.miterLimit=h.strokeMiterLimit,g.toLive?g.gradientUnits==="percentage"||g.gradientTransform||g.patternTransform?this._applyPatternForTransformedGradient(s,g):(s.strokeStyle=g.toLive(s,this),this._applyPatternGradientTransform(s,g)):s.strokeStyle=h.stroke)},_setFillStyles:function(s,h){var g=h.fill;g&&(g.toLive?(s.fillStyle=g.toLive(s,this),this._applyPatternGradientTransform(s,h.fill)):s.fillStyle=g)},_setClippingProperties:function(s){s.globalAlpha=1,s.strokeStyle="transparent",s.fillStyle="#000000"},_setLineDash:function(s,h){!h||h.length===0||(1&h.length&&h.push.apply(h,h),s.setLineDash(h))},_renderControls:function(s,h){var g=this.getViewportTransform(),v=this.calcTransformMatrix(),_,w,C;h=h||{},w=typeof h.hasBorders<"u"?h.hasBorders:this.hasBorders,C=typeof h.hasControls<"u"?h.hasControls:this.hasControls,v=i.util.multiplyTransformMatrices(g,v),_=i.util.qrDecompose(v),s.save(),s.translate(_.translateX,_.translateY),s.lineWidth=1*this.borderScaleFactor,this.group||(s.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(_.angle-=180),s.rotate(n(this.group?_.angle:this.angle)),h.forActiveSelection||this.group?w&&this.drawBordersInGroup(s,_,h):w&&this.drawBorders(s,h),C&&this.drawControls(s,h),s.restore()},_setShadow:function(s){if(!!this.shadow){var h=this.shadow,g=this.canvas,v,_=g&&g.viewportTransform[0]||1,w=g&&g.viewportTransform[3]||1;h.nonScaling?v={scaleX:1,scaleY:1}:v=this.getObjectScaling(),g&&g._isRetinaScaling()&&(_*=i.devicePixelRatio,w*=i.devicePixelRatio),s.shadowColor=h.color,s.shadowBlur=h.blur*i.browserShadowBlurConstant*(_+w)*(v.scaleX+v.scaleY)/4,s.shadowOffsetX=h.offsetX*_*v.scaleX,s.shadowOffsetY=h.offsetY*w*v.scaleY}},_removeShadow:function(s){!this.shadow||(s.shadowColor="",s.shadowBlur=s.shadowOffsetX=s.shadowOffsetY=0)},_applyPatternGradientTransform:function(s,h){if(!h||!h.toLive)return{offsetX:0,offsetY:0};var g=h.gradientTransform||h.patternTransform,v=-this.width/2+h.offsetX||0,_=-this.height/2+h.offsetY||0;return h.gradientUnits==="percentage"?s.transform(this.width,0,0,this.height,v,_):s.transform(1,0,0,1,v,_),g&&s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),{offsetX:v,offsetY:_}},_renderPaintInOrder:function(s){this.paintFirst==="stroke"?(this._renderStroke(s),this._renderFill(s)):(this._renderFill(s),this._renderStroke(s))},_render:function(){},_renderFill:function(s){!this.fill||(s.save(),this._setFillStyles(s,this),this.fillRule==="evenodd"?s.fill("evenodd"):s.fill(),s.restore())},_renderStroke:function(s){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(s),s.save(),this.strokeUniform&&this.group){var h=this.getObjectScaling();s.scale(1/h.scaleX,1/h.scaleY)}else this.strokeUniform&&s.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(s,this.strokeDashArray),this._setStrokeStyles(s,this),s.stroke(),s.restore()}},_applyPatternForTransformedGradient:function(s,h){var g=this._limitCacheSize(this._getCacheCanvasDimensions()),v=i.util.createCanvasElement(),_,w=this.canvas.getRetinaScaling(),C=g.x/this.scaleX/w,P=g.y/this.scaleY/w;v.width=C,v.height=P,_=v.getContext("2d"),_.beginPath(),_.moveTo(0,0),_.lineTo(C,0),_.lineTo(C,P),_.lineTo(0,P),_.closePath(),_.translate(C/2,P/2),_.scale(g.zoomX/this.scaleX/w,g.zoomY/this.scaleY/w),this._applyPatternGradientTransform(_,h),_.fillStyle=h.toLive(s),_.fill(),s.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),s.scale(w*this.scaleX/g.zoomX,w*this.scaleY/g.zoomY),s.strokeStyle=_.createPattern(v,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var s=i.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",s.scaleX),this.set("scaleY",s.scaleY),this.angle=s.angle,this.skewX=s.skewX,this.skewY=0}},_removeTransformMatrix:function(s){var h=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),h=i.util.transformPoint(h,this.transformMatrix)),this.transformMatrix=null,s&&(this.scaleX*=s.scaleX,this.scaleY*=s.scaleY,this.cropX=s.cropX,this.cropY=s.cropY,h.x+=s.offsetLeft,h.y+=s.offsetTop,this.width=s.width,this.height=s.height),this.setPositionByOrigin(h,"center","center")},clone:function(s,h){var g=this.toObject(h);this.constructor.fromObject?this.constructor.fromObject(g,s):i.Object._fromObject("Object",g,s)},cloneAsImage:function(s,h){var g=this.toCanvasElement(h);return s&&s(new i.Image(g)),this},toCanvasElement:function(s){s||(s={});var h=i.util,g=h.saveObjectTransform(this),v=this.group,_=this.shadow,w=Math.abs,C=(s.multiplier||1)*(s.enableRetinaScaling?i.devicePixelRatio:1);delete this.group,s.withoutTransform&&h.resetObjectTransform(this),s.withoutShadow&&(this.shadow=null);var P=i.util.createCanvasElement(),D=this.getBoundingRect(!0,!0),I=this.shadow,N,H={x:0,y:0},K,J,Q;I&&(K=I.blur,I.nonScaling?N={scaleX:1,scaleY:1}:N=this.getObjectScaling(),H.x=2*Math.round(w(I.offsetX)+K)*w(N.scaleX),H.y=2*Math.round(w(I.offsetY)+K)*w(N.scaleY)),J=D.width+H.x,Q=D.height+H.y,P.width=Math.ceil(J),P.height=Math.ceil(Q);var tt=new i.StaticCanvas(P,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});s.format==="jpeg"&&(tt.backgroundColor="#fff"),this.setPositionByOrigin(new i.Point(tt.width/2,tt.height/2),"center","center");var dt=this.canvas;tt.add(this);var rt=tt.toCanvasElement(C||1,s);return this.shadow=_,this.set("canvas",dt),v&&(this.group=v),this.set(g).setCoords(),tt._objects=[],tt.dispose(),tt=null,rt},toDataURL:function(s){return s||(s={}),i.util.toDataURL(this.toCanvasElement(s),s.format||"png",s.quality||1)},isType:function(s){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===s},complexity:function(){return 1},toJSON:function(s){return this.toObject(s)},rotate:function(s){var h=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return h&&this._setOriginToCenter(),this.set("angle",s),h&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(s,h){h=h||this.canvas.getPointer(s);var g=new i.Point(h.x,h.y),v=this._getLeftTopCoords();return this.angle&&(g=i.util.rotatePoint(g,v,n(-this.angle))),{x:g.x-v.x,y:g.y-v.y}},_setupCompositeOperation:function(s){this.globalCompositeOperation&&(s.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){i.runningAnimations&&i.runningAnimations.cancelByTarget(this)}}),i.util.createAccessors&&i.util.createAccessors(i.Object),a(i.Object.prototype,i.Observable),i.Object.NUM_FRACTION_DIGITS=2,i.Object.ENLIVEN_PROPS=["clipPath"],i.Object._fromObject=function(s,h,g,v){var _=i[s];h=l(h,!0),i.util.enlivenPatterns([h.fill,h.stroke],function(w){typeof w[0]<"u"&&(h.fill=w[0]),typeof w[1]<"u"&&(h.stroke=w[1]),i.util.enlivenObjectEnlivables(h,h,function(){var C=v?new _(h[v],h):new _(h);g&&g(C)})})},i.Object.__uid=0)}(A),function(){var d=p.util.degreesToRadians,i={left:-.5,center:0,right:.5},a={top:-.5,center:0,bottom:.5};p.util.object.extend(p.Object.prototype,{translateToGivenOrigin:function(l,e,r,n,o){var u=l.x,s=l.y,h,g,v;return typeof e=="string"?e=i[e]:e-=.5,typeof n=="string"?n=i[n]:n-=.5,h=n-e,typeof r=="string"?r=a[r]:r-=.5,typeof o=="string"?o=a[o]:o-=.5,g=o-r,(h||g)&&(v=this._getTransformedDimensions(),u=l.x+h*v.x,s=l.y+g*v.y),new p.Point(u,s)},translateToCenterPoint:function(l,e,r){var n=this.translateToGivenOrigin(l,e,r,"center","center");return this.angle?p.util.rotatePoint(n,l,d(this.angle)):n},translateToOriginPoint:function(l,e,r){var n=this.translateToGivenOrigin(l,"center","center",e,r);return this.angle?p.util.rotatePoint(n,l,d(this.angle)):n},getCenterPoint:function(){var l=new p.Point(this.left,this.top);return this.translateToCenterPoint(l,this.originX,this.originY)},getPointByOrigin:function(l,e){var r=this.getCenterPoint();return this.translateToOriginPoint(r,l,e)},toLocalPoint:function(l,e,r){var n=this.getCenterPoint(),o,u;return typeof e<"u"&&typeof r<"u"?o=this.translateToGivenOrigin(n,"center","center",e,r):o=new p.Point(this.left,this.top),u=new p.Point(l.x,l.y),this.angle&&(u=p.util.rotatePoint(u,n,-d(this.angle))),u.subtractEquals(o)},setPositionByOrigin:function(l,e,r){var n=this.translateToCenterPoint(l,e,r),o=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",o.x),this.set("top",o.y)},adjustPosition:function(l){var e=d(this.angle),r=this.getScaledWidth(),n=p.util.cos(e)*r,o=p.util.sin(e)*r,u,s;typeof this.originX=="string"?u=i[this.originX]:u=this.originX-.5,typeof l=="string"?s=i[l]:s=l-.5,this.left+=n*(s-u),this.top+=o*(s-u),this.setCoords(),this.originX=l},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var l=this.getCenterPoint();this.originX="center",this.originY="center",this.left=l.x,this.top=l.y},_resetOrigin:function(){var l=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=l.x,this.top=l.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function d(r){return[new p.Point(r.tl.x,r.tl.y),new p.Point(r.tr.x,r.tr.y),new p.Point(r.br.x,r.br.y),new p.Point(r.bl.x,r.bl.y)]}var i=p.util,a=i.degreesToRadians,l=i.multiplyTransformMatrices,e=i.transformPoint;i.object.extend(p.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(r,n){return n?r?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),r?this.aCoords:this.lineCoords)},getCoords:function(r,n){return d(this._getCoords(r,n))},intersectsWithRect:function(r,n,o,u){var s=this.getCoords(o,u),h=p.Intersection.intersectPolygonRectangle(s,r,n);return h.status==="Intersection"},intersectsWithObject:function(r,n,o){var u=p.Intersection.intersectPolygonPolygon(this.getCoords(n,o),r.getCoords(n,o));return u.status==="Intersection"||r.isContainedWithinObject(this,n,o)||this.isContainedWithinObject(r,n,o)},isContainedWithinObject:function(r,n,o){for(var u=this.getCoords(n,o),s=n?r.aCoords:r.lineCoords,h=0,g=r._getImageLines(s);h<4;h++)if(!r.containsPoint(u[h],g))return!1;return!0},isContainedWithinRect:function(r,n,o,u){var s=this.getBoundingRect(o,u);return s.left>=r.x&&s.left+s.width<=n.x&&s.top>=r.y&&s.top+s.height<=n.y},containsPoint:function(r,h,o,u){var s=this._getCoords(o,u),h=h||this._getImageLines(s),g=this._findCrossPoints(r,h);return g!==0&&g%2===1},isOnScreen:function(r){if(!this.canvas)return!1;var n=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br,u=this.getCoords(!0,r);return u.some(function(s){return s.x<=o.x&&s.x>=n.x&&s.y<=o.y&&s.y>=n.y})||this.intersectsWithRect(n,o,!0,r)?!0:this._containsCenterOfCanvas(n,o,r)},_containsCenterOfCanvas:function(r,n,o){var u={x:(r.x+n.x)/2,y:(r.y+n.y)/2};return!!this.containsPoint(u,null,!0,o)},isPartiallyOnScreen:function(r){if(!this.canvas)return!1;var n=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br;if(this.intersectsWithRect(n,o,!0,r))return!0;var u=this.getCoords(!0,r).every(function(s){return(s.x>=o.x||s.x<=n.x)&&(s.y>=o.y||s.y<=n.y)});return u&&this._containsCenterOfCanvas(n,o,r)},_getImageLines:function(r){var n={topline:{o:r.tl,d:r.tr},rightline:{o:r.tr,d:r.br},bottomline:{o:r.br,d:r.bl},leftline:{o:r.bl,d:r.tl}};return n},_findCrossPoints:function(r,n){var o,u,s,h,g,v=0,_;for(var w in n)if(_=n[w],!(_.o.y<r.y&&_.d.y<r.y)&&!(_.o.y>=r.y&&_.d.y>=r.y)&&(_.o.x===_.d.x&&_.o.x>=r.x?g=_.o.x:(o=0,u=(_.d.y-_.o.y)/(_.d.x-_.o.x),s=r.y-o*r.x,h=_.o.y-u*_.o.x,g=-(s-h)/(o-u)),g>=r.x&&(v+=1),v===2))break;return v},getBoundingRect:function(r,n){var o=this.getCoords(r,n);return i.makeBoundingBoxFromPoints(o)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(r){return Math.abs(r)<this.minScaleLimit?r<0?-this.minScaleLimit:this.minScaleLimit:r===0?1e-4:r},scale:function(r){return this._set("scaleX",r),this._set("scaleY",r),this.setCoords()},scaleToWidth:function(r,n){var o=this.getBoundingRect(n).width/this.getScaledWidth();return this.scale(r/this.width/o)},scaleToHeight:function(r,n){var o=this.getBoundingRect(n).height/this.getScaledHeight();return this.scale(r/this.height/o)},calcLineCoords:function(){var r=this.getViewportTransform(),n=this.padding,o=a(this.angle),u=i.cos(o),s=i.sin(o),h=u*n,g=s*n,v=h+g,_=h-g,w=this.calcACoords(),C={tl:e(w.tl,r),tr:e(w.tr,r),bl:e(w.bl,r),br:e(w.br,r)};return n&&(C.tl.x-=_,C.tl.y-=v,C.tr.x+=v,C.tr.y-=_,C.bl.x-=v,C.bl.y+=_,C.br.x+=_,C.br.y+=v),C},calcOCoords:function(){var r=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),o=this.getViewportTransform(),u=l(o,n),s=l(u,r),s=l(s,[1/o[0],0,0,1/o[3],0,0]),h=this._calculateCurrentDimensions(),g={};return this.forEachControl(function(v,_,w){g[_]=v.positionHandler(h,s,w)}),g},calcACoords:function(){var r=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),o=l(n,r),u=this._getTransformedDimensions(),s=u.x/2,h=u.y/2;return{tl:e({x:-s,y:-h},o),tr:e({x:s,y:-h},o),bl:e({x:-s,y:h},o),br:e({x:s,y:h},o)}},setCoords:function(r){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),r?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return i.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var r=this.getCenterPoint();return[1,0,0,1,r.x,r.y]},transformMatrixKey:function(r){var n="_",o="";return!r&&this.group&&(o=this.group.transformMatrixKey(r)+n),o+this.top+n+this.left+n+this.scaleX+n+this.scaleY+n+this.skewX+n+this.skewY+n+this.angle+n+this.originX+n+this.originY+n+this.width+n+this.height+n+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(r){var n=this.calcOwnMatrix();if(r||!this.group)return n;var o=this.transformMatrixKey(r),u=this.matrixCache||(this.matrixCache={});return u.key===o?u.value:(this.group&&(n=l(this.group.calcTransformMatrix(!1),n)),u.key=o,u.value=n,n)},calcOwnMatrix:function(){var r=this.transformMatrixKey(!0),n=this.ownMatrixCache||(this.ownMatrixCache={});if(n.key===r)return n.value;var o=this._calcTranslateMatrix(),u={angle:this.angle,translateX:o[4],translateY:o[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return n.key=r,n.value=i.composeMatrix(u),n.value},_getNonTransformedDimensions:function(){var r=this.strokeWidth,n=this.width+r,o=this.height+r;return{x:n,y:o}},_getTransformedDimensions:function(r,n){typeof r>"u"&&(r=this.skewX),typeof n>"u"&&(n=this.skewY);var o,u,s,h=r===0&&n===0;if(this.strokeUniform?(u=this.width,s=this.height):(o=this._getNonTransformedDimensions(),u=o.x,s=o.y),h)return this._finalizeDimensions(u*this.scaleX,s*this.scaleY);var g=i.sizeAfterTransform(u,s,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:r,skewY:n});return this._finalizeDimensions(g.x,g.y)},_finalizeDimensions:function(r,n){return this.strokeUniform?{x:r+this.strokeWidth,y:n+this.strokeWidth}:{x:r,y:n}},_calculateCurrentDimensions:function(){var r=this.getViewportTransform(),n=this._getTransformedDimensions(),o=e(n,r,!0);return o.scalarAdd(2*this.padding)}})}(),p.util.object.extend(p.Object.prototype,{sendToBack:function(){return this.group?p.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?p.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(d){return this.group?p.StaticCanvas.prototype.sendBackwards.call(this.group,this,d):this.canvas&&this.canvas.sendBackwards(this,d),this},bringForward:function(d){return this.group?p.StaticCanvas.prototype.bringForward.call(this.group,this,d):this.canvas&&this.canvas.bringForward(this,d),this},moveTo:function(d){return this.group&&this.group.type!=="activeSelection"?p.StaticCanvas.prototype.moveTo.call(this.group,this,d):this.canvas&&this.canvas.moveTo(this,d),this}}),function(){function d(a,l){if(l){if(l.toLive)return a+": url(#SVGID_"+l.id+"); ";var e=new p.Color(l),r=a+": "+e.toRgb()+"; ",n=e.getAlpha();return n!==1&&(r+=a+"-opacity: "+n.toString()+"; "),r}else return a+": none; "}var i=p.util.toFixed;p.util.object.extend(p.Object.prototype,{getSvgStyles:function(a){var l=this.fillRule?this.fillRule:"nonzero",e=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"none",n=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",u=this.strokeLineJoin?this.strokeLineJoin:"miter",s=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=typeof this.opacity<"u"?this.opacity:"1",g=this.visible?"":" visibility: hidden;",v=a?"":this.getSvgFilter(),_=d("fill",this.fill),w=d("stroke",this.stroke);return[w,"stroke-width: ",e,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",n,"; ","stroke-linejoin: ",u,"; ","stroke-miterlimit: ",s,"; ",_,"fill-rule: ",l,"; ","opacity: ",h,";",v,g].join("")},getSvgSpanStyles:function(a,l){var e="; ",n=a.fontFamily?"font-family: "+(a.fontFamily.indexOf("'")===-1&&a.fontFamily.indexOf('"')===-1?"'"+a.fontFamily+"'":a.fontFamily)+e:"",r=a.strokeWidth?"stroke-width: "+a.strokeWidth+e:"",n=n,o=a.fontSize?"font-size: "+a.fontSize+"px"+e:"",u=a.fontStyle?"font-style: "+a.fontStyle+e:"",s=a.fontWeight?"font-weight: "+a.fontWeight+e:"",h=a.fill?d("fill",a.fill):"",g=a.stroke?d("stroke",a.stroke):"",v=this.getSvgTextDecoration(a),_=a.deltaY?"baseline-shift: "+-a.deltaY+"; ":"";return v&&(v="text-decoration: "+v+e),[g,r,n,o,u,s,v,h,_,l?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(a){return["overline","underline","line-through"].filter(function(l){return a[l.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(a,l){var e=a?this.calcTransformMatrix():this.calcOwnMatrix(),r='transform="'+p.util.matrixToSVG(e);return r+(l||"")+'" '},_setSVGBg:function(a){if(this.backgroundColor){var l=p.Object.NUM_FRACTION_DIGITS;a.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',i(-this.width/2,l),'" y="',i(-this.height/2,l),'" width="',i(this.width,l),'" height="',i(this.height,l),`"></rect>
`)}},toSVG:function(a){return this._createBaseSVGMarkup(this._toSVG(a),{reviver:a})},toClipPathSVG:function(a){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(a),{reviver:a})},_createBaseClipPathSVGMarkup:function(a,l){l=l||{};var e=l.reviver,r=l.additionalTransform||"",n=[this.getSvgTransform(!0,r),this.getSvgCommons()].join(""),o=a.indexOf("COMMON_PARTS");return a[o]=n,e?e(a.join("")):a.join("")},_createBaseSVGMarkup:function(a,l){l=l||{};var e=l.noStyle,r=l.reviver,n=e?"":'style="'+this.getSvgStyles()+'" ',o=l.withShadow?'style="'+this.getSvgFilter()+'" ':"",u=this.clipPath,s=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=u&&u.absolutePositioned,g=this.stroke,v=this.fill,_=this.shadow,w,C=[],P,D=a.indexOf("COMMON_PARTS"),I=l.additionalTransform;return u&&(u.clipPathId="CLIPPATH_"+p.Object.__uid++,P='<clipPath id="'+u.clipPathId+`" >
`+u.toClipPathSVG(r)+`</clipPath>
`),h&&C.push("<g ",o,this.getSvgCommons(),` >
`),C.push("<g ",this.getSvgTransform(!1),h?"":o+this.getSvgCommons(),` >
`),w=[n,s,e?"":this.addPaintOrder()," ",I?'transform="'+I+'" ':""].join(""),a[D]=w,v&&v.toLive&&C.push(v.toSVG(this)),g&&g.toLive&&C.push(g.toSVG(this)),_&&C.push(_.toSVG(this)),u&&C.push(P),C.push(a.join("")),C.push(`</g>
`),h&&C.push(`</g>
`),r?r(C.join("")):C.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var d=p.util.object.extend,i="stateProperties";function a(e,r,n){var o={},u=!0;n.forEach(function(s){o[s]=e[s]}),d(e[r],o,u)}function l(e,r,n){if(e===r)return!0;if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(var o=0,u=e.length;o<u;o++)if(!l(e[o],r[o]))return!1;return!0}else if(e&&typeof e=="object"){var s=Object.keys(e),h;if(!r||typeof r!="object"||!n&&s.length!==Object.keys(r).length)return!1;for(var o=0,u=s.length;o<u;o++)if(h=s[o],!(h==="canvas"||h==="group")&&!l(e[h],r[h]))return!1;return!0}}p.util.object.extend(p.Object.prototype,{hasStateChanged:function(e){e=e||i;var r="_"+e;return Object.keys(this[r]).length<this[e].length?!0:!l(this[r],this,!0)},saveState:function(e){var r=e&&e.propertySet||i,n="_"+r;return this[n]?(a(this,n,this[r]),e&&e.stateProperties&&a(this,n,e.stateProperties),this):this.setupState(e)},setupState:function(e){e=e||{};var r=e.propertySet||i;return e.propertySet=r,this["_"+r]={},this.saveState(e),this}})}(),function(){var d=p.util.degreesToRadians;p.util.object.extend(p.Object.prototype,{_findTargetCorner:function(i,a){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var l=i.x,e=i.y,r,n,o=Object.keys(this.oCoords),u=o.length-1,s;for(this.__corner=0;u>=0;u--)if(s=o[u],!!this.isControlVisible(s)&&(n=this._getImageLines(a?this.oCoords[s].touchCorner:this.oCoords[s].corner),r=this._findCrossPoints({x:l,y:e},n),r!==0&&r%2===1))return this.__corner=s,s;return!1},forEachControl:function(i){for(var a in this.controls)i(this.controls[a],a,this)},_setCornerCoords:function(){var i=this.oCoords;for(var a in i){var l=this.controls[a];i[a].corner=l.calcCornerCoords(this.angle,this.cornerSize,i[a].x,i[a].y,!1),i[a].touchCorner=l.calcCornerCoords(this.angle,this.touchCornerSize,i[a].x,i[a].y,!0)}},drawSelectionBackground:function(i){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;i.save();var a=this.getCenterPoint(),l=this._calculateCurrentDimensions(),e=this.canvas.viewportTransform;return i.translate(a.x,a.y),i.scale(1/e[0],1/e[3]),i.rotate(d(this.angle)),i.fillStyle=this.selectionBackgroundColor,i.fillRect(-l.x/2,-l.y/2,l.x,l.y),i.restore(),this},drawBorders:function(i,a){a=a||{};var l=this._calculateCurrentDimensions(),e=this.borderScaleFactor,r=l.x+e,n=l.y+e,o=typeof a.hasControls<"u"?a.hasControls:this.hasControls,u=!1;return i.save(),i.strokeStyle=a.borderColor||this.borderColor,this._setLineDash(i,a.borderDashArray||this.borderDashArray),i.strokeRect(-r/2,-n/2,r,n),o&&(i.beginPath(),this.forEachControl(function(s,h,g){s.withConnection&&s.getVisibility(g,h)&&(u=!0,i.moveTo(s.x*r,s.y*n),i.lineTo(s.x*r+s.offsetX,s.y*n+s.offsetY))}),u&&i.stroke()),i.restore(),this},drawBordersInGroup:function(i,a,l){l=l||{};var e=p.util.sizeAfterTransform(this.width,this.height,a),r=this.strokeWidth,n=this.strokeUniform,o=this.borderScaleFactor,u=e.x+r*(n?this.canvas.getZoom():a.scaleX)+o,s=e.y+r*(n?this.canvas.getZoom():a.scaleY)+o;return i.save(),this._setLineDash(i,l.borderDashArray||this.borderDashArray),i.strokeStyle=l.borderColor||this.borderColor,i.strokeRect(-u/2,-s/2,u,s),i.restore(),this},drawControls:function(i,a){a=a||{},i.save();var l=this.canvas.getRetinaScaling(),e,r;return i.setTransform(l,0,0,l,0,0),i.strokeStyle=i.fillStyle=a.cornerColor||this.cornerColor,this.transparentCorners||(i.strokeStyle=a.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(i,a.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(e=this.group.calcTransformMatrix()),this.forEachControl(function(n,o,u){r=u.oCoords[o],n.getVisibility(u,o)&&(e&&(r=p.util.transformPoint(r,e)),n.render(i,r.x,r.y,a,u))}),i.restore(),this},isControlVisible:function(i){return this.controls[i]&&this.controls[i].getVisibility(this,i)},setControlVisible:function(i,a){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[i]=a,this},setControlsVisibility:function(i){i||(i={});for(var a in i)this.setControlVisible(a,i[a]);return this},onDeselect:function(){},onSelect:function(){}})}(),p.util.object.extend(p.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(d,i){i=i||{};var a=function(){},l=i.onComplete||a,e=i.onChange||a,r=this;return p.util.animate({target:this,startValue:d.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(n){d.set("left",n),r.requestRenderAll(),e()},onComplete:function(){d.setCoords(),l()}})},fxCenterObjectV:function(d,i){i=i||{};var a=function(){},l=i.onComplete||a,e=i.onChange||a,r=this;return p.util.animate({target:this,startValue:d.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(n){d.set("top",n),r.requestRenderAll(),e()},onComplete:function(){d.setCoords(),l()}})},fxRemove:function(d,i){i=i||{};var a=function(){},l=i.onComplete||a,e=i.onChange||a,r=this;return p.util.animate({target:this,startValue:d.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(n){d.set("opacity",n),r.requestRenderAll(),e()},onComplete:function(){r.remove(d),l()}})}}),p.util.object.extend(p.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var d=[],i,a,l=[];for(i in arguments[0])d.push(i);for(var e=0,r=d.length;e<r;e++)i=d[e],a=e!==r-1,l.push(this._animate(i,arguments[0][i],arguments[1],a));return l}else return this._animate.apply(this,arguments)},_animate:function(d,i,a,l){var e=this,r;i=i.toString(),a?a=p.util.object.clone(a):a={},~d.indexOf(".")&&(r=d.split("."));var n=e.colorProperties.indexOf(d)>-1||r&&e.colorProperties.indexOf(r[1])>-1,o=r?this.get(r[0])[r[1]]:this.get(d);"from"in a||(a.from=o),n||(~i.indexOf("=")?i=o+parseFloat(i.replace("=","")):i=parseFloat(i));var u={target:this,startValue:a.from,endValue:i,byValue:a.by,easing:a.easing,duration:a.duration,abort:a.abort&&function(s,h,g){return a.abort.call(e,s,h,g)},onChange:function(s,h,g){r?e[r[0]][r[1]]=s:e.set(d,s),!l&&a.onChange&&a.onChange(s,h,g)},onComplete:function(s,h,g){l||(e.setCoords(),a.onComplete&&a.onComplete(s,h,g))}};return n?p.util.animateColor(u.startValue,u.endValue,u.duration,u):p.util.animate(u)}}),function(d){var i=d.fabric||(d.fabric={}),a=i.util.object.extend,l=i.util.object.clone,e={x1:1,x2:1,y1:1,y2:1};if(i.Line){i.warn("fabric.Line is already defined");return}i.Line=i.util.createClass(i.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:i.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(n,o){n||(n=[0,0,0,0]),this.callSuper("initialize",o),this.set("x1",n[0]),this.set("y1",n[1]),this.set("x2",n[2]),this.set("y2",n[3]),this._setWidthHeight(o)},_setWidthHeight:function(n){n||(n={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in n?n.left:this._getLeftToOriginX(),this.top="top"in n?n.top:this._getTopToOriginY()},_set:function(n,o){return this.callSuper("_set",n,o),typeof e[n]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:r({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:r({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(n){n.beginPath();var o=this.calcLinePoints();n.moveTo(o.x1,o.y1),n.lineTo(o.x2,o.y2),n.lineWidth=this.strokeWidth;var u=n.strokeStyle;n.strokeStyle=this.stroke||n.fillStyle,this.stroke&&this._renderStroke(n),n.strokeStyle=u},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(n){return a(this.callSuper("toObject",n),this.calcLinePoints())},_getNonTransformedDimensions:function(){var n=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(n.y-=this.strokeWidth),this.height===0&&(n.x-=this.strokeWidth)),n},calcLinePoints:function(){var n=this.x1<=this.x2?-1:1,o=this.y1<=this.y2?-1:1,u=n*this.width*.5,s=o*this.height*.5,h=n*this.width*-.5,g=o*this.height*-.5;return{x1:u,x2:h,y1:s,y2:g}},_toSVG:function(){var n=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',n.x1,'" y1="',n.y1,'" x2="',n.x2,'" y2="',n.y2,`" />
`]}}),i.Line.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),i.Line.fromElement=function(n,o,u){u=u||{};var s=i.parseAttributes(n,i.Line.ATTRIBUTE_NAMES),h=[s.x1||0,s.y1||0,s.x2||0,s.y2||0];o(new i.Line(h,a(s,u)))},i.Line.fromObject=function(n,o){function u(h){delete h.points,o&&o(h)}var s=l(n,!0);s.points=[n.x1,n.y1,n.x2,n.y2],i.Object._fromObject("Line",s,u,"points")};function r(n,o){var u=n.origin,s=n.axis1,h=n.axis2,g=n.dimension,v=o.nearest,_=o.center,w=o.farthest;return function(){switch(this.get(u)){case v:return Math.min(this.get(s),this.get(h));case _:return Math.min(this.get(s),this.get(h))+.5*this.get(g);case w:return Math.max(this.get(s),this.get(h))}}}}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.util.degreesToRadians;if(i.Circle){i.warn("fabric.Circle is already defined.");return}i.Circle=i.util.createClass(i.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:i.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(e,r){return this.callSuper("_set",e,r),e==="radius"&&this.setRadius(r),this},toObject:function(e){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(e))},_toSVG:function(){var e,r=0,n=0,o=(this.endAngle-this.startAngle)%360;if(o===0)e=["<circle ","COMMON_PARTS",'cx="'+r+'" cy="'+n+'" ','r="',this.radius,`" />
`];else{var u=a(this.startAngle),s=a(this.endAngle),h=this.radius,g=i.util.cos(u)*h,v=i.util.sin(u)*h,_=i.util.cos(s)*h,w=i.util.sin(s)*h,C=o>180?"1":"0";e=['<path d="M '+g+" "+v," A "+h+" "+h," 0 ",+C+" 1"," "+_+" "+w,'" ',"COMMON_PARTS",` />
`]}return e},_render:function(e){e.beginPath(),e.arc(0,0,this.radius,a(this.startAngle),a(this.endAngle),!1),this._renderPaintInOrder(e)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){return this.radius=e,this.set("width",e*2).set("height",e*2)}}),i.Circle.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),i.Circle.fromElement=function(e,r){var n=i.parseAttributes(e,i.Circle.ATTRIBUTE_NAMES);if(!l(n))throw new Error("value of `r` attribute is required and can not be negative");n.left=(n.left||0)-n.radius,n.top=(n.top||0)-n.radius,r(new i.Circle(n))};function l(e){return"radius"in e&&e.radius>=0}i.Circle.fromObject=function(e,r){i.Object._fromObject("Circle",e,r)}}(A),function(d){var i=d.fabric||(d.fabric={});if(i.Triangle){i.warn("fabric.Triangle is already defined");return}i.Triangle=i.util.createClass(i.Object,{type:"triangle",width:100,height:100,_render:function(a){var l=this.width/2,e=this.height/2;a.beginPath(),a.moveTo(-l,e),a.lineTo(0,-e),a.lineTo(l,e),a.closePath(),this._renderPaintInOrder(a)},_toSVG:function(){var a=this.width/2,l=this.height/2,e=[-a+" "+l,"0 "+-l,a+" "+l].join(",");return["<polygon ","COMMON_PARTS",'points="',e,'" />']}}),i.Triangle.fromObject=function(a,l){return i.Object._fromObject("Triangle",a,l)}}(A),function(d){var i=d.fabric||(d.fabric={}),a=Math.PI*2;if(i.Ellipse){i.warn("fabric.Ellipse is already defined.");return}i.Ellipse=i.util.createClass(i.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:i.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(l){this.callSuper("initialize",l),this.set("rx",l&&l.rx||0),this.set("ry",l&&l.ry||0)},_set:function(l,e){switch(this.callSuper("_set",l,e),l){case"rx":this.rx=e,this.set("width",e*2);break;case"ry":this.ry=e,this.set("height",e*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(l){return this.callSuper("toObject",["rx","ry"].concat(l))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(l){l.beginPath(),l.save(),l.transform(1,0,0,this.ry/this.rx,0,0),l.arc(0,0,this.rx,0,a,!1),l.restore(),this._renderPaintInOrder(l)}}),i.Ellipse.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),i.Ellipse.fromElement=function(l,e){var r=i.parseAttributes(l,i.Ellipse.ATTRIBUTE_NAMES);r.left=(r.left||0)-r.rx,r.top=(r.top||0)-r.ry,e(new i.Ellipse(r))},i.Ellipse.fromObject=function(l,e){i.Object._fromObject("Ellipse",l,e)}}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.util.object.extend;if(i.Rect){i.warn("fabric.Rect is already defined");return}i.Rect=i.util.createClass(i.Object,{stateProperties:i.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:i.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(l){this.callSuper("initialize",l),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(l){var e=this.rx?Math.min(this.rx,this.width/2):0,r=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,o=this.height,u=-this.width/2,s=-this.height/2,h=e!==0||r!==0,g=1-.5522847498;l.beginPath(),l.moveTo(u+e,s),l.lineTo(u+n-e,s),h&&l.bezierCurveTo(u+n-g*e,s,u+n,s+g*r,u+n,s+r),l.lineTo(u+n,s+o-r),h&&l.bezierCurveTo(u+n,s+o-g*r,u+n-g*e,s+o,u+n-e,s+o),l.lineTo(u+e,s+o),h&&l.bezierCurveTo(u+g*e,s+o,u,s+o-g*r,u,s+o-r),l.lineTo(u,s+r),h&&l.bezierCurveTo(u,s+g*r,u+g*e,s,u+e,s),l.closePath(),this._renderPaintInOrder(l)},toObject:function(l){return this.callSuper("toObject",["rx","ry"].concat(l))},_toSVG:function(){var l=-this.width/2,e=-this.height/2;return["<rect ","COMMON_PARTS",'x="',l,'" y="',e,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),i.Rect.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),i.Rect.fromElement=function(l,e,r){if(!l)return e(null);r=r||{};var n=i.parseAttributes(l,i.Rect.ATTRIBUTE_NAMES);n.left=n.left||0,n.top=n.top||0,n.height=n.height||0,n.width=n.width||0;var o=new i.Rect(a(r?i.util.object.clone(r):{},n));o.visible=o.visible&&o.width>0&&o.height>0,e(o)},i.Rect.fromObject=function(l,e){return i.Object._fromObject("Rect",l,e)}}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.util.object.extend,l=i.util.array.min,e=i.util.array.max,r=i.util.toFixed,n=i.util.projectStrokeOnPoints;if(i.Polyline){i.warn("fabric.Polyline is already defined");return}i.Polyline=i.util.createClass(i.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:i.Object.prototype.cacheProperties.concat("points"),initialize:function(o,u){u=u||{},this.points=o||[],this.callSuper("initialize",u),this._setPositionDimensions(u)},_projectStrokeOnPoints:function(){return n(this.points,this,!0)},_setPositionDimensions:function(o){var u=this._calcDimensions(o),s,h=this.exactBoundingBox?this.strokeWidth:0;this.width=u.width-h,this.height=u.height-h,o.fromSVG||(s=this.translateToGivenOrigin({x:u.left-this.strokeWidth/2+h/2,y:u.top-this.strokeWidth/2+h/2},"left","top",this.originX,this.originY)),typeof o.left>"u"&&(this.left=o.fromSVG?u.left:s.x),typeof o.top>"u"&&(this.top=o.fromSVG?u.top:s.y),this.pathOffset={x:u.left+this.width/2+h/2,y:u.top+this.height/2+h/2}},_calcDimensions:function(){var o=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,u=l(o,"x")||0,s=l(o,"y")||0,h=e(o,"x")||0,g=e(o,"y")||0,v=h-u,_=g-s;return{left:u,top:s,width:v,height:_}},toObject:function(o){return a(this.callSuper("toObject",o),{points:this.points.concat()})},_toSVG:function(){for(var o=[],u=this.pathOffset.x,s=this.pathOffset.y,h=i.Object.NUM_FRACTION_DIGITS,g=0,v=this.points.length;g<v;g++)o.push(r(this.points[g].x-u,h),",",r(this.points[g].y-s,h)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',o.join(""),`" />
`]},commonRender:function(o){var u,s=this.points.length,h=this.pathOffset.x,g=this.pathOffset.y;if(!s||isNaN(this.points[s-1].y))return!1;o.beginPath(),o.moveTo(this.points[0].x-h,this.points[0].y-g);for(var v=0;v<s;v++)u=this.points[v],o.lineTo(u.x-h,u.y-g);return!0},_render:function(o){!this.commonRender(o)||this._renderPaintInOrder(o)},complexity:function(){return this.get("points").length}}),i.Polyline.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat(),i.Polyline.fromElementGenerator=function(o){return function(u,s,h){if(!u)return s(null);h||(h={});var g=i.parsePointsAttribute(u.getAttribute("points")),v=i.parseAttributes(u,i[o].ATTRIBUTE_NAMES);v.fromSVG=!0,s(new i[o](g,a(v,h)))}},i.Polyline.fromElement=i.Polyline.fromElementGenerator("Polyline"),i.Polyline.fromObject=function(o,u){return i.Object._fromObject("Polyline",o,u,"points")}}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.util.projectStrokeOnPoints;if(i.Polygon){i.warn("fabric.Polygon is already defined");return}i.Polygon=i.util.createClass(i.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return a(this.points,this)},_render:function(l){!this.commonRender(l)||(l.closePath(),this._renderPaintInOrder(l))}}),i.Polygon.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat(),i.Polygon.fromElement=i.Polyline.fromElementGenerator("Polygon"),i.Polygon.fromObject=function(l,e){i.Object._fromObject("Polygon",l,e,"points")}}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.util.array.min,l=i.util.array.max,e=i.util.object.extend,r=i.util.object.clone,n=i.util.toFixed;if(i.Path){i.warn("fabric.Path is already defined");return}i.Path=i.util.createClass(i.Object,{type:"path",path:null,cacheProperties:i.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:i.Object.prototype.stateProperties.concat("path"),initialize:function(o,u){u=r(u||{}),delete u.path,this.callSuper("initialize",u),this._setPath(o||[],u)},_setPath:function(o,u){this.path=i.util.makePathSimpler(Array.isArray(o)?o:i.util.parsePath(o)),i.Polyline.prototype._setPositionDimensions.call(this,u||{})},_renderPathCommands:function(o){var u,s=0,h=0,g=0,v=0,_=0,w=0,C=-this.pathOffset.x,P=-this.pathOffset.y;o.beginPath();for(var D=0,I=this.path.length;D<I;++D)switch(u=this.path[D],u[0]){case"L":g=u[1],v=u[2],o.lineTo(g+C,v+P);break;case"M":g=u[1],v=u[2],s=g,h=v,o.moveTo(g+C,v+P);break;case"C":g=u[5],v=u[6],_=u[3],w=u[4],o.bezierCurveTo(u[1]+C,u[2]+P,_+C,w+P,g+C,v+P);break;case"Q":o.quadraticCurveTo(u[1]+C,u[2]+P,u[3]+C,u[4]+P),g=u[3],v=u[4],_=u[1],w=u[2];break;case"z":case"Z":g=s,v=h,o.closePath();break}},_render:function(o){this._renderPathCommands(o),this._renderPaintInOrder(o)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(o){return e(this.callSuper("toObject",o),{path:this.path.map(function(u){return u.slice()})})},toDatalessObject:function(o){var u=this.toObject(["sourcePath"].concat(o));return u.sourcePath&&delete u.path,u},_toSVG:function(){var o=i.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',o,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var o=i.Object.NUM_FRACTION_DIGITS;return" translate("+n(-this.pathOffset.x,o)+", "+n(-this.pathOffset.y,o)+")"},toClipPathSVG:function(o){var u=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:u})},toSVG:function(o){var u=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:u})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var o=[],u=[],s,h=0,g=0,v=0,_=0,w,C=0,P=this.path.length;C<P;++C){switch(s=this.path[C],s[0]){case"L":v=s[1],_=s[2],w=[];break;case"M":v=s[1],_=s[2],h=v,g=_,w=[];break;case"C":w=i.util.getBoundsOfCurve(v,_,s[1],s[2],s[3],s[4],s[5],s[6]),v=s[5],_=s[6];break;case"Q":w=i.util.getBoundsOfCurve(v,_,s[1],s[2],s[1],s[2],s[3],s[4]),v=s[3],_=s[4];break;case"z":case"Z":v=h,_=g;break}w.forEach(function(Q){o.push(Q.x),u.push(Q.y)}),o.push(v),u.push(_)}var D=a(o)||0,I=a(u)||0,N=l(o)||0,H=l(u)||0,K=N-D,J=H-I;return{left:D,top:I,width:K,height:J}}}),i.Path.fromObject=function(o,u){if(typeof o.sourcePath=="string"){var s=o.sourcePath;i.loadSVGFromURL(s,function(h){var g=h[0];g.setOptions(o),u&&u(g)})}else i.Object._fromObject("Path",o,u,"path")},i.Path.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat(["d"]),i.Path.fromElement=function(o,u,s){var h=i.parseAttributes(o,i.Path.ATTRIBUTE_NAMES);h.fromSVG=!0,u(new i.Path(h.d,e(h,s)))}}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.util.array.min,l=i.util.array.max;i.Group||(i.Group=i.util.createClass(i.Object,i.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(e,r,n){r=r||{},this._objects=[],n&&this.callSuper("initialize",r),this._objects=e||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;if(n)this._updateObjectsACoords();else{var u=r&&r.centerPoint;r.originX!==void 0&&(this.originX=r.originX),r.originY!==void 0&&(this.originY=r.originY),u||this._calcBounds(),this._updateObjectsCoords(u),delete r.centerPoint,this.callSuper("initialize",r)}this.setCoords()},_updateObjectsACoords:function(){for(var e=!0,r=this._objects.length;r--;)this._objects[r].setCoords(e)},_updateObjectsCoords:function(r){for(var r=r||this.getCenterPoint(),n=this._objects.length;n--;)this._updateObjectCoords(this._objects[n],r)},_updateObjectCoords:function(e,r){var n=e.left,o=e.top,u=!0;e.set({left:n-r.x,top:o-r.y}),e.group=this,e.setCoords(u)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(e){var r=!!this.group;return this._restoreObjectsState(),i.util.resetObjectTransform(this),e&&(r&&i.util.removeTransformFromObject(e,this.group.calcTransformMatrix()),this._objects.push(e),e.group=this,e._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,r?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(e){return this._restoreObjectsState(),i.util.resetObjectTransform(this),this.remove(e),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(e){this.dirty=!0,e.group=this,e._set("canvas",this.canvas)},_onObjectRemoved:function(e){this.dirty=!0,delete e.group},_set:function(e,r){var n=this._objects.length;if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(e,r);if(e==="canvas")for(;n--;)this._objects[n]._set(e,r);i.Object.prototype._set.call(this,e,r)},toObject:function(e){var r=this.includeDefaultValues,n=this._objects.filter(function(u){return!u.excludeFromExport}).map(function(u){var s=u.includeDefaultValues;u.includeDefaultValues=r;var h=u.toObject(e);return u.includeDefaultValues=s,h}),o=i.Object.prototype.toObject.call(this,e);return o.objects=n,o},toDatalessObject:function(e){var r,n=this.sourcePath;if(n)r=n;else{var o=this.includeDefaultValues;r=this._objects.map(function(s){var h=s.includeDefaultValues;s.includeDefaultValues=o;var g=s.toDatalessObject(e);return s.includeDefaultValues=h,g})}var u=i.Object.prototype.toDatalessObject.call(this,e);return u.objects=r,u},render:function(e){this._transformDone=!0,this.callSuper("render",e),this._transformDone=!1},shouldCache:function(){var e=i.Object.prototype.shouldCache.call(this);if(e){for(var r=0,n=this._objects.length;r<n;r++)if(this._objects[r].willDrawShadow())return this.ownCaching=!1,!1}return e},willDrawShadow:function(){if(i.Object.prototype.willDrawShadow.call(this))return!0;for(var e=0,r=this._objects.length;e<r;e++)if(this._objects[e].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(e){for(var r=0,n=this._objects.length;r<n;r++)this._objects[r].render(e);this._drawClipPath(e,this.clipPath)},isCacheDirty:function(e){if(this.callSuper("isCacheDirty",e))return!0;if(!this.statefullCache)return!1;for(var r=0,n=this._objects.length;r<n;r++)if(this._objects[r].isCacheDirty(!0)){if(this._cacheCanvas){var o=this.cacheWidth/this.zoomX,u=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-o/2,-u/2,o,u)}return!0}return!1},_restoreObjectsState:function(){var e=this.calcOwnMatrix();return this._objects.forEach(function(r){i.util.addTransformToObject(r,e),delete r.group,r.setCoords()}),this},destroy:function(){return this._objects.forEach(function(e){e.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(e){e.dispose&&e.dispose()}),this._objects=[]},toActiveSelection:function(){if(!!this.canvas){var e=this._objects,r=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var o=new i.ActiveSelection([]);return o.set(n),o.type="activeSelection",r.remove(this),e.forEach(function(u){u.group=o,u.dirty=!0,r.add(u)}),o.canvas=r,o._objects=e,r._activeObject=o,o.setCoords(),o}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var e=!0;return this.forEachObject(function(r){r.setCoords(e)}),this},_calcBounds:function(e){for(var r=[],n=[],o,u,s,h=["tr","br","bl","tl"],g=0,v=this._objects.length,_,w=h.length;g<v;++g){for(o=this._objects[g],s=o.calcACoords(),_=0;_<w;_++)u=h[_],r.push(s[u].x),n.push(s[u].y);o.aCoords=s}this._getBounds(r,n,e)},_getBounds:function(e,r,n){var o=new i.Point(a(e),a(r)),u=new i.Point(l(e),l(r)),s=o.y||0,h=o.x||0,g=u.x-o.x||0,v=u.y-o.y||0;this.width=g,this.height=v,n||this.setPositionByOrigin({x:h,y:s},"left","top")},_toSVG:function(e){for(var r=["<g ","COMMON_PARTS",` >
`],n=0,o=this._objects.length;n<o;n++)r.push("		",this._objects[n].toSVG(e));return r.push(`</g>
`),r},getSvgStyles:function(){var e=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",r=this.visible?"":" visibility: hidden;";return[e,this.getSvgFilter(),r].join("")},toClipPathSVG:function(e){for(var r=[],n=0,o=this._objects.length;n<o;n++)r.push("	",this._objects[n].toClipPathSVG(e));return this._createBaseClipPathSVGMarkup(r,{reviver:e})}}),i.Group.fromObject=function(e,r){var n=e.objects,o=i.util.object.clone(e,!0);if(delete o.objects,typeof n=="string"){i.loadSVGFromURL(n,function(u){var s=i.util.groupSVGElements(u,e,n);s.set(o),r&&r(s)});return}i.util.enlivenObjects(n,function(u){var s=i.util.object.clone(e,!0);delete s.objects,i.util.enlivenObjectEnlivables(e,s,function(){r&&r(new i.Group(u,s,!0))})})})}(A),function(d){var i=d.fabric||(d.fabric={});i.ActiveSelection||(i.ActiveSelection=i.util.createClass(i.Group,{type:"activeSelection",initialize:function(a,l){l=l||{},this._objects=a||[];for(var e=this._objects.length;e--;)this._objects[e].group=this;l.originX&&(this.originX=l.originX),l.originY&&(this.originY=l.originY),this._calcBounds(),this._updateObjectsCoords(),i.Object.prototype.initialize.call(this,l),this.setCoords()},toGroup:function(){var a=this._objects.concat();this._objects=[];var l=i.Object.prototype.toObject.call(this),e=new i.Group([]);if(delete l.type,e.set(l),a.forEach(function(n){n.canvas.remove(n),n.group=e}),e._objects=a,!this.canvas)return e;var r=this.canvas;return r.add(e),r._activeObject=e,e.setCoords(),e},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(a,l,e){a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",a,l),e=e||{},typeof e.hasControls>"u"&&(e.hasControls=!1),e.forActiveSelection=!0;for(var r=0,n=this._objects.length;r<n;r++)this._objects[r]._renderControls(a,e);a.restore()}}),i.ActiveSelection.fromObject=function(a,l){i.util.enlivenObjects(a.objects,function(e){delete a.objects,l&&l(new i.ActiveSelection(e,a,!0))})})}(A),function(d){var i=p.util.object.extend;if(d.fabric||(d.fabric={}),d.fabric.Image){p.warn("fabric.Image is already defined.");return}p.Image=p.util.createClass(p.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:p.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:p.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(a,l){l||(l={}),this.filters=[],this.cacheKey="texture"+p.Object.__uid++,this.callSuper("initialize",l),this._initElement(a,l)},getElement:function(){return this._element||{}},setElement:function(a,l){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=a,this._originalElement=a,this._initConfig(l),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(a){var l=p.filterBackend;l&&l.evictCachesForKey&&l.evictCachesForKey(a)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(a){p.util.cleanUpJsdomNode(this[a]),this[a]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var a=this.getElement();return{width:a.naturalWidth||a.width,height:a.naturalHeight||a.height}},_stroke:function(a){if(!(!this.stroke||this.strokeWidth===0)){var l=this.width/2,e=this.height/2;a.beginPath(),a.moveTo(-l,-e),a.lineTo(l,-e),a.lineTo(l,e),a.lineTo(-l,e),a.lineTo(-l,-e),a.closePath()}},toObject:function(a){var l=[];this.filters.forEach(function(r){r&&l.push(r.toObject())});var e=i(this.callSuper("toObject",["cropX","cropY"].concat(a)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:l});return this.resizeFilter&&(e.resizeFilter=this.resizeFilter.toObject()),e},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var a=[],l=[],e,r=this._element,n=-this.width/2,o=-this.height/2,u="",s="";if(!r)return[];if(this.hasCrop()){var h=p.Object.__uid++;a.push('<clipPath id="imageCrop_'+h+`">
`,'	<rect x="'+n+'" y="'+o+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),u=' clip-path="url(#imageCrop_'+h+')" '}if(this.imageSmoothing||(s='" image-rendering="optimizeSpeed'),l.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',n-this.cropX,'" y="',o-this.cropY,'" width="',r.width||r.naturalWidth,'" height="',r.height||r.height,s,'"',u,`></image>
`),this.stroke||this.strokeDashArray){var g=this.fill;this.fill=null,e=["	<rect ",'x="',n,'" y="',o,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=g}return this.paintFirst!=="fill"?a=a.concat(e,l):a=a.concat(l,e),a},getSrc:function(a){var l=a?this._element:this._originalElement;return l?l.toDataURL?l.toDataURL():this.srcFromAttribute?l.getAttribute("src"):l.src:this.src||""},setSrc:function(a,l,e){return p.util.loadImage(a,function(r,n){this.setElement(r,e),this._setWidthHeight(),l&&l(this,n)},this,e&&e.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var a=this.resizeFilter,l=this.minimumScaleTrigger,e=this.getTotalObjectScaling(),r=e.scaleX,n=e.scaleY,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!a||r>l&&n>l){this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=r,this._lastScaleY=n;return}p.filterBackend||(p.filterBackend=p.initFilterBackend());var u=p.util.createCanvasElement(),s=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,h=o.width,g=o.height;u.width=h,u.height=g,this._element=u,this._lastScaleX=a.scaleX=r,this._lastScaleY=a.scaleY=n,p.filterBackend.applyFilters([a],o,h,g,this._element,s),this._filterScalingX=u.width/this._originalElement.width,this._filterScalingY=u.height/this._originalElement.height},applyFilters:function(a){if(a=a||this.filters||[],a=a.filter(function(o){return o&&!o.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),a.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var l=this._originalElement,e=l.naturalWidth||l.width,r=l.naturalHeight||l.height;if(this._element===this._originalElement){var n=p.util.createCanvasElement();n.width=e,n.height=r,this._element=n,this._filteredEl=n}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,e,r),this._lastScaleX=1,this._lastScaleY=1;return p.filterBackend||(p.filterBackend=p.initFilterBackend()),p.filterBackend.applyFilters(a,this._originalElement,e,r,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(a){p.util.setImageSmoothing(a,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(a),this._renderPaintInOrder(a)},drawCacheOnCanvas:function(a){p.util.setImageSmoothing(a,this.imageSmoothing),p.Object.prototype.drawCacheOnCanvas.call(this,a)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(a){var l=this._element;if(!!l){var e=this._filterScalingX,r=this._filterScalingY,n=this.width,o=this.height,u=Math.min,s=Math.max,h=s(this.cropX,0),g=s(this.cropY,0),v=l.naturalWidth||l.width,_=l.naturalHeight||l.height,w=h*e,C=g*r,P=u(n*e,v-w),D=u(o*r,_-C),I=-n/2,N=-o/2,H=u(n,v/e-h),K=u(o,_/r-g);l&&a.drawImage(l,w,C,P,D,I,N,H,K)}},_needsResize:function(){var a=this.getTotalObjectScaling();return a.scaleX!==this._lastScaleX||a.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(a,l){this.setElement(p.util.getById(a),l),p.util.addClass(this.getElement(),p.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={}),this.setOptions(a),this._setWidthHeight(a)},_initFilters:function(a,l){a&&a.length?p.util.enlivenObjects(a,function(e){l&&l(e)},"fabric.Image.filters"):l&&l()},_setWidthHeight:function(a){a||(a={});var l=this.getElement();this.width=a.width||l.naturalWidth||l.width||0,this.height=a.height||l.naturalHeight||l.height||0},parsePreserveAspectRatioAttribute:function(){var a=p.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),l=this._element.width,e=this._element.height,r=1,n=1,o=0,u=0,s=0,h=0,g,v=this.width,_=this.height,w={width:v,height:_};return a&&(a.alignX!=="none"||a.alignY!=="none")?(a.meetOrSlice==="meet"&&(r=n=p.util.findScaleToFit(this._element,w),g=(v-l*r)/2,a.alignX==="Min"&&(o=-g),a.alignX==="Max"&&(o=g),g=(_-e*n)/2,a.alignY==="Min"&&(u=-g),a.alignY==="Max"&&(u=g)),a.meetOrSlice==="slice"&&(r=n=p.util.findScaleToCover(this._element,w),g=l-v/r,a.alignX==="Mid"&&(s=g/2),a.alignX==="Max"&&(s=g),g=e-_/n,a.alignY==="Mid"&&(h=g/2),a.alignY==="Max"&&(h=g),l=v/r,e=_/n)):(r=v/l,n=_/e),{width:l,height:e,scaleX:r,scaleY:n,offsetLeft:o,offsetTop:u,cropX:s,cropY:h}}}),p.Image.CSS_CANVAS="canvas-img",p.Image.prototype.getSvgSrc=p.Image.prototype.getSrc,p.Image.fromObject=function(a,l){var e=p.util.object.clone(a);p.util.loadImage(e.src,function(r,n){if(n){l&&l(null,!0);return}p.Image.prototype._initFilters.call(e,e.filters,function(o){e.filters=o||[],p.Image.prototype._initFilters.call(e,[e.resizeFilter],function(u){e.resizeFilter=u[0],p.util.enlivenObjectEnlivables(e,e,function(){var s=new p.Image(r,e);l(s,!1)})})})},null,e.crossOrigin)},p.Image.fromURL=function(a,l,e){p.util.loadImage(a,function(r,n){l&&l(new p.Image(r,e),n)},null,e&&e.crossOrigin)},p.Image.ATTRIBUTE_NAMES=p.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),p.Image.fromElement=function(a,l,e){var r=p.parseAttributes(a,p.Image.ATTRIBUTE_NAMES);p.Image.fromURL(r["xlink:href"],l,i(e?p.util.object.clone(e):{},r))}}(A),p.util.object.extend(p.Object.prototype,{_getAngleValueForStraighten:function(){var d=this.angle%360;return d>0?Math.round((d-1)/90)*90:Math.round(d/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(d){d=d||{};var i=function(){},a=d.onComplete||i,l=d.onChange||i,e=this;return p.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(r){e.rotate(r),l()},onComplete:function(){e.setCoords(),a()}})}}),p.util.object.extend(p.StaticCanvas.prototype,{straightenObject:function(d){return d.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(d){return d.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function d(a,l){var e="precision "+l+` float;
void main(){}`,r=a.createShader(a.FRAGMENT_SHADER);return a.shaderSource(r,e),a.compileShader(r),!!a.getShaderParameter(r,a.COMPILE_STATUS)}p.isWebglSupported=function(a){if(p.isLikelyNode)return!1;a=a||p.WebglFilterBackend.prototype.tileSize;var l=document.createElement("canvas"),e=l.getContext("webgl")||l.getContext("experimental-webgl"),r=!1;if(e){p.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),r=p.maxTextureSize>=a;for(var n=["highp","mediump","lowp"],o=0;o<3;o++)if(d(e,n[o])){p.webGlPrecision=n[o];break}}return this.isSupported=r,r},p.WebglFilterBackend=i;function i(a){a&&a.tileSize&&(this.tileSize=a.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}i.prototype={tileSize:2048,resources:{},setupGLContext:function(a,l){this.dispose(),this.createWebGLCanvas(a,l),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(a,l)},chooseFastestCopyGLTo2DMethod:function(a,l){var e=typeof window.performance<"u",r;try{new ImageData(1,1),r=!0}catch{r=!1}var n=typeof ArrayBuffer<"u",o=typeof Uint8ClampedArray<"u";if(!!(e&&r&&n&&o)){var u=p.util.createCanvasElement(),s=new ArrayBuffer(a*l*4);if(p.forceGLPutImageData){this.imageBuffer=s,this.copyGLTo2D=M;return}var h={imageBuffer:s,destinationWidth:a,destinationHeight:l,targetCanvas:u},g,v,_;u.width=a,u.height=l,g=window.performance.now(),E.call(h,this.gl,h),v=window.performance.now()-g,g=window.performance.now(),M.call(h,this.gl,h),_=window.performance.now()-g,v>_?(this.imageBuffer=s,this.copyGLTo2D=M):this.copyGLTo2D=E}},createWebGLCanvas:function(a,l){var e=p.util.createCanvasElement();e.width=a,e.height=l;var r={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},n=e.getContext("webgl",r);n||(n=e.getContext("experimental-webgl",r)),n&&(n.clearColor(0,0,0,0),this.canvas=e,this.gl=n)},applyFilters:function(a,l,e,r,n,o){var u=this.gl,s;o&&(s=this.getCachedTexture(o,l));var h={originalWidth:l.width||l.originalWidth,originalHeight:l.height||l.originalHeight,sourceWidth:e,sourceHeight:r,destinationWidth:e,destinationHeight:r,context:u,sourceTexture:this.createTexture(u,e,r,!s&&l),targetTexture:this.createTexture(u,e,r),originalTexture:s||this.createTexture(u,e,r,!s&&l),passes:a.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:n},g=u.createFramebuffer();return u.bindFramebuffer(u.FRAMEBUFFER,g),a.forEach(function(v){v&&v.applyTo(h)}),S(h),this.copyGLTo2D(u,h),u.bindTexture(u.TEXTURE_2D,null),u.deleteTexture(h.sourceTexture),u.deleteTexture(h.targetTexture),u.deleteFramebuffer(g),n.getContext("2d").setTransform(1,0,0,1,0,0),h},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(a,l,e,r){var n=a.createTexture();return a.bindTexture(a.TEXTURE_2D,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),r?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,r):a.texImage2D(a.TEXTURE_2D,0,a.RGBA,l,e,0,a.RGBA,a.UNSIGNED_BYTE,null),n},getCachedTexture:function(a,l){if(this.textureCache[a])return this.textureCache[a];var e=this.createTexture(this.gl,l.width,l.height,l);return this.textureCache[a]=e,e},evictCachesForKey:function(a){this.textureCache[a]&&(this.gl.deleteTexture(this.textureCache[a]),delete this.textureCache[a])},copyGLTo2D:E,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var a=this.gl,l={renderer:"",vendor:""};if(!a)return l;var e=a.getExtension("WEBGL_debug_renderer_info");if(e){var r=a.getParameter(e.UNMASKED_RENDERER_WEBGL),n=a.getParameter(e.UNMASKED_VENDOR_WEBGL);r&&(l.renderer=r.toLowerCase()),n&&(l.vendor=n.toLowerCase())}return this.gpuInfo=l,l}}}();function S(d){var i=d.targetCanvas,a=i.width,l=i.height,e=d.destinationWidth,r=d.destinationHeight;(a!==e||l!==r)&&(i.width=e,i.height=r)}function E(d,i){var a=d.canvas,l=i.targetCanvas,e=l.getContext("2d");e.translate(0,l.height),e.scale(1,-1);var r=a.height-l.height;e.drawImage(a,0,r,l.width,l.height,0,0,l.width,l.height)}function M(d,i){var a=i.targetCanvas,l=a.getContext("2d"),e=i.destinationWidth,r=i.destinationHeight,n=e*r*4,o=new Uint8Array(this.imageBuffer,0,n),u=new Uint8ClampedArray(this.imageBuffer,0,n);d.readPixels(0,0,e,r,d.RGBA,d.UNSIGNED_BYTE,o);var s=new ImageData(u,e,r);l.putImageData(s,0,0)}(function(){var d=function(){};p.Canvas2dFilterBackend=i;function i(){}i.prototype={evictCachesForKey:d,dispose:d,clearWebGLCaches:d,resources:{},applyFilters:function(a,l,e,r,n){var o=n.getContext("2d");o.drawImage(l,0,0,e,r);var u=o.getImageData(0,0,e,r),s=o.getImageData(0,0,e,r),h={sourceWidth:e,sourceHeight:r,imageData:u,originalEl:l,originalImageData:s,canvasEl:n,ctx:o,filterBackend:this};return a.forEach(function(g){g.applyTo(h)}),(h.imageData.width!==e||h.imageData.height!==r)&&(n.width=h.imageData.width,n.height=h.imageData.height),o.putImageData(h.imageData,0,0),h}}})(),p.Image=p.Image||{},p.Image.filters=p.Image.filters||{},p.Image.filters.BaseFilter=p.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(d){d&&this.setOptions(d)},setOptions:function(d){for(var i in d)this[i]=d[i]},createProgram:function(d,i,a){i=i||this.fragmentSource,a=a||this.vertexSource,p.webGlPrecision!=="highp"&&(i=i.replace(/precision highp float/g,"precision "+p.webGlPrecision+" float"));var l=d.createShader(d.VERTEX_SHADER);if(d.shaderSource(l,a),d.compileShader(l),!d.getShaderParameter(l,d.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+d.getShaderInfoLog(l));var e=d.createShader(d.FRAGMENT_SHADER);if(d.shaderSource(e,i),d.compileShader(e),!d.getShaderParameter(e,d.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+d.getShaderInfoLog(e));var r=d.createProgram();if(d.attachShader(r,l),d.attachShader(r,e),d.linkProgram(r),!d.getProgramParameter(r,d.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+d.getProgramInfoLog(r));var n=this.getAttributeLocations(d,r),o=this.getUniformLocations(d,r)||{};return o.uStepW=d.getUniformLocation(r,"uStepW"),o.uStepH=d.getUniformLocation(r,"uStepH"),{program:r,attributeLocations:n,uniformLocations:o}},getAttributeLocations:function(d,i){return{aPosition:d.getAttribLocation(i,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(d,i,a){var l=i.aPosition,e=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,e),d.enableVertexAttribArray(l),d.vertexAttribPointer(l,2,d.FLOAT,!1,0,0),d.bufferData(d.ARRAY_BUFFER,a,d.STATIC_DRAW)},_setupFrameBuffer:function(d){var i=d.context,a,l;d.passes>1?(a=d.destinationWidth,l=d.destinationHeight,(d.sourceWidth!==a||d.sourceHeight!==l)&&(i.deleteTexture(d.targetTexture),d.targetTexture=d.filterBackend.createTexture(i,a,l)),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,d.targetTexture,0)):(i.bindFramebuffer(i.FRAMEBUFFER,null),i.finish())},_swapTextures:function(d){d.passes--,d.pass++;var i=d.targetTexture;d.targetTexture=d.sourceTexture,d.sourceTexture=i},isNeutralState:function(){var d=this.mainParameter,i=p.Image.filters[this.type].prototype;if(d)if(Array.isArray(i[d])){for(var a=i[d].length;a--;)if(this[d][a]!==i[d][a])return!1;return!0}else return i[d]===this[d];else return!1},applyTo:function(d){d.webgl?(this._setupFrameBuffer(d),this.applyToWebGL(d),this._swapTextures(d)):this.applyTo2d(d)},retrieveShader:function(d){return d.programCache.hasOwnProperty(this.type)||(d.programCache[this.type]=this.createProgram(d.context)),d.programCache[this.type]},applyToWebGL:function(d){var i=d.context,a=this.retrieveShader(d);d.pass===0&&d.originalTexture?i.bindTexture(i.TEXTURE_2D,d.originalTexture):i.bindTexture(i.TEXTURE_2D,d.sourceTexture),i.useProgram(a.program),this.sendAttributeData(i,a.attributeLocations,d.aPosition),i.uniform1f(a.uniformLocations.uStepW,1/d.sourceWidth),i.uniform1f(a.uniformLocations.uStepH,1/d.sourceHeight),this.sendUniformData(i,a.uniformLocations),i.viewport(0,0,d.destinationWidth,d.destinationHeight),i.drawArrays(i.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(d,i,a){d.activeTexture(a),d.bindTexture(d.TEXTURE_2D,i),d.activeTexture(d.TEXTURE0)},unbindAdditionalTexture:function(d,i){d.activeTexture(i),d.bindTexture(d.TEXTURE_2D,null),d.activeTexture(d.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(d){this[this.mainParameter]=d},sendUniformData:function(){},createHelpLayer:function(d){if(!d.helpLayer){var i=document.createElement("canvas");i.width=d.sourceWidth,i.height=d.sourceHeight,d.helpLayer=i}},toObject:function(){var d={type:this.type},i=this.mainParameter;return i&&(d[i]=this[i]),d},toJSON:function(){return this.toObject()}}),p.Image.filters.BaseFilter.fromObject=function(d,i){var a=new p.Image.filters[d.type](d);return i&&i(a),a},function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass;a.ColorMatrix=l(a.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(e){this.callSuper("initialize",e),this.matrix=this.matrix.slice(0)},applyTo2d:function(e){var r=e.imageData,n=r.data,o=n.length,u=this.matrix,s,h,g,v,_,w=this.colorsOnly;for(_=0;_<o;_+=4)s=n[_],h=n[_+1],g=n[_+2],w?(n[_]=s*u[0]+h*u[1]+g*u[2]+u[4]*255,n[_+1]=s*u[5]+h*u[6]+g*u[7]+u[9]*255,n[_+2]=s*u[10]+h*u[11]+g*u[12]+u[14]*255):(v=n[_+3],n[_]=s*u[0]+h*u[1]+g*u[2]+v*u[3]+u[4]*255,n[_+1]=s*u[5]+h*u[6]+g*u[7]+v*u[8]+u[9]*255,n[_+2]=s*u[10]+h*u[11]+g*u[12]+v*u[13]+u[14]*255,n[_+3]=s*u[15]+h*u[16]+g*u[17]+v*u[18]+u[19]*255)},getUniformLocations:function(e,r){return{uColorMatrix:e.getUniformLocation(r,"uColorMatrix"),uConstants:e.getUniformLocation(r,"uConstants")}},sendUniformData:function(e,r){var n=this.matrix,o=[n[0],n[1],n[2],n[3],n[5],n[6],n[7],n[8],n[10],n[11],n[12],n[13],n[15],n[16],n[17],n[18]],u=[n[4],n[9],n[14],n[19]];e.uniformMatrix4fv(r.uColorMatrix,!1,o),e.uniform4fv(r.uConstants,u)}}),i.Image.filters.ColorMatrix.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass;a.Brightness=l(a.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(e){if(this.brightness!==0){var r=e.imageData,n=r.data,o,u=n.length,s=Math.round(this.brightness*255);for(o=0;o<u;o+=4)n[o]=n[o]+s,n[o+1]=n[o+1]+s,n[o+2]=n[o+2]+s}},getUniformLocations:function(e,r){return{uBrightness:e.getUniformLocation(r,"uBrightness")}},sendUniformData:function(e,r){e.uniform1f(r.uBrightness,this.brightness)}}),i.Image.filters.Brightness.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.util.object.extend,l=i.Image.filters,e=i.util.createClass;l.Convolute=e(l.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(r){var n=Math.sqrt(this.matrix.length),o=this.type+"_"+n+"_"+(this.opaque?1:0),u=this.fragmentSource[o];return r.programCache.hasOwnProperty(o)||(r.programCache[o]=this.createProgram(r.context,u)),r.programCache[o]},applyTo2d:function(r){var n=r.imageData,o=n.data,u=this.matrix,s=Math.round(Math.sqrt(u.length)),h=Math.floor(s/2),g=n.width,v=n.height,_=r.ctx.createImageData(g,v),w=_.data,C=this.opaque?1:0,P,D,I,N,H,K,J,Q,tt,dt,rt,_t,T;for(rt=0;rt<v;rt++)for(dt=0;dt<g;dt++){for(H=(rt*g+dt)*4,P=0,D=0,I=0,N=0,T=0;T<s;T++)for(_t=0;_t<s;_t++)J=rt+T-h,K=dt+_t-h,!(J<0||J>=v||K<0||K>=g)&&(Q=(J*g+K)*4,tt=u[T*s+_t],P+=o[Q]*tt,D+=o[Q+1]*tt,I+=o[Q+2]*tt,C||(N+=o[Q+3]*tt));w[H]=P,w[H+1]=D,w[H+2]=I,C?w[H+3]=o[H+3]:w[H+3]=N}r.imageData=_},getUniformLocations:function(r,n){return{uMatrix:r.getUniformLocation(n,"uMatrix"),uOpaque:r.getUniformLocation(n,"uOpaque"),uHalfSize:r.getUniformLocation(n,"uHalfSize"),uSize:r.getUniformLocation(n,"uSize")}},sendUniformData:function(r,n){r.uniform1fv(n.uMatrix,this.matrix)},toObject:function(){return a(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),i.Image.filters.Convolute.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass;a.Grayscale=l(a.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(e){var r=e.imageData,n=r.data,o,u=n.length,s,h=this.mode;for(o=0;o<u;o+=4)h==="average"?s=(n[o]+n[o+1]+n[o+2])/3:h==="lightness"?s=(Math.min(n[o],n[o+1],n[o+2])+Math.max(n[o],n[o+1],n[o+2]))/2:h==="luminosity"&&(s=.21*n[o]+.72*n[o+1]+.07*n[o+2]),n[o]=s,n[o+1]=s,n[o+2]=s},retrieveShader:function(e){var r=this.type+"_"+this.mode;if(!e.programCache.hasOwnProperty(r)){var n=this.fragmentSource[this.mode];e.programCache[r]=this.createProgram(e.context,n)}return e.programCache[r]},getUniformLocations:function(e,r){return{uMode:e.getUniformLocation(r,"uMode")}},sendUniformData:function(e,r){var n=1;e.uniform1i(r.uMode,n)},isNeutralState:function(){return!1}}),i.Image.filters.Grayscale.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass;a.Invert=l(a.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(e){var r=e.imageData,n=r.data,o,u=n.length;for(o=0;o<u;o+=4)n[o]=255-n[o],n[o+1]=255-n[o+1],n[o+2]=255-n[o+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(e,r){return{uInvert:e.getUniformLocation(r,"uInvert")}},sendUniformData:function(e,r){e.uniform1i(r.uInvert,this.invert)}}),i.Image.filters.Invert.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.util.object.extend,l=i.Image.filters,e=i.util.createClass;l.Noise=e(l.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(r){if(this.noise!==0){var n=r.imageData,o=n.data,u,s=o.length,h=this.noise,g;for(u=0,s=o.length;u<s;u+=4)g=(.5-Math.random())*h,o[u]+=g,o[u+1]+=g,o[u+2]+=g}},getUniformLocations:function(r,n){return{uNoise:r.getUniformLocation(n,"uNoise"),uSeed:r.getUniformLocation(n,"uSeed")}},sendUniformData:function(r,n){r.uniform1f(n.uNoise,this.noise/255),r.uniform1f(n.uSeed,Math.random())},toObject:function(){return a(this.callSuper("toObject"),{noise:this.noise})}}),i.Image.filters.Noise.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass;a.Pixelate=l(a.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(e){var r=e.imageData,n=r.data,o=r.height,u=r.width,s,h,g,v,_,w,C,P,D,I,N;for(h=0;h<o;h+=this.blocksize)for(g=0;g<u;g+=this.blocksize)for(s=h*4*u+g*4,v=n[s],_=n[s+1],w=n[s+2],C=n[s+3],I=Math.min(h+this.blocksize,o),N=Math.min(g+this.blocksize,u),P=h;P<I;P++)for(D=g;D<N;D++)s=P*4*u+D*4,n[s]=v,n[s+1]=_,n[s+2]=w,n[s+3]=C},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(e,r){return{uBlocksize:e.getUniformLocation(r,"uBlocksize"),uStepW:e.getUniformLocation(r,"uStepW"),uStepH:e.getUniformLocation(r,"uStepH")}},sendUniformData:function(e,r){e.uniform1f(r.uBlocksize,this.blocksize)}}),i.Image.filters.Pixelate.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.util.object.extend,l=i.Image.filters,e=i.util.createClass;l.RemoveColor=e(l.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(r){var n=r.imageData,o=n.data,u,s=this.distance*255,h,g,v,_=new i.Color(this.color).getSource(),w=[_[0]-s,_[1]-s,_[2]-s],C=[_[0]+s,_[1]+s,_[2]+s];for(u=0;u<o.length;u+=4)h=o[u],g=o[u+1],v=o[u+2],h>w[0]&&g>w[1]&&v>w[2]&&h<C[0]&&g<C[1]&&v<C[2]&&(o[u+3]=0)},getUniformLocations:function(r,n){return{uLow:r.getUniformLocation(n,"uLow"),uHigh:r.getUniformLocation(n,"uHigh")}},sendUniformData:function(r,n){var o=new i.Color(this.color).getSource(),u=parseFloat(this.distance),s=[0+o[0]/255-u,0+o[1]/255-u,0+o[2]/255-u,1],h=[o[0]/255+u,o[1]/255+u,o[2]/255+u,1];r.uniform4fv(n.uLow,s),r.uniform4fv(n.uHigh,h)},toObject:function(){return a(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),i.Image.filters.RemoveColor.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass,e={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var r in e)a[r]=l(a.ColorMatrix,{type:r,matrix:e[r],mainParameter:!1,colorsOnly:!0}),i.Image.filters[r].fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric,a=i.Image.filters,l=i.util.createClass;a.BlendColor=l(a.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(e){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[e]+`}
}`},retrieveShader:function(e){var r=this.type+"_"+this.mode,n;return e.programCache.hasOwnProperty(r)||(n=this.buildSource(this.mode),e.programCache[r]=this.createProgram(e.context,n)),e.programCache[r]},applyTo2d:function(e){var r=e.imageData,n=r.data,o=n.length,u,s,h,g,v,_,w,C=1-this.alpha;w=new i.Color(this.color).getSource(),u=w[0]*this.alpha,s=w[1]*this.alpha,h=w[2]*this.alpha;for(var P=0;P<o;P+=4)switch(g=n[P],v=n[P+1],_=n[P+2],this.mode){case"multiply":n[P]=g*u/255,n[P+1]=v*s/255,n[P+2]=_*h/255;break;case"screen":n[P]=255-(255-g)*(255-u)/255,n[P+1]=255-(255-v)*(255-s)/255,n[P+2]=255-(255-_)*(255-h)/255;break;case"add":n[P]=g+u,n[P+1]=v+s,n[P+2]=_+h;break;case"diff":case"difference":n[P]=Math.abs(g-u),n[P+1]=Math.abs(v-s),n[P+2]=Math.abs(_-h);break;case"subtract":n[P]=g-u,n[P+1]=v-s,n[P+2]=_-h;break;case"darken":n[P]=Math.min(g,u),n[P+1]=Math.min(v,s),n[P+2]=Math.min(_,h);break;case"lighten":n[P]=Math.max(g,u),n[P+1]=Math.max(v,s),n[P+2]=Math.max(_,h);break;case"overlay":n[P]=u<128?2*g*u/255:255-2*(255-g)*(255-u)/255,n[P+1]=s<128?2*v*s/255:255-2*(255-v)*(255-s)/255,n[P+2]=h<128?2*_*h/255:255-2*(255-_)*(255-h)/255;break;case"exclusion":n[P]=u+g-2*u*g/255,n[P+1]=s+v-2*s*v/255,n[P+2]=h+_-2*h*_/255;break;case"tint":n[P]=u+g*C,n[P+1]=s+v*C,n[P+2]=h+_*C}},getUniformLocations:function(e,r){return{uColor:e.getUniformLocation(r,"uColor")}},sendUniformData:function(e,r){var n=new i.Color(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,e.uniform4fv(r.uColor,n)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),i.Image.filters.BlendColor.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric,a=i.Image.filters,l=i.util.createClass;a.BlendImage=l(a.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(e){var r=this.type+"_"+this.mode,n=this.fragmentSource[this.mode];return e.programCache.hasOwnProperty(r)||(e.programCache[r]=this.createProgram(e.context,n)),e.programCache[r]},applyToWebGL:function(e){var r=e.context,n=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(r,n,r.TEXTURE1),this.callSuper("applyToWebGL",e),this.unbindAdditionalTexture(r,r.TEXTURE1)},createTexture:function(e,r){return e.getCachedTexture(r.cacheKey,r._element)},calculateMatrix:function(){var e=this.image,r=e._element.width,n=e._element.height;return[1/e.scaleX,0,0,0,1/e.scaleY,0,-e.left/r,-e.top/n,1]},applyTo2d:function(e){var r=e.imageData,n=e.filterBackend.resources,o=r.data,u=o.length,s=r.width,h=r.height,g,v,_,w,C,P,D,I,N,H,K=this.image,J;n.blendImage||(n.blendImage=i.util.createCanvasElement()),N=n.blendImage,H=N.getContext("2d"),N.width!==s||N.height!==h?(N.width=s,N.height=h):H.clearRect(0,0,s,h),H.setTransform(K.scaleX,0,0,K.scaleY,K.left,K.top),H.drawImage(K._element,0,0,s,h),J=H.getImageData(0,0,s,h).data;for(var Q=0;Q<u;Q+=4)switch(C=o[Q],P=o[Q+1],D=o[Q+2],I=o[Q+3],g=J[Q],v=J[Q+1],_=J[Q+2],w=J[Q+3],this.mode){case"multiply":o[Q]=C*g/255,o[Q+1]=P*v/255,o[Q+2]=D*_/255,o[Q+3]=I*w/255;break;case"mask":o[Q+3]=w;break}},getUniformLocations:function(e,r){return{uTransformMatrix:e.getUniformLocation(r,"uTransformMatrix"),uImage:e.getUniformLocation(r,"uImage")}},sendUniformData:function(e,r){var n=this.calculateMatrix();e.uniform1i(r.uImage,1),e.uniformMatrix3fv(r.uTransformMatrix,!1,n)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),i.Image.filters.BlendImage.fromObject=function(e,r){i.Image.fromObject(e.image,function(n){var o=i.util.object.clone(e);o.image=n,r(new i.Image.filters.BlendImage(o))})}}(A),function(d){var i=d.fabric||(d.fabric={}),a=Math.pow,l=Math.floor,e=Math.sqrt,r=Math.abs,n=Math.round,o=Math.sin,u=Math.ceil,s=i.Image.filters,h=i.util.createClass;s.Resize=h(s.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(g,v){return{uDelta:g.getUniformLocation(v,"uDelta"),uTaps:g.getUniformLocation(v,"uTaps")}},sendUniformData:function(g,v){g.uniform2fv(v.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),g.uniform1fv(v.uTaps,this.taps)},retrieveShader:function(g){var v=this.getFilterWindow(),_=this.type+"_"+v;if(!g.programCache.hasOwnProperty(_)){var w=this.generateShader(v);g.programCache[_]=this.createProgram(g.context,w)}return g.programCache[_]},getFilterWindow:function(){var g=this.tempScale;return Math.ceil(this.lanczosLobes/g)},getTaps:function(){for(var g=this.lanczosCreate(this.lanczosLobes),v=this.tempScale,_=this.getFilterWindow(),w=new Array(_),C=1;C<=_;C++)w[C-1]=g(C*v);return w},generateShader:function(w){for(var v=new Array(w),_=this.fragmentSourceTOP,w,C=1;C<=w;C++)v[C-1]=C+".0 * uDelta";return _+="uniform float uTaps["+w+`];
`,_+=`void main() {
`,_+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,_+=`  float sum = 1.0;
`,v.forEach(function(P,D){_+="  color += texture2D(uTexture, vTexCoord + "+P+") * uTaps["+D+`];
`,_+="  color += texture2D(uTexture, vTexCoord - "+P+") * uTaps["+D+`];
`,_+="  sum += 2.0 * uTaps["+D+`];
`}),_+=`  gl_FragColor = color / sum;
`,_+="}",_},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(g){g.webgl?(g.passes++,this.width=g.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=g.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),g.destinationWidth=this.dW,this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g),g.sourceWidth=g.destinationWidth,this.height=g.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),g.destinationHeight=this.dH,this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g),g.sourceHeight=g.destinationHeight):this.applyTo2d(g)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(g){return function(v){if(v>=g||v<=-g)return 0;if(v<11920929e-14&&v>-11920929e-14)return 1;v*=Math.PI;var _=v/g;return o(v)/v*o(_)/_}},applyTo2d:function(g){var v=g.imageData,_=this.scaleX,w=this.scaleY;this.rcpScaleX=1/_,this.rcpScaleY=1/w;var C=v.width,P=v.height,D=n(C*_),I=n(P*w),N;this.resizeType==="sliceHack"?N=this.sliceByTwo(g,C,P,D,I):this.resizeType==="hermite"?N=this.hermiteFastResize(g,C,P,D,I):this.resizeType==="bilinear"?N=this.bilinearFiltering(g,C,P,D,I):this.resizeType==="lanczos"&&(N=this.lanczosResize(g,C,P,D,I)),g.imageData=N},sliceByTwo:function(g,v,_,w,C){var P=g.imageData,D=.5,I=!1,N=!1,H=v*D,K=_*D,J=i.filterBackend.resources,Q,tt,dt=0,rt=0,_t=v,T=0;for(J.sliceByTwo||(J.sliceByTwo=document.createElement("canvas")),Q=J.sliceByTwo,(Q.width<v*1.5||Q.height<_)&&(Q.width=v*1.5,Q.height=_),tt=Q.getContext("2d"),tt.clearRect(0,0,v*1.5,_),tt.putImageData(P,0,0),w=l(w),C=l(C);!I||!N;)v=H,_=K,w<l(H*D)?H=l(H*D):(H=w,I=!0),C<l(K*D)?K=l(K*D):(K=C,N=!0),tt.drawImage(Q,dt,rt,v,_,_t,T,H,K),dt=_t,rt=T,T+=K;return tt.getImageData(dt,rt,w,C)},lanczosResize:function(g,v,_,w,C){function P(R){var V,G,F,k,X,Z,st,et,lt,ft,yt;for(T.x=(R+.5)*K,B.x=l(T.x),V=0;V<C;V++){for(T.y=(V+.5)*J,B.y=l(T.y),X=0,Z=0,st=0,et=0,lt=0,G=B.x-dt;G<=B.x+dt;G++)if(!(G<0||G>=v)){ft=l(1e3*r(G-T.x)),_t[ft]||(_t[ft]={});for(var it=B.y-rt;it<=B.y+rt;it++)it<0||it>=_||(yt=l(1e3*r(it-T.y)),_t[ft][yt]||(_t[ft][yt]=H(e(a(ft*Q,2)+a(yt*tt,2))/1e3)),F=_t[ft][yt],F>0&&(k=(it*v+G)*4,X+=F,Z+=F*D[k],st+=F*D[k+1],et+=F*D[k+2],lt+=F*D[k+3]))}k=(V*w+R)*4,N[k]=Z/X,N[k+1]=st/X,N[k+2]=et/X,N[k+3]=lt/X}return++R<w?P(R):I}var D=g.imageData.data,I=g.ctx.createImageData(w,C),N=I.data,H=this.lanczosCreate(this.lanczosLobes),K=this.rcpScaleX,J=this.rcpScaleY,Q=2/this.rcpScaleX,tt=2/this.rcpScaleY,dt=u(K*this.lanczosLobes/2),rt=u(J*this.lanczosLobes/2),_t={},T={},B={};return P(0)},bilinearFiltering:function(g,v,_,w,C){var P,D,I,N,H,K,J,Q,tt,dt,rt,_t,T=0,B,R=this.rcpScaleX,V=this.rcpScaleY,G=4*(v-1),F=g.imageData,k=F.data,X=g.ctx.createImageData(w,C),Z=X.data;for(J=0;J<C;J++)for(Q=0;Q<w;Q++)for(H=l(R*Q),K=l(V*J),tt=R*Q-H,dt=V*J-K,B=4*(K*v+H),rt=0;rt<4;rt++)P=k[B+rt],D=k[B+4+rt],I=k[B+G+rt],N=k[B+G+4+rt],_t=P*(1-tt)*(1-dt)+D*tt*(1-dt)+I*dt*(1-tt)+N*tt*dt,Z[T++]=_t;return X},hermiteFastResize:function(g,v,_,w,C){for(var P=this.rcpScaleX,D=this.rcpScaleY,I=u(P/2),N=u(D/2),H=g.imageData,K=H.data,J=g.ctx.createImageData(w,C),Q=J.data,tt=0;tt<C;tt++)for(var dt=0;dt<w;dt++){for(var rt=(dt+tt*w)*4,_t=0,T=0,B=0,R=0,V=0,G=0,F=0,k=(tt+.5)*D,X=l(tt*D);X<(tt+1)*D;X++)for(var Z=r(k-(X+.5))/N,st=(dt+.5)*P,et=Z*Z,lt=l(dt*P);lt<(dt+1)*P;lt++){var ft=r(st-(lt+.5))/I,yt=e(et+ft*ft);yt>1&&yt<-1||(_t=2*yt*yt*yt-3*yt*yt+1,_t>0&&(ft=4*(lt+X*v),F+=_t*K[ft+3],B+=_t,K[ft+3]<255&&(_t=_t*K[ft+3]/250),R+=_t*K[ft],V+=_t*K[ft+1],G+=_t*K[ft+2],T+=_t))}Q[rt]=R/T,Q[rt+1]=V/T,Q[rt+2]=G/T,Q[rt+3]=F/B}return J},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),i.Image.filters.Resize.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass;a.Contrast=l(a.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(e){if(this.contrast!==0){var r=e.imageData,n,u,o=r.data,u=o.length,s=Math.floor(this.contrast*255),h=259*(s+255)/(255*(259-s));for(n=0;n<u;n+=4)o[n]=h*(o[n]-128)+128,o[n+1]=h*(o[n+1]-128)+128,o[n+2]=h*(o[n+2]-128)+128}},getUniformLocations:function(e,r){return{uContrast:e.getUniformLocation(r,"uContrast")}},sendUniformData:function(e,r){e.uniform1f(r.uContrast,this.contrast)}}),i.Image.filters.Contrast.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass;a.Saturation=l(a.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(e){if(this.saturation!==0){var r=e.imageData,n=r.data,o=n.length,u=-this.saturation,s,h;for(s=0;s<o;s+=4)h=Math.max(n[s],n[s+1],n[s+2]),n[s]+=h!==n[s]?(h-n[s])*u:0,n[s+1]+=h!==n[s+1]?(h-n[s+1])*u:0,n[s+2]+=h!==n[s+2]?(h-n[s+2])*u:0}},getUniformLocations:function(e,r){return{uSaturation:e.getUniformLocation(r,"uSaturation")}},sendUniformData:function(e,r){e.uniform1f(r.uSaturation,-this.saturation)}}),i.Image.filters.Saturation.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass;a.Vibrance=l(a.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(e){if(this.vibrance!==0){var r=e.imageData,n=r.data,o=n.length,u=-this.vibrance,s,h,g,v;for(s=0;s<o;s+=4)h=Math.max(n[s],n[s+1],n[s+2]),g=(n[s]+n[s+1]+n[s+2])/3,v=Math.abs(h-g)*2/255*u,n[s]+=h!==n[s]?(h-n[s])*v:0,n[s+1]+=h!==n[s+1]?(h-n[s+1])*v:0,n[s+2]+=h!==n[s+2]?(h-n[s+2])*v:0}},getUniformLocations:function(e,r){return{uVibrance:e.getUniformLocation(r,"uVibrance")}},sendUniformData:function(e,r){e.uniform1f(r.uVibrance,-this.vibrance)}}),i.Image.filters.Vibrance.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass;a.Blur=l(a.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(e){e.webgl?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},applyTo2d:function(e){e.imageData=this.simpleBlur(e)},simpleBlur:function(e){var r=e.filterBackend.resources,n,o,u=e.imageData.width,s=e.imageData.height;r.blurLayer1||(r.blurLayer1=i.util.createCanvasElement(),r.blurLayer2=i.util.createCanvasElement()),n=r.blurLayer1,o=r.blurLayer2,(n.width!==u||n.height!==s)&&(o.width=n.width=u,o.height=n.height=s);var h=n.getContext("2d"),g=o.getContext("2d"),v=15,_,w,C,P,D=this.blur*.06*.5;for(h.putImageData(e.imageData,0,0),g.clearRect(0,0,u,s),P=-v;P<=v;P++)_=(Math.random()-.5)/4,w=P/v,C=D*w*u+_,g.globalAlpha=1-Math.abs(w),g.drawImage(n,C,_),h.drawImage(o,0,0),g.globalAlpha=1,g.clearRect(0,0,o.width,o.height);for(P=-v;P<=v;P++)_=(Math.random()-.5)/4,w=P/v,C=D*w*s+_,g.globalAlpha=1-Math.abs(w),g.drawImage(n,_,C),h.drawImage(o,0,0),g.globalAlpha=1,g.clearRect(0,0,o.width,o.height);e.ctx.drawImage(n,0,0);var I=e.ctx.getImageData(0,0,n.width,n.height);return h.globalAlpha=1,h.clearRect(0,0,n.width,n.height),I},getUniformLocations:function(e,r){return{delta:e.getUniformLocation(r,"uDelta")}},sendUniformData:function(e,r){var n=this.chooseRightDelta();e.uniform2fv(r.delta,n)},chooseRightDelta:function(){var e=1,r=[0,0],n;return this.horizontal?this.aspectRatio>1&&(e=1/this.aspectRatio):this.aspectRatio<1&&(e=this.aspectRatio),n=e*this.blur*.12,this.horizontal?r[0]=n:r[1]=n,r}}),a.Blur.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass;a.Gamma=l(a.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(e){this.gamma=[1,1,1],a.BaseFilter.prototype.initialize.call(this,e)},applyTo2d:function(e){var r=e.imageData,n=r.data,o=this.gamma,u=n.length,s=1/o[0],h=1/o[1],g=1/o[2],v;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),v=0,u=256;v<u;v++)this.rVals[v]=Math.pow(v/255,s)*255,this.gVals[v]=Math.pow(v/255,h)*255,this.bVals[v]=Math.pow(v/255,g)*255;for(v=0,u=n.length;v<u;v+=4)n[v]=this.rVals[n[v]],n[v+1]=this.gVals[n[v+1]],n[v+2]=this.bVals[n[v+2]]},getUniformLocations:function(e,r){return{uGamma:e.getUniformLocation(r,"uGamma")}},sendUniformData:function(e,r){e.uniform3fv(r.uGamma,this.gamma)}}),i.Image.filters.Gamma.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass;a.Composed=l(a.BaseFilter,{type:"Composed",subFilters:[],initialize:function(e){this.callSuper("initialize",e),this.subFilters=this.subFilters.slice(0)},applyTo:function(e){e.passes+=this.subFilters.length-1,this.subFilters.forEach(function(r){r.applyTo(e)})},toObject:function(){return i.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(e){return e.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(e){return!e.isNeutralState()})}}),i.Image.filters.Composed.fromObject=function(e,r){var n=e.subFilters||[],o=n.map(function(s){return new i.Image.filters[s.type](s)}),u=new i.Image.filters.Composed({subFilters:o});return r&&r(u),u}}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.Image.filters,l=i.util.createClass;a.HueRotation=l(a.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var e=this.rotation*Math.PI,r=i.util.cos(e),n=i.util.sin(e),o=1/3,u=Math.sqrt(o)*n,s=1-r;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=r+s/3,this.matrix[1]=o*s-u,this.matrix[2]=o*s+u,this.matrix[5]=o*s+u,this.matrix[6]=r+o*s,this.matrix[7]=o*s-u,this.matrix[10]=o*s-u,this.matrix[11]=o*s+u,this.matrix[12]=r+o*s},isNeutralState:function(e){return this.calculateMatrix(),a.BaseFilter.prototype.isNeutralState.call(this,e)},applyTo:function(e){this.calculateMatrix(),a.BaseFilter.prototype.applyTo.call(this,e)}}),i.Image.filters.HueRotation.fromObject=i.Image.filters.BaseFilter.fromObject}(A),function(d){var i=d.fabric||(d.fabric={}),a=i.util.object.clone;if(i.Text){i.warn("fabric.Text is already defined");return}var l="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");i.Text=i.util.createClass(i.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:i.Object.prototype.stateProperties.concat(l),cacheProperties:i.Object.prototype.cacheProperties.concat(l),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(e,r){this.styles=r?r.styles||{}:{},this.text=e,this.__skipDimension=!0,this.callSuper("initialize",r),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var e=this.path;e&&(e.segmentsInfo=i.util.getPathSegmentsInfo(e.path))},getMeasuringContext:function(){return i._measuringContext||(i._measuringContext=this.canvas&&this.canvas.contextCache||i.util.createCanvasElement().getContext("2d")),i._measuringContext},_splitText:function(){var e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var e,r,n,o,u,s,h,g=0,v=this._textLines.length;g<v;g++)if(!(this.textAlign!=="justify"&&(g===v-1||this.isEndOfWrapping(g)))&&(o=0,u=this._textLines[g],r=this.getLineWidth(g),r<this.width&&(h=this.textLines[g].match(this._reSpacesAndTabs)))){n=h.length,e=(this.width-r)/n;for(var _=0,w=u.length;_<=w;_++)s=this.__charBounds[g][_],this._reSpaceAndTab.test(u[_])?(s.width+=e,s.kernedWidth+=e,s.left+=o,o+=e):s.left+=o}},isEndOfWrapping:function(e){return e===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var e=this.callSuper("_getCacheCanvasDimensions"),r=this.fontSize;return e.width+=r*e.zoomX,e.height+=r*e.zoomY,e},_render:function(e){var r=this.path;r&&!r.isNotVisible()&&r._render(e),this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")},_renderText:function(e){this.paintFirst==="stroke"?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))},_setTextStyles:function(e,r,n){if(e.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":e.textBaseline="middle";break;case"ascender":e.textBaseline="top";break;case"descender":e.textBaseline="bottom";break}e.font=this._getFontDeclaration(r,n)},calcTextWidth:function(){for(var e=this.getLineWidth(0),r=1,n=this._textLines.length;r<n;r++){var o=this.getLineWidth(r);o>e&&(e=o)}return e},_renderTextLine:function(e,r,n,o,u,s){this._renderChars(e,r,n,o,u,s)},_renderTextLinesBackground:function(e){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var r,n,o=e.fillStyle,u,s,h=this._getLeftOffset(),g=this._getTopOffset(),v=0,_=0,w,C,P=this.path,D,I=0,N=this._textLines.length;I<N;I++){if(r=this.getHeightOfLine(I),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",I)){g+=r;continue}u=this._textLines[I],n=this._getLineLeftOffset(I),_=0,v=0,s=this.getValueOfPropertyAt(I,0,"textBackgroundColor");for(var H=0,K=u.length;H<K;H++)w=this.__charBounds[I][H],C=this.getValueOfPropertyAt(I,H,"textBackgroundColor"),P?(e.save(),e.translate(w.renderLeft,w.renderTop),e.rotate(w.angle),e.fillStyle=C,C&&e.fillRect(-w.width/2,-r/this.lineHeight*(1-this._fontSizeFraction),w.width,r/this.lineHeight),e.restore()):C!==s?(D=h+n+v,this.direction==="rtl"&&(D=this.width-D-_),e.fillStyle=s,s&&e.fillRect(D,g,_,r/this.lineHeight),v=w.left,_=w.width,s=C):_+=w.kernedWidth;C&&!P&&(D=h+n+v,this.direction==="rtl"&&(D=this.width-D-_),e.fillStyle=C,e.fillRect(D,g,_,r/this.lineHeight)),g+=r}e.fillStyle=o,this._removeShadow(e)}},getFontCache:function(e){var r=e.fontFamily.toLowerCase();i.charWidthsCache[r]||(i.charWidthsCache[r]={});var n=i.charWidthsCache[r],o=e.fontStyle.toLowerCase()+"_"+(e.fontWeight+"").toLowerCase();return n[o]||(n[o]={}),n[o]},_measureChar:function(e,r,n,o){var u=this.getFontCache(r),s=this._getFontDeclaration(r),h=this._getFontDeclaration(o),g=n+e,v=s===h,_,w,C,P=r.fontSize/this.CACHE_FONT_SIZE,D;if(n&&u[n]!==void 0&&(C=u[n]),u[e]!==void 0&&(D=_=u[e]),v&&u[g]!==void 0&&(w=u[g],D=w-C),_===void 0||C===void 0||w===void 0){var I=this.getMeasuringContext();this._setTextStyles(I,r,!0)}return _===void 0&&(D=_=I.measureText(e).width,u[e]=_),C===void 0&&v&&n&&(C=I.measureText(n).width,u[n]=C),v&&w===void 0&&(w=I.measureText(g).width,u[g]=w,D=w-C),{width:_*P,kernedWidth:D*P}},getHeightOfChar:function(e,r){return this.getValueOfPropertyAt(e,r,"fontSize")},measureLine:function(e){var r=this._measureLine(e);return this.charSpacing!==0&&(r.width-=this._getWidthOfCharSpacing()),r.width<0&&(r.width=0),r},_measureLine:function(e){var r=0,n,o,u=this._textLines[e],s,h,g=0,v=new Array(u.length),_=0,w,C,P=this.path,D=this.pathSide==="right";for(this.__charBounds[e]=v,n=0;n<u.length;n++)o=u[n],h=this._getGraphemeBox(o,e,n,s),v[n]=h,r+=h.kernedWidth,s=o;if(v[n]={left:h?h.left+h.width:0,width:0,kernedWidth:0,height:this.fontSize},P){switch(C=P.segmentsInfo[P.segmentsInfo.length-1].length,w=i.util.getPointOnPath(P.path,0,P.segmentsInfo),w.x+=P.pathOffset.x,w.y+=P.pathOffset.y,this.textAlign){case"left":_=D?C-r:0;break;case"center":_=(C-r)/2;break;case"right":_=D?0:C-r;break}for(_+=this.pathStartOffset*(D?-1:1),n=D?u.length-1:0;D?n>=0:n<u.length;D?n--:n++)h=v[n],_>C?_%=C:_<0&&(_+=C),this._setGraphemeOnPath(_,h,w),_+=h.kernedWidth}return{width:r,numOfSpaces:g}},_setGraphemeOnPath:function(e,r,n){var o=e+r.kernedWidth/2,u=this.path,s=i.util.getPointOnPath(u.path,o,u.segmentsInfo);r.renderLeft=s.x-n.x,r.renderTop=s.y-n.y,r.angle=s.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(e,r,n,o,u){var s=this.getCompleteStyleDeclaration(r,n),h=o?this.getCompleteStyleDeclaration(r,n-1):{},g=this._measureChar(e,s,o,h),v=g.kernedWidth,_=g.width,w;this.charSpacing!==0&&(w=this._getWidthOfCharSpacing(),_+=w,v+=w);var C={width:_,left:0,height:s.fontSize,kernedWidth:v,deltaY:s.deltaY};if(n>0&&!u){var P=this.__charBounds[r][n-1];C.left=P.left+P.width+g.kernedWidth-g.width}return C},getHeightOfLine:function(e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var r=this._textLines[e],n=this.getHeightOfChar(e,0),o=1,u=r.length;o<u;o++)n=Math.max(this.getHeightOfChar(e,o),n);return this.__lineHeights[e]=n*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var e,r=0,n=0,o=this._textLines.length;n<o;n++)e=this.getHeightOfLine(n),r+=n===o-1?e/this.lineHeight:e;return r},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(e,r){e.save();for(var n=0,o=this._getLeftOffset(),u=this._getTopOffset(),s=0,h=this._textLines.length;s<h;s++){var g=this.getHeightOfLine(s),v=g/this.lineHeight,_=this._getLineLeftOffset(s);this._renderTextLine(r,e,this._textLines[s],o+_,u+n+v,s),n+=g}e.restore()},_renderTextFill:function(e){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(e,"fillText")},_renderTextStroke:function(e){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())},_renderChars:function(e,r,n,o,u,s){var h=this.getHeightOfLine(s),g=this.textAlign.indexOf("justify")!==-1,v,_,w="",C,P=0,D,I=this.path,N=!g&&this.charSpacing===0&&this.isEmptyStyles(s)&&!I,H=this.direction==="ltr",K=this.direction==="ltr"?1:-1,J,Q=r.canvas.getAttribute("dir");if(r.save(),Q!==this.direction&&(r.canvas.setAttribute("dir",H?"ltr":"rtl"),r.direction=H?"ltr":"rtl",r.textAlign=H?"left":"right"),u-=h*this._fontSizeFraction/this.lineHeight,N){this._renderChar(e,r,s,0,n.join(""),o,u,h),r.restore();return}for(var tt=0,dt=n.length-1;tt<=dt;tt++)D=tt===dt||this.charSpacing||I,w+=n[tt],C=this.__charBounds[s][tt],P===0?(o+=K*(C.kernedWidth-C.width),P+=C.width):P+=C.kernedWidth,g&&!D&&this._reSpaceAndTab.test(n[tt])&&(D=!0),D||(v=v||this.getCompleteStyleDeclaration(s,tt),_=this.getCompleteStyleDeclaration(s,tt+1),D=this._hasStyleChanged(v,_)),D&&(I?(r.save(),r.translate(C.renderLeft,C.renderTop),r.rotate(C.angle),this._renderChar(e,r,s,tt,w,-P/2,0,h),r.restore()):(J=o,this._renderChar(e,r,s,tt,w,J,u,h)),w="",v=_,o+=K*P,P=0);r.restore()},_applyPatternGradientTransformText:function(e){var r=i.util.createCanvasElement(),n,o=this.width+this.strokeWidth,u=this.height+this.strokeWidth;return r.width=o,r.height=u,n=r.getContext("2d"),n.beginPath(),n.moveTo(0,0),n.lineTo(o,0),n.lineTo(o,u),n.lineTo(0,u),n.closePath(),n.translate(o/2,u/2),n.fillStyle=e.toLive(n),this._applyPatternGradientTransform(n,e),n.fill(),n.createPattern(r,"no-repeat")},handleFiller:function(e,r,n){var o,u;return n.toLive?n.gradientUnits==="percentage"||n.gradientTransform||n.patternTransform?(o=-this.width/2,u=-this.height/2,e.translate(o,u),e[r]=this._applyPatternGradientTransformText(n),{offsetX:o,offsetY:u}):(e[r]=n.toLive(e,this),this._applyPatternGradientTransform(e,n)):(e[r]=n,{offsetX:0,offsetY:0})},_setStrokeStyles:function(e,r){return e.lineWidth=r.strokeWidth,e.lineCap=this.strokeLineCap,e.lineDashOffset=this.strokeDashOffset,e.lineJoin=this.strokeLineJoin,e.miterLimit=this.strokeMiterLimit,this.handleFiller(e,"strokeStyle",r.stroke)},_setFillStyles:function(e,r){return this.handleFiller(e,"fillStyle",r.fill)},_renderChar:function(e,r,n,o,u,s,h){var g=this._getStyleDeclaration(n,o),v=this.getCompleteStyleDeclaration(n,o),_=e==="fillText"&&v.fill,w=e==="strokeText"&&v.stroke&&v.strokeWidth,C,P;!w&&!_||(r.save(),_&&(C=this._setFillStyles(r,v)),w&&(P=this._setStrokeStyles(r,v)),r.font=this._getFontDeclaration(v),g&&g.textBackgroundColor&&this._removeShadow(r),g&&g.deltaY&&(h+=g.deltaY),_&&r.fillText(u,s-C.offsetX,h-C.offsetY),w&&r.strokeText(u,s-P.offsetX,h-P.offsetY),r.restore())},setSuperscript:function(e,r){return this._setScript(e,r,this.superscript)},setSubscript:function(e,r){return this._setScript(e,r,this.subscript)},_setScript:function(e,r,n){var o=this.get2DCursorLocation(e,!0),u=this.getValueOfPropertyAt(o.lineIndex,o.charIndex,"fontSize"),s=this.getValueOfPropertyAt(o.lineIndex,o.charIndex,"deltaY"),h={fontSize:u*n.size,deltaY:s+u*n.baseline};return this.setSelectionStyles(h,e,r),this},_hasStyleChanged:function(e,r){return e.fill!==r.fill||e.stroke!==r.stroke||e.strokeWidth!==r.strokeWidth||e.fontSize!==r.fontSize||e.fontFamily!==r.fontFamily||e.fontWeight!==r.fontWeight||e.fontStyle!==r.fontStyle||e.deltaY!==r.deltaY},_hasStyleChangedForSvg:function(e,r){return this._hasStyleChanged(e,r)||e.overline!==r.overline||e.underline!==r.underline||e.linethrough!==r.linethrough},_getLineLeftOffset:function(e){var r=this.getLineWidth(e),n=this.width-r,o=this.textAlign,u=this.direction,h,s=0,h=this.isEndOfWrapping(e);return o==="justify"||o==="justify-center"&&!h||o==="justify-right"&&!h||o==="justify-left"&&!h?0:(o==="center"&&(s=n/2),o==="right"&&(s=n),o==="justify-center"&&(s=n/2),o==="justify-right"&&(s=n),u==="rtl"&&(s-=n),s)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var e=this._forceClearCache;return e||(e=this.hasStateChanged("_dimensionAffectingProps")),e&&(this.dirty=!0,this._forceClearCache=!1),e},getLineWidth:function(e){if(this.__lineWidths[e]!==void 0)return this.__lineWidths[e];var r=this.measureLine(e),n=r.width;return this.__lineWidths[e]=n,n},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(e,r,n){var o=this._getStyleDeclaration(e,r);return o&&typeof o[n]<"u"?o[n]:this[n]},_renderTextDecoration:function(e,r){if(!(!this[r]&&!this.styleHas(r))){for(var n,o,u,s,h,g,v,_,w=this._getLeftOffset(),C=this._getTopOffset(),P,D,I,N,H,K,J,Q,tt=this.path,dt=this._getWidthOfCharSpacing(),rt=this.offsets[r],_t=0,T=this._textLines.length;_t<T;_t++){if(n=this.getHeightOfLine(_t),!this[r]&&!this.styleHas(r,_t)){C+=n;continue}v=this._textLines[_t],K=n/this.lineHeight,s=this._getLineLeftOffset(_t),D=0,I=0,_=this.getValueOfPropertyAt(_t,0,r),Q=this.getValueOfPropertyAt(_t,0,"fill"),P=C+K*(1-this._fontSizeFraction),o=this.getHeightOfChar(_t,0),h=this.getValueOfPropertyAt(_t,0,"deltaY");for(var B=0,R=v.length;B<R;B++)if(N=this.__charBounds[_t][B],H=this.getValueOfPropertyAt(_t,B,r),J=this.getValueOfPropertyAt(_t,B,"fill"),u=this.getHeightOfChar(_t,B),g=this.getValueOfPropertyAt(_t,B,"deltaY"),tt&&H&&J)e.save(),e.fillStyle=Q,e.translate(N.renderLeft,N.renderTop),e.rotate(N.angle),e.fillRect(-N.kernedWidth/2,rt*u+g,N.kernedWidth,this.fontSize/15),e.restore();else if((H!==_||J!==Q||u!==o||g!==h)&&I>0){var V=w+s+D;this.direction==="rtl"&&(V=this.width-V-I),_&&Q&&(e.fillStyle=Q,e.fillRect(V,P+rt*o+h,I,this.fontSize/15)),D=N.left,I=N.width,_=H,Q=J,o=u,h=g}else I+=N.kernedWidth;var V=w+s+D;this.direction==="rtl"&&(V=this.width-V-I),e.fillStyle=J,H&&J&&e.fillRect(V,P+rt*o+h,I-dt,this.fontSize/15),C+=n}this._removeShadow(e)}},_getFontDeclaration:function(e,r){var n=e||this,o=this.fontFamily,u=i.Text.genericFonts.indexOf(o.toLowerCase())>-1,s=o===void 0||o.indexOf("'")>-1||o.indexOf(",")>-1||o.indexOf('"')>-1||u?n.fontFamily:'"'+n.fontFamily+'"';return[i.isLikelyNode?n.fontWeight:n.fontStyle,i.isLikelyNode?n.fontStyle:n.fontWeight,r?this.CACHE_FONT_SIZE+"px":n.fontSize+"px",s].join(" ")},render:function(e){!this.visible||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",e))},_splitTextIntoLines:function(e){for(var r=e.split(this._reNewline),n=new Array(r.length),o=[`
`],u=[],s=0;s<r.length;s++)n[s]=i.util.string.graphemeSplit(r[s]),u=u.concat(n[s],o);return u.pop(),{_unwrappedLines:n,lines:r,graphemeText:u,graphemeLines:n}},toObject:function(e){var r=l.concat(e),n=this.callSuper("toObject",r);return n.styles=a(this.styles,!0),n.path&&(n.path=this.path.toObject()),n},set:function(e,r){this.callSuper("set",e,r);var n=!1,o=!1;if(typeof e=="object")for(var u in e)u==="path"&&this.setPathInfo(),n=n||this._dimensionAffectingProps.indexOf(u)!==-1,o=o||u==="path";else n=this._dimensionAffectingProps.indexOf(e)!==-1,o=e==="path";return o&&this.setPathInfo(),n&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),i.Text.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),i.Text.DEFAULT_SVG_FONT_SIZE=16,i.Text.fromElement=function(e,r,n){if(!e)return r(null);var o=i.parseAttributes(e,i.Text.ATTRIBUTE_NAMES),u=o.textAnchor||"left";if(n=i.util.object.extend(n?a(n):{},o),n.top=n.top||0,n.left=n.left||0,o.textDecoration){var s=o.textDecoration;s.indexOf("underline")!==-1&&(n.underline=!0),s.indexOf("overline")!==-1&&(n.overline=!0),s.indexOf("line-through")!==-1&&(n.linethrough=!0),delete n.textDecoration}"dx"in o&&(n.left+=o.dx),"dy"in o&&(n.top+=o.dy),"fontSize"in n||(n.fontSize=i.Text.DEFAULT_SVG_FONT_SIZE);var h="";"textContent"in e?h=e.textContent:"firstChild"in e&&e.firstChild!==null&&"data"in e.firstChild&&e.firstChild.data!==null&&(h=e.firstChild.data),h=h.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var g=n.strokeWidth;n.strokeWidth=0;var v=new i.Text(h,n),_=v.getScaledHeight()/v.height,w=(v.height+v.strokeWidth)*v.lineHeight-v.height,C=w*_,P=v.getScaledHeight()+C,D=0;u==="center"&&(D=v.getScaledWidth()/2),u==="right"&&(D=v.getScaledWidth()),v.set({left:v.left-D,top:v.top-(P-v.fontSize*(.07+v._fontSizeFraction))/v.lineHeight,strokeWidth:typeof g<"u"?g:1}),r(v)},i.Text.fromObject=function(e,r){var n=a(e),o=e.path;return delete n.path,i.Object._fromObject("Text",n,function(u){o?i.Object._fromObject("Path",o,function(s){u.set("path",s),r(u)},"path"):r(u)},"text")},i.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],i.util.createAccessors&&i.util.createAccessors(i.Text)}(A),function(){p.util.object.extend(p.Text.prototype,{isEmptyStyles:function(d){if(!this.styles||typeof d<"u"&&!this.styles[d])return!0;var i=typeof d>"u"?this.styles:{line:this.styles[d]};for(var a in i)for(var l in i[a])for(var e in i[a][l])return!1;return!0},styleHas:function(d,i){if(!this.styles||!d||d===""||typeof i<"u"&&!this.styles[i])return!1;var a=typeof i>"u"?this.styles:{0:this.styles[i]};for(var l in a)for(var e in a[l])if(typeof a[l][e][d]<"u")return!0;return!1},cleanStyle:function(d){if(!this.styles||!d||d==="")return!1;var i=this.styles,a=0,l,e,r=!0,n=0,o;for(var u in i){l=0;for(var s in i[u]){var o=i[u][s],h=o.hasOwnProperty(d);a++,h?(e?o[d]!==e&&(r=!1):e=o[d],o[d]===this[d]&&delete o[d]):r=!1,Object.keys(o).length!==0?l++:delete i[u][s]}l===0&&delete i[u]}for(var g=0;g<this._textLines.length;g++)n+=this._textLines[g].length;r&&a===n&&(this[d]=e,this.removeStyle(d))},removeStyle:function(d){if(!(!this.styles||!d||d==="")){var i=this.styles,a,l,e;for(l in i){a=i[l];for(e in a)delete a[e][d],Object.keys(a[e]).length===0&&delete a[e];Object.keys(a).length===0&&delete i[l]}}},_extendStyles:function(d,i){var a=this.get2DCursorLocation(d);this._getLineStyle(a.lineIndex)||this._setLineStyle(a.lineIndex),this._getStyleDeclaration(a.lineIndex,a.charIndex)||this._setStyleDeclaration(a.lineIndex,a.charIndex,{}),p.util.object.extend(this._getStyleDeclaration(a.lineIndex,a.charIndex),i)},get2DCursorLocation:function(d,i){typeof d>"u"&&(d=this.selectionStart);for(var a=i?this._unwrappedTextLines:this._textLines,l=a.length,e=0;e<l;e++){if(d<=a[e].length)return{lineIndex:e,charIndex:d};d-=a[e].length+this.missingNewlineOffset(e)}return{lineIndex:e-1,charIndex:a[e-1].length<d?a[e-1].length:d}},getSelectionStyles:function(d,i,a){typeof d>"u"&&(d=this.selectionStart||0),typeof i>"u"&&(i=this.selectionEnd||d);for(var l=[],e=d;e<i;e++)l.push(this.getStyleAtPosition(e,a));return l},getStyleAtPosition:function(d,i){var a=this.get2DCursorLocation(d),l=i?this.getCompleteStyleDeclaration(a.lineIndex,a.charIndex):this._getStyleDeclaration(a.lineIndex,a.charIndex);return l||{}},setSelectionStyles:function(d,i,a){typeof i>"u"&&(i=this.selectionStart||0),typeof a>"u"&&(a=this.selectionEnd||i);for(var l=i;l<a;l++)this._extendStyles(l,d);return this._forceClearCache=!0,this},_getStyleDeclaration:function(d,i){var a=this.styles&&this.styles[d];return a?a[i]:null},getCompleteStyleDeclaration:function(d,i){for(var a=this._getStyleDeclaration(d,i)||{},l={},e,r=0;r<this._styleProperties.length;r++)e=this._styleProperties[r],l[e]=typeof a[e]>"u"?this[e]:a[e];return l},_setStyleDeclaration:function(d,i,a){this.styles[d][i]=a},_deleteStyleDeclaration:function(d,i){delete this.styles[d][i]},_getLineStyle:function(d){return!!this.styles[d]},_setLineStyle:function(d){this.styles[d]={}},_deleteLineStyle:function(d){delete this.styles[d]}})}(),function(){function d(i){i.textDecoration&&(i.textDecoration.indexOf("underline")>-1&&(i.underline=!0),i.textDecoration.indexOf("line-through")>-1&&(i.linethrough=!0),i.textDecoration.indexOf("overline")>-1&&(i.overline=!0),delete i.textDecoration)}p.IText=p.util.createClass(p.Text,p.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(i,a){this.callSuper("initialize",i,a),this.initBehavior()},setSelectionStart:function(i){i=Math.max(i,0),this._updateAndFire("selectionStart",i)},setSelectionEnd:function(i){i=Math.min(i,this.text.length),this._updateAndFire("selectionEnd",i)},_updateAndFire:function(i,a){this[i]!==a&&(this._fireSelectionChanged(),this[i]=a),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(i){this.clearContextTop(),this.callSuper("render",i),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(i){this.callSuper("_render",i)},clearContextTop:function(i){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var a=this.canvas.contextTop,l=this.canvas.viewportTransform;a.save(),a.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this.transform(a),this._clearTextArea(a),i||a.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var i=this._getCursorBoundaries(),a=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(i,a):this.renderSelection(i,a),a.restore()}},_clearTextArea:function(i){var a=this.width+4,l=this.height+4;i.clearRect(-a/2,-l/2,a,l)},_getCursorBoundaries:function(i){typeof i>"u"&&(i=this.selectionStart);var a=this._getLeftOffset(),l=this._getTopOffset(),e=this._getCursorBoundariesOffsets(i);return{left:a,top:l,leftOffset:e.left,topOffset:e.top}},_getCursorBoundariesOffsets:function(i){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var a,l,e,r=0,n=0,o,u=this.get2DCursorLocation(i);e=u.charIndex,l=u.lineIndex;for(var s=0;s<l;s++)r+=this.getHeightOfLine(s);a=this._getLineLeftOffset(l);var h=this.__charBounds[l][e];return h&&(n=h.left),this.charSpacing!==0&&e===this._textLines[l].length&&(n-=this._getWidthOfCharSpacing()),o={top:r,left:a+(n>0?n:0)},this.direction==="rtl"&&(o.left*=-1),this.cursorOffsetCache=o,this.cursorOffsetCache},renderCursor:function(i,a){var l=this.get2DCursorLocation(),e=l.lineIndex,r=l.charIndex>0?l.charIndex-1:0,n=this.getValueOfPropertyAt(e,r,"fontSize"),o=this.scaleX*this.canvas.getZoom(),u=this.cursorWidth/o,s=i.topOffset,h=this.getValueOfPropertyAt(e,r,"deltaY");s+=(1-this._fontSizeFraction)*this.getHeightOfLine(e)/this.lineHeight-n*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(i,a),a.fillStyle=this.cursorColor||this.getValueOfPropertyAt(e,r,"fill"),a.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,a.fillRect(i.left+i.leftOffset-u/2,s+i.top+h,u,n)},renderSelection:function(i,a){for(var l=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,e=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,r=this.textAlign.indexOf("justify")!==-1,n=this.get2DCursorLocation(l),o=this.get2DCursorLocation(e),u=n.lineIndex,s=o.lineIndex,h=n.charIndex<0?0:n.charIndex,g=o.charIndex<0?0:o.charIndex,v=u;v<=s;v++){var _=this._getLineLeftOffset(v)||0,w=this.getHeightOfLine(v),C=0,P=0,D=0;if(v===u&&(P=this.__charBounds[u][h].left),v>=u&&v<s)D=r&&!this.isEndOfWrapping(v)?this.width:this.getLineWidth(v)||5;else if(v===s)if(g===0)D=this.__charBounds[s][g].left;else{var I=this._getWidthOfCharSpacing();D=this.__charBounds[s][g-1].left+this.__charBounds[s][g-1].width-I}C=w,(this.lineHeight<1||v===s&&this.lineHeight>1)&&(w/=this.lineHeight);var N=i.left+_+P,H=D-P,K=w,J=0;this.inCompositionMode?(a.fillStyle=this.compositionColor||"black",K=1,J=w):a.fillStyle=this.selectionColor,this.direction==="rtl"&&(N=this.width-N-H),a.fillRect(N,i.top+i.topOffset+J,H,K),i.topOffset+=C}},getCurrentCharFontSize:function(){var i=this._getCurrentCharIndex();return this.getValueOfPropertyAt(i.l,i.c,"fontSize")},getCurrentCharColor:function(){var i=this._getCurrentCharIndex();return this.getValueOfPropertyAt(i.l,i.c,"fill")},_getCurrentCharIndex:function(){var i=this.get2DCursorLocation(this.selectionStart,!0),a=i.charIndex>0?i.charIndex-1:0;return{l:i.lineIndex,c:a}}}),p.IText.fromObject=function(i,a){if(d(i),i.styles)for(var l in i.styles)for(var e in i.styles[l])d(i.styles[l][e]);p.Object._fromObject("IText",i,a,"text")}}(),function(){var d=p.util.object.clone;p.util.object.extend(p.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var i=this;this.on("added",function(){var a=i.canvas;a&&(a._hasITextHandlers||(a._hasITextHandlers=!0,i._initCanvasHandlers(a)),a._iTextInstances=a._iTextInstances||[],a._iTextInstances.push(i))})},initRemovedHandler:function(){var i=this;this.on("removed",function(){var a=i.canvas;a&&(a._iTextInstances=a._iTextInstances||[],p.util.removeFromArray(a._iTextInstances,i),a._iTextInstances.length===0&&(a._hasITextHandlers=!1,i._removeCanvasHandlers(a)))})},_initCanvasHandlers:function(i){i._mouseUpITextHandler=function(){i._iTextInstances&&i._iTextInstances.forEach(function(a){a.__isMousedown=!1})},i.on("mouse:up",i._mouseUpITextHandler)},_removeCanvasHandlers:function(i){i.off("mouse:up",i._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(i,a,l,e){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},i.animate("_currentCursorOpacity",a,{duration:l,onComplete:function(){r.isAborted||i[e]()},onChange:function(){i.canvas&&i.selectionStart===i.selectionEnd&&i.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var i=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){i._currentTickCompleteState=i._animateCursor(i,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(i){var a=this,l=i?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){a._tick()},l)},abortCursorAnimation:function(){var i=this._currentTickState||this._currentTickCompleteState,a=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,i&&a&&a.clearContext(a.contextTop||a.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(i){var a=0,l=i-1;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)a++,l--;for(;/\S/.test(this._text[l])&&l>-1;)a++,l--;return i-a},findWordBoundaryRight:function(i){var a=0,l=i;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)a++,l++;for(;/\S/.test(this._text[l])&&l<this._text.length;)a++,l++;return i+a},findLineBoundaryLeft:function(i){for(var a=0,l=i-1;!/\n/.test(this._text[l])&&l>-1;)a++,l--;return i-a},findLineBoundaryRight:function(i){for(var a=0,l=i;!/\n/.test(this._text[l])&&l<this._text.length;)a++,l++;return i+a},searchWordBoundary:function(i,a){for(var l=this._text,e=this._reSpace.test(l[i])?i-1:i,r=l[e],n=p.reNonWord;!n.test(r)&&e>0&&e<l.length;)e+=a,r=l[e];return n.test(r)&&(e+=a===1?0:1),e},selectWord:function(i){i=i||this.selectionStart;var a=this.searchWordBoundary(i,-1),l=this.searchWordBoundary(i,1);this.selectionStart=a,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(i){i=i||this.selectionStart;var a=this.findLineBoundaryLeft(i),l=this.findLineBoundaryRight(i);return this.selectionStart=a,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(i){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(i),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(i){i._iTextInstances&&i._iTextInstances.forEach(function(a){a.selected=!1,a.isEditing&&a.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(i){if(!(!this.__isMousedown||!this.isEditing)){var a=this.getSelectionStartFromPointer(i.e),l=this.selectionStart,e=this.selectionEnd;(a!==this.__selectionStartOnMouseDown||l===e)&&(l===a||e===a)||(a>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=a):(this.selectionStart=a,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==l||this.selectionEnd!==e)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(i,a,l){var e=l.slice(0,i),r=p.util.string.graphemeSplit(e).length;if(i===a)return{selectionStart:r,selectionEnd:r};var n=l.slice(i,a),o=p.util.string.graphemeSplit(n).length;return{selectionStart:r,selectionEnd:r+o}},fromGraphemeToStringSelection:function(i,a,l){var e=l.slice(0,i),r=e.join("").length;if(i===a)return{selectionStart:r,selectionEnd:r};var n=l.slice(i,a),o=n.join("").length;return{selectionStart:r,selectionEnd:r+o}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var i=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=i.selectionStart,this.hiddenTextarea.selectionEnd=i.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(!!this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var i=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=i.selectionEnd,this.inCompositionMode||(this.selectionStart=i.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var i=this._calcTextareaPosition();this.hiddenTextarea.style.left=i.left,this.hiddenTextarea.style.top=i.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var i=this.inCompositionMode?this.compositionStart:this.selectionStart,a=this._getCursorBoundaries(i),l=this.get2DCursorLocation(i),e=l.lineIndex,r=l.charIndex,n=this.getValueOfPropertyAt(e,r,"fontSize")*this.lineHeight,o=a.leftOffset,u=this.calcTransformMatrix(),s={x:a.left+o,y:a.top+a.topOffset+n},h=this.canvas.getRetinaScaling(),g=this.canvas.upperCanvasEl,v=g.width/h,_=g.height/h,w=v-n,C=_-n,P=g.clientWidth/v,D=g.clientHeight/_;return s=p.util.transformPoint(s,u),s=p.util.transformPoint(s,this.canvas.viewportTransform),s.x*=P,s.y*=D,s.x<0&&(s.x=0),s.x>w&&(s.x=w),s.y<0&&(s.y=0),s.y>C&&(s.y=C),s.x+=this.canvas._offset.left,s.y+=this.canvas._offset.top,{left:s.x+"px",top:s.y+"px",fontSize:n+"px",charHeight:n}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){!this._savedProps||(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var i=this._textBeforeEdit!==this.text,a=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,a&&(a.blur&&a.blur(),a.parentNode&&a.parentNode.removeChild(a)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),i&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),i&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var i in this.styles)this._textLines[i]||delete this.styles[i]},removeStyleFromTo:function(i,a){var l=this.get2DCursorLocation(i,!0),e=this.get2DCursorLocation(a,!0),r=l.lineIndex,n=l.charIndex,o=e.lineIndex,u=e.charIndex,s,h;if(r!==o){if(this.styles[r])for(s=n;s<this._unwrappedTextLines[r].length;s++)delete this.styles[r][s];if(this.styles[o])for(s=u;s<this._unwrappedTextLines[o].length;s++)h=this.styles[o][s],h&&(this.styles[r]||(this.styles[r]={}),this.styles[r][n+s-u]=h);for(s=r+1;s<=o;s++)delete this.styles[s];this.shiftLineStyles(o,r-o)}else if(this.styles[r]){h=this.styles[r];var g=u-n,v,_;for(s=n;s<u;s++)delete h[s];for(_ in this.styles[r])v=parseInt(_,10),v>=u&&(h[v-g]=h[_],delete h[_])}},shiftLineStyles:function(i,a){var l=d(this.styles);for(var e in this.styles){var r=parseInt(e,10);r>i&&(this.styles[r+a]=l[r],l[r-a]||delete this.styles[r])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(i,a,l,e){var r,n={},o=!1,u=this._unwrappedTextLines[i].length===a;l||(l=1),this.shiftLineStyles(i,l),this.styles[i]&&(r=this.styles[i][a===0?a:a-1]);for(var s in this.styles[i]){var h=parseInt(s,10);h>=a&&(o=!0,n[h-a]=this.styles[i][s],u&&a===0||delete this.styles[i][s])}var g=!1;for(o&&!u&&(this.styles[i+l]=n,g=!0),g&&l--;l>0;)e&&e[l-1]?this.styles[i+l]={0:d(e[l-1])}:r?this.styles[i+l]={0:d(r)}:delete this.styles[i+l],l--;this._forceClearCache=!0},insertCharStyleObject:function(i,a,l,e){this.styles||(this.styles={});var r=this.styles[i],n=r?d(r):{};l||(l=1);for(var o in n){var u=parseInt(o,10);u>=a&&(r[u+l]=n[u],n[u-l]||delete r[u])}if(this._forceClearCache=!0,e){for(;l--;)!Object.keys(e[l]).length||(this.styles[i]||(this.styles[i]={}),this.styles[i][a+l]=d(e[l]));return}if(!!r)for(var s=r[a?a-1:1];s&&l--;)this.styles[i][a+l]=d(s)},insertNewStyleBlock:function(i,a,l){for(var e=this.get2DCursorLocation(a,!0),r=[0],n=0,o=0;o<i.length;o++)i[o]===`
`?(n++,r[n]=0):r[n]++;r[0]>0&&(this.insertCharStyleObject(e.lineIndex,e.charIndex,r[0],l),l=l&&l.slice(r[0]+1)),n&&this.insertNewlineStyleObject(e.lineIndex,e.charIndex+r[0],n);for(var o=1;o<n;o++)r[o]>0?this.insertCharStyleObject(e.lineIndex+o,0,r[o],l):l&&this.styles[e.lineIndex+o]&&l[0]&&(this.styles[e.lineIndex+o][0]=l[0]),l=l&&l.slice(r[o]+1);r[o]>0&&this.insertCharStyleObject(e.lineIndex+o,0,r[o],l)},setSelectionStartEndWithShift:function(i,a,l){l<=i?(a===i?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=i),this.selectionStart=l):l>i&&l<a?this._selectionDirection==="right"?this.selectionEnd=l:this.selectionStart=l:(a===i?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=a),this.selectionEnd=l)},setSelectionInBoundaries:function(){var i=this.text.length;this.selectionStart>i?this.selectionStart=i:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>i?this.selectionEnd=i:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),p.util.object.extend(p.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(d){if(!!this.canvas){this.__newClickTime=+new Date;var i=d.pointer;this.isTripleClick(i)&&(this.fire("tripleclick",d),this._stopEvent(d.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=i,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(d){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y},_stopEvent:function(d){d.preventDefault&&d.preventDefault(),d.stopPropagation&&d.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(d){!this.isEditing||this.selectWord(this.getSelectionStartFromPointer(d.e))},tripleClickHandler:function(d){!this.isEditing||this.selectLine(this.getSelectionStartFromPointer(d.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(d){!this.canvas||!this.editable||d.e.button&&d.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(d.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(d){!this.canvas||!this.editable||d.e.button&&d.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(d){if(this.__isMousedown=!1,!(!this.editable||this.group||d.transform&&d.transform.actionPerformed||d.e.button&&d.e.button!==1)){if(this.canvas){var i=this.canvas._activeObject;if(i&&i!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(d.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(d){var i=this.getSelectionStartFromPointer(d),a=this.selectionStart,l=this.selectionEnd;d.shiftKey?this.setSelectionStartEndWithShift(a,l,i):(this.selectionStart=i,this.selectionEnd=i),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(d){for(var i=this.getLocalPointer(d),a=0,l=0,e=0,r=0,n=0,o,u,s=0,h=this._textLines.length;s<h&&e<=i.y;s++)e+=this.getHeightOfLine(s)*this.scaleY,n=s,s>0&&(r+=this._textLines[s-1].length+this.missingNewlineOffset(s-1));o=this._getLineLeftOffset(n),l=o*this.scaleX,u=this._textLines[n],this.direction==="rtl"&&(i.x=this.width*this.scaleX-i.x+l);for(var g=0,v=u.length;g<v&&(a=l,l+=this.__charBounds[n][g].kernedWidth*this.scaleX,l<=i.x);g++)r++;return this._getNewSelectionStartFromOffset(i,a,l,r,v)},_getNewSelectionStartFromOffset:function(d,i,a,l,e){var r=d.x-i,n=a-d.x,o=n>r||n<0?0:1,u=l+o;return this.flipX&&(u=e-u),u>this._text.length&&(u=this._text.length),u}}),p.util.object.extend(p.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=p.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var d=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+d.top+"; left: "+d.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uFF70top: "+d.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):p.document.body.appendChild(this.hiddenTextarea),p.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),p.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),p.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),p.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),p.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),p.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),p.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),p.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),p.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(p.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(d){if(!!this.isEditing){var i=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(d.keyCode in i)this[i[d.keyCode]](d);else if(d.keyCode in this.ctrlKeysMapDown&&(d.ctrlKey||d.metaKey))this[this.ctrlKeysMapDown[d.keyCode]](d);else return;d.stopImmediatePropagation(),d.preventDefault(),d.keyCode>=33&&d.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(d){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(d.keyCode in this.ctrlKeysMapUp&&(d.ctrlKey||d.metaKey))this[this.ctrlKeysMapUp[d.keyCode]](d);else return;d.stopImmediatePropagation(),d.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(d){var i=this.fromPaste;if(this.fromPaste=!1,d&&d.stopPropagation(),!!this.isEditing){var a=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,l=this._text.length,e=a.length,r,n,o=e-l,u=this.selectionStart,s=this.selectionEnd,h=u!==s,g,v,_;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var w=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),C=u>w.selectionStart;h?(r=this._text.slice(u,s),o+=s-u):e<l&&(C?r=this._text.slice(s+o,s):r=this._text.slice(u,u-o)),n=a.slice(w.selectionEnd-o,w.selectionEnd),r&&r.length&&(n.length&&(g=this.getSelectionStyles(u,u+1,!1),g=n.map(function(){return g[0]})),h?(v=u,_=s):C?(v=s-r.length,_=s):(v=s,_=s+r.length),this.removeStyleFromTo(v,_)),n.length&&(i&&n.join("")===p.copiedText&&!p.disableStyleCopyPaste&&(g=p.copiedTextStyle),this.insertNewStyleBlock(n,u,g)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(d){this.compositionStart=d.target.selectionStart,this.compositionEnd=d.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(p.copiedText=this.getSelectedText(),p.disableStyleCopyPaste?p.copiedTextStyle=null:p.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(d){return d&&d.clipboardData||p.window.clipboardData},_getWidthBeforeCursor:function(d,i){var a=this._getLineLeftOffset(d),l;return i>0&&(l=this.__charBounds[d][i-1],a+=l.left+l.width),a},getDownCursorOffset:function(d,i){var a=this._getSelectionForOffset(d,i),l=this.get2DCursorLocation(a),e=l.lineIndex;if(e===this._textLines.length-1||d.metaKey||d.keyCode===34)return this._text.length-a;var r=l.charIndex,n=this._getWidthBeforeCursor(e,r),o=this._getIndexOnLine(e+1,n),u=this._textLines[e].slice(r);return u.length+o+1+this.missingNewlineOffset(e)},_getSelectionForOffset:function(d,i){return d.shiftKey&&this.selectionStart!==this.selectionEnd&&i?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(d,i){var a=this._getSelectionForOffset(d,i),l=this.get2DCursorLocation(a),e=l.lineIndex;if(e===0||d.metaKey||d.keyCode===33)return-a;var r=l.charIndex,n=this._getWidthBeforeCursor(e,r),o=this._getIndexOnLine(e-1,n),u=this._textLines[e].slice(0,r),s=this.missingNewlineOffset(e-1);return-this._textLines[e-1].length+o-u.length+(1-s)},_getIndexOnLine:function(d,i){for(var a=this._textLines[d],l=this._getLineLeftOffset(d),e=l,r=0,n,o,u=0,s=a.length;u<s;u++)if(n=this.__charBounds[d][u].width,e+=n,e>i){o=!0;var h=e-n,g=e,v=Math.abs(h-i),_=Math.abs(g-i);r=_<v?u:u-1;break}return o||(r=a.length-1),r},moveCursorDown:function(d){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",d)},moveCursorUp:function(d){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",d)},_moveCursorUpOrDown:function(d,i){var a="get"+d+"CursorOffset",l=this[a](i,this._selectionDirection==="right");i.shiftKey?this.moveCursorWithShift(l):this.moveCursorWithoutShift(l),l!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(d){var i=this._selectionDirection==="left"?this.selectionStart+d:this.selectionEnd+d;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,i),d!==0},moveCursorWithoutShift:function(d){return d<0?(this.selectionStart+=d,this.selectionEnd=this.selectionStart):(this.selectionEnd+=d,this.selectionStart=this.selectionEnd),d!==0},moveCursorLeft:function(d){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",d)},_move:function(d,i,a){var l;if(d.altKey)l=this["findWordBoundary"+a](this[i]);else if(d.metaKey||d.keyCode===35||d.keyCode===36)l=this["findLineBoundary"+a](this[i]);else return this[i]+=a==="Left"?-1:1,!0;if(typeof l!==void 0&&this[i]!==l)return this[i]=l,!0},_moveLeft:function(d,i){return this._move(d,i,"Left")},_moveRight:function(d,i){return this._move(d,i,"Right")},moveCursorLeftWithoutShift:function(d){var i=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(i=this._moveLeft(d,"selectionStart")),this.selectionEnd=this.selectionStart,i},moveCursorLeftWithShift:function(d){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(d,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(d,"selectionStart")},moveCursorRight:function(d){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",d)},_moveCursorLeftOrRight:function(d,i){var a="moveCursor"+d+"With";this._currentCursorOpacity=1,i.shiftKey?a+="Shift":a+="outShift",this[a](i)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(d){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(d,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(d,"selectionEnd")},moveCursorRightWithoutShift:function(d){var i=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(i=this._moveRight(d,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,i},removeChars:function(d,i){typeof i>"u"&&(i=d+1),this.removeStyleFromTo(d,i),this._text.splice(d,i-d),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(d,i,a,l){typeof l>"u"&&(l=a),l>a&&this.removeStyleFromTo(a,l);var e=p.util.string.graphemeSplit(d);this.insertNewStyleBlock(e,a,i),this._text=[].concat(this._text.slice(0,a),e,this._text.slice(l)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var d=p.util.toFixed,i=/  +/g;p.util.object.extend(p.Text.prototype,{_toSVG:function(){var a=this._getSVGLeftTopOffsets(),l=this._getSVGTextAndBg(a.textTop,a.textLeft);return this._wrapSVGTextAndBg(l)},toSVG:function(a){return this._createBaseSVGMarkup(this._toSVG(),{reviver:a,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(a){var l=!0,e=this.getSvgTextDecoration(this);return[a.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",e?'text-decoration="'+e+'" ':"",'style="',this.getSvgStyles(l),'"',this.addPaintOrder()," >",a.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(a,l){var e=[],r=[],n=a,o;this._setSVGBg(r);for(var u=0,s=this._textLines.length;u<s;u++)o=this._getLineLeftOffset(u),(this.textBackgroundColor||this.styleHas("textBackgroundColor",u))&&this._setSVGTextLineBg(r,u,l+o,n),this._setSVGTextLineText(e,u,l+o,n),n+=this.getHeightOfLine(u);return{textSpans:e,textBgRects:r}},_createTextCharSpan:function(a,l,e,r){var n=a!==a.trim()||a.match(i),o=this.getSvgSpanStyles(l,n),u=o?'style="'+o+'"':"",s=l.deltaY,h="",g=p.Object.NUM_FRACTION_DIGITS;return s&&(h=' dy="'+d(s,g)+'" '),['<tspan x="',d(e,g),'" y="',d(r,g),'" ',h,u,">",p.util.string.escapeXml(a),"</tspan>"].join("")},_setSVGTextLineText:function(a,l,e,r){var n=this.getHeightOfLine(l),o=this.textAlign.indexOf("justify")!==-1,u,s,h="",g,v,_=0,w=this._textLines[l],C;r+=n*(1-this._fontSizeFraction)/this.lineHeight;for(var P=0,D=w.length-1;P<=D;P++)C=P===D||this.charSpacing,h+=w[P],g=this.__charBounds[l][P],_===0?(e+=g.kernedWidth-g.width,_+=g.width):_+=g.kernedWidth,o&&!C&&this._reSpaceAndTab.test(w[P])&&(C=!0),C||(u=u||this.getCompleteStyleDeclaration(l,P),s=this.getCompleteStyleDeclaration(l,P+1),C=this._hasStyleChangedForSvg(u,s)),C&&(v=this._getStyleDeclaration(l,P)||{},a.push(this._createTextCharSpan(h,v,e,r)),h="",u=s,e+=_,_=0)},_pushTextBgRect:function(a,l,e,r,n,o){var u=p.Object.NUM_FRACTION_DIGITS;a.push("		<rect ",this._getFillAttributes(l),' x="',d(e,u),'" y="',d(r,u),'" width="',d(n,u),'" height="',d(o,u),`"></rect>
`)},_setSVGTextLineBg:function(a,l,e,r){for(var n=this._textLines[l],o=this.getHeightOfLine(l)/this.lineHeight,u=0,s=0,h,g,v=this.getValueOfPropertyAt(l,0,"textBackgroundColor"),_=0,w=n.length;_<w;_++)h=this.__charBounds[l][_],g=this.getValueOfPropertyAt(l,_,"textBackgroundColor"),g!==v?(v&&this._pushTextBgRect(a,v,e+s,r,u,o),s=h.left,u=h.width,v=g):u+=h.kernedWidth;g&&this._pushTextBgRect(a,g,e+s,r,u,o)},_getFillAttributes:function(a){var l=a&&typeof a=="string"?new p.Color(a):"";return!l||!l.getSource()||l.getAlpha()===1?'fill="'+a+'"':'opacity="'+l.getAlpha()+'" fill="'+l.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(a){for(var l=0,e=0,r=0;r<a;r++)l+=this.getHeightOfLine(r);return e=this.getHeightOfLine(r),{lineTop:l,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(a){var l=p.Object.prototype.getSvgStyles.call(this,a);return l+" white-space: pre;"}})}(),function(d){var i=d.fabric||(d.fabric={});i.Textbox=i.util.createClass(i.IText,i.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:i.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(a){for(var l=0,e=0,r=0,n={},o=0;o<a.graphemeLines.length;o++)a.graphemeText[r]===`
`&&o>0?(e=0,r++,l++):!this.splitByGrapheme&&this._reSpaceAndTab.test(a.graphemeText[r])&&o>0&&(e++,r++),n[o]={line:l,offset:e},r+=a.graphemeLines[o].length,e+=a.graphemeLines[o].length;return n},styleHas:function(a,l){if(this._styleMap&&!this.isWrapping){var e=this._styleMap[l];e&&(l=e.line)}return i.Text.prototype.styleHas.call(this,a,l)},isEmptyStyles:function(a){if(!this.styles)return!0;var l=0,e=a+1,r,n,o=!1,u=this._styleMap[a],s=this._styleMap[a+1];u&&(a=u.line,l=u.offset),s&&(e=s.line,o=e===a,r=s.offset),n=typeof a>"u"?this.styles:{line:this.styles[a]};for(var h in n)for(var g in n[h])if(g>=l&&(!o||g<r))for(var v in n[h][g])return!1;return!0},_getStyleDeclaration:function(a,l){if(this._styleMap&&!this.isWrapping){var e=this._styleMap[a];if(!e)return null;a=e.line,l=e.offset+l}return this.callSuper("_getStyleDeclaration",a,l)},_setStyleDeclaration:function(a,l,e){var r=this._styleMap[a];a=r.line,l=r.offset+l,this.styles[a][l]=e},_deleteStyleDeclaration:function(a,l){var e=this._styleMap[a];a=e.line,l=e.offset+l,delete this.styles[a][l]},_getLineStyle:function(a){var l=this._styleMap[a];return!!this.styles[l.line]},_setLineStyle:function(a){var l=this._styleMap[a];this.styles[l.line]={}},_wrapText:function(a,l){var e=[],r;for(this.isWrapping=!0,r=0;r<a.length;r++)e=e.concat(this._wrapLine(a[r],r,l));return this.isWrapping=!1,e},_measureWord:function(a,l,e){var r=0,n,o=!0;e=e||0;for(var u=0,s=a.length;u<s;u++){var h=this._getGraphemeBox(a[u],l,u+e,n,o);r+=h.kernedWidth,n=a[u]}return r},_wrapLine:function(a,l,e,N){var n=0,o=this.splitByGrapheme,u=[],s=[],h=o?i.util.string.graphemeSplit(a):a.split(this._wordJoiners),g="",v=0,_=o?"":" ",w=0,C=0,P=0,D=!0,I=this._getWidthOfCharSpacing(),N=N||0;h.length===0&&h.push([]),e-=N;for(var H=0;H<h.length;H++)g=o?h[H]:i.util.string.graphemeSplit(h[H]),w=this._measureWord(g,l,v),v+=g.length,n+=C+w-I,n>e&&!D?(u.push(s),s=[],n=w,D=!0):n+=I,!D&&!o&&s.push(_),s=s.concat(g),C=o?0:this._measureWord([_],l,v),v++,D=!1,w>P&&(P=w);return H&&u.push(s),P+N>this.dynamicMinWidth&&(this.dynamicMinWidth=P-I+N),u},isEndOfWrapping:function(a){return!this._styleMap[a+1]||this._styleMap[a+1].line!==this._styleMap[a].line},missingNewlineOffset:function(a){return this.splitByGrapheme?this.isEndOfWrapping(a)?1:0:1},_splitTextIntoLines:function(a){for(var l=i.Text.prototype._splitTextIntoLines.call(this,a),e=this._wrapText(l.lines,this.width),r=new Array(e.length),n=0;n<e.length;n++)r[n]=e[n].join("");return l.lines=r,l.graphemeLines=e,l},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var a={};for(var l in this._styleMap)this._textLines[l]&&(a[this._styleMap[l].line]=1);for(var l in this.styles)a[l]||delete this.styles[l]},toObject:function(a){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(a))}}),i.Textbox.fromObject=function(a,l){return i.Object._fromObject("Textbox",a,l,"text")}}(A),function(){var d=p.controlsUtils,i=d.scaleSkewCursorStyleHandler,a=d.scaleCursorStyleHandler,l=d.scalingEqually,e=d.scalingYOrSkewingX,r=d.scalingXOrSkewingY,n=d.scaleOrSkewActionName,o=p.Object.prototype.controls;if(o.ml=new p.Control({x:-.5,y:0,cursorStyleHandler:i,actionHandler:r,getActionName:n}),o.mr=new p.Control({x:.5,y:0,cursorStyleHandler:i,actionHandler:r,getActionName:n}),o.mb=new p.Control({x:0,y:.5,cursorStyleHandler:i,actionHandler:e,getActionName:n}),o.mt=new p.Control({x:0,y:-.5,cursorStyleHandler:i,actionHandler:e,getActionName:n}),o.tl=new p.Control({x:-.5,y:-.5,cursorStyleHandler:a,actionHandler:l}),o.tr=new p.Control({x:.5,y:-.5,cursorStyleHandler:a,actionHandler:l}),o.bl=new p.Control({x:-.5,y:.5,cursorStyleHandler:a,actionHandler:l}),o.br=new p.Control({x:.5,y:.5,cursorStyleHandler:a,actionHandler:l}),o.mtr=new p.Control({x:0,y:-.5,actionHandler:d.rotationWithSnapping,cursorStyleHandler:d.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),p.Textbox){var u=p.Textbox.prototype.controls={};u.mtr=o.mtr,u.tr=o.tr,u.br=o.br,u.tl=o.tl,u.bl=o.bl,u.mt=o.mt,u.mb=o.mb,u.mr=new p.Control({x:.5,y:0,actionHandler:d.changeWidth,cursorStyleHandler:i,actionName:"resizing"}),u.ml=new p.Control({x:-.5,y:0,actionHandler:d.changeWidth,cursorStyleHandler:i,actionName:"resizing"})}}()})(se);se.fabric.textureSize=4096;se.fabric.Image.filters.Vignette=se.fabric.util.createClass(se.fabric.Image.filters.BaseFilter,{type:"Vignette",radius:.1,smoothness:.5,mainParameter:"radius",fragmentSource:`
      precision highp float;
      uniform sampler2D uTexture;
      uniform float uRadius;
      uniform float uSmoothness;
      varying vec2 vTexCoord;
      float vignette(vec2 uv, float radius, float smoothness) {
      float diff = radius - distance(uv, vec2(0.5, 0.5));
      return smoothstep(-smoothness, smoothness, diff);
      }
      void main() {
      vec2 p = -1.0 + 2.0 * vTexCoord;
      float r = 1.0 - uRadius;
      float vignetteValue = vignette(vTexCoord, r, uSmoothness);
      vec4 color = vec4(texture2D(uTexture, vTexCoord).rgb ,vignetteValue);
      gl_FragColor = color;
      }`,applyTo2d:A=>{const p=A.imageData,y=p.length;let b;for(b=0;b<y;b+=4)p[b+1]=0,p[b+2]=0},getUniformLocations:(A,p)=>({uRadius:A.getUniformLocation(p,"uRadius"),uSmoothness:A.getUniformLocation(p,"uSmoothness")}),sendUniformData:function(A,p){A.uniform1f(p.uRadius,this.radius),A.uniform1f(p.uSmoothness,this.smoothness)}});se.fabric.Image.filters.Vignette.fromObject=se.fabric.Image.filters.BaseFilter.fromObject;var tl=20,el=1,Re=1e6,Br=1e6,il=-7,nl=21,rl=!1,wi="[big.js] ",Be=wi+"Invalid ",Yi=Be+"decimal places",sl=Be+"rounding mode",Nr=wi+"Division by zero",Nt={},ue=void 0,ol=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function zr(){function A(p){var y=this;if(!(y instanceof A))return p===ue?zr():new A(p);if(p instanceof A)y.s=p.s,y.e=p.e,y.c=p.c.slice();else{if(typeof p!="string"){if(A.strict===!0&&typeof p!="bigint")throw TypeError(Be+"value");p=p===0&&1/p<0?"-0":String(p)}al(y,p)}y.constructor=A}return A.prototype=Nt,A.DP=tl,A.RM=el,A.NE=il,A.PE=nl,A.strict=rl,A.roundDown=0,A.roundHalfUp=1,A.roundHalfEven=2,A.roundUp=3,A}function al(A,p){var y,b,S;if(!ol.test(p))throw Error(Be+"number");for(A.s=p.charAt(0)=="-"?(p=p.slice(1),-1):1,(y=p.indexOf("."))>-1&&(p=p.replace(".","")),(b=p.search(/e/i))>0?(y<0&&(y=b),y+=+p.slice(b+1),p=p.substring(0,b)):y<0&&(y=p.length),S=p.length,b=0;b<S&&p.charAt(b)=="0";)++b;if(b==S)A.c=[A.e=0];else{for(;S>0&&p.charAt(--S)=="0";);for(A.e=y-b-1,A.c=[],y=0;b<=S;)A.c[y++]=+p.charAt(b++)}return A}function je(A,p,y,b){var S=A.c;if(y===ue&&(y=A.constructor.RM),y!==0&&y!==1&&y!==2&&y!==3)throw Error(sl);if(p<1)b=y===3&&(b||!!S[0])||p===0&&(y===1&&S[0]>=5||y===2&&(S[0]>5||S[0]===5&&(b||S[1]!==ue))),S.length=1,b?(A.e=A.e-p+1,S[0]=1):S[0]=A.e=0;else if(p<S.length){if(b=y===1&&S[p]>=5||y===2&&(S[p]>5||S[p]===5&&(b||S[p+1]!==ue||S[p-1]&1))||y===3&&(b||!!S[0]),S.length=p,b){for(;++S[--p]>9;)if(S[p]=0,p===0){++A.e,S.unshift(1);break}}for(p=S.length;!S[--p];)S.pop()}return A}function Je(A,p,y){var b=A.e,S=A.c.join(""),E=S.length;if(p)S=S.charAt(0)+(E>1?"."+S.slice(1):"")+(b<0?"e":"e+")+b;else if(b<0){for(;++b;)S="0"+S;S="0."+S}else if(b>0)if(++b>E)for(b-=E;b--;)S+="0";else b<E&&(S=S.slice(0,b)+"."+S.slice(b));else E>1&&(S=S.charAt(0)+"."+S.slice(1));return A.s<0&&y?"-"+S:S}Nt.abs=function(){var A=new this.constructor(this);return A.s=1,A};Nt.cmp=function(A){var p,y=this,b=y.c,S=(A=new y.constructor(A)).c,E=y.s,M=A.s,d=y.e,i=A.e;if(!b[0]||!S[0])return b[0]?E:S[0]?-M:0;if(E!=M)return E;if(p=E<0,d!=i)return d>i^p?1:-1;for(M=(d=b.length)<(i=S.length)?d:i,E=-1;++E<M;)if(b[E]!=S[E])return b[E]>S[E]^p?1:-1;return d==i?0:d>i^p?1:-1};Nt.div=function(A){var p=this,y=p.constructor,b=p.c,S=(A=new y(A)).c,E=p.s==A.s?1:-1,M=y.DP;if(M!==~~M||M<0||M>Re)throw Error(Yi);if(!S[0])throw Error(Nr);if(!b[0])return A.s=E,A.c=[A.e=0],A;var d,i,a,l,e,r=S.slice(),n=d=S.length,o=b.length,u=b.slice(0,d),s=u.length,h=A,g=h.c=[],v=0,_=M+(h.e=p.e-A.e)+1;for(h.s=E,E=_<0?0:_,r.unshift(0);s++<d;)u.push(0);do{for(a=0;a<10;a++){if(d!=(s=u.length))l=d>s?1:-1;else for(e=-1,l=0;++e<d;)if(S[e]!=u[e]){l=S[e]>u[e]?1:-1;break}if(l<0){for(i=s==d?S:r;s;){if(u[--s]<i[s]){for(e=s;e&&!u[--e];)u[e]=9;--u[e],u[s]+=10}u[s]-=i[s]}for(;!u[0];)u.shift()}else break}g[v++]=l?a:++a,u[0]&&l?u[s]=b[n]||0:u=[b[n]]}while((n++<o||u[0]!==ue)&&E--);return!g[0]&&v!=1&&(g.shift(),h.e--,_--),v>_&&je(h,_,y.RM,u[0]!==ue),h};Nt.eq=function(A){return this.cmp(A)===0};Nt.gt=function(A){return this.cmp(A)>0};Nt.gte=function(A){return this.cmp(A)>-1};Nt.lt=function(A){return this.cmp(A)<0};Nt.lte=function(A){return this.cmp(A)<1};Nt.minus=Nt.sub=function(A){var p,y,b,S,E=this,M=E.constructor,d=E.s,i=(A=new M(A)).s;if(d!=i)return A.s=-i,E.plus(A);var a=E.c.slice(),l=E.e,e=A.c,r=A.e;if(!a[0]||!e[0])return e[0]?A.s=-i:a[0]?A=new M(E):A.s=1,A;if(d=l-r){for((S=d<0)?(d=-d,b=a):(r=l,b=e),b.reverse(),i=d;i--;)b.push(0);b.reverse()}else for(y=((S=a.length<e.length)?a:e).length,d=i=0;i<y;i++)if(a[i]!=e[i]){S=a[i]<e[i];break}if(S&&(b=a,a=e,e=b,A.s=-A.s),(i=(y=e.length)-(p=a.length))>0)for(;i--;)a[p++]=0;for(i=p;y>d;){if(a[--y]<e[y]){for(p=y;p&&!a[--p];)a[p]=9;--a[p],a[y]+=10}a[y]-=e[y]}for(;a[--i]===0;)a.pop();for(;a[0]===0;)a.shift(),--r;return a[0]||(A.s=1,a=[r=0]),A.c=a,A.e=r,A};Nt.mod=function(A){var p,y=this,b=y.constructor,S=y.s,E=(A=new b(A)).s;if(!A.c[0])throw Error(Nr);return y.s=A.s=1,p=A.cmp(y)==1,y.s=S,A.s=E,p?new b(y):(S=b.DP,E=b.RM,b.DP=b.RM=0,y=y.div(A),b.DP=S,b.RM=E,this.minus(y.times(A)))};Nt.neg=function(){var A=new this.constructor(this);return A.s=-A.s,A};Nt.plus=Nt.add=function(A){var p,y,b,S=this,E=S.constructor;if(A=new E(A),S.s!=A.s)return A.s=-A.s,S.minus(A);var M=S.e,d=S.c,i=A.e,a=A.c;if(!d[0]||!a[0])return a[0]||(d[0]?A=new E(S):A.s=S.s),A;if(d=d.slice(),p=M-i){for(p>0?(i=M,b=a):(p=-p,b=d),b.reverse();p--;)b.push(0);b.reverse()}for(d.length-a.length<0&&(b=a,a=d,d=b),p=a.length,y=0;p;d[p]%=10)y=(d[--p]=d[p]+a[p]+y)/10|0;for(y&&(d.unshift(y),++i),p=d.length;d[--p]===0;)d.pop();return A.c=d,A.e=i,A};Nt.pow=function(A){var p=this,y=new p.constructor("1"),b=y,S=A<0;if(A!==~~A||A<-Br||A>Br)throw Error(Be+"exponent");for(S&&(A=-A);A&1&&(b=b.times(p)),A>>=1,!!A;)p=p.times(p);return S?y.div(b):b};Nt.prec=function(A,p){if(A!==~~A||A<1||A>Re)throw Error(Be+"precision");return je(new this.constructor(this),A,p)};Nt.round=function(A,p){if(A===ue)A=0;else if(A!==~~A||A<-Re||A>Re)throw Error(Yi);return je(new this.constructor(this),A+this.e+1,p)};Nt.sqrt=function(){var A,p,y,b=this,S=b.constructor,E=b.s,M=b.e,d=new S("0.5");if(!b.c[0])return new S(b);if(E<0)throw Error(wi+"No square root");E=Math.sqrt(b+""),E===0||E===1/0?(p=b.c.join(""),p.length+M&1||(p+="0"),E=Math.sqrt(p),M=((M+1)/2|0)-(M<0||M&1),A=new S((E==1/0?"5e":(E=E.toExponential()).slice(0,E.indexOf("e")+1))+M)):A=new S(E+""),M=A.e+(S.DP+=4);do y=A,A=d.times(y.plus(b.div(y)));while(y.c.slice(0,M).join("")!==A.c.slice(0,M).join(""));return je(A,(S.DP-=4)+A.e+1,S.RM)};Nt.times=Nt.mul=function(A){var p,y=this,b=y.constructor,S=y.c,E=(A=new b(A)).c,M=S.length,d=E.length,i=y.e,a=A.e;if(A.s=y.s==A.s?1:-1,!S[0]||!E[0])return A.c=[A.e=0],A;for(A.e=i+a,M<d&&(p=S,S=E,E=p,a=M,M=d,d=a),p=new Array(a=M+d);a--;)p[a]=0;for(i=d;i--;){for(d=0,a=M+i;a>i;)d=p[a]+E[i]*S[a-i-1]+d,p[a--]=d%10,d=d/10|0;p[a]=d}for(d?++A.e:p.shift(),i=p.length;!p[--i];)p.pop();return A.c=p,A};Nt.toExponential=function(A,p){var y=this,b=y.c[0];if(A!==ue){if(A!==~~A||A<0||A>Re)throw Error(Yi);for(y=je(new y.constructor(y),++A,p);y.c.length<A;)y.c.push(0)}return Je(y,!0,!!b)};Nt.toFixed=function(A,p){var y=this,b=y.c[0];if(A!==ue){if(A!==~~A||A<0||A>Re)throw Error(Yi);for(y=je(new y.constructor(y),A+y.e+1,p),A=A+y.e+1;y.c.length<A;)y.c.push(0)}return Je(y,!1,!!b)};Nt[Symbol.for("nodejs.util.inspect.custom")]=Nt.toJSON=Nt.toString=function(){var A=this,p=A.constructor;return Je(A,A.e<=p.NE||A.e>=p.PE,!!A.c[0])};Nt.toNumber=function(){var A=Number(Je(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(A.toString()))throw Error(wi+"Imprecise conversion");return A};Nt.toPrecision=function(A,p){var y=this,b=y.constructor,S=y.c[0];if(A!==ue){if(A!==~~A||A<1||A>Re)throw Error(Be+"precision");for(y=je(new b(y),A,p);y.c.length<A;)y.c.push(0)}return Je(y,A<=y.e||y.e<=b.NE||y.e>=b.PE,!!S)};Nt.valueOf=function(){var A=this,p=A.constructor;if(p.strict===!0)throw Error(wi+"valueOf disallowed");return Je(A,A.e<=p.NE||A.e>=p.PE,!0)};var Ze=zr();se.fabric.Object.NUM_FRACTION_DIGITS=100;se.fabric.Object.prototype.objectCaching=!1;Ze.DP=100;const Ln=new se.fabric.Image.filters.Vignette({radius:Bt.vignette_radius,smoothness:Bt.vignette_smoothness});class ll{constructor(p){const y=this;y._el_container=p,y._images=Hr,y.init().catch(console.error)}async init(){const p=this;p.build(),p.initBinds(),p.initAutoSave(),p.initWakeLock(),p.initOpacityOnDrag(),p.initZoom(),p.lock(),p.render()}initWakeLock(){const p=this;document.addEventListener("visibilitychange",async()=>{try{document.visibilityState==="visible"&&await p.wakeLockEnable()}catch(y){console.warn(y)}}),p.wakeLockEnable().catch(console.warn)}initBinds(){const p=this;p.handleZoom=p.handleZoom.bind(p)}initZoom(){const p=this;p._canvas.on("mouse:wheel",p.handleZoom)}initOpacityOnDrag(){const y=this._canvas;y.on({"object:moving":b,"object:scaling":b,"object:modified":()=>{y.forEachObject(S=>{S.opacity=1})}});function b(S){let E=!1;y.forEachObject(M=>{if(!E)M===S.target?(M.opacity=1,E=!0):M.opacity=.5;else switch(M.opacity=.5,S.transform.action){}})}}initAutoSave(){const p=this;p._canvas.on("object:modified",async y=>{var b;try{if(p.locked){console.warn("Can't save in lock mode");return}const S=(b=y.target)==null?void 0:b.id,E=await p._images.getItem(S);E.s=y.target.scaleX,E.h=y.target.height,E.w=y.target.width,E.x=y.target.left,E.y=y.target.top,E.t=Date.now(),await p._images.updateItem(S,E),await p.updateLimits()}catch(S){console.error(S)}})}async wakeLockEnable(){const p=this,y="wakeLock"in navigator;p._wake_lock&&to.wakeLockDisable(),y?(p._wake_lock=await navigator.wakeLock.request("screen"),p._wake_lock.addEventListener("release",()=>{delete p._wake_lock})):alert("WakeLock API not available : recording can be interrupted by sleep mode. Use Chromium based browser to avoid that.")}wakeLockDisable(){const p=this;p._wake_lock&&(p._wake_lock.release(),delete p._wake_lock)}setTitle(p){document.title=p||Bt.pageTitle}setProgress(p){const y=this,b=p>0?`${y._recording?"\u{1F534}":"\u25B6\uFE0F"}${Math.ceil(p*100*100)/100}`:null;y.setTitle(b)}get width(){return this._canvas.width}get height(){return this._canvas.height}setCenterZoomAnim(p){this._center_zoom_anim=p||Bt.center_zoom_anim}get centerZoomAnim(){return this._center_zoom_anim||Bt.center_zoom_anim}render(){this._canvas.discardActiveObject().renderAll()}lock(){this._locked=!0}get locked(){return this._locked}unlock(){this._locked=!1}editFirst(){const p=this;p._curr=p._n,p.editStep(p._curr)}editNext(){const p=this;p.unlock(),p._curr--,p._curr<0&&(p._curr=p._n-1),p.editStep(p._curr)}editPrevious(){const p=this;p._curr++,p._curr>p._n&&(p._curr=0),p.editStep(p._curr)}editLast(){const p=this;p._curr=0,p.editStep(p._curr)}editStep(p){const y=this,b=Bt.ratio;(y._animate||y._recording)&&alert("Editing is not possible during animation"),y.unlock();let S;typeof p<"u"&&p>-1&&p<y._n&&(y._curr=p),y._canvas.forEachObject((E,M)=>{M===y._curr-1&&(S=E)}),S&&(y._canvas.forEachObject((E,M)=>{if(M===y._curr)if(S.timestamp)y.zoomToObject(S);else{const d=y.zoom;y._canvas.setZoom(1);const i=E?E.getScaledWidth():y._w,a=E?E.getScaledHeight():y._h,l=E?E.top:0,e=E?E.left:0;S.scaleToWidth(i*b),S.scaleToHeight(a*b),S.set("top",l-a/3),S.set("left",e-i/3),y._canvas.setZoom(d)}E.set("selectable",!1),E.set("visible",!1),M==y._curr&&E.set("visible",!0)}),S.set("selectable",!0),S.set("visible",!0),y.render())}editEnd(){const p=this;p._canvas.forEachObject(y=>{y.set("visible",!0),y.set("selectable",!1)}),p.lock(),p.zoomToOrigin()}build(){const p=this;p._w=Bt.width,p._h=Bt.height,p._el_canvas=Ee("canvas",{class:"zo--canvas",style:{width:`${p._w}px`,height:`${p._h}px`}}),p._el_container.style.backgroundColor=Bt.background,p._el_container.appendChild(p._el_canvas),p._canvas=new se.fabric.Canvas(p._el_canvas,{preserveObjectStacking:!0}),p._canvas.setHeight(p._h),p._canvas.setWidth(p._w),p._el_canvas.parentElement.classList.add("zo--editor")}parse(p){try{return JSON.parse(p)}catch{return!1}}async updateVignette(p){const y=this;p=Object.assign({radius:Bt.vignette_radius,smoothness:Bt.vignette_smoothness},p),Ln.radius=p.radius,Ln.smoothness=p.smoothness;const b=y._canvas.getObjects();for(const S of b)S.applyFilters();y.render()}async updateLimits(){const p=this,y=await p.getStoreImagesStats();p._zoom_min_max={min:p._canvas.width/y.maxWidth,max:p._canvas.width/y.minWidth},p._n=y.n,p.setCenterZoomAnim(y==null?void 0:y.center)}setZoom(p){const y=this;y._canvas.zoomToPoint({x:y.centerZoomAnim.x,y:y.centerZoomAnim.y},p)}get zoom(){return this._canvas.getZoom()}getZoomMinMaxCache(){return this._zoom_min_max||{}}zoomToOrigin(){const p=this;p._canvas.absolutePan({x:0,y:0}),p._canvas.setZoom(1)}panToObjectId(p){const y=this;y.panToObject(y.getObjectById(p))}panToObject(p,y){const b=this,S=b._canvas,E=y||b._canvas.getZoom(),M=S.getWidth(),d=S.getHeight(),i=p.getScaledHeight(),a=p.getScaledWidth(),l={x:p.aCoords.tl.x,y:p.aCoords.tl.y},e=(M/E/2-l.x-a/2)*E,r=(d/E/2-l.y-i/2)*E;return S.setViewportTransform([E,0,0,E,e,r]),{x:e,y:r}}zoomToObject(p,y){const b=this,S=y||b._canvas.width/p.getScaledWidth();b.panToObject(p,S);const E={x:b._canvas.width/2,y:b._canvas.height/2};b._canvas.zoomToPoint(E,S)}zoomToObjectId(p,y){const b=this,S=b.getObjectById(p);b.zoomToObject(S,y)}zoomToLargest(){const p=this,y=p.getObjectLargest();y&&p.zoomToObject(y)}zoomToSmallest(){const p=this,y=p.getObjectSmallest();y&&p.zoomToObject(y)}async record(){const p=this;if(!Ra()){alert("WebCodeds not supported in this browser");return}return p.play(!0)}async play(p){const y=this;try{const b=Bt,S=[];if(y._animate){y.stop();return}if(y.setProgress(0),y._animate=!0,y._recording=!!p,y._mp4_encoder=null,y._animate_steps_n=b.duration*b.framerate,(await y.getStoreImagesStats()).nMissingConf>0){alert("The animation is not fully configured (apparently).Use Toolbox -> edit.");return}if(y._recording){if(!confirm("Recording can use a lot of ressources. Continue?"))return;const d=await Fa();y._mp4_encoder=d.createWebCodecsEncoder({width:b.width*window.devicePixelRatio,height:b.height*window.devicePixelRatio,fps:b.framerate,bitrate:b.bitrate})}if(b.reverse)for(let M=y._animate_steps_n;M>=0;M--){const d=M/y._animate_steps_n,i=y._big_step(d).toPrecision();S.push({percent:1-d,zoom:i})}else for(let M=0;M<=y._animate_steps_n;M++){const d=M/y._animate_steps_n,i=y._big_step(d).toPrecision();S.push({percent:d,zoom:i})}for(const M of S)!y._animate||(await y._animate_step(M),await y.nextFrame());y._recording&&await y.save()}catch(b){console.error(b)}finally{y.stop(),y.setProgress(-1),delete y._mp4_encoder}}async save(){const p=this;if(p._recording&&p._mp4_encoder){const y=await p._mp4_encoder.end(),b=new Blob([y]);switch(Bt.video_export){case"download":cl(b,"zoomoot.mp4");break;case"open":ul(b);break;default:hl(b)}}}stop(){const p=this;p._animate=!1,p._recording&&(delete p._mp4_encoder,p._recording=!1)}_big_step(p){const y=this,b=y._big_ease(p);return y._big_zoom(b)}_big_ease(p){const y=this,b=Ze(1),S=-(Math.cos(Math.PI*p)-1)/2,E=Ze(Math.pow(y._n||20,-10*S));return b.minus(E)}_big_zoom(p){const y=this,b=y.getZoomMinMaxCache(),S=Ze(b.max),E=Ze(b.min);return y._big_linrp(S,E,p)}_big_linrp(p,y,b){const S=Ze(1);return p.times(S.minus(b)).plus(y.times(b))}async _animate_step(p){const y=this;if(!p||!y._animate){console.warn("No step to animate :/");return}if(y.setZoom(p.zoom),y.setProgress(p.percent),y._recording){const b=await createImageBitmap(y._el_canvas);await y._mp4_encoder.addFrame(b)}}handleZoom(p){const y=this,b=y.getZoomMinMaxCache();if(y._recording)return;y._animate&&y.stop();let S=p.e.deltaY,E=y.zoom;E*=.999**S;const M=y.locked?y.centerZoomAnim.x:p.e.offsetX,d=y.locked?y.centerZoomAnim.y:p.e.offsetY;y.locked&&(E>b.max&&(E=b.max),E<b.min&&(E=b.min)),E>0&&E<1/0&&y._canvas.zoomToPoint({x:M,y:d},E),p.e.preventDefault(),p.e.stopPropagation()}async reset(){const p=this;try{if(!confirm("Reset all iamge ? Changes will be lost"))return;const b=await p.getStoreImages();for(const S of b)S.s=1,S.x=Bt.width/2-S.w/2,S.y=Bt.height/2-S.h/2,S.t=null,await p._images.updateItem(S.id,S);p.clear(),await p.addImagesFromStore(),await p.updateLimits(),p.zoom(1)}catch{}}getObjectById(p){const b=this._canvas.getObjects();for(const S of b)if(S.id===p)return S}toggleBorders(){const p=this,y=p._canvas.getObjects(),b=p._show_border;for(const S of y)S.set("strokeWidth",b?0:5);p._show_border=!0}getObjectLargest(){const y=this._canvas.getObjects();let b;for(const S of y){if(!b){b=S;continue}S.width*S.scaleX>b.width*b.scaleX&&(b=S)}return b}getObjectSmallest(){const y=this._canvas.getObjects();let b;for(const S of y){if(!b){b=S;continue}S.width*S.scaleX<b.width*b.scaleX&&(b=S)}return b}async removeObject(p){const y=this;y.clearCache();const b=y.getObjectById(p);b&&(y._canvas.remove(b),await y.updateLimits(),y.zoomToLargest(),y.render())}async getStoreImagesStats(){return this._images.getStats()}async getStoreImagesLength(){return this._images.length()}async addImage(p,y,b){var M;const S=this,E=await S.createImage(p);S.clearCache(),E.scale(1),E.set(y),E.setControlsVisibility({mtr:!1,mt:!1,mb:!1,ml:!1,mr:!1}),y!=null&&y.id&&await S.removeObject(y.id),S._canvas.add(E),y.filters&&((M=y.filters)==null?void 0:M.length)>0&&E.applyFilters(),b||await S.updateLimits()}async createImage(p){return new Promise(y=>{se.fabric.Image.fromURL(p,y)})}async getStoreImages(){const y=await this._images.getItems();return y.reverse(),y}clear(){this._canvas.clear()}async addImagesFromStore(){const p=this;if(await p.getStoreImagesLength()===0){console.warn("No images to render");return}const b=await p.getStoreImagesStats();if(p.zoomToOrigin(),p._n=b.n,p._n>0){p._curr=p._n,p.clear();const S=await p.getStoreImages();let E=!0;for(const M of S)await p.addImage(M.src,{id:M.id,timestamp:M.t,left:M.x,top:M.y,scaleX:M.s,scaleY:M.s,originY:"top",originX:"left",filters:E?null:[Ln],selectable:!1,srcFromAttribute:!1,zoom:E},!0),E=!1;await p.updateLimits()}}toJSON(){const p=this;return JSON.stringify(p._canvas)}clearCache(){const p=this;delete p._zoom_min_max}nextFrame(){return new Promise(p=>{Bt.framerate===60?requestAnimationFrame(p):setTimeout(p,1/Bt.framerate*1e3)})}}function cl(A,p){const y=document.createElement("a");y.style.display="none";const b=URL.createObjectURL(A);y.download=p,y.setAttribute("href",b),y.addEventListener("click",()=>{setTimeout(()=>{URL.revokeObjectURL(b)},60*1e3),y.remove()}),document.body.appendChild(y),y.click()}function ul(A){window.open(URL.createObjectURL(A))}function hl(A){const p=document.createElement("video");p.setAttribute("src",URL.createObjectURL(A)),document.body.appendChild(p)}var Fn={exports:{}};(function(A,p){(function(b,S){A.exports=S()})(window,function(){return function(y){var b={};function S(E){if(b[E])return b[E].exports;var M=b[E]={i:E,l:!1,exports:{}};return y[E].call(M.exports,M,M.exports,S),M.l=!0,M.exports}return S.m=y,S.c=b,S.d=function(E,M,d){S.o(E,M)||Object.defineProperty(E,M,{enumerable:!0,get:d})},S.r=function(E){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(E,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(E,"__esModule",{value:!0})},S.t=function(E,M){if(M&1&&(E=S(E)),M&8||M&4&&typeof E=="object"&&E&&E.__esModule)return E;var d=Object.create(null);if(S.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:E}),M&2&&typeof E!="string")for(var i in E)S.d(d,i,function(a){return E[a]}.bind(null,i));return d},S.n=function(E){var M=E&&E.__esModule?function(){return E.default}:function(){return E};return S.d(M,"a",M),M},S.o=function(E,M){return Object.prototype.hasOwnProperty.call(E,M)},S.p="",S(S.s=66)}([function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(64),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(60),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(51);Object.defineProperty(b,"closest",{enumerable:!0,get:function(){return d(E).default}});var M=S(49);Object.defineProperty(b,"requestNextAnimationFrame",{enumerable:!0,get:function(){return d(M).default}});function d(i){return i&&i.__esModule?i:{default:i}}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(44);Object.keys(E).forEach(function(M){M==="default"||M==="__esModule"||Object.defineProperty(b,M,{enumerable:!0,get:function(){return E[M]}})})},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(47),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(14);Object.keys(E).forEach(function(r){r==="default"||r==="__esModule"||Object.defineProperty(b,r,{enumerable:!0,get:function(){return E[r]}})});var M=S(13);Object.keys(M).forEach(function(r){r==="default"||r==="__esModule"||Object.defineProperty(b,r,{enumerable:!0,get:function(){return M[r]}})});var d=S(12);Object.keys(d).forEach(function(r){r==="default"||r==="__esModule"||Object.defineProperty(b,r,{enumerable:!0,get:function(){return d[r]}})});var i=S(6);Object.keys(i).forEach(function(r){r==="default"||r==="__esModule"||Object.defineProperty(b,r,{enumerable:!0,get:function(){return i[r]}})});var a=S(37),l=e(a);function e(r){return r&&r.__esModule?r:{default:r}}b.default=l.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(4);Object.defineProperty(b,"Sensor",{enumerable:!0,get:function(){return e(E).default}});var M=S(46);Object.defineProperty(b,"MouseSensor",{enumerable:!0,get:function(){return e(M).default}});var d=S(43);Object.defineProperty(b,"TouchSensor",{enumerable:!0,get:function(){return e(d).default}});var i=S(41);Object.defineProperty(b,"DragSensor",{enumerable:!0,get:function(){return e(i).default}});var a=S(39);Object.defineProperty(b,"ForceTouchSensor",{enumerable:!0,get:function(){return e(a).default}});var l=S(3);Object.keys(l).forEach(function(r){r==="default"||r==="__esModule"||Object.defineProperty(b,r,{enumerable:!0,get:function(){return l[r]}})});function e(r){return r&&r.__esModule?r:{default:r}}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(18);Object.keys(E).forEach(function(M){M==="default"||M==="__esModule"||Object.defineProperty(b,M,{enumerable:!0,get:function(){return E[M]}})})},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(23);Object.keys(E).forEach(function(M){M==="default"||M==="__esModule"||Object.defineProperty(b,M,{enumerable:!0,get:function(){return E[M]}})})},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(27);Object.keys(E).forEach(function(M){M==="default"||M==="__esModule"||Object.defineProperty(b,M,{enumerable:!0,get:function(){return E[M]}})})},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(30);Object.keys(E).forEach(function(M){M==="default"||M==="__esModule"||Object.defineProperty(b,M,{enumerable:!0,get:function(){return E[M]}})})},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(33);Object.keys(E).forEach(function(M){M==="default"||M==="__esModule"||Object.defineProperty(b,M,{enumerable:!0,get:function(){return E[M]}})})},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(62);Object.defineProperty(b,"Announcement",{enumerable:!0,get:function(){return a(E).default}}),Object.defineProperty(b,"defaultAnnouncementOptions",{enumerable:!0,get:function(){return E.defaultOptions}});var M=S(59);Object.defineProperty(b,"Focusable",{enumerable:!0,get:function(){return a(M).default}});var d=S(57);Object.defineProperty(b,"Mirror",{enumerable:!0,get:function(){return a(d).default}}),Object.defineProperty(b,"defaultMirrorOptions",{enumerable:!0,get:function(){return d.defaultOptions}});var i=S(53);Object.defineProperty(b,"Scrollable",{enumerable:!0,get:function(){return a(i).default}}),Object.defineProperty(b,"defaultScrollableOptions",{enumerable:!0,get:function(){return i.defaultOptions}});function a(l){return l&&l.__esModule?l:{default:l}}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(63);Object.keys(E).forEach(function(M){M==="default"||M==="__esModule"||Object.defineProperty(b,M,{enumerable:!0,get:function(){return E[M]}})})},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(65);Object.keys(E).forEach(function(M){M==="default"||M==="__esModule"||Object.defineProperty(b,M,{enumerable:!0,get:function(){return E[M]}})})},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultOptions=void 0;var E=Object.assign||function(o){for(var u=1;u<arguments.length;u++){var s=arguments[u];for(var h in s)Object.prototype.hasOwnProperty.call(s,h)&&(o[h]=s[h])}return o},M=S(1),d=i(M);function i(o){return o&&o.__esModule?o:{default:o}}const a=Symbol("onSortableSorted"),l=b.defaultOptions={duration:150,easingFunction:"ease-in-out",horizontal:!1};class e extends d.default{constructor(u){super(u),this.options=E({},l,this.getOptions()),this.lastAnimationFrame=null,this[a]=this[a].bind(this)}attach(){this.draggable.on("sortable:sorted",this[a])}detach(){this.draggable.off("sortable:sorted",this[a])}getOptions(){return this.draggable.options.swapAnimation||{}}[a]({oldIndex:u,newIndex:s,dragEvent:h}){const{source:g,over:v}=h;cancelAnimationFrame(this.lastAnimationFrame),this.lastAnimationFrame=requestAnimationFrame(()=>{u>=s?r(g,v,this.options):r(v,g,this.options)})}}b.default=e;function r(o,u,{duration:s,easingFunction:h,horizontal:g}){for(const v of[o,u])v.style.pointerEvents="none";if(g){const v=o.offsetWidth;o.style.transform=`translate3d(${v}px, 0, 0)`,u.style.transform=`translate3d(-${v}px, 0, 0)`}else{const v=o.offsetHeight;o.style.transform=`translate3d(0, ${v}px, 0)`,u.style.transform=`translate3d(0, -${v}px, 0)`}requestAnimationFrame(()=>{for(const v of[o,u])v.addEventListener("transitionend",n),v.style.transition=`transform ${s}ms ${h}`,v.style.transform=""})}function n(o){o.target.style.transition="",o.target.style.pointerEvents="",o.target.removeEventListener("transitionend",n)}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultOptions=void 0;var E=S(15),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default,b.defaultOptions=E.defaultOptions},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(1),M=i(E),d=S(7);function i(s){return s&&s.__esModule?s:{default:s}}const a=Symbol("onDragStart"),l=Symbol("onDragStop"),e=Symbol("onDragOver"),r=Symbol("onDragOut"),n=Symbol("onMirrorCreated"),o=Symbol("onMirrorDestroy");class u extends M.default{constructor(h){super(h),this.firstSource=null,this.mirror=null,this[a]=this[a].bind(this),this[l]=this[l].bind(this),this[e]=this[e].bind(this),this[r]=this[r].bind(this),this[n]=this[n].bind(this),this[o]=this[o].bind(this)}attach(){this.draggable.on("drag:start",this[a]).on("drag:stop",this[l]).on("drag:over",this[e]).on("drag:out",this[r]).on("droppable:over",this[e]).on("droppable:out",this[r]).on("mirror:created",this[n]).on("mirror:destroy",this[o])}detach(){this.draggable.off("drag:start",this[a]).off("drag:stop",this[l]).off("drag:over",this[e]).off("drag:out",this[r]).off("droppable:over",this[e]).off("droppable:out",this[r]).off("mirror:created",this[n]).off("mirror:destroy",this[o])}[a](h){h.canceled()||(this.firstSource=h.source)}[l](){this.firstSource=null}[e](h){if(h.canceled())return;const g=h.source||h.dragEvent.source;if(g===this.firstSource){this.firstSource=null;return}const v=new d.SnapInEvent({dragEvent:h,snappable:h.over||h.droppable});this.draggable.trigger(v),!v.canceled()&&(this.mirror&&(this.mirror.style.display="none"),g.classList.remove(this.draggable.getClassNameFor("source:dragging")),g.classList.add(this.draggable.getClassNameFor("source:placed")),setTimeout(()=>{g.classList.remove(this.draggable.getClassNameFor("source:placed"))},this.draggable.options.placedTimeout))}[r](h){if(h.canceled())return;const g=h.source||h.dragEvent.source,v=new d.SnapOutEvent({dragEvent:h,snappable:h.over||h.droppable});this.draggable.trigger(v),!v.canceled()&&(this.mirror&&(this.mirror.style.display=""),g.classList.add(this.draggable.getClassNameFor("source:dragging")))}[n]({mirror:h}){this.mirror=h}[o](){this.mirror=null}}b.default=u},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.SnapOutEvent=b.SnapInEvent=b.SnapEvent=void 0;var E=S(0),M=d(E);function d(e){return e&&e.__esModule?e:{default:e}}class i extends M.default{get dragEvent(){return this.data.dragEvent}get snappable(){return this.data.snappable}}b.SnapEvent=i,i.type="snap";class a extends i{}b.SnapInEvent=a,a.type="snap:in",a.cancelable=!0;class l extends i{}b.SnapOutEvent=l,l.type="snap:out",l.cancelable=!0},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(7);Object.keys(E).forEach(function(a){a==="default"||a==="__esModule"||Object.defineProperty(b,a,{enumerable:!0,get:function(){return E[a]}})});var M=S(17),d=i(M);function i(a){return a&&a.__esModule?a:{default:a}}b.default=d.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultOptions=void 0;var E=Object.assign||function(s){for(var h=1;h<arguments.length;h++){var g=arguments[h];for(var v in g)Object.prototype.hasOwnProperty.call(g,v)&&(s[v]=g[v])}return s},M=S(1),d=a(M),i=S(2);function a(s){return s&&s.__esModule?s:{default:s}}const l=Symbol("onMirrorCreated"),e=Symbol("onMirrorDestroy"),r=Symbol("onDragOver"),n=Symbol("resize"),o=b.defaultOptions={};class u extends d.default{constructor(h){super(h),this.options=E({},o,this.getOptions()),this.lastWidth=0,this.lastHeight=0,this.mirror=null,this[l]=this[l].bind(this),this[e]=this[e].bind(this),this[r]=this[r].bind(this)}attach(){this.draggable.on("mirror:created",this[l]).on("drag:over",this[r]).on("drag:over:container",this[r])}detach(){this.draggable.off("mirror:created",this[l]).off("mirror:destroy",this[e]).off("drag:over",this[r]).off("drag:over:container",this[r])}getOptions(){return this.draggable.options.resizeMirror||{}}[l]({mirror:h}){this.mirror=h}[e](){this.mirror=null}[r](h){this[n](h)}[n]({overContainer:h,over:g}){requestAnimationFrame(()=>{this.mirror.parentNode!==h&&h.appendChild(this.mirror);const v=g||this.draggable.getDraggableElementsForContainer(h)[0];!v||(0,i.requestNextAnimationFrame)(()=>{const _=v.getBoundingClientRect();this.lastHeight===_.height&&this.lastWidth===_.width||(this.mirror.style.width=`${_.width}px`,this.mirror.style.height=`${_.height}px`,this.lastWidth=_.width,this.lastHeight=_.height)})})}}b.default=u},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultOptions=void 0;var E=S(20),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default,b.defaultOptions=E.defaultOptions},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(1),M=a(E),d=S(2),i=S(8);function a(o){return o&&o.__esModule?o:{default:o}}const l=Symbol("onDragMove"),e=Symbol("onDragStop"),r=Symbol("onRequestAnimationFrame");class n extends M.default{constructor(u){super(u),this.currentlyCollidingElement=null,this.lastCollidingElement=null,this.currentAnimationFrame=null,this[l]=this[l].bind(this),this[e]=this[e].bind(this),this[r]=this[r].bind(this)}attach(){this.draggable.on("drag:move",this[l]).on("drag:stop",this[e])}detach(){this.draggable.off("drag:move",this[l]).off("drag:stop",this[e])}getCollidables(){const u=this.draggable.options.collidables;return typeof u=="string"?Array.prototype.slice.call(document.querySelectorAll(u)):u instanceof NodeList||u instanceof Array?Array.prototype.slice.call(u):u instanceof HTMLElement?[u]:typeof u=="function"?u():[]}[l](u){const s=u.sensorEvent.target;this.currentAnimationFrame=requestAnimationFrame(this[r](s)),this.currentlyCollidingElement&&u.cancel();const h=new i.CollidableInEvent({dragEvent:u,collidingElement:this.currentlyCollidingElement}),g=new i.CollidableOutEvent({dragEvent:u,collidingElement:this.lastCollidingElement}),v=Boolean(this.currentlyCollidingElement&&this.lastCollidingElement!==this.currentlyCollidingElement),_=Boolean(!this.currentlyCollidingElement&&this.lastCollidingElement);v?(this.lastCollidingElement&&this.draggable.trigger(g),this.draggable.trigger(h)):_&&this.draggable.trigger(g),this.lastCollidingElement=this.currentlyCollidingElement}[e](u){const s=this.currentlyCollidingElement||this.lastCollidingElement,h=new i.CollidableOutEvent({dragEvent:u,collidingElement:s});s&&this.draggable.trigger(h),this.lastCollidingElement=null,this.currentlyCollidingElement=null}[r](u){return()=>{const s=this.getCollidables();this.currentlyCollidingElement=(0,d.closest)(u,h=>s.includes(h))}}}b.default=n},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.CollidableOutEvent=b.CollidableInEvent=b.CollidableEvent=void 0;var E=S(0),M=d(E);function d(e){return e&&e.__esModule?e:{default:e}}class i extends M.default{get dragEvent(){return this.data.dragEvent}}b.CollidableEvent=i,i.type="collidable";class a extends i{get collidingElement(){return this.data.collidingElement}}b.CollidableInEvent=a,a.type="collidable:in";class l extends i{get collidingElement(){return this.data.collidingElement}}b.CollidableOutEvent=l,l.type="collidable:out"},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(8);Object.keys(E).forEach(function(a){a==="default"||a==="__esModule"||Object.defineProperty(b,a,{enumerable:!0,get:function(){return E[a]}})});var M=S(22),d=i(M);function i(a){return a&&a.__esModule?a:{default:a}}b.default=d.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(24);Object.defineProperty(b,"Collidable",{enumerable:!0,get:function(){return a(E).default}});var M=S(21);Object.defineProperty(b,"ResizeMirror",{enumerable:!0,get:function(){return a(M).default}}),Object.defineProperty(b,"defaultResizeMirrorOptions",{enumerable:!0,get:function(){return M.defaultOptions}});var d=S(19);Object.defineProperty(b,"Snappable",{enumerable:!0,get:function(){return a(d).default}});var i=S(16);Object.defineProperty(b,"SwapAnimation",{enumerable:!0,get:function(){return a(i).default}}),Object.defineProperty(b,"defaultSwapAnimationOptions",{enumerable:!0,get:function(){return i.defaultOptions}});function a(l){return l&&l.__esModule?l:{default:l}}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=Object.assign||function(C){for(var P=1;P<arguments.length;P++){var D=arguments[P];for(var I in D)Object.prototype.hasOwnProperty.call(D,I)&&(C[I]=D[I])}return C},M=S(5),d=a(M),i=S(9);function a(C){return C&&C.__esModule?C:{default:C}}const l=Symbol("onDragStart"),e=Symbol("onDragOverContainer"),r=Symbol("onDragOver"),n=Symbol("onDragStop");function o({dragEvent:C}){const P=C.source.textContent.trim()||C.source.id||"sortable element";if(C.over){const D=C.over.textContent.trim()||C.over.id||"sortable element";return C.source.compareDocumentPosition(C.over)&Node.DOCUMENT_POSITION_FOLLOWING?`Placed ${P} after ${D}`:`Placed ${P} before ${D}`}else return`Placed ${P} into a different container`}const u={"sortable:sorted":o};class s extends d.default{constructor(P=[],D={}){super(P,E({},D,{announcements:E({},u,D.announcements||{})})),this.startIndex=null,this.startContainer=null,this[l]=this[l].bind(this),this[e]=this[e].bind(this),this[r]=this[r].bind(this),this[n]=this[n].bind(this),this.on("drag:start",this[l]).on("drag:over:container",this[e]).on("drag:over",this[r]).on("drag:stop",this[n])}destroy(){super.destroy(),this.off("drag:start",this[l]).off("drag:over:container",this[e]).off("drag:over",this[r]).off("drag:stop",this[n])}index(P){return this.getDraggableElementsForContainer(P.parentNode).indexOf(P)}[l](P){this.startContainer=P.source.parentNode,this.startIndex=this.index(P.source);const D=new i.SortableStartEvent({dragEvent:P,startIndex:this.startIndex,startContainer:this.startContainer});this.trigger(D),D.canceled()&&P.cancel()}[e](P){if(P.canceled())return;const{source:D,over:I,overContainer:N}=P,H=this.index(D),K=new i.SortableSortEvent({dragEvent:P,currentIndex:H,source:D,over:I});if(this.trigger(K),K.canceled())return;const J=this.getDraggableElementsForContainer(N),Q=g({source:D,over:I,overContainer:N,children:J});if(!Q)return;const{oldContainer:tt,newContainer:dt}=Q,rt=this.index(P.source),_t=new i.SortableSortedEvent({dragEvent:P,oldIndex:H,newIndex:rt,oldContainer:tt,newContainer:dt});this.trigger(_t)}[r](P){if(P.over===P.originalSource||P.over===P.source)return;const{source:D,over:I,overContainer:N}=P,H=this.index(D),K=new i.SortableSortEvent({dragEvent:P,currentIndex:H,source:D,over:I});if(this.trigger(K),K.canceled())return;const J=this.getDraggableElementsForContainer(N),Q=g({source:D,over:I,overContainer:N,children:J});if(!Q)return;const{oldContainer:tt,newContainer:dt}=Q,rt=this.index(D),_t=new i.SortableSortedEvent({dragEvent:P,oldIndex:H,newIndex:rt,oldContainer:tt,newContainer:dt});this.trigger(_t)}[n](P){const D=new i.SortableStopEvent({dragEvent:P,oldIndex:this.startIndex,newIndex:this.index(P.source),oldContainer:this.startContainer,newContainer:P.source.parentNode});this.trigger(D),this.startIndex=null,this.startContainer=null}}b.default=s;function h(C){return Array.prototype.indexOf.call(C.parentNode.children,C)}function g({source:C,over:P,overContainer:D,children:I}){const N=!I.length,H=C.parentNode!==D,K=P&&!H;return N?v(C,D):K?_(C,P):H?w(C,P,D):null}function v(C,P){const D=C.parentNode;return P.appendChild(C),{oldContainer:D,newContainer:P}}function _(C,P){const D=h(C),I=h(P);return D<I?C.parentNode.insertBefore(C,P.nextElementSibling):C.parentNode.insertBefore(C,P),{oldContainer:C.parentNode,newContainer:C.parentNode}}function w(C,P,D){const I=C.parentNode;return P?P.parentNode.insertBefore(C,P):D.appendChild(C),{oldContainer:I,newContainer:C.parentNode}}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.SortableStopEvent=b.SortableSortedEvent=b.SortableSortEvent=b.SortableStartEvent=b.SortableEvent=void 0;var E=S(0),M=d(E);function d(n){return n&&n.__esModule?n:{default:n}}class i extends M.default{get dragEvent(){return this.data.dragEvent}}b.SortableEvent=i,i.type="sortable";class a extends i{get startIndex(){return this.data.startIndex}get startContainer(){return this.data.startContainer}}b.SortableStartEvent=a,a.type="sortable:start",a.cancelable=!0;class l extends i{get currentIndex(){return this.data.currentIndex}get over(){return this.data.oldIndex}get overContainer(){return this.data.newIndex}}b.SortableSortEvent=l,l.type="sortable:sort",l.cancelable=!0;class e extends i{get oldIndex(){return this.data.oldIndex}get newIndex(){return this.data.newIndex}get oldContainer(){return this.data.oldContainer}get newContainer(){return this.data.newContainer}}b.SortableSortedEvent=e,e.type="sortable:sorted";class r extends i{get oldIndex(){return this.data.oldIndex}get newIndex(){return this.data.newIndex}get oldContainer(){return this.data.oldContainer}get newContainer(){return this.data.newContainer}}b.SortableStopEvent=r,r.type="sortable:stop"},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(9);Object.keys(E).forEach(function(a){a==="default"||a==="__esModule"||Object.defineProperty(b,a,{enumerable:!0,get:function(){return E[a]}})});var M=S(26),d=i(M);function i(a){return a&&a.__esModule?a:{default:a}}b.default=d.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=Object.assign||function(g){for(var v=1;v<arguments.length;v++){var _=arguments[v];for(var w in _)Object.prototype.hasOwnProperty.call(_,w)&&(g[w]=_[w])}return g},M=S(5),d=a(M),i=S(10);function a(g){return g&&g.__esModule?g:{default:g}}const l=Symbol("onDragStart"),e=Symbol("onDragOver"),r=Symbol("onDragStop");function n({dragEvent:g,swappedElement:v}){const _=g.source.textContent.trim()||g.source.id||"swappable element",w=v.textContent.trim()||v.id||"swappable element";return`Swapped ${_} with ${w}`}const o={"swappabled:swapped":n};class u extends d.default{constructor(v=[],_={}){super(v,E({},_,{announcements:E({},o,_.announcements||{})})),this.lastOver=null,this[l]=this[l].bind(this),this[e]=this[e].bind(this),this[r]=this[r].bind(this),this.on("drag:start",this[l]).on("drag:over",this[e]).on("drag:stop",this[r])}destroy(){super.destroy(),this.off("drag:start",this._onDragStart).off("drag:over",this._onDragOver).off("drag:stop",this._onDragStop)}[l](v){const _=new i.SwappableStartEvent({dragEvent:v});this.trigger(_),_.canceled()&&v.cancel()}[e](v){if(v.over===v.originalSource||v.over===v.source||v.canceled())return;const _=new i.SwappableSwapEvent({dragEvent:v,over:v.over,overContainer:v.overContainer});if(this.trigger(_),_.canceled())return;this.lastOver&&this.lastOver!==v.over&&h(this.lastOver,v.source),this.lastOver===v.over?this.lastOver=null:this.lastOver=v.over,h(v.source,v.over);const w=new i.SwappableSwappedEvent({dragEvent:v,swappedElement:v.over});this.trigger(w)}[r](v){const _=new i.SwappableStopEvent({dragEvent:v});this.trigger(_),this.lastOver=null}}b.default=u;function s(g){const v=document.createElement("div");g(v),v.parentNode.removeChild(v)}function h(g,v){const _=v.parentNode,w=g.parentNode;s(C=>{w.insertBefore(C,g),_.insertBefore(g,v),w.insertBefore(v,C)})}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.SwappableStopEvent=b.SwappableSwappedEvent=b.SwappableSwapEvent=b.SwappableStartEvent=b.SwappableEvent=void 0;var E=S(0),M=d(E);function d(n){return n&&n.__esModule?n:{default:n}}class i extends M.default{get dragEvent(){return this.data.dragEvent}}b.SwappableEvent=i,i.type="swappable";class a extends i{}b.SwappableStartEvent=a,a.type="swappable:start",a.cancelable=!0;class l extends i{get over(){return this.data.over}get overContainer(){return this.data.overContainer}}b.SwappableSwapEvent=l,l.type="swappable:swap",l.cancelable=!0;class e extends i{get swappedElement(){return this.data.swappedElement}}b.SwappableSwappedEvent=e,e.type="swappable:swapped";class r extends i{}b.SwappableStopEvent=r,r.type="swappable:stop"},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(10);Object.keys(E).forEach(function(a){a==="default"||a==="__esModule"||Object.defineProperty(b,a,{enumerable:!0,get:function(){return E[a]}})});var M=S(29),d=i(M);function i(a){return a&&a.__esModule?a:{default:a}}b.default=d.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=Object.assign||function(D){for(var I=1;I<arguments.length;I++){var N=arguments[I];for(var H in N)Object.prototype.hasOwnProperty.call(N,H)&&(D[H]=N[H])}return D},M=S(2),d=S(5),i=l(d),a=S(11);function l(D){return D&&D.__esModule?D:{default:D}}const e=Symbol("onDragStart"),r=Symbol("onDragMove"),n=Symbol("onDragStop"),o=Symbol("dropInDropZone"),u=Symbol("returnToOriginalDropzone"),s=Symbol("closestDropzone"),h=Symbol("getDropzones");function g({dragEvent:D,dropzone:I}){const N=D.source.textContent.trim()||D.source.id||"draggable element",H=I.textContent.trim()||I.id||"droppable element";return`Dropped ${N} into ${H}`}function v({dragEvent:D,dropzone:I}){const N=D.source.textContent.trim()||D.source.id||"draggable element",H=I.textContent.trim()||I.id||"droppable element";return`Returned ${N} from ${H}`}const _={"droppable:dropped":g,"droppable:returned":v},w={"droppable:active":"draggable-dropzone--active","droppable:occupied":"draggable-dropzone--occupied"},C={dropzone:".draggable-droppable"};class P extends i.default{constructor(I=[],N={}){super(I,E({},C,N,{classes:E({},w,N.classes||{}),announcements:E({},_,N.announcements||{})})),this.dropzones=null,this.lastDropzone=null,this.initialDropzone=null,this[e]=this[e].bind(this),this[r]=this[r].bind(this),this[n]=this[n].bind(this),this.on("drag:start",this[e]).on("drag:move",this[r]).on("drag:stop",this[n])}destroy(){super.destroy(),this.off("drag:start",this[e]).off("drag:move",this[r]).off("drag:stop",this[n])}[e](I){if(I.canceled())return;this.dropzones=[...this[h]()];const N=(0,M.closest)(I.sensorEvent.target,this.options.dropzone);if(!N){I.cancel();return}const H=new a.DroppableStartEvent({dragEvent:I,dropzone:N});if(this.trigger(H),H.canceled()){I.cancel();return}this.initialDropzone=N;for(const K of this.dropzones)K.classList.contains(this.getClassNameFor("droppable:occupied"))||K.classList.add(this.getClassNameFor("droppable:active"))}[r](I){if(I.canceled())return;const N=this[s](I.sensorEvent.target);N&&!N.classList.contains(this.getClassNameFor("droppable:occupied"))&&this[o](I,N)?this.lastDropzone=N:(!N||N===this.initialDropzone)&&this.lastDropzone&&(this[u](I),this.lastDropzone=null)}[n](I){const N=new a.DroppableStopEvent({dragEvent:I,dropzone:this.lastDropzone||this.initialDropzone});this.trigger(N);const H=this.getClassNameFor("droppable:occupied");for(const K of this.dropzones)K.classList.remove(this.getClassNameFor("droppable:active"));this.lastDropzone&&this.lastDropzone!==this.initialDropzone&&this.initialDropzone.classList.remove(H),this.dropzones=null,this.lastDropzone=null,this.initialDropzone=null}[o](I,N){const H=new a.DroppableDroppedEvent({dragEvent:I,dropzone:N});if(this.trigger(H),H.canceled())return!1;const K=this.getClassNameFor("droppable:occupied");return this.lastDropzone&&this.lastDropzone.classList.remove(K),N.appendChild(I.source),N.classList.add(K),!0}[u](I){const N=new a.DroppableReturnedEvent({dragEvent:I,dropzone:this.lastDropzone});this.trigger(N),!N.canceled()&&(this.initialDropzone.appendChild(I.source),this.lastDropzone.classList.remove(this.getClassNameFor("droppable:occupied")))}[s](I){return this.dropzones?(0,M.closest)(I,this.dropzones):null}[h](){const I=this.options.dropzone;return typeof I=="string"?document.querySelectorAll(I):I instanceof NodeList||I instanceof Array?I:typeof I=="function"?I():[]}}b.default=P},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.DroppableStopEvent=b.DroppableReturnedEvent=b.DroppableDroppedEvent=b.DroppableStartEvent=b.DroppableEvent=void 0;var E=S(0),M=d(E);function d(n){return n&&n.__esModule?n:{default:n}}class i extends M.default{get dragEvent(){return this.data.dragEvent}}b.DroppableEvent=i,i.type="droppable";class a extends i{get dropzone(){return this.data.dropzone}}b.DroppableStartEvent=a,a.type="droppable:start",a.cancelable=!0;class l extends i{get dropzone(){return this.data.dropzone}}b.DroppableDroppedEvent=l,l.type="droppable:dropped",l.cancelable=!0;class e extends i{get dropzone(){return this.data.dropzone}}b.DroppableReturnedEvent=e,e.type="droppable:returned",e.cancelable=!0;class r extends i{get dropzone(){return this.data.dropzone}}b.DroppableStopEvent=r,r.type="droppable:stop",r.cancelable=!0},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(11);Object.keys(E).forEach(function(a){a==="default"||a==="__esModule"||Object.defineProperty(b,a,{enumerable:!0,get:function(){return E[a]}})});var M=S(32),d=i(M);function i(a){return a&&a.__esModule?a:{default:a}}b.default=d.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});class E{constructor(){this.callbacks={}}on(d,...i){return this.callbacks[d]||(this.callbacks[d]=[]),this.callbacks[d].push(...i),this}off(d,i){if(!this.callbacks[d])return null;const a=this.callbacks[d].slice(0);for(let l=0;l<a.length;l++)i===a[l]&&this.callbacks[d].splice(l,1);return this}trigger(d){if(!this.callbacks[d.type])return null;const i=[...this.callbacks[d.type]],a=[];for(let l=i.length-1;l>=0;l--){const e=i[l];try{e(d)}catch(r){a.push(r)}}return a.length&&console.error(`Draggable caught errors while triggering '${d.type}'`,a),this}}b.default=E},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(35),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultOptions=void 0;var E=Object.assign||function(D){for(var I=1;I<arguments.length;I++){var N=arguments[I];for(var H in N)Object.prototype.hasOwnProperty.call(N,H)&&(D[H]=N[H])}return D},M=S(2),d=S(12),i=S(36),a=n(i),l=S(6),e=S(13),r=S(14);function n(D){return D&&D.__esModule?D:{default:D}}const o=Symbol("onDragStart"),u=Symbol("onDragMove"),s=Symbol("onDragStop"),h=Symbol("onDragPressure"),g={"drag:start":D=>`Picked up ${D.source.textContent.trim()||D.source.id||"draggable element"}`,"drag:stop":D=>`Released ${D.source.textContent.trim()||D.source.id||"draggable element"}`},v={"container:dragging":"draggable-container--is-dragging","source:dragging":"draggable-source--is-dragging","source:placed":"draggable-source--placed","container:placed":"draggable-container--placed","body:dragging":"draggable--is-dragging","draggable:over":"draggable--over","container:over":"draggable-container--over","source:original":"draggable--original",mirror:"draggable-mirror"},_=b.defaultOptions={draggable:".draggable-source",handle:null,delay:100,placedTimeout:800,plugins:[],sensors:[]};class w{constructor(I=[document.body],N={}){if(I instanceof NodeList||I instanceof Array)this.containers=[...I];else if(I instanceof HTMLElement)this.containers=[I];else throw new Error("Draggable containers are expected to be of type `NodeList`, `HTMLElement[]` or `HTMLElement`");this.options=E({},_,N,{classes:E({},v,N.classes||{}),announcements:E({},g,N.announcements||{})}),this.emitter=new a.default,this.dragging=!1,this.plugins=[],this.sensors=[],this[o]=this[o].bind(this),this[u]=this[u].bind(this),this[s]=this[s].bind(this),this[h]=this[h].bind(this),document.addEventListener("drag:start",this[o],!0),document.addEventListener("drag:move",this[u],!0),document.addEventListener("drag:stop",this[s],!0),document.addEventListener("drag:pressure",this[h],!0);const H=Object.values(w.Plugins).map(Q=>Q),K=[l.MouseSensor,l.TouchSensor];this.addPlugin(...H,...this.options.plugins),this.addSensor(...K,...this.options.sensors);const J=new e.DraggableInitializedEvent({draggable:this});this.on("mirror:created",({mirror:Q})=>this.mirror=Q),this.on("mirror:destroy",()=>this.mirror=null),this.trigger(J)}destroy(){document.removeEventListener("drag:start",this[o],!0),document.removeEventListener("drag:move",this[u],!0),document.removeEventListener("drag:stop",this[s],!0),document.removeEventListener("drag:pressure",this[h],!0);const I=new e.DraggableDestroyEvent({draggable:this});this.trigger(I),this.removePlugin(...this.plugins.map(N=>N.constructor)),this.removeSensor(...this.sensors.map(N=>N.constructor))}addPlugin(...I){const N=I.map(H=>new H(this));return N.forEach(H=>H.attach()),this.plugins=[...this.plugins,...N],this}removePlugin(...I){return this.plugins.filter(H=>I.includes(H.constructor)).forEach(H=>H.detach()),this.plugins=this.plugins.filter(H=>!I.includes(H.constructor)),this}addSensor(...I){const N=I.map(H=>new H(this.containers,this.options));return N.forEach(H=>H.attach()),this.sensors=[...this.sensors,...N],this}removeSensor(...I){return this.sensors.filter(H=>I.includes(H.constructor)).forEach(H=>H.detach()),this.sensors=this.sensors.filter(H=>!I.includes(H.constructor)),this}addContainer(...I){return this.containers=[...this.containers,...I],this.sensors.forEach(N=>N.addContainer(...I)),this}removeContainer(...I){return this.containers=this.containers.filter(N=>!I.includes(N)),this.sensors.forEach(N=>N.removeContainer(...I)),this}on(I,...N){return this.emitter.on(I,...N),this}off(I,N){return this.emitter.off(I,N),this}trigger(I){return this.emitter.trigger(I),this}getClassNameFor(I){return this.options.classes[I]}isDragging(){return Boolean(this.dragging)}getDraggableElements(){return this.containers.reduce((I,N)=>[...I,...this.getDraggableElementsForContainer(N)],[])}getDraggableElementsForContainer(I){return[...I.querySelectorAll(this.options.draggable)].filter(H=>H!==this.originalSource&&H!==this.mirror)}[o](I){const N=C(I),{target:H,container:K}=N;if(!this.containers.includes(K))return;if(this.options.handle&&H&&!(0,M.closest)(H,this.options.handle)){N.cancel();return}if(this.originalSource=(0,M.closest)(H,this.options.draggable),this.sourceContainer=K,!this.originalSource){N.cancel();return}this.lastPlacedSource&&this.lastPlacedContainer&&(clearTimeout(this.placedTimeoutID),this.lastPlacedSource.classList.remove(this.getClassNameFor("source:placed")),this.lastPlacedContainer.classList.remove(this.getClassNameFor("container:placed"))),this.source=this.originalSource.cloneNode(!0),this.originalSource.parentNode.insertBefore(this.source,this.originalSource),this.originalSource.style.display="none";const J=new r.DragStartEvent({source:this.source,originalSource:this.originalSource,sourceContainer:K,sensorEvent:N});if(this.trigger(J),this.dragging=!J.canceled(),J.canceled()){this.source.parentNode.removeChild(this.source),this.originalSource.style.display=null;return}this.originalSource.classList.add(this.getClassNameFor("source:original")),this.source.classList.add(this.getClassNameFor("source:dragging")),this.sourceContainer.classList.add(this.getClassNameFor("container:dragging")),document.body.classList.add(this.getClassNameFor("body:dragging")),P(document.body,"none"),requestAnimationFrame(()=>{const tt=C(I).clone({target:this.source});this[u](E({},I,{detail:tt}))})}[u](I){if(!this.dragging)return;const N=C(I),{container:H}=N;let K=N.target;const J=new r.DragMoveEvent({source:this.source,originalSource:this.originalSource,sourceContainer:H,sensorEvent:N});this.trigger(J),J.canceled()&&N.cancel(),K=(0,M.closest)(K,this.options.draggable);const Q=(0,M.closest)(N.target,this.containers),tt=N.overContainer||Q,dt=this.currentOverContainer&&tt!==this.currentOverContainer,rt=this.currentOver&&K!==this.currentOver,_t=tt&&this.currentOverContainer!==tt,T=Q&&K&&this.currentOver!==K;if(rt){const B=new r.DragOutEvent({source:this.source,originalSource:this.originalSource,sourceContainer:H,sensorEvent:N,over:this.currentOver});this.currentOver.classList.remove(this.getClassNameFor("draggable:over")),this.currentOver=null,this.trigger(B)}if(dt){const B=new r.DragOutContainerEvent({source:this.source,originalSource:this.originalSource,sourceContainer:H,sensorEvent:N,overContainer:this.currentOverContainer});this.currentOverContainer.classList.remove(this.getClassNameFor("container:over")),this.currentOverContainer=null,this.trigger(B)}if(_t){tt.classList.add(this.getClassNameFor("container:over"));const B=new r.DragOverContainerEvent({source:this.source,originalSource:this.originalSource,sourceContainer:H,sensorEvent:N,overContainer:tt});this.currentOverContainer=tt,this.trigger(B)}if(T){K.classList.add(this.getClassNameFor("draggable:over"));const B=new r.DragOverEvent({source:this.source,originalSource:this.originalSource,sourceContainer:H,sensorEvent:N,overContainer:tt,over:K});this.currentOver=K,this.trigger(B)}}[s](I){if(!this.dragging)return;this.dragging=!1;const N=new r.DragStopEvent({source:this.source,originalSource:this.originalSource,sensorEvent:I.sensorEvent,sourceContainer:this.sourceContainer});this.trigger(N),this.source.parentNode.insertBefore(this.originalSource,this.source),this.source.parentNode.removeChild(this.source),this.originalSource.style.display="",this.source.classList.remove(this.getClassNameFor("source:dragging")),this.originalSource.classList.remove(this.getClassNameFor("source:original")),this.originalSource.classList.add(this.getClassNameFor("source:placed")),this.sourceContainer.classList.add(this.getClassNameFor("container:placed")),this.sourceContainer.classList.remove(this.getClassNameFor("container:dragging")),document.body.classList.remove(this.getClassNameFor("body:dragging")),P(document.body,""),this.currentOver&&this.currentOver.classList.remove(this.getClassNameFor("draggable:over")),this.currentOverContainer&&this.currentOverContainer.classList.remove(this.getClassNameFor("container:over")),this.lastPlacedSource=this.originalSource,this.lastPlacedContainer=this.sourceContainer,this.placedTimeoutID=setTimeout(()=>{this.lastPlacedSource&&this.lastPlacedSource.classList.remove(this.getClassNameFor("source:placed")),this.lastPlacedContainer&&this.lastPlacedContainer.classList.remove(this.getClassNameFor("container:placed")),this.lastPlacedSource=null,this.lastPlacedContainer=null},this.options.placedTimeout),this.source=null,this.originalSource=null,this.currentOverContainer=null,this.currentOver=null,this.sourceContainer=null}[h](I){if(!this.dragging)return;const N=C(I),H=this.source||(0,M.closest)(N.originalEvent.target,this.options.draggable),K=new r.DragPressureEvent({sensorEvent:N,source:H,pressure:N.pressure});this.trigger(K)}}b.default=w,w.Plugins={Announcement:d.Announcement,Focusable:d.Focusable,Mirror:d.Mirror,Scrollable:d.Scrollable};function C(D){return D.detail}function P(D,I){D.style.webkitUserSelect=I,D.style.mozUserSelect=I,D.style.msUserSelect=I,D.style.oUserSelect=I,D.style.userSelect=I}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(4),M=i(E),d=S(3);function i(h){return h&&h.__esModule?h:{default:h}}const a=Symbol("onMouseForceWillBegin"),l=Symbol("onMouseForceDown"),e=Symbol("onMouseDown"),r=Symbol("onMouseForceChange"),n=Symbol("onMouseMove"),o=Symbol("onMouseUp"),u=Symbol("onMouseForceGlobalChange");class s extends M.default{constructor(g=[],v={}){super(g,v),this.mightDrag=!1,this[a]=this[a].bind(this),this[l]=this[l].bind(this),this[e]=this[e].bind(this),this[r]=this[r].bind(this),this[n]=this[n].bind(this),this[o]=this[o].bind(this)}attach(){for(const g of this.containers)g.addEventListener("webkitmouseforcewillbegin",this[a],!1),g.addEventListener("webkitmouseforcedown",this[l],!1),g.addEventListener("mousedown",this[e],!0),g.addEventListener("webkitmouseforcechanged",this[r],!1);document.addEventListener("mousemove",this[n]),document.addEventListener("mouseup",this[o])}detach(){for(const g of this.containers)g.removeEventListener("webkitmouseforcewillbegin",this[a],!1),g.removeEventListener("webkitmouseforcedown",this[l],!1),g.removeEventListener("mousedown",this[e],!0),g.removeEventListener("webkitmouseforcechanged",this[r],!1);document.removeEventListener("mousemove",this[n]),document.removeEventListener("mouseup",this[o])}[a](g){g.preventDefault(),this.mightDrag=!0}[l](g){if(this.dragging)return;const v=document.elementFromPoint(g.clientX,g.clientY),_=g.currentTarget,w=new d.DragStartSensorEvent({clientX:g.clientX,clientY:g.clientY,target:v,container:_,originalEvent:g});this.trigger(_,w),this.currentContainer=_,this.dragging=!w.canceled(),this.mightDrag=!1}[o](g){if(!this.dragging)return;const v=new d.DragStopSensorEvent({clientX:g.clientX,clientY:g.clientY,target:null,container:this.currentContainer,originalEvent:g});this.trigger(this.currentContainer,v),this.currentContainer=null,this.dragging=!1,this.mightDrag=!1}[e](g){!this.mightDrag||(g.stopPropagation(),g.stopImmediatePropagation(),g.preventDefault())}[n](g){if(!this.dragging)return;const v=document.elementFromPoint(g.clientX,g.clientY),_=new d.DragMoveSensorEvent({clientX:g.clientX,clientY:g.clientY,target:v,container:this.currentContainer,originalEvent:g});this.trigger(this.currentContainer,_)}[r](g){if(this.dragging)return;const v=g.target,_=g.currentTarget,w=new d.DragPressureSensorEvent({pressure:g.webkitForce,clientX:g.clientX,clientY:g.clientY,target:v,container:_,originalEvent:g});this.trigger(_,w)}[u](g){if(!this.dragging)return;const v=g.target,_=new d.DragPressureSensorEvent({pressure:g.webkitForce,clientX:g.clientX,clientY:g.clientY,target:v,container:this.currentContainer,originalEvent:g});this.trigger(this.currentContainer,_)}}b.default=s},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(38),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(2),M=S(4),d=a(M),i=S(3);function a(g){return g&&g.__esModule?g:{default:g}}const l=Symbol("onMouseDown"),e=Symbol("onMouseUp"),r=Symbol("onDragStart"),n=Symbol("onDragOver"),o=Symbol("onDragEnd"),u=Symbol("onDrop"),s=Symbol("reset");class h extends d.default{constructor(v=[],_={}){super(v,_),this.mouseDownTimeout=null,this.draggableElement=null,this.nativeDraggableElement=null,this[l]=this[l].bind(this),this[e]=this[e].bind(this),this[r]=this[r].bind(this),this[n]=this[n].bind(this),this[o]=this[o].bind(this),this[u]=this[u].bind(this)}attach(){document.addEventListener("mousedown",this[l],!0)}detach(){document.removeEventListener("mousedown",this[l],!0)}[r](v){v.dataTransfer.setData("text",""),v.dataTransfer.effectAllowed=this.options.type;const _=document.elementFromPoint(v.clientX,v.clientY);if(this.currentContainer=(0,E.closest)(v.target,this.containers),!this.currentContainer)return;const w=new i.DragStartSensorEvent({clientX:v.clientX,clientY:v.clientY,target:_,container:this.currentContainer,originalEvent:v});setTimeout(()=>{this.trigger(this.currentContainer,w),w.canceled()?this.dragging=!1:this.dragging=!0},0)}[n](v){if(!this.dragging)return;const _=document.elementFromPoint(v.clientX,v.clientY),w=this.currentContainer,C=new i.DragMoveSensorEvent({clientX:v.clientX,clientY:v.clientY,target:_,container:w,originalEvent:v});this.trigger(w,C),C.canceled()||(v.preventDefault(),v.dataTransfer.dropEffect=this.options.type)}[o](v){if(!this.dragging)return;document.removeEventListener("mouseup",this[e],!0);const _=document.elementFromPoint(v.clientX,v.clientY),w=this.currentContainer,C=new i.DragStopSensorEvent({clientX:v.clientX,clientY:v.clientY,target:_,container:w,originalEvent:v});this.trigger(w,C),this.dragging=!1,this[s]()}[u](v){v.preventDefault()}[l](v){if(v.target&&(v.target.form||v.target.contenteditable))return;const _=(0,E.closest)(v.target,C=>C.draggable);_&&(_.draggable=!1,this.nativeDraggableElement=_),document.addEventListener("mouseup",this[e],!0),document.addEventListener("dragstart",this[r],!1),document.addEventListener("dragover",this[n],!1),document.addEventListener("dragend",this[o],!1),document.addEventListener("drop",this[u],!1);const w=(0,E.closest)(v.target,this.options.draggable);!w||(this.mouseDownTimeout=setTimeout(()=>{w.draggable=!0,this.draggableElement=w},this.options.delay))}[e](){this[s]()}[s](){clearTimeout(this.mouseDownTimeout),document.removeEventListener("mouseup",this[e],!0),document.removeEventListener("dragstart",this[r],!1),document.removeEventListener("dragover",this[n],!1),document.removeEventListener("dragend",this[o],!1),document.removeEventListener("drop",this[u],!1),this.nativeDraggableElement&&(this.nativeDraggableElement.draggable=!0,this.nativeDraggableElement=null),this.draggableElement&&(this.draggableElement.draggable=!1,this.draggableElement=null)}}b.default=h},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(40),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(2),M=S(4),d=a(M),i=S(3);function a(h){return h&&h.__esModule?h:{default:h}}const l=Symbol("onTouchStart"),e=Symbol("onTouchHold"),r=Symbol("onTouchEnd"),n=Symbol("onTouchMove");let o=!1;window.addEventListener("touchmove",h=>{!o||h.preventDefault()},{passive:!1});class u extends d.default{constructor(g=[],v={}){super(g,v),this.currentScrollableParent=null,this.tapTimeout=null,this.touchMoved=!1,this[l]=this[l].bind(this),this[e]=this[e].bind(this),this[r]=this[r].bind(this),this[n]=this[n].bind(this)}attach(){document.addEventListener("touchstart",this[l])}detach(){document.removeEventListener("touchstart",this[l])}[l](g){const v=(0,E.closest)(g.target,this.containers);!v||(document.addEventListener("touchmove",this[n]),document.addEventListener("touchend",this[r]),document.addEventListener("touchcancel",this[r]),v.addEventListener("contextmenu",s),this.currentContainer=v,this.tapTimeout=setTimeout(this[e](g,v),this.options.delay))}[e](g,v){return()=>{if(this.touchMoved)return;const _=g.touches[0]||g.changedTouches[0],w=g.target,C=new i.DragStartSensorEvent({clientX:_.pageX,clientY:_.pageY,target:w,container:v,originalEvent:g});this.trigger(v,C),this.dragging=!C.canceled(),o=this.dragging}}[n](g){if(this.touchMoved=!0,!this.dragging)return;const v=g.touches[0]||g.changedTouches[0],_=document.elementFromPoint(v.pageX-window.scrollX,v.pageY-window.scrollY),w=new i.DragMoveSensorEvent({clientX:v.pageX,clientY:v.pageY,target:_,container:this.currentContainer,originalEvent:g});this.trigger(this.currentContainer,w)}[r](g){if(this.touchMoved=!1,o=!1,document.removeEventListener("touchend",this[r]),document.removeEventListener("touchcancel",this[r]),document.removeEventListener("touchmove",this[n]),this.currentContainer&&this.currentContainer.removeEventListener("contextmenu",s),clearTimeout(this.tapTimeout),!this.dragging)return;const v=g.touches[0]||g.changedTouches[0],_=document.elementFromPoint(v.pageX-window.scrollX,v.pageY-window.scrollY);g.preventDefault();const w=new i.DragStopSensorEvent({clientX:v.pageX,clientY:v.pageY,target:_,container:this.currentContainer,originalEvent:g});this.trigger(this.currentContainer,w),this.currentContainer=null,this.dragging=!1}}b.default=u;function s(h){h.preventDefault(),h.stopPropagation()}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(42),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.DragPressureSensorEvent=b.DragStopSensorEvent=b.DragMoveSensorEvent=b.DragStartSensorEvent=b.SensorEvent=void 0;var E=S(0),M=d(E);function d(n){return n&&n.__esModule?n:{default:n}}class i extends M.default{get originalEvent(){return this.data.originalEvent}get clientX(){return this.data.clientX}get clientY(){return this.data.clientY}get target(){return this.data.target}get container(){return this.data.container}get pressure(){return this.data.pressure}}b.SensorEvent=i;class a extends i{}b.DragStartSensorEvent=a,a.type="drag:start";class l extends i{}b.DragMoveSensorEvent=l,l.type="drag:move";class e extends i{}b.DragStopSensorEvent=e,e.type="drag:stop";class r extends i{}b.DragPressureSensorEvent=r,r.type="drag:pressure"},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(2),M=S(4),d=a(M),i=S(3);function a(s){return s&&s.__esModule?s:{default:s}}const l=Symbol("onContextMenuWhileDragging"),e=Symbol("onMouseDown"),r=Symbol("onMouseMove"),n=Symbol("onMouseUp");class o extends d.default{constructor(h=[],g={}){super(h,g),this.mouseDown=!1,this.mouseDownTimeout=null,this.openedContextMenu=!1,this[l]=this[l].bind(this),this[e]=this[e].bind(this),this[r]=this[r].bind(this),this[n]=this[n].bind(this)}attach(){document.addEventListener("mousedown",this[e],!0)}detach(){document.removeEventListener("mousedown",this[e],!0)}[e](h){if(h.button!==0||h.ctrlKey||h.metaKey)return;document.addEventListener("mouseup",this[n]);const g=document.elementFromPoint(h.clientX,h.clientY),v=(0,E.closest)(g,this.containers);!v||(document.addEventListener("dragstart",u),this.mouseDown=!0,clearTimeout(this.mouseDownTimeout),this.mouseDownTimeout=setTimeout(()=>{if(!this.mouseDown)return;const _=new i.DragStartSensorEvent({clientX:h.clientX,clientY:h.clientY,target:g,container:v,originalEvent:h});this.trigger(v,_),this.currentContainer=v,this.dragging=!_.canceled(),this.dragging&&(document.addEventListener("contextmenu",this[l]),document.addEventListener("mousemove",this[r]))},this.options.delay))}[r](h){if(!this.dragging)return;const g=document.elementFromPoint(h.clientX,h.clientY),v=new i.DragMoveSensorEvent({clientX:h.clientX,clientY:h.clientY,target:g,container:this.currentContainer,originalEvent:h});this.trigger(this.currentContainer,v)}[n](h){if(this.mouseDown=Boolean(this.openedContextMenu),this.openedContextMenu){this.openedContextMenu=!1;return}if(document.removeEventListener("mouseup",this[n]),document.removeEventListener("dragstart",u),!this.dragging)return;const g=document.elementFromPoint(h.clientX,h.clientY),v=new i.DragStopSensorEvent({clientX:h.clientX,clientY:h.clientY,target:g,container:this.currentContainer,originalEvent:h});this.trigger(this.currentContainer,v),document.removeEventListener("contextmenu",this[l]),document.removeEventListener("mousemove",this[r]),this.currentContainer=null,this.dragging=!1}[l](h){h.preventDefault(),this.openedContextMenu=!0}}b.default=o;function u(s){s.preventDefault()}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(45),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=Object.assign||function(d){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(d[l]=a[l])}return d};class M{constructor(i=[],a={}){this.containers=[...i],this.options=E({},a),this.dragging=!1,this.currentContainer=null}attach(){return this}detach(){return this}addContainer(...i){this.containers=[...this.containers,...i]}removeContainer(...i){this.containers=this.containers.filter(a=>!i.includes(a))}trigger(i,a){const l=document.createEvent("Event");return l.detail=a,l.initEvent(a.type,!0,!0),i.dispatchEvent(l),this.lastEvent=a,a}}b.default=M},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.default=E;function E(M){return requestAnimationFrame(()=>{requestAnimationFrame(M)})}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(48),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.default=M;const E=Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector;function M(d,i){if(!d)return null;const a=i,l=i,e=i,r=i,n=Boolean(typeof i=="string"),o=Boolean(typeof i=="function"),u=Boolean(i instanceof NodeList||i instanceof Array),s=Boolean(i instanceof HTMLElement);function h(v){return v&&(n?E.call(v,a):u?[...e].includes(v):s?r===v:o?l(v):null)}let g=d;do{if(g=g.correspondingUseElement||g.correspondingElement||g,h(g))return g;g=g.parentNode}while(g&&g!==document.body&&g!==document);return null}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(50),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultOptions=b.scroll=b.onDragStop=b.onDragMove=b.onDragStart=void 0;var E=Object.assign||function(_){for(var w=1;w<arguments.length;w++){var C=arguments[w];for(var P in C)Object.prototype.hasOwnProperty.call(C,P)&&(_[P]=C[P])}return _},M=S(1),d=a(M),i=S(2);function a(_){return _&&_.__esModule?_:{default:_}}const l=b.onDragStart=Symbol("onDragStart"),e=b.onDragMove=Symbol("onDragMove"),r=b.onDragStop=Symbol("onDragStop"),n=b.scroll=Symbol("scroll"),o=b.defaultOptions={speed:6,sensitivity:50,scrollableElements:[]};class u extends d.default{constructor(w){super(w),this.options=E({},o,this.getOptions()),this.currentMousePosition=null,this.scrollAnimationFrame=null,this.scrollableElement=null,this.findScrollableElementFrame=null,this[l]=this[l].bind(this),this[e]=this[e].bind(this),this[r]=this[r].bind(this),this[n]=this[n].bind(this)}attach(){this.draggable.on("drag:start",this[l]).on("drag:move",this[e]).on("drag:stop",this[r])}detach(){this.draggable.off("drag:start",this[l]).off("drag:move",this[e]).off("drag:stop",this[r])}getOptions(){return this.draggable.options.scrollable||{}}getScrollableElement(w){return this.hasDefinedScrollableElements()?(0,i.closest)(w,this.options.scrollableElements)||document.documentElement:g(w)}hasDefinedScrollableElements(){return Boolean(this.options.scrollableElements.length!==0)}[l](w){this.findScrollableElementFrame=requestAnimationFrame(()=>{this.scrollableElement=this.getScrollableElement(w.source)})}[e](w){if(this.findScrollableElementFrame=requestAnimationFrame(()=>{this.scrollableElement=this.getScrollableElement(w.sensorEvent.target)}),!this.scrollableElement)return;const C=w.sensorEvent,P={x:0,y:0};"ontouchstart"in window&&(P.y=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,P.x=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),this.currentMousePosition={clientX:C.clientX-P.x,clientY:C.clientY-P.y},this.scrollAnimationFrame=requestAnimationFrame(this[n])}[r](){cancelAnimationFrame(this.scrollAnimationFrame),cancelAnimationFrame(this.findScrollableElementFrame),this.scrollableElement=null,this.scrollAnimationFrame=null,this.findScrollableElementFrame=null,this.currentMousePosition=null}[n](){if(!this.scrollableElement||!this.currentMousePosition)return;cancelAnimationFrame(this.scrollAnimationFrame);const{speed:w,sensitivity:C}=this.options,P=this.scrollableElement.getBoundingClientRect(),D=P.bottom>window.innerHeight,N=P.top<0||D,H=v(),K=this.scrollableElement,J=this.currentMousePosition.clientX,Q=this.currentMousePosition.clientY;if(K!==document.body&&K!==document.documentElement&&!N){const{offsetHeight:tt,offsetWidth:dt}=K;P.top+tt-Q<C?K.scrollTop+=w:Q-P.top<C&&(K.scrollTop-=w),P.left+dt-J<C?K.scrollLeft+=w:J-P.left<C&&(K.scrollLeft-=w)}else{const{innerHeight:tt,innerWidth:dt}=window;Q<C?H.scrollTop-=w:tt-Q<C&&(H.scrollTop+=w),J<C?H.scrollLeft-=w:dt-J<C&&(H.scrollLeft+=w)}this.scrollAnimationFrame=requestAnimationFrame(this[n])}}b.default=u;function s(_){const w=/(auto|scroll)/,C=getComputedStyle(_,null),P=C.getPropertyValue("overflow")+C.getPropertyValue("overflow-y")+C.getPropertyValue("overflow-x");return w.test(P)}function h(_){return getComputedStyle(_).getPropertyValue("position")==="static"}function g(_){if(!_)return v();const w=getComputedStyle(_).getPropertyValue("position"),C=w==="absolute",P=(0,i.closest)(_,D=>C&&h(D)?!1:s(D));return w==="fixed"||!P?v():P}function v(){return document.scrollingElement||document.documentElement}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultOptions=void 0;var E=S(52),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default,b.defaultOptions=E.defaultOptions},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.MirrorDestroyEvent=b.MirrorMoveEvent=b.MirrorAttachedEvent=b.MirrorCreatedEvent=b.MirrorCreateEvent=b.MirrorEvent=void 0;var E=S(0),M=d(E);function d(o){return o&&o.__esModule?o:{default:o}}class i extends M.default{get source(){return this.data.source}get originalSource(){return this.data.originalSource}get sourceContainer(){return this.data.sourceContainer}get sensorEvent(){return this.data.sensorEvent}get dragEvent(){return this.data.dragEvent}get originalEvent(){return this.sensorEvent?this.sensorEvent.originalEvent:null}}b.MirrorEvent=i;class a extends i{}b.MirrorCreateEvent=a,a.type="mirror:create";class l extends i{get mirror(){return this.data.mirror}}b.MirrorCreatedEvent=l,l.type="mirror:created";class e extends i{get mirror(){return this.data.mirror}}b.MirrorAttachedEvent=e,e.type="mirror:attached";class r extends i{get mirror(){return this.data.mirror}}b.MirrorMoveEvent=r,r.type="mirror:move",r.cancelable=!0;class n extends i{get mirror(){return this.data.mirror}}b.MirrorDestroyEvent=n,n.type="mirror:destroy",n.cancelable=!0},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(54);Object.keys(E).forEach(function(M){M==="default"||M==="__esModule"||Object.defineProperty(b,M,{enumerable:!0,get:function(){return E[M]}})})},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultOptions=b.getAppendableContainer=b.onScroll=b.onMirrorMove=b.onMirrorCreated=b.onDragStop=b.onDragMove=b.onDragStart=void 0;var E=Object.assign||function(K){for(var J=1;J<arguments.length;J++){var Q=arguments[J];for(var tt in Q)Object.prototype.hasOwnProperty.call(Q,tt)&&(K[tt]=Q[tt])}return K},M=S(1),d=a(M),i=S(55);function a(K){return K&&K.__esModule?K:{default:K}}function l(K,J){var Q={};for(var tt in K)J.indexOf(tt)>=0||!Object.prototype.hasOwnProperty.call(K,tt)||(Q[tt]=K[tt]);return Q}const e=b.onDragStart=Symbol("onDragStart"),r=b.onDragMove=Symbol("onDragMove"),n=b.onDragStop=Symbol("onDragStop"),o=b.onMirrorCreated=Symbol("onMirrorCreated"),u=b.onMirrorMove=Symbol("onMirrorMove"),s=b.onScroll=Symbol("onScroll"),h=b.getAppendableContainer=Symbol("getAppendableContainer"),g=b.defaultOptions={constrainDimensions:!1,xAxis:!0,yAxis:!0,cursorOffsetX:null,cursorOffsetY:null};class v extends d.default{constructor(J){super(J),this.options=E({},g,this.getOptions()),this.scrollOffset={x:0,y:0},this.initialScrollOffset={x:window.scrollX,y:window.scrollY},this[e]=this[e].bind(this),this[r]=this[r].bind(this),this[n]=this[n].bind(this),this[o]=this[o].bind(this),this[u]=this[u].bind(this),this[s]=this[s].bind(this)}attach(){this.draggable.on("drag:start",this[e]).on("drag:move",this[r]).on("drag:stop",this[n]).on("mirror:created",this[o]).on("mirror:move",this[u])}detach(){this.draggable.off("drag:start",this[e]).off("drag:move",this[r]).off("drag:stop",this[n]).off("mirror:created",this[o]).off("mirror:move",this[u])}getOptions(){return this.draggable.options.mirror||{}}[e](J){if(J.canceled())return;"ontouchstart"in window&&document.addEventListener("scroll",this[s],!0),this.initialScrollOffset={x:window.scrollX,y:window.scrollY};const{source:Q,originalSource:tt,sourceContainer:dt,sensorEvent:rt}=J,_t=new i.MirrorCreateEvent({source:Q,originalSource:tt,sourceContainer:dt,sensorEvent:rt,dragEvent:J});if(this.draggable.trigger(_t),H(rt)||_t.canceled())return;const T=this[h](Q)||dt;this.mirror=Q.cloneNode(!0);const B=new i.MirrorCreatedEvent({source:Q,originalSource:tt,sourceContainer:dt,sensorEvent:rt,dragEvent:J,mirror:this.mirror}),R=new i.MirrorAttachedEvent({source:Q,originalSource:tt,sourceContainer:dt,sensorEvent:rt,dragEvent:J,mirror:this.mirror});this.draggable.trigger(B),T.appendChild(this.mirror),this.draggable.trigger(R)}[r](J){if(!this.mirror||J.canceled())return;const{source:Q,originalSource:tt,sourceContainer:dt,sensorEvent:rt}=J,_t=new i.MirrorMoveEvent({source:Q,originalSource:tt,sourceContainer:dt,sensorEvent:rt,dragEvent:J,mirror:this.mirror});this.draggable.trigger(_t)}[n](J){if("ontouchstart"in window&&document.removeEventListener("scroll",this[s],!0),this.initialScrollOffset={x:0,y:0},this.scrollOffset={x:0,y:0},!this.mirror)return;const{source:Q,sourceContainer:tt,sensorEvent:dt}=J,rt=new i.MirrorDestroyEvent({source:Q,mirror:this.mirror,sourceContainer:tt,sensorEvent:dt,dragEvent:J});this.draggable.trigger(rt),rt.canceled()||this.mirror.parentNode.removeChild(this.mirror)}[s](){this.scrollOffset={x:window.scrollX-this.initialScrollOffset.x,y:window.scrollY-this.initialScrollOffset.y}}[o]({mirror:J,source:Q,sensorEvent:tt}){const dt=this.draggable.getClassNameFor("mirror"),rt=T=>{let{mirrorOffset:B,initialX:R,initialY:V}=T,G=l(T,["mirrorOffset","initialX","initialY"]);return this.mirrorOffset=B,this.initialX=R,this.initialY=V,E({mirrorOffset:B,initialX:R,initialY:V},G)},_t={mirror:J,source:Q,sensorEvent:tt,mirrorClass:dt,scrollOffset:this.scrollOffset,options:this.options};return Promise.resolve(_t).then(_).then(w).then(C).then(P).then(I({initial:!0})).then(D).then(rt)}[u](J){if(J.canceled())return null;const Q={mirror:J.mirror,sensorEvent:J.sensorEvent,mirrorOffset:this.mirrorOffset,options:this.options,initialX:this.initialX,initialY:this.initialY,scrollOffset:this.scrollOffset};return Promise.resolve(Q).then(I({raf:!0}))}[h](J){const Q=this.options.appendTo;return typeof Q=="string"?document.querySelector(Q):Q instanceof HTMLElement?Q:typeof Q=="function"?Q(J):J.parentNode}}b.default=v;function _(K){let{source:J}=K,Q=l(K,["source"]);return N(tt=>{const dt=J.getBoundingClientRect();tt(E({source:J,sourceRect:dt},Q))})}function w(K){let{sensorEvent:J,sourceRect:Q,options:tt}=K,dt=l(K,["sensorEvent","sourceRect","options"]);return N(rt=>{const _t=tt.cursorOffsetY===null?J.clientY-Q.top:tt.cursorOffsetY,T=tt.cursorOffsetX===null?J.clientX-Q.left:tt.cursorOffsetX;rt(E({sensorEvent:J,sourceRect:Q,mirrorOffset:{top:_t,left:T},options:tt},dt))})}function C(K){let{mirror:J,source:Q,options:tt}=K,dt=l(K,["mirror","source","options"]);return N(rt=>{let _t,T;if(tt.constrainDimensions){const B=getComputedStyle(Q);_t=B.getPropertyValue("height"),T=B.getPropertyValue("width")}J.style.position="fixed",J.style.pointerEvents="none",J.style.top=0,J.style.left=0,J.style.margin=0,tt.constrainDimensions&&(J.style.height=_t,J.style.width=T),rt(E({mirror:J,source:Q,options:tt},dt))})}function P(K){let{mirror:J,mirrorClass:Q}=K,tt=l(K,["mirror","mirrorClass"]);return N(dt=>{J.classList.add(Q),dt(E({mirror:J,mirrorClass:Q},tt))})}function D(K){let{mirror:J}=K,Q=l(K,["mirror"]);return N(tt=>{J.removeAttribute("id"),delete J.id,tt(E({mirror:J},Q))})}function I({withFrame:K=!1,initial:J=!1}={}){return Q=>{let{mirror:tt,sensorEvent:dt,mirrorOffset:rt,initialY:_t,initialX:T,scrollOffset:B,options:R}=Q,V=l(Q,["mirror","sensorEvent","mirrorOffset","initialY","initialX","scrollOffset","options"]);return N(G=>{const F=E({mirror:tt,sensorEvent:dt,mirrorOffset:rt,options:R},V);if(rt){const k=dt.clientX-rt.left-B.x,X=dt.clientY-rt.top-B.y;R.xAxis&&R.yAxis||J?tt.style.transform=`translate3d(${k}px, ${X}px, 0)`:R.xAxis&&!R.yAxis?tt.style.transform=`translate3d(${k}px, ${_t}px, 0)`:R.yAxis&&!R.xAxis&&(tt.style.transform=`translate3d(${T}px, ${X}px, 0)`),J&&(F.initialX=k,F.initialY=X)}G(F)},{frame:K})}}function N(K,{raf:J=!1}={}){return new Promise((Q,tt)=>{J?requestAnimationFrame(()=>{K(Q,tt)}):K(Q,tt)})}function H(K){return/^drag/.test(K.originalEvent.type)}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultOptions=void 0;var E=S(56),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default,b.defaultOptions=E.defaultOptions},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=Object.assign||function(s){for(var h=1;h<arguments.length;h++){var g=arguments[h];for(var v in g)Object.prototype.hasOwnProperty.call(g,v)&&(s[v]=g[v])}return s},M=S(1),d=i(M);function i(s){return s&&s.__esModule?s:{default:s}}const a=Symbol("onInitialize"),l=Symbol("onDestroy"),e={};class r extends d.default{constructor(h){super(h),this.options=E({},e,this.getOptions()),this[a]=this[a].bind(this),this[l]=this[l].bind(this)}attach(){this.draggable.on("draggable:initialize",this[a]).on("draggable:destroy",this[l])}detach(){this.draggable.off("draggable:initialize",this[a]).off("draggable:destroy",this[l])}getOptions(){return this.draggable.options.focusable||{}}getElements(){return[...this.draggable.containers,...this.draggable.getDraggableElements()]}[a](){requestAnimationFrame(()=>{this.getElements().forEach(h=>o(h))})}[l](){requestAnimationFrame(()=>{this.getElements().forEach(h=>u(h))})}}b.default=r;const n=[];function o(s){Boolean(!s.getAttribute("tabindex")&&s.tabIndex===-1)&&(n.push(s),s.tabIndex=0)}function u(s){const h=n.indexOf(s);h!==-1&&(s.tabIndex=-1,n.splice(h,1))}},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=S(58),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});class E{constructor(d){this.draggable=d}attach(){throw new Error("Not Implemented")}detach(){throw new Error("Not Implemented")}}b.default=E},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultOptions=void 0;var E=Object.assign||function(C){for(var P=1;P<arguments.length;P++){var D=arguments[P];for(var I in D)Object.prototype.hasOwnProperty.call(D,I)&&(C[I]=D[I])}return C},M=S(1),d=i(M);function i(C){return C&&C.__esModule?C:{default:C}}const a=Symbol("onInitialize"),l=Symbol("onDestroy"),e=Symbol("announceEvent"),r=Symbol("announceMessage"),n="aria-relevant",o="aria-atomic",u="aria-live",s="role",h=b.defaultOptions={expire:7e3};class g extends d.default{constructor(P){super(P),this.options=E({},h,this.getOptions()),this.originalTriggerMethod=this.draggable.trigger,this[a]=this[a].bind(this),this[l]=this[l].bind(this)}attach(){this.draggable.on("draggable:initialize",this[a])}detach(){this.draggable.off("draggable:destroy",this[l])}getOptions(){return this.draggable.options.announcements||{}}[e](P){const D=this.options[P.type];D&&typeof D=="string"&&this[r](D),D&&typeof D=="function"&&this[r](D(P))}[r](P){_(P,{expire:this.options.expire})}[a](){this.draggable.trigger=P=>{try{this[e](P)}finally{this.originalTriggerMethod.call(this.draggable,P)}}}[l](){this.draggable.trigger=this.originalTriggerMethod}}b.default=g;const v=w();function _(C,{expire:P}){const D=document.createElement("div");return D.textContent=C,v.appendChild(D),setTimeout(()=>{v.removeChild(D)},P)}function w(){const C=document.createElement("div");return C.setAttribute("id","draggable-live-region"),C.setAttribute(n,"additions"),C.setAttribute(o,"true"),C.setAttribute(u,"assertive"),C.setAttribute(s,"log"),C.style.position="fixed",C.style.width="1px",C.style.height="1px",C.style.top="-1px",C.style.overflow="hidden",C}document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(v)})},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultOptions=void 0;var E=S(61),M=d(E);function d(i){return i&&i.__esModule?i:{default:i}}b.default=M.default,b.defaultOptions=E.defaultOptions},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.DraggableDestroyEvent=b.DraggableInitializedEvent=b.DraggableEvent=void 0;var E=S(0),M=d(E);function d(e){return e&&e.__esModule?e:{default:e}}class i extends M.default{get draggable(){return this.data.draggable}}b.DraggableEvent=i,i.type="draggable";class a extends i{}b.DraggableInitializedEvent=a,a.type="draggable:initialize";class l extends i{}b.DraggableDestroyEvent=l,l.type="draggable:destroy"},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0});var E=Object.assign||function(i){for(var a=1;a<arguments.length;a++){var l=arguments[a];for(var e in l)Object.prototype.hasOwnProperty.call(l,e)&&(i[e]=l[e])}return i};const M=Symbol("canceled");class d{constructor(a){this[M]=!1,this.data=a}get type(){return this.constructor.type}get cancelable(){return this.constructor.cancelable}cancel(){this[M]=!0}canceled(){return Boolean(this[M])}clone(a){return new this.constructor(E({},this.data,a))}}b.default=d,d.type="event",d.cancelable=!1},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.DragStopEvent=b.DragPressureEvent=b.DragOutContainerEvent=b.DragOverContainerEvent=b.DragOutEvent=b.DragOverEvent=b.DragMoveEvent=b.DragStartEvent=b.DragEvent=void 0;var E=S(0),M=d(E);function d(h){return h&&h.__esModule?h:{default:h}}class i extends M.default{get source(){return this.data.source}get originalSource(){return this.data.originalSource}get mirror(){return this.data.mirror}get sourceContainer(){return this.data.sourceContainer}get sensorEvent(){return this.data.sensorEvent}get originalEvent(){return this.sensorEvent?this.sensorEvent.originalEvent:null}}b.DragEvent=i,i.type="drag";class a extends i{}b.DragStartEvent=a,a.type="drag:start",a.cancelable=!0;class l extends i{}b.DragMoveEvent=l,l.type="drag:move";class e extends i{get overContainer(){return this.data.overContainer}get over(){return this.data.over}}b.DragOverEvent=e,e.type="drag:over",e.cancelable=!0;class r extends i{get overContainer(){return this.data.overContainer}get over(){return this.data.over}}b.DragOutEvent=r,r.type="drag:out";class n extends i{get overContainer(){return this.data.overContainer}}b.DragOverContainerEvent=n,n.type="drag:over:container";class o extends i{get overContainer(){return this.data.overContainer}}b.DragOutContainerEvent=o,o.type="drag:out:container";class u extends i{get pressure(){return this.data.pressure}}b.DragPressureEvent=u,u.type="drag:pressure";class s extends i{}b.DragStopEvent=s,s.type="drag:stop"},function(y,b,S){Object.defineProperty(b,"__esModule",{value:!0}),b.Plugins=b.Sensors=b.Sortable=b.Swappable=b.Droppable=b.Draggable=b.BasePlugin=b.BaseEvent=void 0;var E=S(5);Object.defineProperty(b,"Draggable",{enumerable:!0,get:function(){return g(E).default}});var M=S(34);Object.defineProperty(b,"Droppable",{enumerable:!0,get:function(){return g(M).default}});var d=S(31);Object.defineProperty(b,"Swappable",{enumerable:!0,get:function(){return g(d).default}});var i=S(28);Object.defineProperty(b,"Sortable",{enumerable:!0,get:function(){return g(i).default}});var a=S(0),l=g(a),e=S(1),r=g(e),n=S(6),o=h(n),u=S(25),s=h(u);function h(v){if(v&&v.__esModule)return v;var _={};if(v!=null)for(var w in v)Object.prototype.hasOwnProperty.call(v,w)&&(_[w]=v[w]);return _.default=v,_}function g(v){return v&&v.__esModule?v:{default:v}}b.BaseEvent=l.default,b.BasePlugin=r.default,b.Sensors=o,b.Plugins=s}])})})(Fn);function Ni(A){throw new Error('Could not dynamically require "'+A+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Yr={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(A,p){(function(y){A.exports=y()})(function(){return function y(b,S,E){function M(a,l){if(!S[a]){if(!b[a]){var e=typeof Ni=="function"&&Ni;if(!l&&e)return e(a,!0);if(d)return d(a,!0);var r=new Error("Cannot find module '"+a+"'");throw r.code="MODULE_NOT_FOUND",r}var n=S[a]={exports:{}};b[a][0].call(n.exports,function(o){var u=b[a][1][o];return M(u||o)},n,n.exports,y,b,S,E)}return S[a].exports}for(var d=typeof Ni=="function"&&Ni,i=0;i<E.length;i++)M(E[i]);return M}({1:[function(y,b,S){(function(E){var M=E.MutationObserver||E.WebKitMutationObserver,d;if(M){var i=0,a=new M(o),l=E.document.createTextNode("");a.observe(l,{characterData:!0}),d=function(){l.data=i=++i%2}}else if(!E.setImmediate&&typeof E.MessageChannel<"u"){var e=new E.MessageChannel;e.port1.onmessage=o,d=function(){e.port2.postMessage(0)}}else"document"in E&&"onreadystatechange"in E.document.createElement("script")?d=function(){var s=E.document.createElement("script");s.onreadystatechange=function(){o(),s.onreadystatechange=null,s.parentNode.removeChild(s),s=null},E.document.documentElement.appendChild(s)}:d=function(){setTimeout(o,0)};var r,n=[];function o(){r=!0;for(var s,h,g=n.length;g;){for(h=n,n=[],s=-1;++s<g;)h[s]();g=n.length}r=!1}b.exports=u;function u(s){n.push(s)===1&&!r&&d()}}).call(this,typeof bi<"u"?bi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(y,b,S){var E=y(1);function M(){}var d={},i=["REJECTED"],a=["FULFILLED"],l=["PENDING"];b.exports=e;function e(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,w!==M&&u(this,w)}e.prototype.catch=function(w){return this.then(null,w)},e.prototype.then=function(w,C){if(typeof w!="function"&&this.state===a||typeof C!="function"&&this.state===i)return this;var P=new this.constructor(M);if(this.state!==l){var D=this.state===a?w:C;n(P,D,this.outcome)}else this.queue.push(new r(P,w,C));return P};function r(w,C,P){this.promise=w,typeof C=="function"&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),typeof P=="function"&&(this.onRejected=P,this.callRejected=this.otherCallRejected)}r.prototype.callFulfilled=function(w){d.resolve(this.promise,w)},r.prototype.otherCallFulfilled=function(w){n(this.promise,this.onFulfilled,w)},r.prototype.callRejected=function(w){d.reject(this.promise,w)},r.prototype.otherCallRejected=function(w){n(this.promise,this.onRejected,w)};function n(w,C,P){E(function(){var D;try{D=C(P)}catch(I){return d.reject(w,I)}D===w?d.reject(w,new TypeError("Cannot resolve promise with itself")):d.resolve(w,D)})}d.resolve=function(w,C){var P=s(o,C);if(P.status==="error")return d.reject(w,P.value);var D=P.value;if(D)u(w,D);else{w.state=a,w.outcome=C;for(var I=-1,N=w.queue.length;++I<N;)w.queue[I].callFulfilled(C)}return w},d.reject=function(w,C){w.state=i,w.outcome=C;for(var P=-1,D=w.queue.length;++P<D;)w.queue[P].callRejected(C);return w};function o(w){var C=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof C=="function")return function(){C.apply(w,arguments)}}function u(w,C){var P=!1;function D(K){P||(P=!0,d.reject(w,K))}function I(K){P||(P=!0,d.resolve(w,K))}function N(){C(I,D)}var H=s(N);H.status==="error"&&D(H.value)}function s(w,C){var P={};try{P.value=w(C),P.status="success"}catch(D){P.status="error",P.value=D}return P}e.resolve=h;function h(w){return w instanceof this?w:d.resolve(new this(M),w)}e.reject=g;function g(w){var C=new this(M);return d.reject(C,w)}e.all=v;function v(w){var C=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var P=w.length,D=!1;if(!P)return this.resolve([]);for(var I=new Array(P),N=0,H=-1,K=new this(M);++H<P;)J(w[H],H);return K;function J(Q,tt){C.resolve(Q).then(dt,function(rt){D||(D=!0,d.reject(K,rt))});function dt(rt){I[tt]=rt,++N===P&&!D&&(D=!0,d.resolve(K,I))}}}e.race=_;function _(w){var C=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var P=w.length,D=!1;if(!P)return this.resolve([]);for(var I=-1,N=new this(M);++I<P;)H(w[I]);return N;function H(K){C.resolve(K).then(function(J){D||(D=!0,d.resolve(N,J))},function(J){D||(D=!0,d.reject(N,J))})}}},{1:1}],3:[function(y,b,S){(function(E){typeof E.Promise!="function"&&(E.Promise=y(2))}).call(this,typeof bi<"u"?bi:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(y,b,S){var E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O};function M(O,z){if(!(O instanceof z))throw new TypeError("Cannot call a class as a function")}function d(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var i=d();function a(){try{if(!i||!i.open)return!1;var O=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),z=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!O||z)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function l(O,z){O=O||[],z=z||{};try{return new Blob(O,z)}catch(Y){if(Y.name!=="TypeError")throw Y;for(var L=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,U=new L,W=0;W<O.length;W+=1)U.append(O[W]);return U.getBlob(z.type)}}typeof Promise>"u"&&y(3);var e=Promise;function r(O,z){z&&O.then(function(L){z(null,L)},function(L){z(L)})}function n(O,z,L){typeof z=="function"&&O.then(z),typeof L=="function"&&O.catch(L)}function o(O){return typeof O!="string"&&(console.warn(O+" used as a key, but it is not a string."),O=String(O)),O}function u(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var s="local-forage-detect-blob-support",h=void 0,g={},v=Object.prototype.toString,_="readonly",w="readwrite";function C(O){for(var z=O.length,L=new ArrayBuffer(z),U=new Uint8Array(L),W=0;W<z;W++)U[W]=O.charCodeAt(W);return L}function P(O){return new e(function(z){var L=O.transaction(s,w),U=l([""]);L.objectStore(s).put(U,"key"),L.onabort=function(W){W.preventDefault(),W.stopPropagation(),z(!1)},L.oncomplete=function(){var W=navigator.userAgent.match(/Chrome\/(\d+)/),Y=navigator.userAgent.match(/Edge\//);z(Y||!W||parseInt(W[1],10)>=43)}}).catch(function(){return!1})}function D(O){return typeof h=="boolean"?e.resolve(h):P(O).then(function(z){return h=z,h})}function I(O){var z=g[O.name],L={};L.promise=new e(function(U,W){L.resolve=U,L.reject=W}),z.deferredOperations.push(L),z.dbReady?z.dbReady=z.dbReady.then(function(){return L.promise}):z.dbReady=L.promise}function N(O){var z=g[O.name],L=z.deferredOperations.pop();if(L)return L.resolve(),L.promise}function H(O,z){var L=g[O.name],U=L.deferredOperations.pop();if(U)return U.reject(z),U.promise}function K(O,z){return new e(function(L,U){if(g[O.name]=g[O.name]||V(),O.db)if(z)I(O),O.db.close();else return L(O.db);var W=[O.name];z&&W.push(O.version);var Y=i.open.apply(i,W);z&&(Y.onupgradeneeded=function(at){var pt=Y.result;try{pt.createObjectStore(O.storeName),at.oldVersion<=1&&pt.createObjectStore(s)}catch(gt){if(gt.name==="ConstraintError")console.warn('The database "'+O.name+'" has been upgraded from version '+at.oldVersion+" to version "+at.newVersion+', but the storage "'+O.storeName+'" already exists.');else throw gt}}),Y.onerror=function(at){at.preventDefault(),U(Y.error)},Y.onsuccess=function(){var at=Y.result;at.onversionchange=function(pt){pt.target.close()},L(at),N(O)}})}function J(O){return K(O,!1)}function Q(O){return K(O,!0)}function tt(O,z){if(!O.db)return!0;var L=!O.db.objectStoreNames.contains(O.storeName),U=O.version<O.db.version,W=O.version>O.db.version;if(U&&(O.version!==z&&console.warn('The database "'+O.name+`" can't be downgraded from version `+O.db.version+" to version "+O.version+"."),O.version=O.db.version),W||L){if(L){var Y=O.db.version+1;Y>O.version&&(O.version=Y)}return!0}return!1}function dt(O){return new e(function(z,L){var U=new FileReader;U.onerror=L,U.onloadend=function(W){var Y=btoa(W.target.result||"");z({__local_forage_encoded_blob:!0,data:Y,type:O.type})},U.readAsBinaryString(O)})}function rt(O){var z=C(atob(O.data));return l([z],{type:O.type})}function _t(O){return O&&O.__local_forage_encoded_blob}function T(O){var z=this,L=z._initReady().then(function(){var U=g[z._dbInfo.name];if(U&&U.dbReady)return U.dbReady});return n(L,O,O),L}function B(O){I(O);for(var z=g[O.name],L=z.forages,U=0;U<L.length;U++){var W=L[U];W._dbInfo.db&&(W._dbInfo.db.close(),W._dbInfo.db=null)}return O.db=null,J(O).then(function(Y){return O.db=Y,tt(O)?Q(O):Y}).then(function(Y){O.db=z.db=Y;for(var at=0;at<L.length;at++)L[at]._dbInfo.db=Y}).catch(function(Y){throw H(O,Y),Y})}function R(O,z,L,U){U===void 0&&(U=1);try{var W=O.db.transaction(O.storeName,z);L(null,W)}catch(Y){if(U>0&&(!O.db||Y.name==="InvalidStateError"||Y.name==="NotFoundError"))return e.resolve().then(function(){if(!O.db||Y.name==="NotFoundError"&&!O.db.objectStoreNames.contains(O.storeName)&&O.version<=O.db.version)return O.db&&(O.version=O.db.version+1),Q(O)}).then(function(){return B(O).then(function(){R(O,z,L,U-1)})}).catch(L);L(Y)}}function V(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function G(O){var z=this,L={db:null};if(O)for(var U in O)L[U]=O[U];var W=g[L.name];W||(W=V(),g[L.name]=W),W.forages.push(z),z._initReady||(z._initReady=z.ready,z.ready=T);var Y=[];function at(){return e.resolve()}for(var pt=0;pt<W.forages.length;pt++){var gt=W.forages[pt];gt!==z&&Y.push(gt._initReady().catch(at))}var mt=W.forages.slice(0);return e.all(Y).then(function(){return L.db=W.db,J(L)}).then(function(bt){return L.db=bt,tt(L,z._defaultConfig.version)?Q(L):bt}).then(function(bt){L.db=W.db=bt,z._dbInfo=L;for(var St=0;St<mt.length;St++){var Dt=mt[St];Dt!==z&&(Dt._dbInfo.db=L.db,Dt._dbInfo.version=L.version)}})}function F(O,z){var L=this;O=o(O);var U=new e(function(W,Y){L.ready().then(function(){R(L._dbInfo,_,function(at,pt){if(at)return Y(at);try{var gt=pt.objectStore(L._dbInfo.storeName),mt=gt.get(O);mt.onsuccess=function(){var bt=mt.result;bt===void 0&&(bt=null),_t(bt)&&(bt=rt(bt)),W(bt)},mt.onerror=function(){Y(mt.error)}}catch(bt){Y(bt)}})}).catch(Y)});return r(U,z),U}function k(O,z){var L=this,U=new e(function(W,Y){L.ready().then(function(){R(L._dbInfo,_,function(at,pt){if(at)return Y(at);try{var gt=pt.objectStore(L._dbInfo.storeName),mt=gt.openCursor(),bt=1;mt.onsuccess=function(){var St=mt.result;if(St){var Dt=St.value;_t(Dt)&&(Dt=rt(Dt));var Lt=O(Dt,St.key,bt++);Lt!==void 0?W(Lt):St.continue()}else W()},mt.onerror=function(){Y(mt.error)}}catch(St){Y(St)}})}).catch(Y)});return r(U,z),U}function X(O,z,L){var U=this;O=o(O);var W=new e(function(Y,at){var pt;U.ready().then(function(){return pt=U._dbInfo,v.call(z)==="[object Blob]"?D(pt.db).then(function(gt){return gt?z:dt(z)}):z}).then(function(gt){R(U._dbInfo,w,function(mt,bt){if(mt)return at(mt);try{var St=bt.objectStore(U._dbInfo.storeName);gt===null&&(gt=void 0);var Dt=St.put(gt,O);bt.oncomplete=function(){gt===void 0&&(gt=null),Y(gt)},bt.onabort=bt.onerror=function(){var Lt=Dt.error?Dt.error:Dt.transaction.error;at(Lt)}}catch(Lt){at(Lt)}})}).catch(at)});return r(W,L),W}function Z(O,z){var L=this;O=o(O);var U=new e(function(W,Y){L.ready().then(function(){R(L._dbInfo,w,function(at,pt){if(at)return Y(at);try{var gt=pt.objectStore(L._dbInfo.storeName),mt=gt.delete(O);pt.oncomplete=function(){W()},pt.onerror=function(){Y(mt.error)},pt.onabort=function(){var bt=mt.error?mt.error:mt.transaction.error;Y(bt)}}catch(bt){Y(bt)}})}).catch(Y)});return r(U,z),U}function st(O){var z=this,L=new e(function(U,W){z.ready().then(function(){R(z._dbInfo,w,function(Y,at){if(Y)return W(Y);try{var pt=at.objectStore(z._dbInfo.storeName),gt=pt.clear();at.oncomplete=function(){U()},at.onabort=at.onerror=function(){var mt=gt.error?gt.error:gt.transaction.error;W(mt)}}catch(mt){W(mt)}})}).catch(W)});return r(L,O),L}function et(O){var z=this,L=new e(function(U,W){z.ready().then(function(){R(z._dbInfo,_,function(Y,at){if(Y)return W(Y);try{var pt=at.objectStore(z._dbInfo.storeName),gt=pt.count();gt.onsuccess=function(){U(gt.result)},gt.onerror=function(){W(gt.error)}}catch(mt){W(mt)}})}).catch(W)});return r(L,O),L}function lt(O,z){var L=this,U=new e(function(W,Y){if(O<0){W(null);return}L.ready().then(function(){R(L._dbInfo,_,function(at,pt){if(at)return Y(at);try{var gt=pt.objectStore(L._dbInfo.storeName),mt=!1,bt=gt.openKeyCursor();bt.onsuccess=function(){var St=bt.result;if(!St){W(null);return}O===0||mt?W(St.key):(mt=!0,St.advance(O))},bt.onerror=function(){Y(bt.error)}}catch(St){Y(St)}})}).catch(Y)});return r(U,z),U}function ft(O){var z=this,L=new e(function(U,W){z.ready().then(function(){R(z._dbInfo,_,function(Y,at){if(Y)return W(Y);try{var pt=at.objectStore(z._dbInfo.storeName),gt=pt.openKeyCursor(),mt=[];gt.onsuccess=function(){var bt=gt.result;if(!bt){U(mt);return}mt.push(bt.key),bt.continue()},gt.onerror=function(){W(gt.error)}}catch(bt){W(bt)}})}).catch(W)});return r(L,O),L}function yt(O,z){z=u.apply(this,arguments);var L=this.config();O=typeof O!="function"&&O||{},O.name||(O.name=O.name||L.name,O.storeName=O.storeName||L.storeName);var U=this,W;if(!O.name)W=e.reject("Invalid arguments");else{var Y=O.name===L.name&&U._dbInfo.db,at=Y?e.resolve(U._dbInfo.db):J(O).then(function(pt){var gt=g[O.name],mt=gt.forages;gt.db=pt;for(var bt=0;bt<mt.length;bt++)mt[bt]._dbInfo.db=pt;return pt});O.storeName?W=at.then(function(pt){if(!!pt.objectStoreNames.contains(O.storeName)){var gt=pt.version+1;I(O);var mt=g[O.name],bt=mt.forages;pt.close();for(var St=0;St<bt.length;St++){var Dt=bt[St];Dt._dbInfo.db=null,Dt._dbInfo.version=gt}var Lt=new e(function(Ft,Ut){var Yt=i.open(O.name,gt);Yt.onerror=function(Jt){var ce=Yt.result;ce.close(),Ut(Jt)},Yt.onupgradeneeded=function(){var Jt=Yt.result;Jt.deleteObjectStore(O.storeName)},Yt.onsuccess=function(){var Jt=Yt.result;Jt.close(),Ft(Jt)}});return Lt.then(function(Ft){mt.db=Ft;for(var Ut=0;Ut<bt.length;Ut++){var Yt=bt[Ut];Yt._dbInfo.db=Ft,N(Yt._dbInfo)}}).catch(function(Ft){throw(H(O,Ft)||e.resolve()).catch(function(){}),Ft})}}):W=at.then(function(pt){I(O);var gt=g[O.name],mt=gt.forages;pt.close();for(var bt=0;bt<mt.length;bt++){var St=mt[bt];St._dbInfo.db=null}var Dt=new e(function(Lt,Ft){var Ut=i.deleteDatabase(O.name);Ut.onerror=function(){var Yt=Ut.result;Yt&&Yt.close(),Ft(Ut.error)},Ut.onblocked=function(){console.warn('dropInstance blocked for database "'+O.name+'" until all open connections are closed')},Ut.onsuccess=function(){var Yt=Ut.result;Yt&&Yt.close(),Lt(Yt)}});return Dt.then(function(Lt){gt.db=Lt;for(var Ft=0;Ft<mt.length;Ft++){var Ut=mt[Ft];N(Ut._dbInfo)}}).catch(function(Lt){throw(H(O,Lt)||e.resolve()).catch(function(){}),Lt})})}return r(W,z),W}var it={_driver:"asyncStorage",_initStorage:G,_support:a(),iterate:k,getItem:F,setItem:X,removeItem:Z,clear:st,length:et,key:lt,keys:ft,dropInstance:yt};function q(){return typeof openDatabase=="function"}var ot="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ht="~~local_forage_type~",nt=/^~~local_forage_type~([^~]+)~/,ut="__lfsc__:",wt=ut.length,Pt="arbf",Ct="blob",ct="si08",xt="ui08",Tt="uic8",Mt="si16",jt="si32",At="ur16",Ht="ui32",Vt="fl32",Kt="fl64",$t=wt+Pt.length,qt=Object.prototype.toString;function Pe(O){var z=O.length*.75,L=O.length,U,W=0,Y,at,pt,gt;O[O.length-1]==="="&&(z--,O[O.length-2]==="="&&z--);var mt=new ArrayBuffer(z),bt=new Uint8Array(mt);for(U=0;U<L;U+=4)Y=ot.indexOf(O[U]),at=ot.indexOf(O[U+1]),pt=ot.indexOf(O[U+2]),gt=ot.indexOf(O[U+3]),bt[W++]=Y<<2|at>>4,bt[W++]=(at&15)<<4|pt>>2,bt[W++]=(pt&3)<<6|gt&63;return mt}function ae(O){var z=new Uint8Array(O),L="",U;for(U=0;U<z.length;U+=3)L+=ot[z[U]>>2],L+=ot[(z[U]&3)<<4|z[U+1]>>4],L+=ot[(z[U+1]&15)<<2|z[U+2]>>6],L+=ot[z[U+2]&63];return z.length%3===2?L=L.substring(0,L.length-1)+"=":z.length%3===1&&(L=L.substring(0,L.length-2)+"=="),L}function Te(O,z){var L="";if(O&&(L=qt.call(O)),O&&(L==="[object ArrayBuffer]"||O.buffer&&qt.call(O.buffer)==="[object ArrayBuffer]")){var U,W=ut;O instanceof ArrayBuffer?(U=O,W+=Pt):(U=O.buffer,L==="[object Int8Array]"?W+=ct:L==="[object Uint8Array]"?W+=xt:L==="[object Uint8ClampedArray]"?W+=Tt:L==="[object Int16Array]"?W+=Mt:L==="[object Uint16Array]"?W+=At:L==="[object Int32Array]"?W+=jt:L==="[object Uint32Array]"?W+=Ht:L==="[object Float32Array]"?W+=Vt:L==="[object Float64Array]"?W+=Kt:z(new Error("Failed to get type for BinaryArray"))),z(W+ae(U))}else if(L==="[object Blob]"){var Y=new FileReader;Y.onload=function(){var at=ht+O.type+"~"+ae(this.result);z(ut+Ct+at)},Y.readAsArrayBuffer(O)}else try{z(JSON.stringify(O))}catch(at){console.error("Couldn't convert value into a JSON string: ",O),z(null,at)}}function Qe(O){if(O.substring(0,wt)!==ut)return JSON.parse(O);var z=O.substring($t),L=O.substring(wt,$t),U;if(L===Ct&&nt.test(z)){var W=z.match(nt);U=W[1],z=z.substring(W[0].length)}var Y=Pe(z);switch(L){case Pt:return Y;case Ct:return l([Y],{type:U});case ct:return new Int8Array(Y);case xt:return new Uint8Array(Y);case Tt:return new Uint8ClampedArray(Y);case Mt:return new Int16Array(Y);case At:return new Uint16Array(Y);case jt:return new Int32Array(Y);case Ht:return new Uint32Array(Y);case Vt:return new Float32Array(Y);case Kt:return new Float64Array(Y);default:throw new Error("Unkown type: "+L)}}var ti={serialize:Te,deserialize:Qe,stringToBuffer:Pe,bufferToString:ae};function yi(O,z,L,U){O.executeSql("CREATE TABLE IF NOT EXISTS "+z.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],L,U)}function Xi(O){var z=this,L={db:null};if(O)for(var U in O)L[U]=typeof O[U]!="string"?O[U].toString():O[U];var W=new e(function(Y,at){try{L.db=openDatabase(L.name,String(L.version),L.description,L.size)}catch(pt){return at(pt)}L.db.transaction(function(pt){yi(pt,L,function(){z._dbInfo=L,Y()},function(gt,mt){at(mt)})},at)});return L.serializer=ti,W}function ee(O,z,L,U,W,Y){O.executeSql(L,U,W,function(at,pt){pt.code===pt.SYNTAX_ERR?at.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[z.storeName],function(gt,mt){mt.rows.length?Y(gt,pt):yi(gt,z,function(){gt.executeSql(L,U,W,Y)},Y)},Y):Y(at,pt)},Y)}function ei(O,z){var L=this;O=o(O);var U=new e(function(W,Y){L.ready().then(function(){var at=L._dbInfo;at.db.transaction(function(pt){ee(pt,at,"SELECT * FROM "+at.storeName+" WHERE key = ? LIMIT 1",[O],function(gt,mt){var bt=mt.rows.length?mt.rows.item(0).value:null;bt&&(bt=at.serializer.deserialize(bt)),W(bt)},function(gt,mt){Y(mt)})})}).catch(Y)});return r(U,z),U}function ie(O,z){var L=this,U=new e(function(W,Y){L.ready().then(function(){var at=L._dbInfo;at.db.transaction(function(pt){ee(pt,at,"SELECT * FROM "+at.storeName,[],function(gt,mt){for(var bt=mt.rows,St=bt.length,Dt=0;Dt<St;Dt++){var Lt=bt.item(Dt),Ft=Lt.value;if(Ft&&(Ft=at.serializer.deserialize(Ft)),Ft=O(Ft,Lt.key,Dt+1),Ft!==void 0){W(Ft);return}}W()},function(gt,mt){Y(mt)})})}).catch(Y)});return r(U,z),U}function Ve(O,z,L,U){var W=this;O=o(O);var Y=new e(function(at,pt){W.ready().then(function(){z===void 0&&(z=null);var gt=z,mt=W._dbInfo;mt.serializer.serialize(z,function(bt,St){St?pt(St):mt.db.transaction(function(Dt){ee(Dt,mt,"INSERT OR REPLACE INTO "+mt.storeName+" (key, value) VALUES (?, ?)",[O,bt],function(){at(gt)},function(Lt,Ft){pt(Ft)})},function(Dt){if(Dt.code===Dt.QUOTA_ERR){if(U>0){at(Ve.apply(W,[O,gt,L,U-1]));return}pt(Dt)}})})}).catch(pt)});return r(Y,L),Y}function le(O,z,L){return Ve.apply(this,[O,z,L,1])}function Ui(O,z){var L=this;O=o(O);var U=new e(function(W,Y){L.ready().then(function(){var at=L._dbInfo;at.db.transaction(function(pt){ee(pt,at,"DELETE FROM "+at.storeName+" WHERE key = ?",[O],function(){W()},function(gt,mt){Y(mt)})})}).catch(Y)});return r(U,z),U}function Oe(O){var z=this,L=new e(function(U,W){z.ready().then(function(){var Y=z._dbInfo;Y.db.transaction(function(at){ee(at,Y,"DELETE FROM "+Y.storeName,[],function(){U()},function(pt,gt){W(gt)})})}).catch(W)});return r(L,O),L}function Ci(O){var z=this,L=new e(function(U,W){z.ready().then(function(){var Y=z._dbInfo;Y.db.transaction(function(at){ee(at,Y,"SELECT COUNT(key) as c FROM "+Y.storeName,[],function(pt,gt){var mt=gt.rows.item(0).c;U(mt)},function(pt,gt){W(gt)})})}).catch(W)});return r(L,O),L}function Ne(O,z){var L=this,U=new e(function(W,Y){L.ready().then(function(){var at=L._dbInfo;at.db.transaction(function(pt){ee(pt,at,"SELECT key FROM "+at.storeName+" WHERE id = ? LIMIT 1",[O+1],function(gt,mt){var bt=mt.rows.length?mt.rows.item(0).key:null;W(bt)},function(gt,mt){Y(mt)})})}).catch(Y)});return r(U,z),U}function ii(O){var z=this,L=new e(function(U,W){z.ready().then(function(){var Y=z._dbInfo;Y.db.transaction(function(at){ee(at,Y,"SELECT key FROM "+Y.storeName,[],function(pt,gt){for(var mt=[],bt=0;bt<gt.rows.length;bt++)mt.push(gt.rows.item(bt).key);U(mt)},function(pt,gt){W(gt)})})}).catch(W)});return r(L,O),L}function ni(O){return new e(function(z,L){O.transaction(function(U){U.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(W,Y){for(var at=[],pt=0;pt<Y.rows.length;pt++)at.push(Y.rows.item(pt).name);z({db:O,storeNames:at})},function(W,Y){L(Y)})},function(U){L(U)})})}function Hi(O,z){z=u.apply(this,arguments);var L=this.config();O=typeof O!="function"&&O||{},O.name||(O.name=O.name||L.name,O.storeName=O.storeName||L.storeName);var U=this,W;return O.name?W=new e(function(Y){var at;O.name===L.name?at=U._dbInfo.db:at=openDatabase(O.name,"","",0),O.storeName?Y({db:at,storeNames:[O.storeName]}):Y(ni(at))}).then(function(Y){return new e(function(at,pt){Y.db.transaction(function(gt){function mt(Lt){return new e(function(Ft,Ut){gt.executeSql("DROP TABLE IF EXISTS "+Lt,[],function(){Ft()},function(Yt,Jt){Ut(Jt)})})}for(var bt=[],St=0,Dt=Y.storeNames.length;St<Dt;St++)bt.push(mt(Y.storeNames[St]));e.all(bt).then(function(){at()}).catch(function(Lt){pt(Lt)})},function(gt){pt(gt)})})}):W=e.reject("Invalid arguments"),r(W,z),W}var Wi={_driver:"webSQLStorage",_initStorage:Xi,_support:q(),iterate:ie,getItem:ei,setItem:le,removeItem:Ui,clear:Oe,length:Ci,key:Ne,keys:ii,dropInstance:Hi};function Gi(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function Si(O,z){var L=O.name+"/";return O.storeName!==z.storeName&&(L+=O.storeName+"/"),L}function ri(){var O="_localforage_support_test";try{return localStorage.setItem(O,!0),localStorage.removeItem(O),!1}catch{return!0}}function Ki(){return!ri()||localStorage.length>0}function qi(O){var z=this,L={};if(O)for(var U in O)L[U]=O[U];return L.keyPrefix=Si(O,z._defaultConfig),Ki()?(z._dbInfo=L,L.serializer=ti,e.resolve()):e.reject()}function De(O){var z=this,L=z.ready().then(function(){for(var U=z._dbInfo.keyPrefix,W=localStorage.length-1;W>=0;W--){var Y=localStorage.key(W);Y.indexOf(U)===0&&localStorage.removeItem(Y)}});return r(L,O),L}function xi(O,z){var L=this;O=o(O);var U=L.ready().then(function(){var W=L._dbInfo,Y=localStorage.getItem(W.keyPrefix+O);return Y&&(Y=W.serializer.deserialize(Y)),Y});return r(U,z),U}function $i(O,z){var L=this,U=L.ready().then(function(){for(var W=L._dbInfo,Y=W.keyPrefix,at=Y.length,pt=localStorage.length,gt=1,mt=0;mt<pt;mt++){var bt=localStorage.key(mt);if(bt.indexOf(Y)===0){var St=localStorage.getItem(bt);if(St&&(St=W.serializer.deserialize(St)),St=O(St,bt.substring(at),gt++),St!==void 0)return St}}});return r(U,z),U}function si(O,z){var L=this,U=L.ready().then(function(){var W=L._dbInfo,Y;try{Y=localStorage.key(O)}catch{Y=null}return Y&&(Y=Y.substring(W.keyPrefix.length)),Y});return r(U,z),U}function Zi(O){var z=this,L=z.ready().then(function(){for(var U=z._dbInfo,W=localStorage.length,Y=[],at=0;at<W;at++){var pt=localStorage.key(at);pt.indexOf(U.keyPrefix)===0&&Y.push(pt.substring(U.keyPrefix.length))}return Y});return r(L,O),L}function ge(O){var z=this,L=z.keys().then(function(U){return U.length});return r(L,O),L}function Ei(O,z){var L=this;O=o(O);var U=L.ready().then(function(){var W=L._dbInfo;localStorage.removeItem(W.keyPrefix+O)});return r(U,z),U}function Pi(O,z,L){var U=this;O=o(O);var W=U.ready().then(function(){z===void 0&&(z=null);var Y=z;return new e(function(at,pt){var gt=U._dbInfo;gt.serializer.serialize(z,function(mt,bt){if(bt)pt(bt);else try{localStorage.setItem(gt.keyPrefix+O,mt),at(Y)}catch(St){(St.name==="QuotaExceededError"||St.name==="NS_ERROR_DOM_QUOTA_REACHED")&&pt(St),pt(St)}})})});return r(W,L),W}function Ji(O,z){if(z=u.apply(this,arguments),O=typeof O!="function"&&O||{},!O.name){var L=this.config();O.name=O.name||L.name,O.storeName=O.storeName||L.storeName}var U=this,W;return O.name?W=new e(function(Y){O.storeName?Y(Si(O,U._defaultConfig)):Y(O.name+"/")}).then(function(Y){for(var at=localStorage.length-1;at>=0;at--){var pt=localStorage.key(at);pt.indexOf(Y)===0&&localStorage.removeItem(pt)}}):W=e.reject("Invalid arguments"),r(W,z),W}var Ti={_driver:"localStorageWrapper",_initStorage:qi,_support:Gi(),iterate:$i,getItem:xi,setItem:Pi,removeItem:Ei,clear:De,length:ge,key:si,keys:Zi,dropInstance:Ji},Qi=function(z,L){return z===L||typeof z=="number"&&typeof L=="number"&&isNaN(z)&&isNaN(L)},tn=function(z,L){for(var U=z.length,W=0;W<U;){if(Qi(z[W],L))return!0;W++}return!1},oi=Array.isArray||function(O){return Object.prototype.toString.call(O)==="[object Array]"},Zt={},ve={},me={INDEXEDDB:it,WEBSQL:Wi,LOCALSTORAGE:Ti},en=[me.INDEXEDDB._driver,me.WEBSQL._driver,me.LOCALSTORAGE._driver],Me=["dropInstance"],ze=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Me),Oi={description:"",driver:en.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Di(O,z){O[z]=function(){var L=arguments;return O.ready().then(function(){return O[z].apply(O,L)})}}function ai(){for(var O=1;O<arguments.length;O++){var z=arguments[O];if(z)for(var L in z)z.hasOwnProperty(L)&&(oi(z[L])?arguments[0][L]=z[L].slice():arguments[0][L]=z[L])}return arguments[0]}var Ye=function(){function O(z){M(this,O);for(var L in me)if(me.hasOwnProperty(L)){var U=me[L],W=U._driver;this[L]=W,Zt[W]||this.defineDriver(U)}this._defaultConfig=ai({},Oi),this._config=ai({},this._defaultConfig,z),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return O.prototype.config=function(L){if((typeof L>"u"?"undefined":E(L))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var U in L){if(U==="storeName"&&(L[U]=L[U].replace(/\W/g,"_")),U==="version"&&typeof L[U]!="number")return new Error("Database version must be a number.");this._config[U]=L[U]}return"driver"in L&&L.driver?this.setDriver(this._config.driver):!0}else return typeof L=="string"?this._config[L]:this._config},O.prototype.defineDriver=function(L,U,W){var Y=new e(function(at,pt){try{var gt=L._driver,mt=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!L._driver){pt(mt);return}for(var bt=ze.concat("_initStorage"),St=0,Dt=bt.length;St<Dt;St++){var Lt=bt[St],Ft=!tn(Me,Lt);if((Ft||L[Lt])&&typeof L[Lt]!="function"){pt(mt);return}}var Ut=function(){for(var ce=function(rn){return function(){var sn=new Error("Method "+rn+" is not implemented by the current driver"),Ai=e.reject(sn);return r(Ai,arguments[arguments.length-1]),Ai}},li=0,Mi=Me.length;li<Mi;li++){var Xe=Me[li];L[Xe]||(L[Xe]=ce(Xe))}};Ut();var Yt=function(ce){Zt[gt]&&console.info("Redefining LocalForage driver: "+gt),Zt[gt]=L,ve[gt]=ce,at()};"_support"in L?L._support&&typeof L._support=="function"?L._support().then(Yt,pt):Yt(!!L._support):Yt(!0)}catch(Jt){pt(Jt)}});return n(Y,U,W),Y},O.prototype.driver=function(){return this._driver||null},O.prototype.getDriver=function(L,U,W){var Y=Zt[L]?e.resolve(Zt[L]):e.reject(new Error("Driver not found."));return n(Y,U,W),Y},O.prototype.getSerializer=function(L){var U=e.resolve(ti);return n(U,L),U},O.prototype.ready=function(L){var U=this,W=U._driverSet.then(function(){return U._ready===null&&(U._ready=U._initDriver()),U._ready});return n(W,L,L),W},O.prototype.setDriver=function(L,U,W){var Y=this;oi(L)||(L=[L]);var at=this._getSupportedDrivers(L);function pt(){Y._config.driver=Y.driver()}function gt(St){return Y._extend(St),pt(),Y._ready=Y._initStorage(Y._config),Y._ready}function mt(St){return function(){var Dt=0;function Lt(){for(;Dt<St.length;){var Ft=St[Dt];return Dt++,Y._dbInfo=null,Y._ready=null,Y.getDriver(Ft).then(gt).catch(Lt)}pt();var Ut=new Error("No available storage method found.");return Y._driverSet=e.reject(Ut),Y._driverSet}return Lt()}}var bt=this._driverSet!==null?this._driverSet.catch(function(){return e.resolve()}):e.resolve();return this._driverSet=bt.then(function(){var St=at[0];return Y._dbInfo=null,Y._ready=null,Y.getDriver(St).then(function(Dt){Y._driver=Dt._driver,pt(),Y._wrapLibraryMethodsWithReady(),Y._initDriver=mt(at)})}).catch(function(){pt();var St=new Error("No available storage method found.");return Y._driverSet=e.reject(St),Y._driverSet}),n(this._driverSet,U,W),this._driverSet},O.prototype.supports=function(L){return!!ve[L]},O.prototype._extend=function(L){ai(this,L)},O.prototype._getSupportedDrivers=function(L){for(var U=[],W=0,Y=L.length;W<Y;W++){var at=L[W];this.supports(at)&&U.push(at)}return U},O.prototype._wrapLibraryMethodsWithReady=function(){for(var L=0,U=ze.length;L<U;L++)Di(this,ze[L])},O.prototype.createInstance=function(L){return new O(L)},O}(),nn=new Ye;b.exports=nn},{3:3}]},{},[4])(4)})})(Yr);const dl=Yr.exports,jr=dl.createInstance({name:"zo@images_data_test"});class fl{constructor(p,y){const b=this;b._opt=Object.assign({},{loaderDefault:null},y),b._settings=Bt,b._el_container=p,b.init().catch(console.error)}async init(){const p=this;p._store=jr,p.build(),p.initListener(),await p.initImages()}async length(){return await this._store.length()}addImageList(p){const y=this,b=document.createDocumentFragment();for(const S of p){const E=y.buildImagePreview(S,100,100);E&&b.appendChild(E)}y._el_gallery.appendChild(b),y.initSortable()}async removeImage(p){const y=this;document.getElementById(p).remove(),await y._store.removeItem(p),await te.removeObject(p)}async getItem(p){return await this._store.getItem(p)}async updateItem(p,y){const b=this,S=await b.getItem(p);S&&(Object.assign(S,{},y),await b._store.setItem(p,S)),console.log("Saved item id")}getIdOrder(){const p=this,y=[],b=p._el_gallery.querySelectorAll(".zo--image-container");for(const S of b)y.push(S.id);return y}async getItems(p){const y=this,b=[],S=y.getIdOrder();if(!S.length||!p)await y._store.iterate(E=>{b.push(E)});else for(const E of S){const M=await y._store.getItem(E);b.push(M)}return b}build(){const p=this;p._el_gallery=Ee("div",{class:"zo--images-gallery"}),p._el_container.appendChild(p._el_gallery)}async initImages(){const p=this;try{p.busyGallery(!0,"restoring"),await p._store.length()===0?await p.importFromDefault():await p.importFromStore(),await te.addImagesFromStore()}catch(y){console.error(y)}finally{p.busyGallery(!1)}}initListener(){const p=this,y=["dragenter","dragover","dragleave","drop"];for(const b of y)window.addEventListener(b,gl,!1);p._el_gallery.addEventListener("drop",p.handleDropImages.bind(p))}busyGallery(p,y){const b=this;p?b._el_gallery.classList.add("busy"):b._el_gallery.classList.remove("busy"),b._el_gallery.dataset.message=y}async handleDropImages(p){const y=this;try{const b=p.dataTransfer.files;if(!b)return;const S=[],E=b.length;let M=1;for(const d of b)if(y.busyGallery(!0,`Importing image ${M++}/${E}`),!pl(d.name))alert(`Image name not valid : ${d.name}. Format: 001.png -> 999.png. This limitation will be removed later.`);else{const i=await y.fileToImgObj(d);S.push(i)}y.addImageList(S),await y.saveImages(S),await te.addImagesFromStore()}catch(b){console.error(b)}finally{y.busyGallery(!1)}}async importFromStore(){const p=this,y=[],b=await p._store.length();await p._store.iterate((S,E,M)=>{p.busyGallery(!0,`Restoring image ${M}/${b}`),y.push(S)}),p.addImageList(y)}async importFromDefault(){const p=this;if(confirm("Empty project. Download default project ?")){const b=await p._opt.loaderDefault();p.addImageList(b),await p.saveImages(b)}}async fileToImgObj(p){const y=this,b=await vl(p),S=await y.getImageSrcSize(b);return{src:b,id:p.name,w:S.width,h:S.height,x:Bt.width/2-S.width/2,y:Bt.height/2-S.height/2,s:1,t:null}}async getImageSrcSize(p){return new Promise(y=>{const b=new Image;b.src=p,b.onload=()=>{y({width:b.width,height:b.height})}})}async getStats(){const y=await this.getItems(!1),b={n:y.length,minWidth:1,maxWidth:1,minHeight:1,maxHeight:1,minScale:1,maxScale:1,minTop:0,maxTop:0,minLeft:0,maxLeft:0,center:{x:0,y:0},nMissingConf:y.length-1};let S=!0,E,M,d;for(const i of y){if(M=i.h*i.s,d=i.w*i.s,S){S=!1,b.maxScale=i.s,b.minScale=i.s,b.minHeight=M,b.maxHeight=M,b.minWidth=d,b.maxWidth=d,b.minLeft=i.x,b.maxLeft=i.x,b.minTop=i.y,b.maxTop=i.y,E=i;continue}i.t>0&&b.nMissingConf--,i.s>b.maxScale&&(b.maxScale=i.s),i.s<b.minScale&&(b.minScale=i.s),M<b.minHeight&&(b.minHeight=M),M>b.maxHeight&&(b.maxHeight=M),d<b.minWidth&&(b.minWidth=d),d>b.maxWidth&&(b.maxWidth=d,E=i),i.x<b.minLeft&&(b.minLeft=i.x),i.x>b.maxLeft&&(b.maxLeft=i.x),i.y<b.minTop&&(b.minTop=i.y),i.y>b.maxTop&&(b.maxTop=i.y)}return E&&(b.center.x=Bt.width-Bt.offset.x-(E.x+E.w*E.s)/E.s,b.center.y=Bt.height+Bt.offset.y-(E.y+E.h*E.s)/E.s),b}buildImagePreview(p,y,b){const S=this,E=document.getElementById(p.id);if(E){E.querySelector("img").setAttribute("src",p.src);return}const M=Ee("img",{title:p.id,width:y,height:b,src:p.src,style:{display:"block"},on:["click",()=>{te.zoomToObjectId(p.id)}]}),d=Ee("button",{class:"zo--btn zo--btn-circle-small",title:"remove",on:["click",()=>{S.removeImage(p.id).catch(console.errror)}]},"\u292B");return Ee("div",{id:p.id,class:"zo--image-container"},[d,M])}async saveImages(p){const y=this;for(const b of p)await y._store.setItem(b.id,b)}initSortable(){const p=this;p._images_sortable||(p._images_sortable=new Fn.exports.Swappable(p._el_gallery,{draggable:".zo--image-container",delay:300,mirror:{constrainDimensions:!0},plugins:[Fn.exports.Plugins.ResizeMirror]}),p._images_sortable.on("swappable:swapped",async()=>{const y=await p.getItems();console.log(y)}))}async export(){const p=[];await jr.iterate(y=>{p.push(y)}),console.log(p)}import(p){console.log(p)}}function pl(A){return/^[0-9]{3,4}\.(jpe?g|png|gif)$/i.test(A)}function gl(A){A.preventDefault(),A.stopPropagation()}async function vl(A){return new Promise(p=>{const y=new FileReader;y.addEventListener("load",()=>{p(y.result)},!1),y.readAsDataURL(A)})}const ml="modulepreload",_l=function(A){return"/zoomoot/"+A},Vr={},zt=function(p,y,b){return!y||y.length===0?p():Promise.all(y.map(S=>{if(S=_l(S),S in Vr)return;Vr[S]=!0;const E=S.endsWith(".css"),M=E?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${M}`))return;const d=document.createElement("link");if(d.rel=E?"stylesheet":ml,E||(d.as="script",d.crossOrigin=""),d.href=S,document.head.appendChild(d),E)return new Promise((i,a)=>{d.addEventListener("load",i),d.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${S}`)))})})).then(()=>p())},bl=[zt(()=>import("./001.png.818bdfea.js"),[]),zt(()=>import("./002.png.c922b38f.js"),[]),zt(()=>import("./003.png.1fde8666.js"),[]),zt(()=>import("./004.png.f0080df2.js"),[]),zt(()=>import("./005.png.2d48ba06.js"),[]),zt(()=>import("./006.png.3b570246.js"),[]),zt(()=>import("./007.png.c3109916.js"),[]),zt(()=>import("./008.png.af1cd66d.js"),[]),zt(()=>import("./009.png.1d9aefed.js"),[]),zt(()=>import("./010.png.a4a93296.js"),[]),zt(()=>import("./011.png.166ce96e.js"),[]),zt(()=>import("./012.png.ecd429d2.js"),[]),zt(()=>import("./013.png.0ef2b36c.js"),[]),zt(()=>import("./014.png.283bb52b.js"),[]),zt(()=>import("./015.png.314b970e.js"),[]),zt(()=>import("./016.png.3a74e8ab.js"),[]),zt(()=>import("./017.png.3af1a3bc.js"),[]),zt(()=>import("./018.png.e500f253.js"),[]),zt(()=>import("./019.png.1dda7445.js"),[]),zt(()=>import("./020.png.b106d11d.js"),[]),zt(()=>import("./021.png.4779c1cc.js"),[]),zt(()=>import("./022.png.6dc35188.js"),[]),zt(()=>import("./023.png.0464b27b.js"),[]),zt(()=>import("./024.png.9c390849.js"),[]),zt(()=>import("./025.png.f5433c93.js"),[])];async function wl(){const A=[],p=await Promise.all(bl);for(const y of p)A.push(y.default);return A}const yl=document.getElementById("app"),Xr=Ee("div",{class:"zo--row"}),Ur=Ee("div",{class:"zo--row"}),Cl=Ee("div",{class:["zo--container","dark"]},[Ur,Xr]);yl.appendChild(Cl);const Hr=new fl(Xr,{loaderDefault:wl}),te=new ll(Ur);window.zo={editor:te,images:Hr};
